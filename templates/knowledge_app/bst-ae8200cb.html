{% extends 'knowledge_app/base.html' %}

{% block title %}{{ page_title|default:"äºŒå‰æœç´¢æ ‘(BST)" }} - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<div class="page-container fade-in">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a>
        <span>></span>
        <span>{{ breadcrumb_category|default:"æ•°æ®ç»“æ„" }}</span>
        <span>></span>
        <span>{{ page_title|default:"äºŒå‰æœç´¢æ ‘(BST)" }}</span>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header slide-in-left">
        <h1>
            <span class="page-icon">{{ page_icon|default:"ğŸŒ³" }}</span>
            {{ page_title|default:"äºŒå‰æœç´¢æ ‘(BST)" }}
        </h1>
        <p>{{ page_description|default:"æŒæ¡æœ€é‡è¦çš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œç†è§£æœç´¢ã€æ’å…¥ã€åˆ é™¤çš„é«˜æ•ˆå®ç°" }}</p>
    </div>

    <!-- ğŸ“‹ çŸ¥è¯†ç‚¹æ¦‚è¿° -->
    <div class="content-card slide-in-right">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“‹</span>
                çŸ¥è¯†ç‚¹æ¦‚è¿°
            </h2>
            <div class="overview-content">
                <div class="concept-intro">
                    <p><strong>æ ¸å¿ƒæ¦‚å¿µï¼š</strong>äºŒå‰æœç´¢æ ‘æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œå°±åƒä¸€ä¸ªæ™ºèƒ½çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿï¼Œå·¦è¾¹æ”¾è¾ƒå°çš„æ•°ï¼Œå³è¾¹æ”¾è¾ƒå¤§çš„æ•°ï¼Œè®©æŸ¥æ‰¾å˜å¾—è¶…çº§å¿«ï¼</p>
                </div>

                <div class="unified-grid unified-grid-2">
                    <div class="info-box info-box-info">
                        <h3>ğŸ·ï¸ å…³é”®æœ¯è¯­</h3>
                        <ul>
                            <li><strong>èŠ‚ç‚¹(Node)ï¼š</strong>å­˜å‚¨æ•°æ®çš„åŸºæœ¬å•å…ƒ</li>
                            <li><strong>æ ¹èŠ‚ç‚¹(Root)ï¼š</strong>æ ‘çš„é¡¶ç‚¹ï¼Œæ²¡æœ‰çˆ¶èŠ‚ç‚¹</li>
                            <li><strong>å¶å­èŠ‚ç‚¹(Leaf)ï¼š</strong>æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</li>
                            <li><strong>ä¸­åºéå†ï¼š</strong>æŒ‰å‡åºè¾“å‡ºæ‰€æœ‰èŠ‚ç‚¹</li>
                            <li><strong>å¹³è¡¡æ€§ï¼š</strong>å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1</li>
                        </ul>
                    </div>

                    <div class="info-box info-box-success">
                        <h3>ğŸ“Š å­¦ä¹ æŒ‡æ ‡</h3>
                        <p><strong>éš¾åº¦ç­‰çº§ï¼š</strong> <span class="badge badge-medium">è¿›é˜¶</span></p>
                        <p><strong>å‰ç½®çŸ¥è¯†ï¼š</strong></p>
                        <ul>
                            <li>é€’å½’æ€æƒ³ âœ“</li>
                            <li>äºŒå‰æ ‘åŸºç¡€ âœ“</li>
                            <li>æŒ‡é’ˆ/å¼•ç”¨æ¦‚å¿µ âœ“</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ” æ¦‚å¿µè¯¦è§£ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ”</span>
                æ¦‚å¿µè¯¦è§£
            </h2>

            <div class="concept-details">
                <div class="concept-item">
                    <h3>ğŸ—ï¸ BSTçš„æ ¸å¿ƒæ€§è´¨</h3>
                    <p>æƒ³è±¡ä¸€ä¸ªæ™ºèƒ½å›¾ä¹¦é¦†ï¼š</p>
                    <ul>
                        <li>æ¯ä¸ªä¹¦æ¶(èŠ‚ç‚¹)åªèƒ½æ”¾ä¸€æœ¬ç‰¹å®šç¼–å·çš„ä¹¦</li>
                        <li>ç¼–å·å°çš„ä¹¦æ°¸è¿œåœ¨å·¦è¾¹çš„ä¹¦æ¶</li>
                        <li>ç¼–å·å¤§çš„ä¹¦æ°¸è¿œåœ¨å³è¾¹çš„ä¹¦æ¶</li>
                        <li>æ‰¾ä¹¦æ—¶ï¼Œåªéœ€è¦æ¯”è¾ƒç¼–å·å°±çŸ¥é“å¾€å“ªè¾¹èµ°ï¼</li>
                    </ul>
                </div>

                <div class="concept-item">
                    <h3>ğŸ”„ ä¸‰å¤§åŸºæœ¬æ“ä½œ</h3>
                    <div class="operations-grid">
                        <div class="operation-card">
                            <span class="op-icon">ğŸ”</span>
                            <h4>æŸ¥æ‰¾(Search)</h4>
                            <p>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œå°äº†å¾€å·¦ï¼Œå¤§äº†å¾€å³ï¼Œç›¸ç­‰å°±æ‰¾åˆ°äº†ï¼</p>
                        </div>
                        <div class="operation-card">
                            <span class="op-icon">â•</span>
                            <h4>æ’å…¥(Insert)</h4>
                            <p>æ‰¾åˆ°åˆé€‚ä½ç½®(å¶å­èŠ‚ç‚¹)ï¼ŒæŒ‰ç…§BSTæ€§è´¨æ”¾å…¥æ–°èŠ‚ç‚¹</p>
                        </div>
                        <div class="operation-card">
                            <span class="op-icon">ğŸ—‘ï¸</span>
                            <h4>åˆ é™¤(Delete)</h4>
                            <p>æœ€å¤æ‚çš„æ“ä½œï¼Œéœ€è¦è€ƒè™‘0ä¸ªã€1ä¸ªã€2ä¸ªå­èŠ‚ç‚¹çš„æƒ…å†µ</p>
                        </div>
                    </div>
                </div>

                <div class="concept-item">
                    <h3>âš ï¸ å®¹æ˜“æ··æ·†çš„æ¦‚å¿µ</h3>
                    <div class="comparison-table">
                        <table>
                            <tr>
                                <th>æ¦‚å¿µ</th>
                                <th>BST</th>
                                <th>æ™®é€šäºŒå‰æ ‘</th>
                            </tr>
                            <tr>
                                <td>èŠ‚ç‚¹æ’åˆ—</td>
                                <td>æœ‰åº(å·¦å°å³å¤§)</td>
                                <td>æ— åº</td>
                            </tr>
                            <tr>
                                <td>æŸ¥æ‰¾æ•ˆç‡</td>
                                <td>O(log n) æœ€å¥½</td>
                                <td>O(n)</td>
                            </tr>
                            <tr>
                                <td>ä¸­åºéå†</td>
                                <td>å‡åºè¾“å‡º</td>
                                <td>æ— åºè¾“å‡º</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“Š å¯è§†åŒ–å±•ç¤º -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“Š</span>
                å¯è§†åŒ–å±•ç¤º
            </h2>

            <!-- é™æ€ç»“æ„å›¾ -->
            <div class="visualization-container">
                <h3>ğŸ›ï¸ BSTåŸºæœ¬ç»“æ„</h3>
                <div class="static-diagram">
                    <svg width="100%" height="300" viewBox="0 0 800 300">
                        <!-- èŠ‚ç‚¹ -->
                        <circle cx="400" cy="50" r="25" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
                        <text x="400" y="55" text-anchor="middle" fill="white" font-weight="bold">50</text>

                        <circle cx="250" cy="130" r="25" fill="#2196F3" stroke="#1976D2" stroke-width="2"/>
                        <text x="250" y="135" text-anchor="middle" fill="white" font-weight="bold">30</text>

                        <circle cx="550" cy="130" r="25" fill="#2196F3" stroke="#1976D2" stroke-width="2"/>
                        <text x="550" y="135" text-anchor="middle" fill="white" font-weight="bold">70</text>

                        <circle cx="150" cy="210" r="25" fill="#FF9800" stroke="#F57C00" stroke-width="2"/>
                        <text x="150" y="215" text-anchor="middle" fill="white" font-weight="bold">20</text>

                        <circle cx="350" cy="210" r="25" fill="#FF9800" stroke="#F57C00" stroke-width="2"/>
                        <text x="350" y="215" text-anchor="middle" fill="white" font-weight="bold">40</text>

                        <circle cx="650" cy="210" r="25" fill="#FF9800" stroke="#F57C00" stroke-width="2"/>
                        <text x="650" y="215" text-anchor="middle" fill="white" font-weight="bold">80</text>

                        <!-- è¿çº¿ -->
                        <line x1="380" y1="65" x2="270" y2="115" stroke="#666" stroke-width="2"/>
                        <line x1="420" y1="65" x2="530" y2="115" stroke="#666" stroke-width="2"/>
                        <line x1="230" y1="145" x2="170" y2="195" stroke="#666" stroke-width="2"/>
                        <line x1="270" y1="145" x2="330" y2="195" stroke="#666" stroke-width="2"/>
                        <line x1="570" y1="145" x2="630" y2="195" stroke="#666" stroke-width="2"/>

                        <!-- æ ‡æ³¨ -->
                        <text x="400" y="20" text-anchor="middle" font-size="14" fill="#2E7D32">æ ¹èŠ‚ç‚¹</text>
                        <text x="100" y="250" text-anchor="middle" font-size="12" fill="#F57C00">å¶å­èŠ‚ç‚¹</text>
                        <text x="80" y="130" text-anchor="middle" font-size="12" fill="#1976D2">å·¦å­æ ‘ &lt; 50</text>
                        <text x="720" y="130" text-anchor="middle" font-size="12" fill="#1976D2">å³å­æ ‘ &gt; 50</text>
                    </svg>
                </div>

                <!-- åŠ¨æ€æ“ä½œæ¼”ç¤º -->
                <h3>ğŸ¬ åŠ¨æ€æ“ä½œæ¼”ç¤º</h3>
                <div class="animation-controls">
                    <div class="control-panel">
                        <button id="insertBtn" class="unified-btn unified-btn-primary">æ’å…¥èŠ‚ç‚¹</button>
                        <button id="searchBtn" class="unified-btn unified-btn-secondary">æŸ¥æ‰¾èŠ‚ç‚¹</button>
                        <button id="deleteBtn" class="unified-btn unified-btn-warning">åˆ é™¤èŠ‚ç‚¹</button>
                        <input type="number" id="nodeValue" placeholder="è¾“å…¥æ•°å€¼" min="1" max="100">
                        <button id="resetBtn" class="unified-btn">é‡ç½®</button>
                    </div>
                    <div class="step-info" id="stepInfo">ç‚¹å‡»æ“ä½œæŒ‰é’®å¼€å§‹æ¼”ç¤º</div>
                </div>

                <div class="canvas-container">
                    <canvas id="bstCanvas" width="800" height="400"></canvas>
                </div>

                <!-- åˆ é™¤æ“ä½œè¯¦è§£ -->
                <div class="delete-explanation">
                    <h3>ğŸ” åˆ é™¤æ“ä½œè¯¦è§£</h3>
                    <div class="delete-cases">
                        <div class="case-card">
                            <h4>æ¡ˆä¾‹1: åˆ é™¤å¶å­èŠ‚ç‚¹</h4>
                            <p><strong>ä¾‹å¦‚åˆ é™¤èŠ‚ç‚¹20ï¼š</strong></p>
                            <p>ç›´æ¥ç§»é™¤èŠ‚ç‚¹20ï¼Œä¸å½±å“å…¶ä»–èŠ‚ç‚¹ã€‚æœ€ç®€å•çš„æƒ…å†µã€‚</p>
                        </div>

                        <div class="case-card">
                            <h4>æ¡ˆä¾‹2: åˆ é™¤åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹</h4>
                            <p><strong>ä¾‹å¦‚åˆ é™¤èŠ‚ç‚¹30ï¼ˆåªæœ‰å·¦å­èŠ‚ç‚¹20ï¼‰ï¼š</strong></p>
                            <p>ç”¨èŠ‚ç‚¹20æ›¿ä»£èŠ‚ç‚¹30çš„ä½ç½®ï¼Œä¿æŒçˆ¶å­å…³ç³»ä¸å˜ã€‚</p>
                        </div>

                        <div class="case-card complex">
                            <h4>æ¡ˆä¾‹3: åˆ é™¤æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹ â­</h4>
                            <p><strong>ä¾‹å¦‚åˆ é™¤æ ¹èŠ‚ç‚¹50ï¼š</strong></p>
                            <ol style="font-size: 14px; margin: 10px 0;">
                                <li>åœ¨å³å­æ ‘(70)ä¸­æ‰¾æœ€å°å€¼ â†’ æ‰¾åˆ°60</li>
                                <li>ç”¨60æ›¿æ¢50çš„ä½ç½®</li>
                                <li>åˆ é™¤åŸæ¥ä½ç½®çš„60ï¼ˆæ­¤æ—¶60æœ€å¤šåªæœ‰å³å­èŠ‚ç‚¹ï¼‰</li>
                                <li>ç»“æœï¼šæ–°çš„æ ¹èŠ‚ç‚¹å˜æˆ60ï¼ŒBSTæ€§è´¨ä¿æŒ</li>
                            </ol>
                            <div style="background: #e8f5e8; padding: 10px; margin-top: 10px; border-radius: 4px; font-size: 13px;">
                                <strong>ğŸ¤” ä¸ºä»€ä¹ˆé€‰æ‹©ä¸­åºåç»§ï¼Ÿ</strong><br>
                                å› ä¸ºå®ƒæ˜¯æ¯”åˆ é™¤èŠ‚ç‚¹å¤§çš„æœ€å°å€¼ï¼Œæ”¾åœ¨åˆ é™¤èŠ‚ç‚¹ä½ç½®åèƒ½ä¿è¯å·¦è¾¹éƒ½å°äºå®ƒï¼Œå³è¾¹éƒ½å¤§äºå®ƒï¼
                            </div>
                        </div>
                    </div>
                </div>
                <div class="operation-steps">
                    <div class="step-card">
                        <h4>ğŸ” æŸ¥æ‰¾æ­¥éª¤</h4>
                        <ol>
                            <li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹æ¯”è¾ƒ</li>
                            <li>ç›®æ ‡å€¼ < å½“å‰èŠ‚ç‚¹ â†’ å¾€å·¦å­æ ‘</li>
                            <li>ç›®æ ‡å€¼ > å½“å‰èŠ‚ç‚¹ â†’ å¾€å³å­æ ‘</li>
                            <li>ç›¸ç­‰ â†’ æ‰¾åˆ°ï¼</li>
                            <li>åˆ°è¾¾ç©ºèŠ‚ç‚¹ â†’ ä¸å­˜åœ¨</li>
                        </ol>
                    </div>

                    <div class="step-card">
                        <h4>â• æ’å…¥æ­¥éª¤</h4>
                        <ol>
                            <li>åƒæŸ¥æ‰¾ä¸€æ ·æ‰¾åˆ°æ’å…¥ä½ç½®</li>
                            <li>åœ¨ç©ºèŠ‚ç‚¹ä½ç½®åˆ›å»ºæ–°èŠ‚ç‚¹</li>
                            <li>è¿æ¥åˆ°çˆ¶èŠ‚ç‚¹</li>
                            <li>ä¿æŒBSTæ€§è´¨ä¸å˜</li>
                        </ol>
                    </div>

                    <div class="step-card">
                        <h4>ğŸ—‘ï¸ åˆ é™¤æ­¥éª¤</h4>
                        <ol>
                            <li><strong>æƒ…å†µ1 - å¶å­èŠ‚ç‚¹ï¼š</strong>ç›´æ¥åˆ é™¤</li>
                            <li><strong>æƒ…å†µ2 - ä¸€ä¸ªå­èŠ‚ç‚¹ï¼š</strong>å­èŠ‚ç‚¹æ›¿ä»£çˆ¶èŠ‚ç‚¹</li>
                            <li><strong>æƒ…å†µ3 - ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼š</strong>
                                <ul style="margin: 5px 0 5px 20px; font-size: 14px;">
                                    <li>â‘  æ‰¾åˆ°å³å­æ ‘æœ€å°å€¼ï¼ˆä¸­åºåç»§ï¼‰</li>
                                    <li>â‘¡ ç”¨åç»§å€¼æ›¿æ¢åˆ é™¤èŠ‚ç‚¹</li>
                                    <li>â‘¢ é€’å½’åˆ é™¤åŸåç»§èŠ‚ç‚¹</li>
                                </ul>
                            </li>
                            <li>ä¿æŒBSTæ€§è´¨ä¸å˜</li>
                        </ol>
                        <div style="background: #fff3cd; padding: 10px; margin-top: 10px; border-radius: 4px; font-size: 13px;">
                            <strong>ğŸ’¡ æç¤ºï¼š</strong>åˆ é™¤ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æƒ…å†µæœ€å¤æ‚ï¼Œéœ€è¦ç”¨ä¸­åºåç»§ä¿è¯åˆ é™¤åä»æ»¡è¶³BSTæ€§è´¨ï¼
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸŒŸ å®é™…åº”ç”¨ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸŒŸ</span>
                å®é™…åº”ç”¨
            </h2>

            <div class="applications">
                <div class="application-item">
                    <h3>ğŸ’¾ æ•°æ®åº“ç´¢å¼•</h3>
                    <p>æ•°æ®åº“ä½¿ç”¨BST(ç‰¹åˆ«æ˜¯B+æ ‘)æ¥å¿«é€ŸæŸ¥æ‰¾è®°å½•ï¼Œå°±åƒå›¾ä¹¦é¦†çš„ç´¢å¼•ç³»ç»Ÿï¼</p>
                </div>

                <div class="application-item">
                    <h3>ğŸ” æœç´¢å¼•æ“</h3>
                    <p>æœç´¢å¼•æ“ç”¨BSTå­˜å‚¨ç½‘é¡µå…³é”®è¯ï¼Œå®ç°æ¯«ç§’çº§çš„æœç´¢å“åº”ã€‚</p>
                </div>

                <div class="application-item">
                    <h3>ğŸ¯ è¡¨è¾¾å¼è§£æ</h3>
                    <p>ç¼–è¯‘å™¨ä½¿ç”¨BSTæ„å»ºè¯­æ³•æ ‘ï¼Œå°†ä»£ç è½¬æ¢ä¸ºæœºå™¨èƒ½ç†è§£çš„æŒ‡ä»¤ã€‚</p>
                </div>
            </div>

            <!-- ä»£ç ç¤ºä¾‹ -->
            <div class="code-examples">
                <h3>ğŸ’» ä»£ç å®ç°</h3>
                <div class="code-tabs">
                    <button class="tab-btn active" data-lang="cpp">C++</button>
                    <button class="tab-btn" data-lang="java">Java</button>
                    <button class="tab-btn" data-lang="python">Python</button>
                </div>

                <!-- C++ ä»£ç  -->
                <div class="code-content active" data-lang="cpp">
                    <div class="code-header">
                        <span>BSTèŠ‚ç‚¹ç»“æ„å’ŒåŸºæœ¬æ“ä½œ - C++</span>
                        <button class="copy-btn" data-clipboard-target="cpp-code">ğŸ“‹ å¤åˆ¶</button>
                    </div>
                    <pre id="cpp-code"><code>
struct TreeNode {
    int val;
    TreeNode* left;
    TreeNode* right;
    TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}
};

class BST {
public:
    TreeNode* root;

    BST() : root(nullptr) {}

    // æ’å…¥èŠ‚ç‚¹
    TreeNode* insert(TreeNode* node, int val) {
        if (node == nullptr) {
            return new TreeNode(val);
        }

        if (val < node->val) {
            node->left = insert(node->left, val);
        } else if (val > node->val) {
            node->right = insert(node->right, val);
        }

        return node;
    }

    // æŸ¥æ‰¾èŠ‚ç‚¹
    bool search(TreeNode* node, int val) {
        if (node == nullptr) return false;
        if (node->val == val) return true;

        if (val < node->val) {
            return search(node->left, val);
        } else {
            return search(node->right, val);
        }
    }

    // ä¸­åºéå†
    void inorder(TreeNode* node, vector&lt;int&gt;& result) {
        if (node != nullptr) {
            inorder(node->left, result);
            result.push_back(node->val);
            inorder(node->right, result);
        }
    }
};
                    </code></pre>
                </div>

                <!-- Java ä»£ç  -->
                <div class="code-content" data-lang="java">
                    <div class="code-header">
                        <span>BSTèŠ‚ç‚¹ç»“æ„å’ŒåŸºæœ¬æ“ä½œ - Java</span>
                        <button class="copy-btn" data-clipboard-target="java-code">ğŸ“‹ å¤åˆ¶</button>
                    </div>
                    <pre id="java-code"><code>
class TreeNode {
    int val;
    TreeNode left;
    TreeNode right;

    TreeNode(int val) {
        this.val = val;
        this.left = null;
        this.right = null;
    }
}

public class BST {
    private TreeNode root;

    public BST() {
        this.root = null;
    }

    // æ’å…¥èŠ‚ç‚¹
    public TreeNode insert(TreeNode node, int val) {
        if (node == null) {
            return new TreeNode(val);
        }

        if (val < node.val) {
            node.left = insert(node.left, val);
        } else if (val > node.val) {
            node.right = insert(node.right, val);
        }

        return node;
    }

    // æŸ¥æ‰¾èŠ‚ç‚¹
    public boolean search(TreeNode node, int val) {
        if (node == null) return false;
        if (node.val == val) return true;

        if (val < node.val) {
            return search(node.left, val);
        } else {
            return search(node.right, val);
        }
    }

    // ä¸­åºéå†
    public void inorder(TreeNode node, List&lt;Integer&gt; result) {
        if (node != null) {
            inorder(node.left, result);
            result.add(node.val);
            inorder(node.right, result);
        }
    }
}
                    </code></pre>
                </div>

                <!-- Python ä»£ç  -->
                <div class="code-content" data-lang="python">
                    <div class="code-header">
                        <span>BSTèŠ‚ç‚¹ç»“æ„å’ŒåŸºæœ¬æ“ä½œ - Python</span>
                        <button class="copy-btn" data-clipboard-target="python-code">ğŸ“‹ å¤åˆ¶</button>
                    </div>
                    <pre id="python-code"><code>
class TreeNode:
    def __init__(self, val=0):
        self.val = val
        self.left = None
        self.right = None

class BST:
    def __init__(self):
        self.root = None

    def insert(self, node, val):
        """æ’å…¥èŠ‚ç‚¹"""
        if node is None:
            return TreeNode(val)

        if val < node.val:
            node.left = self.insert(node.left, val)
        elif val > node.val:
            node.right = self.insert(node.right, val)

        return node

    def search(self, node, val):
        """æŸ¥æ‰¾èŠ‚ç‚¹"""
        if node is None:
            return False
        if node.val == val:
            return True

        if val < node.val:
            return self.search(node.left, val)
        else:
            return self.search(node.right, val)

    def inorder(self, node, result):
        """ä¸­åºéå†"""
        if node is not None:
            self.inorder(node.left, result)
            result.append(node.val)
            self.inorder(node.right, result)

    def insert_public(self, val):
        """å…¬å…±æ’å…¥æ¥å£"""
        self.root = self.insert(self.root, val)

    def search_public(self, val):
        """å…¬å…±æŸ¥æ‰¾æ¥å£"""
        return self.search(self.root, val)
                    </code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… å­¦ä¹ æ£€éªŒ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">âœ…</span>
                å­¦ä¹ æ£€éªŒ
            </h2>

            <div class="quiz-container">
                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜1ï¼šBSTæ€§è´¨åˆ¤æ–­</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>ç»™å®šåºåˆ— [20, 10, 30, 5, 15, 25, 35]ï¼ŒæŒ‰é¡ºåºæ’å…¥ç©ºçš„BSTä¸­ï¼Œæœ€ç»ˆçš„ä¸­åºéå†ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer1')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer1">
                        <p><strong>ç­”æ¡ˆï¼š</strong>[5, 10, 15, 20, 25, 30, 35]</p>
                        <p><strong>è§£é‡Šï¼š</strong>BSTçš„ä¸­åºéå†æ€»æ˜¯æŒ‰å‡åºè¾“å‡ºæ‰€æœ‰å…ƒç´ ï¼Œè¿™æ˜¯BSTæœ€é‡è¦çš„æ€§è´¨ä¹‹ä¸€ï¼</p>
                    </div>
                </div>

                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜2ï¼šæ—¶é—´å¤æ‚åº¦åˆ†æ</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>åœ¨æœ€åæƒ…å†µä¸‹ï¼ŒBSTçš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer2')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer2">
                        <p><strong>ç­”æ¡ˆï¼š</strong>O(n)ï¼Œå½“BSTé€€åŒ–æˆé“¾è¡¨æ—¶ã€‚</p>
                        <p><strong>è§£é‡Šï¼š</strong>ä¾‹å¦‚æŒ‰å‡åºæ’å…¥ [1,2,3,4,5]ï¼Œä¼šå½¢æˆä¸€æ¡å³åé“¾ï¼Œæ­¤æ—¶æŸ¥æ‰¾æ•ˆç‡ç­‰åŒäºçº¿æ€§æœç´¢ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦å¹³è¡¡äºŒå‰æœç´¢æ ‘ï¼ˆå¦‚AVLæ ‘ï¼‰çš„åŸå› ã€‚</p>
                    </div>
                </div>

                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜3ï¼šåˆ é™¤æ“ä½œç†è§£</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>åœ¨BSTä¸­åˆ é™¤æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹æ—¶ï¼Œä¸ºä»€ä¹ˆé€šå¸¸é€‰æ‹©ç”¨"ä¸­åºåç»§"æ¥æ›¿ä»£ï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer3')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer3">
                        <p><strong>ç­”æ¡ˆï¼š</strong>å› ä¸ºä¸­åºåç»§æ˜¯å³å­æ ‘ä¸­çš„æœ€å°å€¼ï¼Œå®ƒèƒ½ä¿æŒBSTæ€§è´¨ã€‚</p>
                        <p><strong>è§£é‡Šï¼š</strong>ä¸­åºåç»§æ¯”å·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹éƒ½å¤§ï¼Œæ¯”å³å­æ ‘é™¤å®ƒä¹‹å¤–çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å°ï¼Œç”¨å®ƒæ›¿ä»£åˆ é™¤èŠ‚ç‚¹æ­£å¥½ç»´æŒBSTçš„å·¦å°å³å¤§æ€§è´¨ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸­åºå‰é©±ï¼ˆå·¦å­æ ‘æœ€å¤§å€¼ï¼‰ã€‚</p>
                    </div>
                </div>

                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜4ï¼šå®é™…åº”ç”¨</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>ä¸ºä»€ä¹ˆæ•°æ®åº“ç´¢å¼•ç»å¸¸ä½¿ç”¨æ ‘ç»“æ„è€Œä¸æ˜¯å“ˆå¸Œè¡¨ï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer4')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer4">
                        <p><strong>ç­”æ¡ˆï¼š</strong>å› ä¸ºæ ‘ç»“æ„æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œè€Œå“ˆå¸Œè¡¨ä¸æ”¯æŒã€‚</p>
                        <p><strong>è§£é‡Šï¼š</strong>BSTæ”¯æŒé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚æŸ¥æ‰¾18-25å²çš„ç”¨æˆ·ï¼‰ï¼Œæ’åºè¾“å‡ºï¼Œè€Œå“ˆå¸Œè¡¨åªèƒ½åšç²¾ç¡®æŸ¥æ‰¾ã€‚æ•°æ®åº“ç»å¸¸éœ€è¦ BETWEENã€ORDER BY ç­‰æ“ä½œï¼Œè¿™äº›éƒ½æ˜¯BSTçš„å¼ºé¡¹ã€‚</p>
                    </div>
                </div>

                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜5ï¼šç®—æ³•ä¼˜åŒ–</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªäºŒå‰æ ‘æ˜¯å¦ä¸ºæœ‰æ•ˆçš„BSTï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer5')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer5">
                        <p><strong>ç­”æ¡ˆï¼š</strong>ä½¿ç”¨èŒƒå›´æ£€æŸ¥ï¼šæ¯ä¸ªèŠ‚ç‚¹éƒ½è¦åœ¨ç‰¹å®šèŒƒå›´å†…ã€‚</p>
                        <p><strong>è§£é‡Šï¼š</strong>ä¸èƒ½åªæ¯”è¾ƒçˆ¶å­å…³ç³»ï¼è¦ä¿è¯æ¯ä¸ªèŠ‚ç‚¹éƒ½åœ¨å…è®¸çš„èŒƒå›´å†…ã€‚æ ¹èŠ‚ç‚¹èŒƒå›´æ˜¯(-âˆ, +âˆ)ï¼Œå·¦å­èŠ‚ç‚¹èŒƒå›´æ˜¯(-âˆ, parent.val)ï¼Œå³å­èŠ‚ç‚¹èŒƒå›´æ˜¯(parent.val, +âˆ)ã€‚é€’å½’æ£€æŸ¥å³å¯ã€‚</p>
                    </div>
                </div>
            </div>

            <!-- è¿›é˜¶å­¦ä¹ å»ºè®® -->
            <div class="learning-progress">
                <h3>ğŸ“š è¿›é˜¶å­¦ä¹ è·¯å¾„</h3>
                <div class="progress-steps">
                    <div class="progress-step completed">
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <h4>BSTåŸºç¡€</h4>
                            <p>æŒæ¡å¢åˆ æŸ¥æ”¹æ“ä½œ</p>
                        </div>
                    </div>
                    <div class="progress-step next">
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <h4>å¹³è¡¡äºŒå‰æ ‘</h4>
                            <p>å­¦ä¹ AVLæ ‘ã€çº¢é»‘æ ‘</p>
                        </div>
                    </div>
                    <div class="progress-step">
                        <span class="step-number">3</span>
                        <div class="step-content">
                            <h4>å¤šè·¯æœç´¢æ ‘</h4>
                            <p>Bæ ‘ã€B+æ ‘åŸç†</p>
                        </div>
                    </div>
                    <div class="progress-step">
                        <span class="step-number">4</span>
                        <div class="step-content">
                            <h4>å®é™…åº”ç”¨</h4>
                            <p>æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary">
            <span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a>
        <a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary">
            <span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a>
    </div>
</div>

<!-- CSSæ ·å¼ -->
<style>
.overview-content {
    margin-top: 20px;
}

.concept-intro {
    background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    border-left: 4px solid #2196F3;
}

.badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    color: white;
}

.badge-medium {
    background: #FF9800;
}

.concept-details {
    margin-top: 20px;
}

.concept-item {
    margin-bottom: 30px;
    padding: 20px;
    background: #fafafa;
    border-radius: 8px;
    border-left: 4px solid #4CAF50;
}

.operations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.operation-card {
    text-align: center;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.operation-card:hover {
    transform: translateY(-5px);
}

.op-icon {
    font-size: 2em;
    display: block;
    margin-bottom: 10px;
}

.comparison-table table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.comparison-table th,
.comparison-table td {
    border: 1px solid #ddd;
    padding: 8px 12px;
    text-align: left;
}

.comparison-table th {
    background-color: #f5f5f5;
    font-weight: bold;
}

.visualization-container {
    margin-top: 20px;
}

.static-diagram {
    text-align: center;
    margin: 20px 0;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 8px;
}

.animation-controls {
    margin: 20px 0;
    text-align: center;
}

.control-panel {
    margin-bottom: 15px;
}

.control-panel button,
.control-panel input {
    margin: 5px;
}

#nodeValue {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    width: 120px;
}

.step-info {
    padding: 10px;
    background: #e3f2fd;
    border-radius: 4px;
    margin-bottom: 15px;
    font-weight: bold;
}

.canvas-container {
    text-align: center;
    background: white;
    border: 2px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    margin: 15px 0;
}

#bstCanvas {
    border: 1px solid #eee;
    border-radius: 4px;
}

.operation-steps {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.step-card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #2196F3;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.step-card h4 {
    margin-top: 0;
    color: #1976D2;
}

.step-card ol {
    margin: 10px 0 0 20px;
}

.applications {
    margin-top: 20px;
}

.application-item {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #FF5722;
}

.code-examples {
    margin-top: 30px;
}

.code-tabs {
    display: flex;
    margin-bottom: 0;
    border-bottom: 2px solid #e0e0e0;
}

.tab-btn {
    padding: 12px 24px;
    background: #f5f5f5;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
}

.tab-btn.active {
    background: #2196F3;
    color: white;
    border-bottom-color: #2196F3;
}

.code-content {
    display: none;
    background: #1e1e1e;
    border-radius: 0 0 8px 8px;
    overflow: hidden;
}

.code-content.active {
    display: block;
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background: #333;
    color: white;
    font-size: 14px;
}

.copy-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: background 0.2s;
}

.copy-btn:hover {
    background: #45a049;
}

pre {
    margin: 0;
    overflow-x: auto;
}

code {
    color: #f8f8f2;
    font-family: 'Monaco', 'Consolas', monospace;
    font-size: 14px;
    line-height: 1.5;
    display: block;
    padding: 20px;
}

.quiz-container {
    margin-top: 20px;
}

.quiz-item {
    margin-bottom: 25px;
    padding: 20px;
    background: white;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.quiz-item h3 {
    color: #1976D2;
    margin-top: 0;
}

.answer-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    margin: 10px 0;
    font-weight: bold;
    transition: background 0.2s;
}

.answer-btn:hover {
    background: #45a049;
}

.answer-content {
    display: none;
    margin-top: 15px;
    padding: 15px;
    background: #e8f5e8;
    border-radius: 5px;
    border-left: 4px solid #4CAF50;
}

.answer-content.show {
    display: block;
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.learning-progress {
    margin-top: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
    border-radius: 10px;
}

.progress-steps {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.progress-step {
    display: flex;
    align-items: center;
    padding: 15px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    opacity: 0.6;
    transition: all 0.3s;
}

.progress-step.completed {
    opacity: 1;
    border-left: 4px solid #4CAF50;
}

.progress-step.next {
    opacity: 1;
    border-left: 4px solid #FF9800;
    transform: scale(1.05);
}

.step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: #e0e0e0;
    color: white;
    border-radius: 50%;
    margin-right: 15px;
    font-weight: bold;
}

.progress-step.completed .step-number {
    background: #4CAF50;
}

.progress-step.next .step-number {
    background: #FF9800;
}

.step-content h4 {
    margin: 0 0 5px 0;
    color: #333;
}

.step-content p {
    margin: 0;
    color: #666;
    font-size: 14px;
}

.delete-explanation {
    margin: 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
    border-left: 4px solid #FF5722;
}

.delete-cases {
    display: grid;
    gap: 15px;
    margin-top: 15px;
}

.case-card {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-left: 3px solid #4CAF50;
}

.case-card.complex {
    border-left-color: #FF9800;
    background: linear-gradient(135deg, #fff8e1, #ffffff);
}

.case-card h4 {
    margin: 0 0 10px 0;
    color: #333;
    font-size: 16px;
}

.case-card p {
    margin: 5px 0;
    color: #555;
    font-size: 14px;
}

.case-card ol {
    margin: 10px 0 10px 20px;
    color: #555;
}

@media (max-width: 768px) {
    .operations-grid {
        grid-template-columns: 1fr;
    }

    .operation-steps {
        grid-template-columns: 1fr;
    }

    .progress-steps {
        grid-template-columns: 1fr;
    }

    .code-tabs {
        flex-wrap: wrap;
    }

    .tab-btn {
        flex: 1;
        min-width: 80px;
    }
}
</style>

<!-- JavaScript -->
<script>
// BSTåŠ¨ç”»ç›¸å…³å˜é‡
let canvas, ctx;
let bstNodes = [];
let animationStep = 0;
let currentOperation = '';
let targetValue = null;
let animationPath = [];

// åˆå§‹åŒ–BSTæ¼”ç¤º
document.addEventListener('DOMContentLoaded', function() {
    canvas = document.getElementById('bstCanvas');
    ctx = canvas.getContext('2d');

    // åˆå§‹åŒ–ä¸€ä¸ªç¤ºä¾‹BST
    initializeSampleBST();
    drawBST();

    // ç»‘å®šäº‹ä»¶
    document.getElementById('insertBtn').addEventListener('click', () => {
        const value = parseInt(document.getElementById('nodeValue').value);
        if (value) {
            startAnimation('insert', value);
        } else {
            alert('è¯·è¾“å…¥ä¸€ä¸ªæ•°å€¼');
        }
    });

    document.getElementById('searchBtn').addEventListener('click', () => {
        const value = parseInt(document.getElementById('nodeValue').value);
        if (value) {
            startAnimation('search', value);
        } else {
            alert('è¯·è¾“å…¥ä¸€ä¸ªæ•°å€¼');
        }
    });

    document.getElementById('deleteBtn').addEventListener('click', () => {
        const value = parseInt(document.getElementById('nodeValue').value);
        if (value) {
            startAnimation('delete', value);
        } else {
            alert('è¯·è¾“å…¥ä¸€ä¸ªæ•°å€¼');
        }
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
        bstNodes = [];
        animationPath = [];
        animationStep = 0;
        document.getElementById('stepInfo').textContent = 'å·²é‡ç½®ï¼Œç‚¹å‡»æ“ä½œæŒ‰é’®å¼€å§‹æ¼”ç¤º';
        initializeSampleBST();
        drawBST();
    });
});

// åˆå§‹åŒ–ç¤ºä¾‹BST
function initializeSampleBST() {
    bstNodes = [
        {value: 50, x: 400, y: 80, left: null, right: null, id: 1},
        {value: 30, x: 280, y: 160, left: null, right: null, id: 2},
        {value: 70, x: 520, y: 160, left: null, right: null, id: 3},
        {value: 20, x: 220, y: 240, left: null, right: null, id: 4},
        {value: 40, x: 340, y: 240, left: null, right: null, id: 5},
        {value: 60, x: 460, y: 240, left: null, right: null, id: 6},
        {value: 80, x: 580, y: 240, left: null, right: null, id: 7}
    ];

    // å»ºç«‹çˆ¶å­å…³ç³»ï¼ˆä»…ç”¨äºç»˜åˆ¶è¿çº¿ï¼‰
    bstNodes[0].left = bstNodes[1];
    bstNodes[0].right = bstNodes[2];
    bstNodes[1].left = bstNodes[3];
    bstNodes[1].right = bstNodes[4];
    bstNodes[2].left = bstNodes[5];
    bstNodes[2].right = bstNodes[6];
}

// ç»˜åˆ¶BST
function drawBST() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // ç»˜åˆ¶è¿çº¿
    bstNodes.forEach(node => {
        if (node.left) {
            drawLine(node.x, node.y, node.left.x, node.left.y, '#666');
        }
        if (node.right) {
            drawLine(node.x, node.y, node.right.x, node.right.y, '#666');
        }
    });

    // ç»˜åˆ¶èŠ‚ç‚¹
    bstNodes.forEach((node, index) => {
        let color = '#4CAF50';
        let strokeColor = '#2E7D32';

        if (animationPath.includes(index)) {
            if (currentOperation === 'delete' && index === animationPath[0]) {
                color = '#f44336'; // çº¢è‰²è¡¨ç¤ºè¦åˆ é™¤çš„èŠ‚ç‚¹
                strokeColor = '#d32f2f';
            } else if (currentOperation === 'search' && index === animationPath[animationPath.length - 1]) {
                color = '#FF5722'; // æ©™è‰²è¡¨ç¤ºå½“å‰æœç´¢ä½ç½®
                strokeColor = '#E64A19';
            } else {
                color = '#FF9800'; // é»„è‰²è¡¨ç¤ºè·¯å¾„ä¸Šçš„èŠ‚ç‚¹
                strokeColor = '#F57C00';
            }
        }

        drawNode(node.x, node.y, node.value, color, strokeColor);
    });

    // æ·»åŠ æ“ä½œè¯´æ˜
    if (animationPath.length > 0 && currentOperation) {
        ctx.fillStyle = '#333';
        ctx.font = '14px Arial';
        ctx.textAlign = 'left';

        let instructions = '';
        switch(currentOperation) {
            case 'search':
                instructions = 'ğŸ” æ©™è‰²èŠ‚ç‚¹ï¼šå½“å‰æœç´¢ä½ç½®';
                break;
            case 'insert':
                instructions = 'â• é»„è‰²èŠ‚ç‚¹ï¼šæœç´¢è·¯å¾„ï¼Œæ©™è‰²èŠ‚ç‚¹ï¼šæ’å…¥ä½ç½®';
                break;
            case 'delete':
                instructions = 'ğŸ—‘ï¸ çº¢è‰²èŠ‚ç‚¹ï¼šè¦åˆ é™¤çš„èŠ‚ç‚¹ï¼Œé»„è‰²èŠ‚ç‚¹ï¼šæ“ä½œè·¯å¾„';
                break;
        }

        if (instructions) {
            ctx.fillText(instructions, 10, canvas.height - 20);
        }
    }
}

// ç»˜åˆ¶å•ä¸ªèŠ‚ç‚¹
function drawNode(x, y, value, color = '#4CAF50', strokeColor = '#2E7D32') {
    // ç»˜åˆ¶åœ†åœˆ
    ctx.beginPath();
    ctx.arc(x, y, 25, 0, 2 * Math.PI);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.strokeStyle = strokeColor;
    ctx.lineWidth = 3;
    ctx.stroke();

    // ç»˜åˆ¶æ•°å€¼
    ctx.fillStyle = 'white';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(value.toString(), x, y);
}

// ç»˜åˆ¶è¿çº¿
function drawLine(x1, y1, x2, y2, color = '#666') {
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.stroke();
}

// å¼€å§‹åŠ¨ç”»
function startAnimation(operation, value) {
    currentOperation = operation;
    targetValue = value;
    animationStep = 0;
    animationPath = [];

    if (operation === 'search') {
        animateSearch(value);
    } else if (operation === 'insert') {
        animateInsert(value);
    } else if (operation === 'delete') {
        animateDelete(value);
    }
}

// æœç´¢åŠ¨ç”»
function animateSearch(value) {
    let currentIndex = 0; // ä»æ ¹èŠ‚ç‚¹å¼€å§‹
    let step = 1;

    const searchStep = () => {
        if (currentIndex >= bstNodes.length) {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œæœç´¢å¤±è´¥`;
            return;
        }

        const currentNode = bstNodes[currentIndex];
        animationPath.push(currentIndex);
        drawBST();

        if (currentNode.value === value) {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: æ‰¾åˆ°ç›®æ ‡å€¼ ${value}ï¼æœç´¢æˆåŠŸ`;
            return;
        } else if (value < currentNode.value) {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: ${value} < ${currentNode.value}ï¼Œå¾€å·¦å­æ ‘æœç´¢`;
            currentIndex = bstNodes.findIndex(node => node === currentNode.left);
        } else {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: ${value} > ${currentNode.value}ï¼Œå¾€å³å­æ ‘æœç´¢`;
            currentIndex = bstNodes.findIndex(node => node === currentNode.right);
        }

        step++;
        if (currentIndex !== -1) {
            setTimeout(searchStep, 1500);
        } else {
            setTimeout(() => {
                document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åˆ°è¾¾ç©ºèŠ‚ç‚¹ï¼Œå€¼ ${value} ä¸å­˜åœ¨äºBSTä¸­`;
            }, 1500);
        }
    };

    searchStep();
}

// æ’å…¥åŠ¨ç”»
function animateInsert(value) {
    // æ£€æŸ¥å€¼æ˜¯å¦å·²å­˜åœ¨
    if (bstNodes.find(node => node.value === value)) {
        document.getElementById('stepInfo').textContent = `å€¼ ${value} å·²å­˜åœ¨äºBSTä¸­ï¼Œæ— éœ€æ’å…¥`;
        return;
    }

    let currentIndex = 0;
    let step = 1;
    let parentIndex = -1;
    let isLeftChild = false;

    const insertStep = () => {
        if (currentIndex >= bstNodes.length || currentIndex === -1) {
            // æ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œåˆ›å»ºæ–°èŠ‚ç‚¹
            let newX, newY;
            if (parentIndex !== -1) {
                const parent = bstNodes[parentIndex];
                if (isLeftChild) {
                    newX = parent.x - 60;
                    newY = parent.y + 80;
                } else {
                    newX = parent.x + 60;
                    newY = parent.y + 80;
                }
            } else {
                newX = 400;
                newY = 80;
            }

            const newNode = {
                value: value,
                x: newX,
                y: newY,
                left: null,
                right: null,
                id: bstNodes.length + 1
            };

            bstNodes.push(newNode);

            // å»ºç«‹çˆ¶å­å…³ç³»
            if (parentIndex !== -1) {
                if (isLeftChild) {
                    bstNodes[parentIndex].left = newNode;
                } else {
                    bstNodes[parentIndex].right = newNode;
                }
            }

            animationPath.push(bstNodes.length - 1);
            drawBST();
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åœ¨ç©ºä½ç½®æ’å…¥æ–°èŠ‚ç‚¹ ${value}`;
            return;
        }

        const currentNode = bstNodes[currentIndex];
        animationPath.push(currentIndex);
        drawBST();

        if (value < currentNode.value) {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: ${value} < ${currentNode.value}ï¼Œå¾€å·¦å­æ ‘`;
            parentIndex = currentIndex;
            isLeftChild = true;
            currentIndex = bstNodes.findIndex(node => node === currentNode.left);
        } else {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: ${value} > ${currentNode.value}ï¼Œå¾€å³å­æ ‘`;
            parentIndex = currentIndex;
            isLeftChild = false;
            currentIndex = bstNodes.findIndex(node => node === currentNode.right);
        }

        step++;
        setTimeout(insertStep, 1500);
    };

    insertStep();
}

// åˆ é™¤åŠ¨ç”»ï¼ˆå®Œæ•´ç‰ˆï¼Œå¤„ç†æ‰€æœ‰æƒ…å†µï¼‰
function animateDelete(value) {
    const nodeIndex = bstNodes.findIndex(node => node.value === value);
    if (nodeIndex === -1) {
        document.getElementById('stepInfo').textContent = `å€¼ ${value} ä¸å­˜åœ¨äºBSTä¸­`;
        return;
    }

    const nodeToDelete = bstNodes[nodeIndex];
    let step = 1;

    // é«˜äº®è¦åˆ é™¤çš„èŠ‚ç‚¹
    animationPath = [nodeIndex];
    drawBST();

    setTimeout(() => {
        // æƒ…å†µ1ï¼šå¶å­èŠ‚ç‚¹ï¼ˆæ— å­èŠ‚ç‚¹ï¼‰
        if (!nodeToDelete.left && !nodeToDelete.right) {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åˆ é™¤å¶å­èŠ‚ç‚¹ ${value}`;
            deleteLeafNode(nodeIndex, value);
        }
        // æƒ…å†µ2ï¼šåªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹
        else if (!nodeToDelete.left || !nodeToDelete.right) {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åˆ é™¤åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹ ${value}`;
            deleteNodeWithOneChild(nodeIndex, value, step);
        }
        // æƒ…å†µ3ï¼šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹
        else {
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åˆ é™¤æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹ ${value}ï¼Œéœ€è¦æ‰¾åˆ°ä¸­åºåç»§`;
            deleteNodeWithTwoChildren(nodeIndex, value, step);
        }
    }, 1500);
}

// åˆ é™¤å¶å­èŠ‚ç‚¹
function deleteLeafNode(nodeIndex, value) {
    const nodeToDelete = bstNodes[nodeIndex];

    setTimeout(() => {
        // ä»çˆ¶èŠ‚ç‚¹ä¸­ç§»é™¤å¼•ç”¨
        bstNodes.forEach(node => {
            if (node.left === nodeToDelete) {
                node.left = null;
            }
            if (node.right === nodeToDelete) {
                node.right = null;
            }
        });

        // ä»æ•°ç»„ä¸­ç§»é™¤èŠ‚ç‚¹
        bstNodes.splice(nodeIndex, 1);
        animationPath = [];
        drawBST();
        document.getElementById('stepInfo').textContent = `åˆ é™¤å®Œæˆï¼å¶å­èŠ‚ç‚¹ ${value} å·²è¢«ç§»é™¤`;
    }, 1000);
}

// åˆ é™¤åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹
function deleteNodeWithOneChild(nodeIndex, value, step) {
    const nodeToDelete = bstNodes[nodeIndex];
    const child = nodeToDelete.left || nodeToDelete.right;
    const childIndex = bstNodes.findIndex(node => node === child);

    setTimeout(() => {
        step++;
        document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: ç”¨å­èŠ‚ç‚¹ ${child.value} æ›¿ä»£åˆ é™¤èŠ‚ç‚¹ ${value}`;

        // é«˜äº®å­èŠ‚ç‚¹
        animationPath = [nodeIndex, childIndex];
        drawBST();

        setTimeout(() => {
            // æ‰¾åˆ°çˆ¶èŠ‚ç‚¹å¹¶æ›´æ–°å¼•ç”¨
            let parentFound = false;
            bstNodes.forEach(node => {
                if (node.left === nodeToDelete) {
                    node.left = child;
                    parentFound = true;
                } else if (node.right === nodeToDelete) {
                    node.right = child;
                    parentFound = true;
                }
            });

            // å¦‚æœåˆ é™¤çš„æ˜¯æ ¹èŠ‚ç‚¹ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
            if (!parentFound) {
                // å°†å­èŠ‚ç‚¹ç§»åŠ¨åˆ°æ ¹èŠ‚ç‚¹ä½ç½®
                child.x = nodeToDelete.x;
                child.y = nodeToDelete.y;
            }

            // ä»æ•°ç»„ä¸­ç§»é™¤è¢«åˆ é™¤çš„èŠ‚ç‚¹
            bstNodes.splice(nodeIndex, 1);
            animationPath = [];
            drawBST();

            step++;
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åˆ é™¤å®Œæˆï¼èŠ‚ç‚¹ ${value} å·²è¢«å…¶å­èŠ‚ç‚¹æ›¿ä»£`;
        }, 1500);
    }, 1000);
}

// åˆ é™¤æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹
function deleteNodeWithTwoChildren(nodeIndex, value, step) {
    const nodeToDelete = bstNodes[nodeIndex];

    setTimeout(() => {
        step++;
        document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åœ¨å³å­æ ‘ä¸­æŸ¥æ‰¾æœ€å°å€¼ï¼ˆä¸­åºåç»§ï¼‰`;

        // æ‰¾åˆ°ä¸­åºåç»§ï¼ˆå³å­æ ‘çš„æœ€å°å€¼ï¼‰
        let successor = nodeToDelete.right;
        let successorPath = [nodeIndex];

        // æ·»åŠ å³å­æ ‘æ ¹èŠ‚ç‚¹åˆ°è·¯å¾„
        const rightChildIndex = bstNodes.findIndex(node => node === successor);
        successorPath.push(rightChildIndex);

        // ä¸€ç›´å¾€å·¦èµ°æ‰¾æœ€å°å€¼
        while (successor.left) {
            successor = successor.left;
            const successorIndex = bstNodes.findIndex(node => node === successor);
            successorPath.push(successorIndex);
        }

        const successorIndex = bstNodes.findIndex(node => node === successor);
        animationPath = successorPath;
        drawBST();

        setTimeout(() => {
            step++;
            document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: æ‰¾åˆ°ä¸­åºåç»§ ${successor.value}ï¼Œç”¨å®ƒæ›¿æ¢è¦åˆ é™¤çš„èŠ‚ç‚¹`;

            // é«˜äº®åç»§èŠ‚ç‚¹
            animationPath = [nodeIndex, successorIndex];
            drawBST();

            setTimeout(() => {
                // ä¿å­˜åç»§èŠ‚ç‚¹çš„å€¼
                const successorValue = successor.value;

                // ç”¨åç»§èŠ‚ç‚¹çš„å€¼æ›¿æ¢è¦åˆ é™¤èŠ‚ç‚¹çš„å€¼
                nodeToDelete.value = successorValue;

                step++;
                document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: å€¼å·²æ›¿æ¢ï¼Œç°åœ¨åˆ é™¤åŸæ¥çš„ä¸­åºåç»§èŠ‚ç‚¹`;

                // é‡æ–°ç»˜åˆ¶ï¼Œæ˜¾ç¤ºå€¼å·²ç»è¢«æ›¿æ¢
                animationPath = [nodeIndex];
                drawBST();

                setTimeout(() => {
                    // åˆ é™¤åŸæ¥çš„åç»§èŠ‚ç‚¹ï¼ˆå®ƒæœ€å¤šåªæœ‰å³å­èŠ‚ç‚¹ï¼‰
                    deleteSuccessorNode(successor, successorIndex, step + 1);
                }, 1500);
            }, 1500);
        }, 1500);
    }, 1000);
}

// åˆ é™¤ä¸­åºåç»§èŠ‚ç‚¹ï¼ˆæœ€å¤šåªæœ‰å³å­èŠ‚ç‚¹ï¼‰
function deleteSuccessorNode(successor, successorIndex, step) {
    document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åˆ é™¤ä¸­åºåç»§èŠ‚ç‚¹ ${successor.value}`;

    animationPath = [successorIndex];
    drawBST();

    setTimeout(() => {
        // æ‰¾åˆ°åç»§èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹
        let successorParent = null;
        bstNodes.forEach(node => {
            if (node.left === successor || node.right === successor) {
                successorParent = node;
            }
        });

        if (successorParent) {
            // å¦‚æœåç»§èŠ‚ç‚¹æœ‰å³å­èŠ‚ç‚¹ï¼Œç”¨å³å­èŠ‚ç‚¹æ›¿ä»£
            if (successor.right) {
                if (successorParent.left === successor) {
                    successorParent.left = successor.right;
                } else {
                    successorParent.right = successor.right;
                }
            } else {
                // å¦‚æœåç»§èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç›´æ¥åˆ é™¤
                if (successorParent.left === successor) {
                    successorParent.left = null;
                } else {
                    successorParent.right = null;
                }
            }
        }

        // ä»æ•°ç»„ä¸­ç§»é™¤åç»§èŠ‚ç‚¹
        bstNodes.splice(successorIndex, 1);
        animationPath = [];
        drawBST();

        step++;
        document.getElementById('stepInfo').textContent = `æ­¥éª¤${step}: åˆ é™¤æ“ä½œå®Œæˆï¼èŠ‚ç‚¹å·²è¢«æˆåŠŸåˆ é™¤å¹¶ä¿æŒBSTæ€§è´¨`;
    }, 1500);
}

// ä»£ç æ ‡ç­¾é¡µåˆ‡æ¢
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        // ç§»é™¤æ‰€æœ‰activeç±»
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.code-content').forEach(c => c.classList.remove('active'));

        // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
        this.classList.add('active');
        const lang = this.getAttribute('data-lang');
        document.querySelector(`.code-content[data-lang="${lang}"]`).classList.add('active');
    });
});

// å¤åˆ¶ä»£ç åŠŸèƒ½
document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const targetId = this.getAttribute('data-clipboard-target');
        const codeElement = document.getElementById(targetId);

        if (codeElement) {
            // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
            const textarea = document.createElement('textarea');
            textarea.value = codeElement.textContent;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
            const originalText = this.textContent;
            this.textContent = 'âœ… å·²å¤åˆ¶';
            setTimeout(() => {
                this.textContent = originalText;
            }, 2000);
        }
    });
});

// ç­”æ¡ˆåˆ‡æ¢åŠŸèƒ½
function toggleAnswer(answerId) {
    const answerElement = document.getElementById(answerId);
    const button = answerElement.previousElementSibling;

    if (answerElement.classList.contains('show')) {
        answerElement.classList.remove('show');
        button.textContent = 'ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ';
    } else {
        answerElement.classList.add('show');
        button.textContent = 'éšè—ç­”æ¡ˆ';
    }
}
</script>

{% endblock %}t