{% extends 'knowledge_app/base.html' %}

{% block title %}{{ page_title|default:"å…³é”®è·¯å¾„" }} - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<div class="page-container fade-in">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a>
        <span>></span>
        <span>{{ breadcrumb_category|default:"ç®—æ³•è®¾è®¡" }}</span>
        <span>></span>
        <span>{{ page_title|default:"å…³é”®è·¯å¾„" }}</span>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header slide-in-left">
        <h1>
            <span class="page-icon">ğŸ›¤ï¸</span>
            å…³é”®è·¯å¾„ (Critical Path Method)
        </h1>
        <p>æŒæ¡é¡¹ç›®ç®¡ç†å’Œä»»åŠ¡è°ƒåº¦çš„æ ¸å¿ƒç®—æ³•</p>
    </div>

    <!-- ğŸ“‹ çŸ¥è¯†ç‚¹æ¦‚è¿° -->
    <div class="content-card slide-in-right">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“‹</span>
                çŸ¥è¯†ç‚¹æ¦‚è¿°
            </h2>

            <div class="concept-overview">
                <div class="core-concept">
                    <h3>ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ</h3>
                    <p><strong>å…³é”®è·¯å¾„</strong>æ˜¯é¡¹ç›®ç®¡ç†ä¸­ç”¨äºç¡®å®šå®Œæˆé¡¹ç›®æ‰€éœ€æœ€çŸ­æ—¶é—´çš„æ–¹æ³•ã€‚å®ƒé€šè¿‡è¯†åˆ«é¡¹ç›®ä¸­æœ€é•¿çš„ä»»åŠ¡åºåˆ—ï¼Œæ‰¾å‡ºä¸èƒ½å»¶è¿Ÿçš„å…³é”®ä»»åŠ¡ã€‚</p>
                </div>

                <div class="unified-grid unified-grid-3">
                    <div class="grid-card">
                        <span class="card-icon">ğŸ”‘</span>
                        <h4>å…³é”®æ´»åŠ¨ (Critical Activity)</h4>
                        <p>ä»»ä½•å»¶è¿Ÿéƒ½ä¼šå½±å“é¡¹ç›®å®Œæˆæ—¶é—´çš„æ´»åŠ¨</p>
                    </div>
                    <div class="grid-card">
                        <span class="card-icon">â±ï¸</span>
                        <h4>æµ®åŠ¨æ—¶é—´ (Float Time)</h4>
                        <p>æ´»åŠ¨å¯ä»¥å»¶è¿Ÿè€Œä¸å½±å“é¡¹ç›®å·¥æœŸçš„æ—¶é—´</p>
                    </div>
                    <div class="grid-card">
                        <span class="card-icon">ğŸ¯</span>
                        <h4>æœ€æ—©/æœ€æ™šæ—¶é—´ (ES/LS)</h4>
                        <p>æ´»åŠ¨å¯ä»¥å¼€å§‹æˆ–å¿…é¡»å¼€å§‹çš„æ—¶é—´ç‚¹</p>
                    </div>
                </div>

                <div class="unified-grid unified-grid-2">
                    <div class="info-box info-box-info">
                        <span class="info-icon">ğŸ“ˆ</span>
                        <strong>å­¦ä¹ éš¾åº¦ï¼š</strong>è¿›é˜¶çº§ - éœ€è¦ç†è§£å›¾è®ºåŸºç¡€å’ŒåŠ¨æ€è§„åˆ’æ€æƒ³
                    </div>
                    <div class="info-box info-box-warning">
                        <span class="info-icon">ğŸ“š</span>
                        <strong>å‰ç½®çŸ¥è¯†ï¼š</strong>æœ‰å‘æ— ç¯å›¾(DAG)ã€æ‹“æ‰‘æ’åºã€å›¾çš„éå†
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ” æ¦‚å¿µè¯¦è§£ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ”</span>
                æ¦‚å¿µè¯¦è§£
            </h2>

            <div class="concept-breakdown">
                <div class="concept-item">
                    <h3>1ï¸âƒ£ é¡¹ç›®ç½‘ç»œå›¾</h3>
                    <p>å°†é¡¹ç›®ä»»åŠ¡è¡¨ç¤ºä¸ºæœ‰å‘æ— ç¯å›¾ï¼ŒèŠ‚ç‚¹ä»£è¡¨é‡Œç¨‹ç¢‘äº‹ä»¶ï¼Œè¾¹ä»£è¡¨æ´»åŠ¨ä»»åŠ¡ã€‚å°±åƒ<strong>åœ°é“çº¿è·¯å›¾</strong>ä¸€æ ·ï¼Œæ¯ä¸ªç«™ç‚¹æ˜¯äº‹ä»¶ï¼Œç«™ç‚¹é—´çš„çº¿è·¯æ˜¯æ´»åŠ¨ã€‚</p>
                </div>

                <div class="concept-item">
                    <h3>2ï¸âƒ£ æ­£å‘è®¡ç®— (Forward Pass)</h3>
                    <p>ä»é¡¹ç›®å¼€å§‹è®¡ç®—æ¯ä¸ªäº‹ä»¶çš„<strong>æœ€æ—©å‘ç”Ÿæ—¶é—´(ES)</strong>ã€‚å¦‚åŒ<strong>å¤šç±³è¯ºéª¨ç‰Œ</strong>ï¼Œå‰é¢çš„å€’ä¸‹åé¢çš„æ‰èƒ½å¼€å§‹å€’ã€‚</p>
                </div>

                <div class="concept-item">
                    <h3>3ï¸âƒ£ åå‘è®¡ç®— (Backward Pass)</h3>
                    <p>ä»é¡¹ç›®ç»“æŸå€’æ¨æ¯ä¸ªäº‹ä»¶çš„<strong>æœ€æ™šå‘ç”Ÿæ—¶é—´(LS)</strong>ã€‚å¦‚åŒ<strong>å€’æ¨ç«è½¦æ—¶åˆ»è¡¨</strong>ï¼Œè¦å‡†æ—¶åˆ°è¾¾ç»ˆç‚¹ç«™ï¼Œæ¯ç«™æœ€æ™šå‡ ç‚¹å¿…é¡»å‡ºå‘ã€‚</p>
                </div>

                <div class="concept-item">
                    <h3>4ï¸âƒ£ å…³é”®è·¯å¾„è¯†åˆ«</h3>
                    <p>æµ®åŠ¨æ—¶é—´ä¸º0çš„è·¯å¾„å°±æ˜¯å…³é”®è·¯å¾„ã€‚å¦‚åŒ<strong>äº¤é€šè¦é“</strong>ï¼Œä»»ä½•æ‹¥å µéƒ½ä¼šå½±å“æ•´ä½“é€šè¡Œã€‚</p>
                </div>

                <div class="common-mistakes">
                    <h4>ğŸš¨ å¸¸è§è¯¯åŒº</h4>
                    <ul>
                        <li><strong>è¯¯åŒº1ï¼š</strong>è®¤ä¸ºå…³é”®è·¯å¾„åªæœ‰ä¸€æ¡ â†’ å®é™…å¯èƒ½æœ‰å¤šæ¡å¹¶è¡Œå…³é”®è·¯å¾„</li>
                        <li><strong>è¯¯åŒº2ï¼š</strong>æ··æ·†æœ€æ—©æ—¶é—´å’Œæœ€æ™šæ—¶é—´ â†’ ESæ˜¯èƒ½å¼€å§‹çš„æœ€æ—©æ—¶é—´ï¼ŒLSæ˜¯å¿…é¡»å¼€å§‹çš„æœ€æ™šæ—¶é—´</li>
                        <li><strong>è¯¯åŒº3ï¼š</strong>å¿½ç•¥æµ®åŠ¨æ—¶é—´çš„ç®¡ç†ä»·å€¼ â†’ æµ®åŠ¨æ—¶é—´ä¸ºèµ„æºè°ƒé…æä¾›çµæ´»æ€§</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“Š å¯è§†åŒ–å±•ç¤º -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“Š</span>
                å¯è§†åŒ–å±•ç¤º
            </h2>

            <!-- é™æ€ç»“æ„å›¾ -->
            <div class="visualization-container">
                <h3>ğŸ“ˆ é¡¹ç›®ç½‘ç»œå›¾ç»“æ„</h3>
                <div class="static-diagram">
                    <canvas id="networkCanvas" width="800" height="400" style="border: 1px solid #ddd; border-radius: 8px;"></canvas>
                </div>
            </div>

            <!-- åŠ¨æ€æ¼”ç¤ºæ§åˆ¶å™¨ -->
            <div class="demo-controls">
                <h3>ğŸ® äº¤äº’å¼æ¼”ç¤º</h3>
                <div class="control-panel">
                    <button id="startDemo" class="unified-btn unified-btn-primary">å¼€å§‹æ¼”ç¤º</button>
                    <button id="stepForward" class="unified-btn unified-btn-secondary">æ­£å‘è®¡ç®—</button>
                    <button id="stepBackward" class="unified-btn unified-btn-secondary">åå‘è®¡ç®—</button>
                    <button id="showCritical" class="unified-btn unified-btn-success">æ˜¾ç¤ºå…³é”®è·¯å¾„</button>
                    <button id="resetDemo" class="unified-btn unified-btn-warning">é‡ç½®</button>
                </div>
                <div id="stepInfo" class="step-info"></div>
            </div>

            <!-- è®¡ç®—è¿‡ç¨‹å±•ç¤º -->
            <div class="calculation-display">
                <h3>ğŸ“ è®¡ç®—è¿‡ç¨‹</h3>
                <div id="calculationSteps" class="calculation-steps"></div>
            </div>
        </div>
    </div>

    <!-- ğŸŒŸ å®é™…åº”ç”¨ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸŒŸ</span>
                å®é™…åº”ç”¨
            </h2>

            <div class="applications">
                <div class="app-example">
                    <h3>ğŸ—ï¸ å»ºç­‘å·¥ç¨‹ç®¡ç†</h3>
                    <p>åœ¨å»ºé€ æ‘©å¤©å¤§æ¥¼æ—¶ï¼Œåœ°åŸºâ†’æ¡†æ¶â†’è£…ä¿®â†’éªŒæ”¶ï¼Œæ¯ä¸ªé˜¶æ®µæœ‰ä¾èµ–å…³ç³»ã€‚å…³é”®è·¯å¾„å¸®åŠ©ç¡®å®šæœ€çŸ­å»ºè®¾å‘¨æœŸå’Œèµ„æºé…ç½®ã€‚</p>
                </div>

                <div class="app-example">
                    <h3>ğŸ’» è½¯ä»¶å¼€å‘æµç¨‹</h3>
                    <p>éœ€æ±‚åˆ†æâ†’è®¾è®¡â†’ç¼–ç â†’æµ‹è¯•â†’éƒ¨ç½²ï¼Œè¯†åˆ«å…³é”®è·¯å¾„å¯ä»¥ä¼˜åŒ–å¼€å‘è¿›åº¦ï¼Œåˆç†å®‰æ’äººå‘˜å’Œèµ„æºã€‚</p>
                </div>

                <div class="app-example">
                    <h3>ğŸ“± äº§å“å‘å¸ƒè§„åˆ’</h3>
                    <p>å¸‚åœºè°ƒç ”â†’äº§å“è®¾è®¡â†’ç”Ÿäº§â†’è¥é”€â†’é”€å”®ï¼Œæ‰¾åˆ°å…³é”®è·¯å¾„ç¡®ä¿äº§å“æŒ‰æ—¶ä¸Šå¸‚ï¼ŒæŠ¢å å¸‚åœºå…ˆæœºã€‚</p>
                </div>
            </div>

            <!-- ä»£ç ç¤ºä¾‹ -->
            <div class="code-examples">
                <h3>ğŸ’» ç®—æ³•å®ç°</h3>

                <!-- è¯­è¨€é€‰æ‹©å™¨ -->
                <div class="language-selector">
                    <button class="lang-btn active" data-lang="python">Python</button>
                    <button class="lang-btn" data-lang="java">Java</button>
                    <button class="lang-btn" data-lang="cpp">C++</button>
                </div>

                <!-- Pythonä»£ç  -->
                <div id="code-python" class="code-container active">
                    <div class="code-header">
                        <span>Pythonå®ç°</span>
                        <button class="copy-btn" data-code="python">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code class="python">from collections import defaultdict, deque

class CriticalPath:
    def __init__(self):
        self.graph = defaultdict(list)  # é‚»æ¥è¡¨
        self.in_degree = defaultdict(int)  # å…¥åº¦
        self.activities = {}  # æ´»åŠ¨æ—¶é—´

    def add_activity(self, start, end, duration):
        """æ·»åŠ æ´»åŠ¨"""
        self.graph[start].append(end)
        self.in_degree[end] += 1
        self.activities[(start, end)] = duration
        if start not in self.in_degree:
            self.in_degree[start] = 0

    def find_critical_path(self):
        """å¯»æ‰¾å…³é”®è·¯å¾„"""
        # æ­£å‘è®¡ç®—æœ€æ—©æ—¶é—´
        earliest_time = self.forward_pass()
        # åå‘è®¡ç®—æœ€æ™šæ—¶é—´
        latest_time = self.backward_pass(earliest_time)
        # è¯†åˆ«å…³é”®è·¯å¾„
        critical_path = self.identify_critical_activities(
            earliest_time, latest_time)

        return earliest_time, latest_time, critical_path

    def forward_pass(self):
        """æ­£å‘è®¡ç®—æœ€æ—©å‘ç”Ÿæ—¶é—´"""
        earliest = defaultdict(int)
        queue = deque()
        temp_in_degree = self.in_degree.copy()

        # æ‰¾åˆ°æ‰€æœ‰èµ·å§‹èŠ‚ç‚¹
        for node in temp_in_degree:
            if temp_in_degree[node] == 0:
                queue.append(node)

        while queue:
            current = queue.popleft()
            for neighbor in self.graph[current]:
                # æ›´æ–°æœ€æ—©æ—¶é—´
                activity_time = self.activities[(current, neighbor)]
                earliest[neighbor] = max(earliest[neighbor],
                                       earliest[current] + activity_time)
                temp_in_degree[neighbor] -= 1
                if temp_in_degree[neighbor] == 0:
                    queue.append(neighbor)

        return dict(earliest)

    def backward_pass(self, earliest_time):
        """åå‘è®¡ç®—æœ€æ™šå‘ç”Ÿæ—¶é—´"""
        # é¡¹ç›®æ€»æ—¶é—´
        project_time = max(earliest_time.values()) if earliest_time else 0
        latest = defaultdict(lambda: project_time)

        # ä»ç»ˆç‚¹å¼€å§‹åå‘è®¡ç®—
        end_nodes = [node for node in earliest_time
                    if earliest_time[node] == project_time]

        for end_node in end_nodes:
            latest[end_node] = project_time

        # æ‹“æ‰‘æ’åºçš„é€†åºè¿›è¡Œåå‘è®¡ç®—
        visited = set()

        def dfs_backward(node):
            if node in visited:
                return
            visited.add(node)

            for next_node in self.graph[node]:
                dfs_backward(next_node)
                activity_time = self.activities[(node, next_node)]
                latest[node] = min(latest[node],
                                 latest[next_node] - activity_time)

        for node in self.graph:
            dfs_backward(node)

        return dict(latest)

    def identify_critical_activities(self, earliest, latest):
        """è¯†åˆ«å…³é”®æ´»åŠ¨"""
        critical = []
        for (start, end), duration in self.activities.items():
            # æµ®åŠ¨æ—¶é—´ = æœ€æ™šæ—¶é—´ - æœ€æ—©æ—¶é—´ - æ´»åŠ¨æ—¶é—´
            float_time = (latest[end] - earliest[start] - duration)
            if float_time == 0:
                critical.append((start, end))
        return critical

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    cp = CriticalPath()

    # æ·»åŠ é¡¹ç›®æ´»åŠ¨ (èµ·ç‚¹, ç»ˆç‚¹, æŒç»­æ—¶é—´)
    cp.add_activity('Start', 'A', 3)
    cp.add_activity('Start', 'B', 4)
    cp.add_activity('A', 'C', 2)
    cp.add_activity('B', 'C', 1)
    cp.add_activity('C', 'End', 3)

    earliest, latest, critical = cp.find_critical_path()

    print("æœ€æ—©æ—¶é—´:", earliest)
    print("æœ€æ™šæ—¶é—´:", latest)
    print("å…³é”®è·¯å¾„æ´»åŠ¨:", critical)</code></pre>
                </div>

                <!-- Javaä»£ç  -->
                <div id="code-java" class="code-container">
                    <div class="code-header">
                        <span>Javaå®ç°</span>
                        <button class="copy-btn" data-code="java">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code class="java">import java.util.*;

public class CriticalPath {
    private Map<String, List<String>> graph;
    private Map<String, Integer> inDegree;
    private Map<String, Map<String, Integer>> activities;

    public CriticalPath() {
        this.graph = new HashMap<>();
        this.inDegree = new HashMap<>();
        this.activities = new HashMap<>();
    }

    public void addActivity(String start, String end, int duration) {
        graph.computeIfAbsent(start, k -> new ArrayList<>()).add(end);
        inDegree.put(end, inDegree.getOrDefault(end, 0) + 1);
        inDegree.putIfAbsent(start, 0);

        activities.computeIfAbsent(start, k -> new HashMap<>()).put(end, duration);
    }

    public CriticalPathResult findCriticalPath() {
        Map<String, Integer> earliestTime = forwardPass();
        Map<String, Integer> latestTime = backwardPass(earliestTime);
        List<String> criticalPath = identifyCriticalActivities(earliestTime, latestTime);

        return new CriticalPathResult(earliestTime, latestTime, criticalPath);
    }

    private Map<String, Integer> forwardPass() {
        Map<String, Integer> earliest = new HashMap<>();
        Queue<String> queue = new LinkedList<>();
        Map<String, Integer> tempInDegree = new HashMap<>(inDegree);

        // åˆå§‹åŒ–èµ·å§‹èŠ‚ç‚¹
        for (String node : tempInDegree.keySet()) {
            earliest.put(node, 0);
            if (tempInDegree.get(node) == 0) {
                queue.offer(node);
            }
        }

        while (!queue.isEmpty()) {
            String current = queue.poll();

            if (graph.containsKey(current)) {
                for (String neighbor : graph.get(current)) {
                    int activityTime = activities.get(current).get(neighbor);
                    earliest.put(neighbor, Math.max(earliest.get(neighbor),
                                                  earliest.get(current) + activityTime));

                    tempInDegree.put(neighbor, tempInDegree.get(neighbor) - 1);
                    if (tempInDegree.get(neighbor) == 0) {
                        queue.offer(neighbor);
                    }
                }
            }
        }

        return earliest;
    }

    private Map<String, Integer> backwardPass(Map<String, Integer> earliestTime) {
        int projectTime = Collections.max(earliestTime.values());
        Map<String, Integer> latest = new HashMap<>();

        // åˆå§‹åŒ–æ‰€æœ‰èŠ‚ç‚¹çš„æœ€æ™šæ—¶é—´
        for (String node : earliestTime.keySet()) {
            latest.put(node, projectTime);
        }

        // æ‰¾åˆ°ç»ˆç‚¹èŠ‚ç‚¹å¹¶è®¾ç½®æœ€æ™šæ—¶é—´
        for (String node : earliestTime.keySet()) {
            if (earliestTime.get(node) == projectTime) {
                latest.put(node, projectTime);
            }
        }

        // åå‘è®¡ç®—
        Set<String> visited = new HashSet<>();
        for (String node : graph.keySet()) {
            dfsBackward(node, latest, visited);
        }

        return latest;
    }

    private void dfsBackward(String node, Map<String, Integer> latest, Set<String> visited) {
        if (visited.contains(node)) {
            return;
        }
        visited.add(node);

        if (graph.containsKey(node)) {
            for (String nextNode : graph.get(node)) {
                dfsBackward(nextNode, latest, visited);
                int activityTime = activities.get(node).get(nextNode);
                latest.put(node, Math.min(latest.get(node),
                                        latest.get(nextNode) - activityTime));
            }
        }
    }

    private List<String> identifyCriticalActivities(Map<String, Integer> earliest,
                                                   Map<String, Integer> latest) {
        List<String> critical = new ArrayList<>();

        for (String start : activities.keySet()) {
            for (String end : activities.get(start).keySet()) {
                int duration = activities.get(start).get(end);
                int floatTime = latest.get(end) - earliest.get(start) - duration;

                if (floatTime == 0) {
                    critical.add(start + " -> " + end);
                }
            }
        }

        return critical;
    }

    public static class CriticalPathResult {
        public final Map<String, Integer> earliestTime;
        public final Map<String, Integer> latestTime;
        public final List<String> criticalActivities;

        public CriticalPathResult(Map<String, Integer> earliest,
                                Map<String, Integer> latest,
                                List<String> critical) {
            this.earliestTime = earliest;
            this.latestTime = latest;
            this.criticalActivities = critical;
        }
    }

    // ä½¿ç”¨ç¤ºä¾‹
    public static void main(String[] args) {
        CriticalPath cp = new CriticalPath();

        cp.addActivity("Start", "A", 3);
        cp.addActivity("Start", "B", 4);
        cp.addActivity("A", "C", 2);
        cp.addActivity("B", "C", 1);
        cp.addActivity("C", "End", 3);

        CriticalPathResult result = cp.findCriticalPath();

        System.out.println("æœ€æ—©æ—¶é—´: " + result.earliestTime);
        System.out.println("æœ€æ™šæ—¶é—´: " + result.latestTime);
        System.out.println("å…³é”®è·¯å¾„æ´»åŠ¨: " + result.criticalActivities);
    }
}</code></pre>
                </div>

                <!-- C++ä»£ç  -->
                <div id="code-cpp" class="code-container">
                    <div class="code-header">
                        <span>C++å®ç°</span>
                        <button class="copy-btn" data-code="cpp">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code class="cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;unordered_map&gt;
#include &lt;unordered_set&gt;
#include &lt;queue&gt;
#include &lt;algorithm&gt;
#include &lt;climits&gt;

class CriticalPath {
private:
    std::unordered_map&lt;std::string, std::vector&lt;std::string&gt;&gt; graph;
    std::unordered_map&lt;std::string, int&gt; inDegree;
    std::unordered_map&lt;std::string, std::unordered_map&lt;std::string, int&gt;&gt; activities;

public:
    void addActivity(const std::string& start, const std::string& end, int duration) {
        graph[start].push_back(end);
        inDegree[end]++;
        if (inDegree.find(start) == inDegree.end()) {
            inDegree[start] = 0;
        }
        activities[start][end] = duration;
    }

    struct CriticalPathResult {
        std::unordered_map&lt;std::string, int&gt; earliestTime;
        std::unordered_map&lt;std::string, int&gt; latestTime;
        std::vector&lt;std::pair&lt;std::string, std::string&gt;&gt; criticalActivities;
    };

    CriticalPathResult findCriticalPath() {
        auto earliestTime = forwardPass();
        auto latestTime = backwardPass(earliestTime);
        auto criticalActivities = identifyCriticalActivities(earliestTime, latestTime);

        return {earliestTime, latestTime, criticalActivities};
    }

private:
    std::unordered_map&lt;std::string, int&gt; forwardPass() {
        std::unordered_map&lt;std::string, int&gt; earliest;
        std::queue&lt;std::string&gt; q;
        auto tempInDegree = inDegree;

        // åˆå§‹åŒ–å’Œæ‰¾åˆ°èµ·å§‹èŠ‚ç‚¹
        for (const auto& pair : inDegree) {
            earliest[pair.first] = 0;
            if (pair.second == 0) {
                q.push(pair.first);
            }
        }

        while (!q.empty()) {
            std::string current = q.front();
            q.pop();

            for (const std::string& neighbor : graph[current]) {
                int activityTime = activities[current][neighbor];
                earliest[neighbor] = std::max(earliest[neighbor],
                                            earliest[current] + activityTime);

                tempInDegree[neighbor]--;
                if (tempInDegree[neighbor] == 0) {
                    q.push(neighbor);
                }
            }
        }

        return earliest;
    }

    std::unordered_map&lt;std::string, int&gt; backwardPass(
        const std::unordered_map&lt;std::string, int&gt;& earliestTime) {

        int projectTime = 0;
        for (const auto& pair : earliestTime) {
            projectTime = std::max(projectTime, pair.second);
        }

        std::unordered_map&lt;std::string, int&gt; latest;
        for (const auto& pair : earliestTime) {
            latest[pair.first] = projectTime;
        }

        // è®¾ç½®ç»ˆç‚¹èŠ‚ç‚¹çš„æœ€æ™šæ—¶é—´
        for (const auto& pair : earliestTime) {
            if (pair.second == projectTime) {
                latest[pair.first] = projectTime;
            }
        }

        // åå‘è®¡ç®—
        std::unordered_set&lt;std::string&gt; visited;
        for (const auto& pair : graph) {
            dfsBackward(pair.first, latest, visited);
        }

        return latest;
    }

    void dfsBackward(const std::string& node,
                    std::unordered_map&lt;std::string, int&gt;& latest,
                    std::unordered_set&lt;std::string&gt;& visited) {
        if (visited.find(node) != visited.end()) {
            return;
        }
        visited.insert(node);

        for (const std::string& nextNode : graph[node]) {
            dfsBackward(nextNode, latest, visited);
            int activityTime = activities[node][nextNode];
            latest[node] = std::min(latest[node], latest[nextNode] - activityTime);
        }
    }

    std::vector&lt;std::pair&lt;std::string, std::string&gt;&gt; identifyCriticalActivities(
        const std::unordered_map&lt;std::string, int&gt;& earliest,
        const std::unordered_map&lt;std::string, int&gt;& latest) {

        std::vector&lt;std::pair&lt;std::string, std::string&gt;&gt; critical;

        for (const auto& startPair : activities) {
            const std::string& start = startPair.first;
            for (const auto& endPair : startPair.second) {
                const std::string& end = endPair.first;
                int duration = endPair.second;

                int floatTime = latest.at(end) - earliest.at(start) - duration;
                if (floatTime == 0) {
                    critical.emplace_back(start, end);
                }
            }
        }

        return critical;
    }
};

// ä½¿ç”¨ç¤ºä¾‹
int main() {
    CriticalPath cp;

    cp.addActivity("Start", "A", 3);
    cp.addActivity("Start", "B", 4);
    cp.addActivity("A", "C", 2);
    cp.addActivity("B", "C", 1);
    cp.addActivity("C", "End", 3);

    auto result = cp.findCriticalPath();

    std::cout &lt;&lt; "æœ€æ—©æ—¶é—´:\n";
    for (const auto& pair : result.earliestTime) {
        std::cout &lt;&lt; pair.first &lt;&lt; ": " &lt;&lt; pair.second &lt;&lt; "\n";
    }

    std::cout &lt;&lt; "\næœ€æ™šæ—¶é—´:\n";
    for (const auto& pair : result.latestTime) {
        std::cout &lt;&lt; pair.first &lt;&lt; ": " &lt;&lt; pair.second &lt;&lt; "\n";
    }

    std::cout &lt;&lt; "\nå…³é”®è·¯å¾„æ´»åŠ¨:\n";
    for (const auto& activity : result.criticalActivities) {
        std::cout &lt;&lt; activity.first &lt;&lt; " -> " &lt;&lt; activity.second &lt;&lt; "\n";
    }

    return 0;
}</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… å­¦ä¹ æ£€éªŒ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">âœ…</span>
                å­¦ä¹ æ£€éªŒ
            </h2>

            <div class="quiz-section">
                <h3>ğŸ¯ å¸¸è§é—®é¢˜è§£ç­”</h3>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ ä¸ºä»€ä¹ˆæœ‰äº›é¡¹ç›®ä¼šæœ‰å¤šæ¡å…³é”®è·¯å¾„ï¼Ÿè¿™ç§æƒ…å†µä¸‹å¦‚ä½•ç®¡ç†ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer1">
                        <button class="show-answer-btn" onclick="showAnswer(1)">æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>è¯¦ç»†è§£ç­”ï¼š</strong><br>
                            å½“é¡¹ç›®ä¸­å­˜åœ¨å¤šæ¡è·¯å¾„çš„æ€»æ—¶é•¿éƒ½ç­‰äºé¡¹ç›®æœ€çŸ­å®Œæˆæ—¶é—´æ—¶ï¼Œå°±ä¼šå‡ºç°å¤šæ¡å…³é”®è·¯å¾„ã€‚è¿™ç§æƒ…å†µåœ¨å®é™…é¡¹ç›®ä¸­å¾ˆå¸¸è§ã€‚<br><br>
                            <strong>ç®¡ç†ç­–ç•¥ï¼š</strong><br>
                            â€¢ <strong>åŒæ­¥ç›‘æ§ï¼š</strong>å¿…é¡»åŒæ—¶å¯†åˆ‡å…³æ³¨æ‰€æœ‰å…³é”®è·¯å¾„ä¸Šçš„æ´»åŠ¨<br>
                            â€¢ <strong>èµ„æºåè°ƒï¼š</strong>ç¡®ä¿å¤šæ¡è·¯å¾„éƒ½æœ‰è¶³å¤Ÿçš„èµ„æºæ”¯æŒ<br>
                            â€¢ <strong>é£é™©åˆ†æ•£ï¼š</strong>å¤šæ¡å…³é”®è·¯å¾„æ„å‘³ç€é¡¹ç›®é£é™©æ›´é«˜ï¼Œéœ€è¦åˆ¶å®šæ›´å…¨é¢çš„åº”æ€¥é¢„æ¡ˆ<br>
                            â€¢ <strong>æ²Ÿé€šåŠ å¼ºï¼š</strong>å„å…³é”®è·¯å¾„çš„è´Ÿè´£äººä¹‹é—´éœ€è¦åŠ å¼ºåè°ƒæ²Ÿé€š
                        </div>
                    </div>
                </div>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ å¦‚ä½•åˆ©ç”¨éå…³é”®è·¯å¾„ä¸Šæ´»åŠ¨çš„æµ®åŠ¨æ—¶é—´æ¥ä¼˜åŒ–èµ„æºé…ç½®ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer2">
                        <button class="show-answer-btn" onclick="showAnswer(2)">æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>æµ®åŠ¨æ—¶é—´çš„ä¼˜åŒ–åˆ©ç”¨ï¼š</strong><br><br>
                            <strong>1. èµ„æºå¹³è¡¡ï¼š</strong><br>
                            â€¢ å°†å…³é”®è·¯å¾„ä¸Šçš„äººå‘˜ä¸´æ—¶è°ƒé…åˆ°éå…³é”®æ´»åŠ¨<br>
                            â€¢ åˆ©ç”¨æµ®åŠ¨æ—¶é—´é”™å³°ä½¿ç”¨å…±äº«èµ„æºï¼ˆè®¾å¤‡ã€åœºåœ°ç­‰ï¼‰<br><br>
                            <strong>2. æˆæœ¬ä¼˜åŒ–ï¼š</strong><br>
                            â€¢ éå…³é”®æ´»åŠ¨å¯ä»¥é€‰æ‹©æˆæœ¬æ›´ä½ä½†æ—¶é—´ç¨é•¿çš„æ‰§è¡Œæ–¹å¼<br>
                            â€¢ é¿å…æ”¯ä»˜åŠ ç­è´¹æˆ–ç§Ÿç”¨æ˜‚è´µè®¾å¤‡<br><br>
                            <strong>3. è´¨é‡æå‡ï¼š</strong><br>
                            â€¢ åˆ©ç”¨é¢å¤–æ—¶é—´è¿›è¡Œæ›´å……åˆ†çš„è´¨é‡æ£€æŸ¥<br>
                            â€¢ ä¸ºéå…³é”®æ´»åŠ¨å®‰æ’æ›´æœ‰ç»éªŒä½†é€Ÿåº¦è¾ƒæ…¢çš„äººå‘˜<br><br>
                            <strong>4. é£é™©ç¼“å†²ï¼š</strong><br>
                            â€¢ ä¿ç•™éƒ¨åˆ†æµ®åŠ¨æ—¶é—´ä½œä¸ºé£é™©ç¼“å†²ï¼Œåº”å¯¹æ„å¤–æƒ…å†µ
                        </div>
                    </div>
                </div>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå…³é”®è·¯å¾„å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–å—ï¼Ÿå¦‚ä½•åº”å¯¹ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer3">
                        <button class="show-answer-btn" onclick="showAnswer(3)">æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>å…³é”®è·¯å¾„çš„åŠ¨æ€å˜åŒ–ï¼š</strong><br><br>
                            <strong>å˜åŒ–åŸå› ï¼š</strong><br>
                            â€¢ æŸäº›æ´»åŠ¨æå‰æˆ–å»¶åå®Œæˆ<br>
                            â€¢ èµ„æºå¯ç”¨æ€§å‘ç”Ÿå˜åŒ–<br>
                            â€¢ é¡¹ç›®éœ€æ±‚æˆ–èŒƒå›´è°ƒæ•´<br>
                            â€¢ å¤–éƒ¨ç¯å¢ƒå› ç´ å½±å“<br><br>
                            <strong>åº”å¯¹ç­–ç•¥ï¼š</strong><br>
                            <strong>1. åŠ¨æ€ç›‘æ§ï¼š</strong>å®šæœŸé‡æ–°è®¡ç®—å…³é”®è·¯å¾„ï¼ˆå»ºè®®æ¯å‘¨æˆ–æ¯æ¬¡é‡Œç¨‹ç¢‘åï¼‰<br>
                            <strong>2. é¢„è­¦ç³»ç»Ÿï¼š</strong>å½“éå…³é”®æ´»åŠ¨çš„æµ®åŠ¨æ—¶é—´å‡å°‘åˆ°é˜ˆå€¼æ—¶å‘å‡ºè­¦å‘Š<br>
                            <strong>3. çµæ´»è°ƒé…ï¼š</strong>åŠæ—¶è°ƒæ•´èµ„æºåˆ†é…ï¼Œå°†é‡ç‚¹è½¬ç§»åˆ°æ–°çš„å…³é”®è·¯å¾„<br>
                            <strong>4. æƒ…æ™¯è§„åˆ’ï¼š</strong>æå‰åˆ†æå¯èƒ½çš„å…³é”®è·¯å¾„å˜åŒ–æƒ…å†µï¼Œåˆ¶å®šåº”å¯¹é¢„æ¡ˆ<br>
                            <strong>5. æ²Ÿé€šæœºåˆ¶ï¼š</strong>å»ºç«‹å¿«é€Ÿçš„ä¿¡æ¯åé¦ˆæœºåˆ¶ï¼Œç¡®ä¿å…³é”®è·¯å¾„å˜åŒ–èƒ½åŠæ—¶ä¼ è¾¾ç»™ç›¸å…³äººå‘˜
                        </div>
                    </div>
                </div>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ CPMä¸PERTæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨å“ªç§æ–¹æ³•ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer4">
                        <button class="show-answer-btn" onclick="showAnswer(4)">æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>CPM vs PERT å¯¹æ¯”åˆ†æï¼š</strong><br><br>
                            <table style="width:100%; border-collapse: collapse; margin: 10px 0;">
                                <tr style="background:#f3f4f6;">
                                    <th style="border:1px solid #ddd; padding:8px;">ç‰¹å¾</th>
                                    <th style="border:1px solid #ddd; padding:8px;">CPM (å…³é”®è·¯å¾„æ³•)</th>
                                    <th style="border:1px solid #ddd; padding:8px;">PERT (è®¡åˆ’è¯„å®¡æŠ€æœ¯)</th>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>æ—¶é—´ä¼°ç®—</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">å•ä¸€ç¡®å®šæ—¶é—´</td>
                                    <td style="border:1px solid #ddd; padding:8px;">ä¸‰ç‚¹ä¼°ç®—(ä¹è§‚/æœ€å¯èƒ½/æ‚²è§‚)</td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>é€‚ç”¨æ€§</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">é‡å¤æ€§ã€ç»éªŒä¸°å¯Œçš„é¡¹ç›®</td>
                                    <td style="border:1px solid #ddd; padding:8px;">åˆ›æ–°æ€§ã€ä¸ç¡®å®šæ€§é«˜çš„é¡¹ç›®</td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>é‡ç‚¹</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">æ—¶é—´-æˆæœ¬æƒè¡¡</td>
                                    <td style="border:1px solid #ddd; padding:8px;">ä¸ç¡®å®šæ€§å’Œé£é™©ç®¡ç†</td>
                                </tr>
                            </table>
                            <br><strong>é€‰æ‹©å»ºè®®ï¼š</strong><br>
                            â€¢ <strong>é€‰æ‹©CPMï¼š</strong>å»ºç­‘å·¥ç¨‹ã€åˆ¶é€ ä¸šç­‰æ ‡å‡†åŒ–é¡¹ç›®<br>
                            â€¢ <strong>é€‰æ‹©PERTï¼š</strong>ç ”å‘é¡¹ç›®ã€æ–°äº§å“å¼€å‘ç­‰åˆ›æ–°æ€§é¡¹ç›®<br>
                            â€¢ <strong>æ··åˆä½¿ç”¨ï¼š</strong>å¤æ‚é¡¹ç›®å¯ä»¥å¯¹ä¸åŒéƒ¨åˆ†é‡‡ç”¨ä¸åŒæ–¹æ³•
                        </div>
                    </div>
                </div>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ å¦‚ä½•å¤„ç†å…³é”®è·¯å¾„ä¸Šå‡ºç°çš„ç“¶é¢ˆå’Œå»¶è¯¯ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer5">
                        <button class="show-answer-btn" onclick="showAnswer(5)">æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>å…³é”®è·¯å¾„ç“¶é¢ˆå¤„ç†ç­–ç•¥ï¼š</strong><br><br>
                            <strong>å³æ—¶å“åº”æªæ–½ï¼š</strong><br>
                            â€¢ <strong>èµ„æºå¢æŠ•ï¼š</strong>å‘ç“¶é¢ˆæ´»åŠ¨å¢åŠ äººåŠ›ã€è®¾å¤‡æˆ–é¢„ç®—<br>
                            â€¢ <strong>å¹¶è¡Œæ‰§è¡Œï¼š</strong>å°†ä¸²è¡Œæ´»åŠ¨æ”¹ä¸ºå¹¶è¡Œï¼Œç¼©çŸ­æ€»å·¥æœŸ<br>
                            â€¢ <strong>å·¥ä½œåˆ†è§£ï¼š</strong>å°†å¤§æ´»åŠ¨åˆ†è§£ä¸ºå¯å¹¶è¡Œçš„å°æ´»åŠ¨<br>
                            â€¢ <strong>å¤–åŒ…åŠ é€Ÿï¼š</strong>å°†éƒ¨åˆ†å·¥ä½œå¤–åŒ…ç»™ä¸“ä¸šå›¢é˜Ÿ<br><br>
                            <strong>ç»“æ„è°ƒæ•´æ–¹æ¡ˆï¼š</strong><br>
                            â€¢ <strong>å¿«é€Ÿè·Ÿè¿›ï¼š</strong>åœ¨å‰ä¸€æ´»åŠ¨æœªå®Œå…¨ç»“æŸæ—¶å°±å¼€å§‹åç»­æ´»åŠ¨<br>
                            â€¢ <strong>èµ¶å·¥ï¼š</strong>æŠ•å…¥é¢å¤–æˆæœ¬ç¼©çŸ­æ´»åŠ¨æ—¶é—´<br>
                            â€¢ <strong>æ›¿ä»£æ–¹æ¡ˆï¼š</strong>å¯»æ‰¾å®Œæˆä»»åŠ¡çš„æ›¿ä»£æŠ€æœ¯æˆ–æ–¹æ³•<br>
                            â€¢ <strong>èŒƒå›´è°ƒæ•´ï¼š</strong>ä¸å¹²ç³»äººåå•†ï¼Œé€‚å½“å‡å°‘é¡¹ç›®èŒƒå›´<br><br>
                            <strong>é¢„é˜²æªæ–½ï¼š</strong><br>
                            â€¢ ä¸ºå…³é”®æ´»åŠ¨é¢„ç•™æ—¶é—´ç¼“å†²<br>
                            â€¢ å»ºç«‹æ—©æœŸé¢„è­¦æŒ‡æ ‡<br>
                            â€¢ åŸ¹å…»å¤šæŠ€èƒ½å›¢é˜Ÿæˆå‘˜<br>
                            â€¢ ä¸ä¾›åº”å•†å»ºç«‹ç´§æ€¥ä¾›åº”åè®®
                        </div>
                    </div>
                </div>
            </div>

            <div class="learning-path">
                <h3>ğŸ›¤ï¸ æ¸è¿›å¼å­¦ä¹ å»ºè®®</h3>
                <div class="unified-grid unified-grid-2">
                    <div class="path-card">
                        <h4>ğŸ¯ åŸºç¡€æŒæ¡</h4>
                        <ul>
                            <li>ç†è§£é¡¹ç›®ç½‘ç»œå›¾çš„æ„å»º</li>
                            <li>ç»ƒä¹ æ­£å‘å’Œåå‘è®¡ç®—</li>
                            <li>è¯†åˆ«ç®€å•é¡¹ç›®çš„å…³é”®è·¯å¾„</li>
                        </ul>
                    </div>
                    <div class="path-card">
                        <h4>ğŸ“ˆ è¿›é˜¶åº”ç”¨</h4>
                        <ul>
                            <li>å¤„ç†å¤æ‚çš„å¤šè·¯å¾„é¡¹ç›®</li>
                            <li>å­¦ä¹ èµ„æºå¹³è¡¡å’Œä¼˜åŒ–</li>
                            <li>æŒæ¡æ—¶é—´-æˆæœ¬æƒè¡¡åˆ†æ</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="resources">
                <h3>ğŸ“š æ¨èå­¦ä¹ èµ„æº</h3>
                <div class="unified-grid unified-grid-3">
                    <div class="resource-card">
                        <span class="card-icon">ğŸ› ï¸</span>
                        <h4>å·¥å…·æ¨è</h4>
                        <p>Microsoft Project, Primavera P6, GanttProject</p>
                    </div>
                    <div class="resource-card">
                        <span class="card-icon">ğŸ“–</span>
                        <h4>ç›¸å…³ä¸»é¢˜</h4>
                        <p>PERTåˆ†æã€ç”˜ç‰¹å›¾ã€èµ„æºåˆ†é…ã€é¡¹ç›®è°ƒåº¦</p>
                    </div>
                    <div class="resource-card">
                        <span class="card-icon">ğŸ“</span>
                        <h4>åç»­å­¦ä¹ </h4>
                        <p>è¿ç­¹å­¦ã€çº¿æ€§è§„åˆ’ã€å¯å‘å¼ç®—æ³•ã€AIè°ƒåº¦</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary">
            <span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a>
        <a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary">
            <span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a>
    </div>
</div>

<style>
/* åŸºç¡€æ ·å¼ */
.concept-overview {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    padding: 25px;
    color: white;
    margin-bottom: 20px;
}

.core-concept {
    text-align: center;
    margin-bottom: 20px;
}

.core-concept h3 {
    margin-bottom: 10px;
    font-size: 1.3em;
}

.concept-breakdown .concept-item {
    background: #f8f9ff;
    border-left: 4px solid #4f46e5;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 0 10px 10px 0;
}

.common-mistakes {
    background: #fef2f2;
    border: 2px solid #fecaca;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
}

.common-mistakes h4 {
    color: #dc2626;
    margin-bottom: 15px;
}

/* å¯è§†åŒ–æ ·å¼ */
.visualization-container {
    text-align: center;
    margin-bottom: 30px;
}

.static-diagram {
    display: flex;
    justify-content: center;
    margin: 20px 0;
}

.demo-controls {
    background: #f0f4f8;
    border-radius: 15px;
    padding: 25px;
    margin: 20px 0;
    text-align: center;
}

.control-panel {
    margin-bottom: 20px;
}

.control-panel button {
    margin: 5px;
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.step-info {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-top: 15px;
    min-height: 60px;
    border: 2px solid #e5e7eb;
}

.calculation-display {
    background: #1f2937;
    color: white;
    border-radius: 15px;
    padding: 25px;
    margin-top: 20px;
}

.calculation-steps {
    font-family: 'Monaco', 'Menlo', monospace;
    line-height: 1.6;
}

/* åº”ç”¨ç¤ºä¾‹æ ·å¼ */
.applications {
    display: grid;
    gap: 20px;
    margin-bottom: 30px;
}

.app-example {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
}

.app-example h3 {
    margin-bottom: 15px;
    font-size: 1.2em;
}

/* ä»£ç ç¤ºä¾‹æ ·å¼ */
.code-examples {
    margin-top: 30px;
}

.language-selector {
    display: flex;
    background: #f3f4f6;
    border-radius: 10px;
    padding: 5px;
    margin-bottom: 15px;
    justify-content: center;
}

.lang-btn {
    flex: 1;
    max-width: 150px;
    padding: 10px 20px;
    border: none;
    background: transparent;
    cursor: pointer;
    border-radius: 6px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.lang-btn.active {
    background: white;
    color: #4f46e5;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.code-container {
    display: none;
    background: #1e1e1e;
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.code-container.active {
    display: block;
}

.code-header {
    background: #2d2d2d;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
}

.copy-btn {
    background: #4f46e5;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    transition: background 0.3s ease;
}

.copy-btn:hover {
    background: #4338ca;
}

pre {
    margin: 0;
    padding: 20px;
    background: #1e1e1e;
    color: #d4d4d4;
    overflow-x: auto;
    line-height: 1.5;
    font-family: 'Monaco', 'Menlo', monospace;
}

/* å­¦ä¹ æ£€éªŒæ ·å¼ */
.quiz-section {
    margin-bottom: 40px;
}

.quiz-item {
    background: #f8f9ff;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 20px;
    border: 2px solid #e5e7eb;
}

.question h4 {
    color: #1f2937;
    margin-bottom: 15px;
}

.options {
    margin: 15px 0;
}

.options label {
    display: block;
    padding: 10px 0;
    cursor: pointer;
    transition: color 0.3s ease;
}

.options label:hover {
    color: #4f46e5;
}

.options input[type="radio"] {
    margin-right: 10px;
}

.answer {
    margin-top: 15px;
}

.show-answer-btn {
    background: #4f46e5;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s ease;
}

.show-answer-btn:hover {
    background: #4338ca;
}

.answer-content {
    margin-top: 15px;
    padding: 15px;
    background: #dcfce7;
    border-left: 4px solid #16a34a;
    border-radius: 0 8px 8px 0;
}

/* å­¦ä¹ è·¯å¾„æ ·å¼ */
.learning-path {
    margin: 30px 0;
}

.path-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
}

.path-card h4 {
    margin-bottom: 15px;
}

.path-card ul {
    list-style: none;
    padding: 0;
}

.path-card li {
    padding: 5px 0;
    position: relative;
    padding-left: 20px;
}

.path-card li:before {
    content: "âœ…";
    position: absolute;
    left: 0;
}

/* èµ„æºå¡ç‰‡æ ·å¼ */
.resources {
    margin-top: 30px;
}

.resource-card {
    text-align: center;
    padding: 25px;
    background: #f8f9ff;
    border-radius: 15px;
    border: 2px solid #e5e7eb;
    transition: transform 0.3s ease;
}

.resource-card:hover {
    transform: translateY(-5px);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .unified-grid {
        grid-template-columns: 1fr !important;
    }

    .language-selector {
        flex-direction: column;
    }

    .lang-btn {
        max-width: none;
        margin: 2px 0;
    }

    .demo-controls button {
        display: block;
        width: 100%;
        margin: 5px 0;
    }
}
</style>

<script>
// Canvasç»˜å›¾ç›¸å…³
let canvas, ctx;
let animationFrame;
let currentStep = 0;
let showingCritical = false;
let isAnimating = false;
let animationProgress = 0;
let particles = [];
let pulseNodes = [];
let calculatingNode = null;

// èŠ‚ç‚¹å’Œè¾¹çš„æ•°æ®ç»“æ„
let nodes = [
    {id: 'Start', x: 100, y: 200, es: 0, ls: 0, targetES: 0, targetLS: 0, radius: 35, pulse: 0, calculating: false},
    {id: 'A', x: 280, y: 120, es: 0, ls: 0, targetES: 0, targetLS: 0, radius: 35, pulse: 0, calculating: false},
    {id: 'B', x: 280, y: 280, es: 0, ls: 0, targetES: 0, targetLS: 0, radius: 35, pulse: 0, calculating: false},
    {id: 'C', x: 460, y: 200, es: 0, ls: 0, targetES: 0, targetLS: 0, radius: 35, pulse: 0, calculating: false},
    {id: 'End', x: 640, y: 200, es: 0, ls: 0, targetES: 0, targetLS: 0, radius: 35, pulse: 0, calculating: false}
];

let edges = [
    {from: 'Start', to: 'A', duration: 3, critical: false, pulse: 0, calculating: false, flowParticles: []},
    {from: 'Start', to: 'B', duration: 4, critical: true, pulse: 0, calculating: false, flowParticles: []},
    {from: 'A', to: 'C', duration: 2, critical: false, pulse: 0, calculating: false, flowParticles: []},
    {from: 'B', to: 'C', duration: 1, critical: true, pulse: 0, calculating: false, flowParticles: []},
    {from: 'C', to: 'End', duration: 3, critical: true, pulse: 0, calculating: false, flowParticles: []}
];

// ç²’å­ç³»ç»Ÿ
class Particle {
    constructor(x, y, type = 'normal') {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = (Math.random() - 0.5) * 2;
        this.life = 1.0;
        this.maxLife = 60 + Math.random() * 40;
        this.size = 2 + Math.random() * 3;
        this.type = type;
        this.hue = type === 'critical' ? 0 : 220; // çº¢è‰² vs è“è‰²
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.life -= 1/this.maxLife;
        this.vx *= 0.99;
        this.vy *= 0.99;
        return this.life > 0;
    }

    draw(ctx) {
        const alpha = this.life;
        ctx.save();
        ctx.globalAlpha = alpha;
        ctx.fillStyle = `hsla(${this.hue}, 70%, 60%, ${alpha})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size * this.life, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
}

// æµåŠ¨ç²’å­ç±»
class FlowParticle {
    constructor(startX, startY, endX, endY) {
        this.startX = startX;
        this.startY = startY;
        this.endX = endX;
        this.endY = endY;
        this.progress = 0;
        this.x = startX;
        this.y = startY;
        this.speed = 0.02;
        this.size = 3;
        this.life = 1.0;
    }

    update() {
        this.progress += this.speed;
        if (this.progress > 1) {
            this.progress = 0;
        }

        // å¹³æ»‘æ’å€¼
        this.x = this.startX + (this.endX - this.startX) * this.progress;
        this.y = this.startY + (this.endY - this.startY) * this.progress;
    }

    draw(ctx) {
        ctx.save();
        ctx.globalAlpha = 0.8;
        ctx.fillStyle = '#10b981';
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#10b981';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
    }
}

document.addEventListener('DOMContentLoaded', function() {
    canvas = document.getElementById('networkCanvas');
    ctx = canvas.getContext('2d');

    // è®¾ç½®é«˜DPIæ”¯æŒ
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);
    canvas.style.width = rect.width + 'px';
    canvas.style.height = rect.height + 'px';

    // å¯åŠ¨åŠ¨ç”»å¾ªç¯
    animate();

    // ç»‘å®šäº‹ä»¶
    document.getElementById('startDemo').addEventListener('click', startDemo);
    document.getElementById('stepForward').addEventListener('click', stepForward);
    document.getElementById('stepBackward').addEventListener('click', stepBackward);
    document.getElementById('showCritical').addEventListener('click', showCriticalPath);
    document.getElementById('resetDemo').addEventListener('click', resetDemo);

    // ä»£ç åˆ‡æ¢
    setupCodeTabs();
    setupCopyButtons();
});

// ä¸»åŠ¨ç”»å¾ªç¯
function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // æ›´æ–°å’Œç»˜åˆ¶ç²’å­
    updateParticles();

    // æ›´æ–°èŠ‚ç‚¹åŠ¨ç”»
    updateNodeAnimations();

    // æ›´æ–°è¾¹çš„åŠ¨ç”»
    updateEdgeAnimations();

    // ç»˜åˆ¶ç½‘ç»œ
    drawNetwork();

    requestAnimationFrame(animate);
}

// ç»˜åˆ¶ç½‘ç»œï¼ˆå¢å¼ºç‰ˆï¼‰
function drawNetwork() {
    // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
    drawGrid();

    // ç»˜åˆ¶è¾¹å’Œç®­å¤´
    edges.forEach((edge, index) => {
        const fromNode = nodes.find(n => n.id === edge.from);
        const toNode = nodes.find(n => n.id === edge.to);

        drawEdge(fromNode, toNode, edge, index);
    });

    // ç»˜åˆ¶èŠ‚ç‚¹
    nodes.forEach((node, index) => {
        drawNode(node, index);
    });

    // ç»˜åˆ¶ç²’å­æ•ˆæœ
    drawParticles();
}

// ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
function drawGrid() {
    ctx.save();
    ctx.globalAlpha = 0.1;
    ctx.strokeStyle = '#6b7280';
    ctx.lineWidth = 1;

    // å‚ç›´çº¿
    for (let x = 0; x < canvas.width; x += 40) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
    }

    // æ°´å¹³çº¿
    for (let y = 0; y < canvas.height; y += 40) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }

    ctx.restore();
}

// å¢å¼ºçš„è¾¹ç»˜åˆ¶
function drawEdge(fromNode, toNode, edge, index) {
    ctx.save();

    // è®¡ç®—è¾¹çš„ä½ç½®
    const dx = toNode.x - fromNode.x;
    const dy = toNode.y - fromNode.y;
    const distance = Math.sqrt(dx*dx + dy*dy);
    const unitX = dx / distance;
    const unitY = dy / distance;

    const startX = fromNode.x + unitX * fromNode.radius;
    const startY = fromNode.y + unitY * fromNode.radius;
    const endX = toNode.x - unitX * toNode.radius;
    const endY = toNode.y - unitY * toNode.radius;

    // è¾¹çš„é¢œè‰²å’Œå®½åº¦
    let strokeColor = '#6b7280';
    let lineWidth = 3;
    let glowSize = 0;

    if (edge.critical && showingCritical) {
        strokeColor = '#ef4444';
        lineWidth = 4;
        glowSize = 8;
    } else if (edge.calculating) {
        strokeColor = '#10b981';
        lineWidth = 4;
        glowSize = 6;
    }

    // è„‰å†²æ•ˆæœ
    if (edge.pulse > 0) {
        glowSize += edge.pulse * 10;
        ctx.globalAlpha = 0.3 + edge.pulse * 0.7;
    }

    // ç»˜åˆ¶å‘å…‰æ•ˆæœ
    if (glowSize > 0) {
        ctx.strokeStyle = strokeColor;
        ctx.lineWidth = lineWidth + glowSize;
        ctx.globalAlpha = 0.3;
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.lineTo(endX, endY);
        ctx.stroke();
    }

    // ç»˜åˆ¶ä¸»çº¿
    ctx.globalAlpha = 1;
    ctx.strokeStyle = strokeColor;
    ctx.lineWidth = lineWidth;
    ctx.beginPath();
    ctx.moveTo(startX, startY);
    ctx.lineTo(endX, endY);
    ctx.stroke();

    // ç»˜åˆ¶ç®­å¤´
    drawArrow(ctx, startX, startY, endX, endY, strokeColor, lineWidth);

    // ç»˜åˆ¶æƒé‡æ ‡ç­¾
    const midX = (startX + endX) / 2;
    const midY = (startY + endY) / 2 - 20;

    ctx.fillStyle = '#1f2937';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(edge.duration.toString(), midX, midY);

    // ç»˜åˆ¶æµåŠ¨ç²’å­
    edge.flowParticles.forEach(particle => {
        particle.draw(ctx);
    });

    ctx.restore();
}

// å¢å¼ºçš„èŠ‚ç‚¹ç»˜åˆ¶
function drawNode(node, index) {
    ctx.save();

    // è„‰å†²åŠ¨ç”»
    const pulseRadius = node.radius + node.pulse * 15;
    let nodeColor = '#3b82f6';

    if (showingCritical && node.ls === node.es && currentStep > 1) {
        nodeColor = '#ef4444';
    } else if (node.calculating) {
        nodeColor = '#10b981';
    }

    // ç»˜åˆ¶å‘å…‰æ•ˆæœ
    if (node.pulse > 0 || node.calculating) {
        const glowRadius = pulseRadius + 10;
        const gradient = ctx.createRadialGradient(node.x, node.y, node.radius, node.x, node.y, glowRadius);
        gradient.addColorStop(0, nodeColor + '40');
        gradient.addColorStop(1, nodeColor + '00');

        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(node.x, node.y, glowRadius, 0, 2 * Math.PI);
        ctx.fill();
    }

    // ç»˜åˆ¶ä¸»èŠ‚ç‚¹
    ctx.beginPath();
    ctx.arc(node.x, node.y, pulseRadius, 0, 2 * Math.PI);

    // æ¸å˜å¡«å……
    const gradient = ctx.createRadialGradient(node.x - 10, node.y - 10, 0, node.x, node.y, pulseRadius);
    gradient.addColorStop(0, nodeColor + 'dd');
    gradient.addColorStop(1, nodeColor);
    ctx.fillStyle = gradient;
    ctx.fill();

    // è¾¹æ¡†
    ctx.strokeStyle = '#1f2937';
    ctx.lineWidth = 3;
    ctx.stroke();

    // èŠ‚ç‚¹æ ‡ç­¾
    ctx.fillStyle = 'white';
    ctx.font = 'bold 14px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(node.id, node.x, node.y + 5);

    // ES/LSæ ‡ç­¾ï¼ˆå¸¦åŠ¨ç”»ï¼‰
    if (currentStep > 0) {
        ctx.fillStyle = '#1f2937';
        ctx.font = 'bold 12px Arial';

        // ESæ ‡ç­¾
        const esText = `ES:${Math.round(node.es)}`;
        ctx.fillText(esText, node.x - 25, node.y - 50);

        if (currentStep > 1) {
            // LSæ ‡ç­¾
            const lsText = `LS:${Math.round(node.ls)}`;
            ctx.fillText(lsText, node.x + 25, node.y - 50);

            // æµ®åŠ¨æ—¶é—´
            const floatTime = node.ls - node.es;
            if (floatTime >= 0) {
                ctx.fillStyle = floatTime === 0 ? '#ef4444' : '#10b981';
                ctx.font = '10px Arial';
                ctx.fillText(`Float:${floatTime}`, node.x, node.y + 55);
            }
        }
    }

    ctx.restore();
}

// æ›´æ–°èŠ‚ç‚¹åŠ¨ç”»
function updateNodeAnimations() {
    nodes.forEach(node => {
        // å¹³æ»‘æ•°å€¼å˜åŒ–
        node.es += (node.targetES - node.es) * 0.1;
        node.ls += (node.targetLS - node.ls) * 0.1;

        // è„‰å†²åŠ¨ç”»
        if (node.pulse > 0) {
            node.pulse -= 0.02;
            if (node.pulse < 0) node.pulse = 0;
        }

        // è®¡ç®—åŠ¨ç”»
        if (node.calculating) {
            node.pulse = Math.max(node.pulse, Math.sin(Date.now() * 0.01) * 0.5 + 0.5);
        }
    });
}

// æ›´æ–°è¾¹åŠ¨ç”»
function updateEdgeAnimations() {
    edges.forEach(edge => {
        // è„‰å†²åŠ¨ç”»
        if (edge.pulse > 0) {
            edge.pulse -= 0.02;
            if (edge.pulse < 0) edge.pulse = 0;
        }

        // æ›´æ–°æµåŠ¨ç²’å­
        edge.flowParticles.forEach(particle => {
            particle.update();
        });

        // æ·»åŠ æ–°çš„æµåŠ¨ç²’å­
        if (edge.calculating && Math.random() < 0.3) {
            const fromNode = nodes.find(n => n.id === edge.from);
            const toNode = nodes.find(n => n.id === edge.to);
            edge.flowParticles.push(new FlowParticle(fromNode.x, fromNode.y, toNode.x, toNode.y));
        }

        // æ¸…ç†æ—§ç²’å­
        edge.flowParticles = edge.flowParticles.filter(particle => particle.progress < 1.1);
    });
}

// æ›´æ–°ç²’å­ç³»ç»Ÿ
function updateParticles() {
    particles = particles.filter(particle => particle.update());
}

// ç»˜åˆ¶ç²’å­
function drawParticles() {
    particles.forEach(particle => particle.draw(ctx));
}

// æ·»åŠ ç²’å­çˆ†ç‚¸æ•ˆæœ
function addParticleExplosion(x, y, type = 'normal', count = 15) {
    for (let i = 0; i < count; i++) {
        particles.push(new Particle(x, y, type));
    }
}

// å¢å¼ºçš„ç®­å¤´ç»˜åˆ¶
function drawArrow(ctx, fromX, fromY, toX, toY, color, lineWidth) {
    const angle = Math.atan2(toY - fromY, toX - fromX);
    const arrowLength = 15;
    const arrowAngle = Math.PI / 6;

    ctx.save();
    ctx.strokeStyle = color;
    ctx.fillStyle = color;
    ctx.lineWidth = lineWidth;

    // ç®­å¤´çº¿æ¡
    ctx.beginPath();
    ctx.moveTo(toX - arrowLength * Math.cos(angle - arrowAngle),
               toY - arrowLength * Math.sin(angle - arrowAngle));
    ctx.lineTo(toX, toY);
    ctx.lineTo(toX - arrowLength * Math.cos(angle + arrowAngle),
               toY - arrowLength * Math.sin(angle + arrowAngle));
    ctx.closePath();
    ctx.fill();
    ctx.stroke();

    ctx.restore();
}

// æ¼”ç¤ºæ§åˆ¶å‡½æ•°
function startDemo() {
    currentStep = 0;
    showingCritical = false;
    resetNodeValues();
    clearAllAnimations();
    updateStepInfo("æ¼”ç¤ºå·²é‡ç½®ï¼Œç‚¹å‡»'æ­£å‘è®¡ç®—'å¼€å§‹å­¦ä¹ å…³é”®è·¯å¾„ç®—æ³•");
    updateCalculationSteps("");
}

async function stepForward() {
    if (currentStep === 0 && !isAnimating) {
        isAnimating = true;
        updateStepInfo("æ­£å‘è®¡ç®—ä¸­ï¼šä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹è®¡ç®—æœ€æ—©å‘ç”Ÿæ—¶é—´(ES)...");

        // åŠ¨ç”»åŒ–è®¡ç®—ESå€¼
        await animateForwardCalculation();

        currentStep = 1;
        isAnimating = false;
        updateStepInfo("âœ… æ­£å‘è®¡ç®—å®Œæˆï¼šæ‰€æœ‰èŠ‚ç‚¹çš„æœ€æ—©å‘ç”Ÿæ—¶é—´(ES)å·²è®¡ç®—å®Œæ¯•");
        updateCalculationSteps(`<div class="calc-step-by-step">
            <h4>ğŸ”„ æ­£å‘è®¡ç®—è¿‡ç¨‹ (Forward Pass):</h4>
            <div class="calc-line">StartèŠ‚ç‚¹: ES = 0 (é¡¹ç›®èµ·å§‹æ—¶é—´)</div>
            <div class="calc-line">AèŠ‚ç‚¹: ES = ES(Start) + 3 = 0 + 3 = 3</div>
            <div class="calc-line">BèŠ‚ç‚¹: ES = ES(Start) + 4 = 0 + 4 = 4</div>
            <div class="calc-line">CèŠ‚ç‚¹: ES = max(ES(A) + 2, ES(B) + 1) = max(3+2, 4+1) = max(5, 5) = 5</div>
            <div class="calc-line">EndèŠ‚ç‚¹: ES = ES(C) + 3 = 5 + 3 = 8</div>
            <div class="calc-summary">ğŸ“Š é¡¹ç›®æœ€çŸ­å®Œæˆæ—¶é—´: 8å¤©</div>
        </div>`);
    }
}

async function stepBackward() {
    if (currentStep === 1 && !isAnimating) {
        isAnimating = true;
        updateStepInfo("åå‘è®¡ç®—ä¸­ï¼šä»ç»ˆç‚¹èŠ‚ç‚¹å¼€å§‹è®¡ç®—æœ€æ™šå‘ç”Ÿæ—¶é—´(LS)...");

        // åŠ¨ç”»åŒ–è®¡ç®—LSå€¼
        await animateBackwardCalculation();

        currentStep = 2;
        isAnimating = false;
        updateStepInfo("âœ… åå‘è®¡ç®—å®Œæˆï¼šæ‰€æœ‰èŠ‚ç‚¹çš„æœ€æ™šå‘ç”Ÿæ—¶é—´(LS)å·²è®¡ç®—å®Œæ¯•");
        updateCalculationSteps(`<div class="calc-step-by-step">
            <h4>ğŸ”™ åå‘è®¡ç®—è¿‡ç¨‹ (Backward Pass):</h4>
            <div class="calc-line">EndèŠ‚ç‚¹: LS = 8 (é¡¹ç›®å¿…é¡»å®Œæˆæ—¶é—´)</div>
            <div class="calc-line">CèŠ‚ç‚¹: LS = LS(End) - 3 = 8 - 3 = 5</div>
            <div class="calc-line">BèŠ‚ç‚¹: LS = LS(C) - 1 = 5 - 1 = 4</div>
            <div class="calc-line">AèŠ‚ç‚¹: LS = LS(C) - 2 = 5 - 2 = 3</div>
            <div class="calc-line">StartèŠ‚ç‚¹: LS = min(LS(A) - 3, LS(B) - 4) = min(3-3, 4-4) = min(0, 0) = 0</div>
            <div class="calc-summary">ğŸ“Š æµ®åŠ¨æ—¶é—´ = LS - ESï¼Œä¸º0çš„è·¯å¾„æ˜¯å…³é”®è·¯å¾„</div>
        </div>`);
    }
}

async function showCriticalPath() {
    if (currentStep >= 2 && !isAnimating) {
        isAnimating = true;
        showingCritical = true;

        updateStepInfo("è¯†åˆ«å…³é”®è·¯å¾„ä¸­ï¼šåˆ†ææµ®åŠ¨æ—¶é—´ä¸º0çš„æ´»åŠ¨...");

        // åŠ¨ç”»åŒ–å…³é”®è·¯å¾„è¯†åˆ«
        await animateCriticalPathIdentification();

        isAnimating = false;
        updateStepInfo("ğŸ¯ å…³é”®è·¯å¾„å·²è¯†åˆ«ï¼šStart â†’ B â†’ C â†’ End (æ€»å·¥æœŸ: 8å¤©)");
        updateCalculationSteps(`<div class="calc-step-by-step">
            <h4>ğŸ¯ å…³é”®è·¯å¾„åˆ†æ:</h4>
            <div class="calc-header">æµ®åŠ¨æ—¶é—´è®¡ç®—å…¬å¼: Float = LS - ES - Duration</div>
            <br>
            <div class="activity-analysis">
                <div class="activity-item non-critical">
                    <strong>Start â†’ A:</strong> Float = 3 - 0 - 3 = 0 å¤© (å…³é”®æ´»åŠ¨)
                </div>
                <div class="activity-item critical">
                    <strong>Start â†’ B:</strong> Float = 4 - 0 - 4 = 0 å¤© (å…³é”®æ´»åŠ¨) â­
                </div>
                <div class="activity-item non-critical">
                    <strong>A â†’ C:</strong> Float = 5 - 3 - 2 = 0 å¤© (å…³é”®æ´»åŠ¨)
                </div>
                <div class="activity-item critical">
                    <strong>B â†’ C:</strong> Float = 5 - 4 - 1 = 0 å¤© (å…³é”®æ´»åŠ¨) â­
                </div>
                <div class="activity-item critical">
                    <strong>C â†’ End:</strong> Float = 8 - 5 - 3 = 0 å¤© (å…³é”®æ´»åŠ¨) â­
                </div>
            </div>
            <br>
            <div class="critical-path-result">
                <strong>ğŸ”´ å…³é”®è·¯å¾„:</strong> Start â†’ B â†’ C â†’ End<br>
                <strong>â±ï¸ é¡¹ç›®å·¥æœŸ:</strong> 8å¤©<br>
                <strong>âš ï¸ é£é™©æç¤º:</strong> å…³é”®è·¯å¾„ä¸Šä»»ä½•æ´»åŠ¨çš„å»¶è¿Ÿéƒ½ä¼šç›´æ¥å½±å“é¡¹ç›®å®Œæˆæ—¶é—´
            </div>
        </div>`);
    } else if (currentStep < 2) {
        updateStepInfo("âŒ è¯·å…ˆå®Œæˆæ­£å‘å’Œåå‘è®¡ç®—æ­¥éª¤");
    }
}

function resetDemo() {
    currentStep = 0;
    showingCritical = false;
    isAnimating = false;
    resetNodeValues();
    clearAllAnimations();
    updateStepInfo("ğŸ”„ æ¼”ç¤ºå·²é‡ç½®ï¼Œå‡†å¤‡å¼€å§‹æ–°çš„å­¦ä¹ ");
    updateCalculationSteps("");
}

// åŠ¨ç”»å‡½æ•°
async function animateForwardCalculation() {
    const calculationOrder = [
        {node: 'Start', es: 0, delay: 500},
        {node: 'A', es: 3, delay: 800, fromEdge: 0},
        {node: 'B', es: 4, delay: 800, fromEdge: 1},
        {node: 'C', es: 5, delay: 1200, fromEdges: [2, 3]},
        {node: 'End', es: 8, delay: 800, fromEdge: 4}
    ];

    for (const calc of calculationOrder) {
        const node = nodes.find(n => n.id === calc.node);

        // é«˜äº®æ­£åœ¨è®¡ç®—çš„èŠ‚ç‚¹
        node.calculating = true;
        if (calc.fromEdge !== undefined) {
            edges[calc.fromEdge].calculating = true;
        }
        if (calc.fromEdges) {
            calc.fromEdges.forEach(edgeIndex => {
                edges[edgeIndex].calculating = true;
            });
        }

        // æ·»åŠ ç²’å­æ•ˆæœ
        addParticleExplosion(node.x, node.y, 'normal', 10);

        // åŠ¨ç”»æ›´æ–°æ•°å€¼
        await animateNodeValue(node, 'es', calc.es);

        // è„‰å†²æ•ˆæœ
        node.pulse = 1.0;

        // æ¸…ç†åŠ¨ç”»çŠ¶æ€
        node.calculating = false;
        edges.forEach(edge => edge.calculating = false);

        await delay(calc.delay);
    }
}

async function animateBackwardCalculation() {
    const calculationOrder = [
        {node: 'End', ls: 8, delay: 500},
        {node: 'C', ls: 5, delay: 800, fromEdge: 4},
        {node: 'B', ls: 4, delay: 800, fromEdge: 3},
        {node: 'A', ls: 3, delay: 800, fromEdge: 2},
        {node: 'Start', ls: 0, delay: 1200, fromEdges: [0, 1]}
    ];

    for (const calc of calculationOrder) {
        const node = nodes.find(n => n.id === calc.node);

        // é«˜äº®æ­£åœ¨è®¡ç®—çš„èŠ‚ç‚¹
        node.calculating = true;
        if (calc.fromEdge !== undefined) {
            edges[calc.fromEdge].calculating = true;
        }
        if (calc.fromEdges) {
            calc.fromEdges.forEach(edgeIndex => {
                edges[edgeIndex].calculating = true;
            });
        }

        // æ·»åŠ ç²’å­æ•ˆæœ
        addParticleExplosion(node.x, node.y, 'normal', 10);

        // åŠ¨ç”»æ›´æ–°æ•°å€¼
        await animateNodeValue(node, 'ls', calc.ls);

        // è„‰å†²æ•ˆæœ
        node.pulse = 1.0;

        // æ¸…ç†åŠ¨ç”»çŠ¶æ€
        node.calculating = false;
        edges.forEach(edge => edge.calculating = false);

        await delay(calc.delay);
    }
}

async function animateCriticalPathIdentification() {
    // æ ‡è®°å…³é”®è¾¹
    const criticalEdgeIndices = [1, 3, 4]; // Start->B, B->C, C->End

    for (const edgeIndex of criticalEdgeIndices) {
        edges[edgeIndex].critical = true;
        edges[edgeIndex].pulse = 1.0;

        // æ·»åŠ å…³é”®è·¯å¾„ç²’å­æ•ˆæœ
        const edge = edges[edgeIndex];
        const fromNode = nodes.find(n => n.id === edge.from);
        const toNode = nodes.find(n => n.id === edge.to);

        addParticleExplosion(fromNode.x, fromNode.y, 'critical', 15);
        addParticleExplosion(toNode.x, toNode.y, 'critical', 15);

        await delay(600);
    }

    // æ ‡è®°å…³é”®èŠ‚ç‚¹
    const criticalNodeIds = ['Start', 'B', 'C', 'End'];
    criticalNodeIds.forEach(nodeId => {
        const node = nodes.find(n => n.id === nodeId);
        node.pulse = 1.0;
    });
}

// è¾…åŠ©å‡½æ•°
async function animateNodeValue(node, property, targetValue) {
    return new Promise(resolve => {
        node[`target${property.toUpperCase()}`] = targetValue;
        const startValue = node[property];
        const duration = 1000; // 1ç§’
        const startTime = Date.now();

        const animateStep = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(elapsed / duration, 1);

            // ä½¿ç”¨easeOutQuartç¼“åŠ¨å‡½æ•°
            const easedProgress = 1 - Math.pow(1 - progress, 4);
            node[property] = startValue + (targetValue - startValue) * easedProgress;

            if (progress < 1) {
                requestAnimationFrame(animateStep);
            } else {
                resolve();
            }
        };

        animateStep();
    });
}

function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

function resetNodeValues() {
    nodes.forEach(node => {
        node.es = 0;
        node.ls = 0;
        node.targetES = 0;
        node.targetLS = 0;
        node.pulse = 0;
        node.calculating = false;
    });
}

function clearAllAnimations() {
    edges.forEach(edge => {
        edge.critical = false;
        edge.pulse = 0;
        edge.calculating = false;
        edge.flowParticles = [];
    });
    particles.length = 0;
}

function updateStepInfo(message) {
    const stepInfo = document.getElementById('stepInfo');
    stepInfo.innerHTML = `<div class="step-message">${message}</div>`;

    // æ·»åŠ æ‰“å­—æœºæ•ˆæœ
    if (message.includes('è®¡ç®—ä¸­') || message.includes('è¯†åˆ«ä¸­')) {
        stepInfo.classList.add('calculating');
    } else {
        stepInfo.classList.remove('calculating');
    }
}

function updateCalculationSteps(steps) {
    document.getElementById('calculationSteps').innerHTML = steps;
}

// ä»£ç åˆ‡æ¢åŠŸèƒ½
function setupCodeTabs() {
    const langBtns = document.querySelectorAll('.lang-btn');
    const codeContainers = document.querySelectorAll('.code-container');

    langBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');

            langBtns.forEach(b => b.classList.remove('active'));
            codeContainers.forEach(c => c.classList.remove('active'));

            btn.classList.add('active');
            document.getElementById(`code-${lang}`).classList.add('active');
        });
    });
}

// å¤åˆ¶ä»£ç åŠŸèƒ½
function setupCopyButtons() {
    const copyBtns = document.querySelectorAll('.copy-btn');

    copyBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-code');
            const codeElement = document.querySelector(`#code-${lang} code`);
            const text = codeElement.textContent;

            navigator.clipboard.writeText(text).then(() => {
                btn.textContent = 'âœ… å·²å¤åˆ¶';
                btn.style.background = '#10b981';

                setTimeout(() => {
                    btn.textContent = 'ğŸ“‹ å¤åˆ¶ä»£ç ';
                    btn.style.background = '#4f46e5';
                }, 2000);
            });
        });
    });
}

// ç­”æ¡ˆæ˜¾ç¤ºåŠŸèƒ½ï¼ˆå¢å¼ºç‰ˆï¼‰
function showAnswer(questionNum) {
    const answer = document.querySelector(`#answer${questionNum} .answer-content`);
    const btn = document.querySelector(`#answer${questionNum} .show-answer-btn`);

    if (answer.style.display === 'none') {
        answer.style.display = 'block';
        btn.textContent = 'ğŸ”¼ éšè—ç­”æ¡ˆ';
        btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';

        // æ·»åŠ æ˜¾ç¤ºåŠ¨ç”»
        answer.style.animation = 'slideInUp 0.5s ease-out';

        // æ»šåŠ¨åˆ°ç­”æ¡ˆä½ç½®
        setTimeout(() => {
            answer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 300);

    } else {
        answer.style.display = 'none';
        btn.textContent = 'ğŸ“– æŸ¥çœ‹ç­”æ¡ˆ';
        btn.style.background = 'linear-gradient(135deg, #4f46e5, #7c3aed)';
    }
}
</script>
{% endblock %}