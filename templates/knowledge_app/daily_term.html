{% extends 'knowledge_app/base.html' %}
{% load quiz_extras %}

{% block title %}每日名词 - 计算机科学学习平台{% endblock %}

{% block extra_css %}
<style>* {box-sizing:border-box}body {font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;line-height:1.6;color:var(--text-primary);background:linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);min-height:100vh;margin:0;padding:0}.page-layout {min-height:100vh;display:flex;flex-direction:column}.main-content {flex:1;width:100%}.daily-term-container {max-width:1400px;margin:0 auto;padding:24px;min-height:100vh;position:relative;z-index:1;display:flex;flex-direction:column;gap:32px}.page-header {background:rgba(255, 255, 255, 0.1);backdrop-filter:blur(15px);border-radius:24px;padding:40px;margin-bottom:0;color:var(--text-inverse);text-align:center;position:relative;z-index:2;box-shadow:var(--shadow-md)}.breadcrumb {position:absolute;top:24px;left:32px;display:flex;align-items:center;gap:10px;font-size:0.9rem;opacity:0.95;z-index:3}.breadcrumb-item {color:rgba(255, 255, 255, 0.9);text-decoration:none;transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);padding:6px 12px;border-radius:16px;background:rgba(255, 255, 255, 0.12);backdrop-filter:blur(8px);border:1px solid rgba(255, 255, 255, 0.1)}.breadcrumb-item:hover {color:var(--text-inverse);background:rgba(255, 255, 255, 0.25);transform:translateY(-2px);box-shadow:var(--shadow-md)}.breadcrumb-separator {color:rgba(255, 255, 255, 0.7);font-weight:500;font-size:1.1rem}.breadcrumb-current {color:var(--text-inverse);font-weight:600;background:rgba(255, 255, 255, 0.2);padding:6px 12px;border-radius:16px}.quick-nav {margin-top:25px;display:flex;justify-content:center;gap:15px;flex-wrap:wrap}.nav-btn {background:rgba(255, 255, 255, 0.15);color:var(--text-inverse);text-decoration:none;padding:10px 20px;border-radius:25px;border:1px solid rgba(255, 255, 255, 0.3);transition:all 0.3s ease;font-size:0.9rem;font-weight:500;cursor:pointer;display:inline-flex;align-items:center;gap:8px}.nav-btn:hover {background:rgba(255, 255, 255, 0.25);border-color:rgba(255, 255, 255, 0.5);transform:translateY(-2px);box-shadow:var(--shadow-md)}.page-title {font-size:2.8rem;font-weight:800;margin-bottom:16px;display:flex;align-items:center;justify-content:center;gap:16px;letter-spacing:-0.02em;text-shadow:0 2px 8px rgba(0, 0, 0, 0.1)}.page-subtitle {font-size:1.2rem;opacity:0.92;margin-bottom:24px;font-weight:400;line-height:1.5}.current-date {background:rgba(255, 255, 255, 0.25);padding:10px 20px;border-radius:24px;font-size:0.95rem;display:inline-block;font-weight:500;backdrop-filter:blur(8px);border:1px solid rgba(255, 255, 255, 0.2);box-shadow:var(--shadow-md)}.today-term-card {background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);border-radius:24px;padding:3rem;box-shadow:0 12px 40px rgba(0,0,0,0.08);margin:0;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.8);transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);backdrop-filter:blur(20px)}.today-term-card::before {content:'';position:absolute;top:0;left:0;right:0;height:6px;background:linear-gradient(90deg, #667eea 0%, #764ba2 25%, #4ecdc4 50%, #44a08d 75%, #667eea 100%);background-size:300% 100%;animation:gradientShift 4s ease-in-out infinite}@keyframes gradientShift {0%, 100% {background-position:0% 0%}50% {background-position:100% 0%}}.today-term-card:hover {transform:translateY(-12px) scale(1.01);box-shadow:0 25px 60px rgba(0,0,0,0.15);border-color:rgba(102, 126, 234, 0.3)}.term-header {display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:32px;gap:24px}.term-title {font-size:2.8rem;font-weight:900;background:linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:0;letter-spacing:-0.03em;line-height:1.1;flex:1;text-shadow:0 2px 4px rgba(0,0,0,0.1)}.term-meta {display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start;flex-shrink:0}.meta-badge {padding:8px 16px;border-radius:20px;font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.8px;transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);box-shadow:0 2px 8px rgba(0,0,0,0.1);backdrop-filter:blur(10px)}.category-badge {background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;border:1px solid rgba(255,255,255,0.2)}.category-badge:hover {transform:translateY(-2px);box-shadow:0 4px 12px rgba(102, 126, 234, 0.4)}.difficulty-badge {background:linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);color:white;border:1px solid rgba(255,255,255,0.2)}.difficulty-badge:hover {transform:translateY(-2px);box-shadow:0 4px 12px rgba(78, 205, 196, 0.4)}.difficulty-beginner {background:#e8f5e8;color:#2e7d32}.difficulty-intermediate {background:#fff3e0;color:#f57c00}.difficulty-advanced {background:#ffebee;color:#d32f2f}.term-explanation {margin-bottom:40px}.explanation-section {background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);border-radius:16px;padding:2rem;margin-bottom:1.5rem;border-left:4px solid #667eea;box-shadow:0 4px 16px rgba(0,0,0,0.05);transition:all 0.3s ease}.explanation-section:hover {transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.1)}.explanation-section:nth-child(1) {border-left-color:#667eea}.explanation-section:nth-child(2) {border-left-color:#4ecdc4}.explanation-section:nth-child(3) {border-left-color:#45b7d1}.explanation-section:nth-child(4) {border-left-color:#96ceb4}.explanation-section:nth-child(5) {border-left-color:#feca57}.section-title {display:flex;align-items:center;gap:0.8rem;font-size:1.3rem;font-weight:700;color:#2d3748;margin:0 0 1.5rem 0;padding-bottom:0.8rem;border-bottom:2px solid rgba(0,0,0,0.05)}.section-icon {font-size:1.5rem;display:flex;align-items:center;justify-content:center;width:2.5rem;height:2.5rem;background:linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}.section-content {font-size:1.1rem;line-height:1.7;color:#4a5568;white-space:pre-line;font-weight:400;letter-spacing:0.01em}.term-actions {display:flex;gap:15px;align-items:center;justify-content:space-between;padding-top:20px;border-top:1px solid #eee}.action-buttons {display:flex;gap:10px}.btn {padding:14px 28px;border-radius:16px;border:none;font-weight:600;cursor:pointer;transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);text-decoration:none;display:inline-flex;align-items:center;gap:10px;font-size:0.95rem;position:relative;overflow:hidden;white-space:nowrap}.btn::before {content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);transition:left 0.5s}.btn:hover::before {left:100%}.btn-primary {background:linear-gradient(135deg, var(--accent-color), #44a08d);color:var(--text-inverse);box-shadow:0 4px 16px rgba(78, 205, 196, 0.3)}.btn-primary:hover {background:linear-gradient(135deg, #44a08d, #3a8b7a);transform:translateY(-3px);box-shadow:0 8px 24px rgba(78, 205, 196, 0.4)}.btn-secondary {background:#f8f9fa;color:#6c757d;border:1px solid #dee2e6;box-shadow:var(--shadow-md)}.btn-secondary:hover {background:#e9ecef;color:#495057;transform:translateY(-2px);box-shadow:var(--shadow-md)}.btn-ai {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:var(--text-inverse);position:relative;overflow:hidden;border:none;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(102, 126, 234, 0.3)}.btn-ai:hover {background:linear-gradient(135deg, #5a6fd8, #6a4190);transform:translateY(-2px);box-shadow:0 8px 25px rgba(102, 126, 234, 0.3)}.btn-ai.active {background:linear-gradient(135deg, #28a745, #20c997)}.btn-ai.active:hover {background:linear-gradient(135deg, #218838, #1ea080)}.btn-ai::before {content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);transition:left 0.5s}.btn-ai:hover::before {left:100%}.btn-pdf {background:linear-gradient(135deg, #e74c3c, #c0392b);color:var(--text-inverse);text-decoration:none;box-shadow:0 4px 15px rgba(231, 76, 60, 0.3)}.btn-pdf:hover {background:linear-gradient(135deg, #c0392b, #a93226);transform:translateY(-2px);box-shadow:0 8px 25px rgba(231, 76, 60, 0.4);color:var(--text-inverse);text-decoration:none}.term-stats {display:flex;gap:20px;color:#666;font-size:0.9rem}.stat-item {display:flex;align-items:center;gap:5px}.history-section {margin-top:0;padding:0}.section-title {font-size:2rem;font-weight:700;color:#2c3e50;margin-bottom:32px;display:flex;align-items:center;gap:12px;letter-spacing:-0.01em}.history-grid {display:grid;grid-template-columns:repeat(auto-fit, minmax(320px, 1fr));gap:28px;padding:0;width:100%}.history-card {background:var(--bg-card);border-radius:16px;padding:24px;box-shadow:var(--shadow-md);transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);text-decoration:none;color:inherit;border:1px solid rgba(0,0,0,0.05);cursor:pointer;position:relative;overflow:hidden}.history-card::before {content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(135deg, var(--accent-color), var(--primary-color));transform:scaleX(0);transition:transform 0.3s ease}.history-card:hover {transform:translateY(-6px);box-shadow:var(--shadow-md);text-decoration:none;color:inherit;border-color:rgba(78, 205, 196, 0.2)}.history-card:hover::before {transform:scaleX(1)}.history-term {font-size:1.3rem;font-weight:600;color:var(--text-primary);margin-bottom:10px}.history-date {color:#666;font-size:0.9rem;margin-bottom:15px}.history-preview {color:#666;font-size:0.95rem;line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.no-term-message {text-align:center;padding:60px 20px;color:#666}.no-term-icon {font-size:4rem;margin-bottom:20px;opacity:0.6}@media (max-width:768px) {.daily-term-container {padding:20px 16px;gap:24px}.page-header {padding:32px 24px;border-radius:var(--border-radius-lg)}.breadcrumb {position:static;justify-content:center;margin-bottom:20px;flex-wrap:wrap}.page-title {font-size:2.2rem;margin-top:0}.today-term-container {grid-template-columns:1fr;gap:24px}.today-term-container.with-sidebar {grid-template-columns:1fr}.today-term-card {padding:28px}.term-header {flex-direction:column;gap:16px;align-items:flex-start}.term-title {font-size:2rem}.term-meta {align-self:flex-start}.term-actions {flex-direction:column;gap:16px;align-items:stretch}.action-buttons {justify-content:center;flex-wrap:wrap}.chatbot-sidebar {position:relative;top:0;width:100%;min-width:100%;max-width:100%;height:600px}.history-grid {grid-template-columns:1fr;gap:20px}}.modal-overlay {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0, 0, 0, 0.6);backdrop-filter:blur(8px);display:none;justify-content:center;align-items:center;z-index:10000;animation:fadeIn 0.3s ease}.modal-overlay.show {display:flex}.modal-card {background:var(--bg-card);border-radius:25px;max-width:700px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:var(--shadow-md);transform:scale(0.9);transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);position:relative}.modal-overlay.show .modal-card {transform:scale(1)}.modal-header {padding:30px 30px 20px;border-bottom:1px solid #f0f0f0;display:flex;align-items:flex-start;gap:20px;position:relative}.modal-icon {font-size:3rem;background:linear-gradient(135deg, var(--accent-color), #44a08d);border-radius:var(--border-radius);width:70px;height:70px;display:flex;align-items:center;justify-content:center;flex-shrink:0}.modal-title-section {flex:1}.modal-title {font-size:1.8rem;font-weight:700;color:var(--text-primary);margin:0 0 10px 0;line-height:1.3}.modal-meta {display:flex;gap:10px;flex-wrap:wrap}.modal-category, .modal-difficulty {padding:4px 12px;border-radius:12px;font-size:0.8rem;font-weight:600;text-transform:uppercase}.modal-category {background:#e3f2fd;color:#1976d2}.modal-difficulty {background:#f3e5f5;color:#7b1fa2}.modal-difficulty.beginner {background:#e8f5e8;color:#2e7d32}.modal-difficulty.intermediate {background:#fff3e0;color:#f57c00}.modal-difficulty.advanced {background:#ffebee;color:#d32f2f}.modal-close {position:absolute;top:15px;right:15px;background:#f5f5f5;border:none;border-radius:50%;width:35px;height:35px;font-size:1.5rem;color:#666;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center}.modal-close:hover {background:#e0e0e0;color:var(--text-primary);transform:rotate(90deg)}.modal-content {padding:20px 30px 30px}.modal-description {font-size:1.1rem;line-height:1.7;color:#555;margin-bottom:25px;white-space:pre-line}.modal-actions {display:flex;gap:15px;justify-content:center;padding-top:20px;border-top:1px solid #f0f0f0}.modal-btn {padding:12px 24px;border-radius:25px;border:none;font-weight:600;cursor:pointer;transition:all 0.3s ease;font-size:1rem;display:flex;align-items:center;gap:8px}.modal-btn.primary {background:linear-gradient(135deg, var(--accent-color), #44a08d);color:var(--text-inverse);box-shadow:0 4px 15px rgba(78, 205, 196, 0.3)}.modal-btn.primary:hover {transform:translateY(-2px);box-shadow:0 8px 25px rgba(78, 205, 196, 0.4)}.modal-btn.secondary {background:#f8f9fa;color:#6c757d;border:1px solid #dee2e6}.modal-btn.secondary:hover {background:#e9ecef;color:#495057}.today-term-container {display:grid;grid-template-columns:1fr;gap:32px;margin-bottom:0;position:relative;align-items:start;width:100%}.today-term-container.with-sidebar {grid-template-columns:1fr 420px;gap:40px}.today-term-card {transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1);margin:0;width:100%;min-width:0}.chatbot-sidebar {width:420px;min-width:420px;max-width:420px;height:700px;background:linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);border:2px solid var(--primary-color);border-radius:24px;box-shadow:0 20px 80px rgba(102, 126, 234, 0.15);display:none;flex-direction:column;overflow:hidden;transition:all 0.6s cubic-bezier(0.4, 0, 0.2, 1);opacity:0;transform:translateX(40px) scale(0.95);position:sticky;top:32px;z-index:100;backdrop-filter:blur(20px)}.chatbot-sidebar.show {display:flex !important;opacity:1;transform:translateX(0) scale(1);visibility:visible}.chatbot-sidebar::before {content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--accent-color));border-radius:24px 24px 0 0}.sidebar-header {padding:20px;border-bottom:1px solid #e9ecef;background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:var(--text-inverse);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;border-radius:20px 20px 0 0}.chatbot-header {display:flex;align-items:center;gap:15px;flex:1}.sidebar-close {background:rgba(255, 255, 255, 0.2);border:none;color:var(--text-inverse);width:32px;height:32px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.2rem;transition:all 0.3s ease}.sidebar-close:hover {background:rgba(255, 255, 255, 0.3);transform:scale(1.1)}.header-controls {display:flex;align-items:center;gap:10px}.theme-btn {background:rgba(255, 255, 255, 0.2);border:none;color:var(--text-inverse);width:32px;height:32px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1rem;transition:all 0.3s ease}.theme-btn:hover {background:rgba(255, 255, 255, 0.3);transform:scale(1.1)}.theme-selector {background:#f8f9fa;border-bottom:1px solid #e9ecef;padding:15px 20px;display:none}.theme-selector.show {display:block}.theme-selector-header h4 {margin:0 0 15px 0;color:var(--text-primary);font-size:0.9rem;font-weight:600}.theme-options {display:flex;flex-direction:column;gap:8px}.theme-option {display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:var(--border-radius-sm);cursor:pointer;transition:all 0.3s ease;border:1px solid transparent}.theme-option:hover {background:#e9ecef;border-color:var(--primary-color)}.theme-option.active {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:var(--text-inverse);border-color:var(--primary-color)}.theme-option.active .theme-avatar {background:rgba(255, 255, 255, 0.2)}.theme-avatar {width:32px;height:32px;border-radius:50%;background:#e9ecef;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}.theme-info {flex:1}.theme-name {font-weight:600;font-size:0.9rem;margin-bottom:2px}.theme-description {font-size:0.8rem;opacity:0.8;line-height:1.3}.loading-themes {text-align:center;color:#666;font-style:italic;padding:10px}.theme-change-message {border-left:3px solid var(--primary-color);background:linear-gradient(135deg, #f8f9ff, #f0f2ff);transition:opacity 0.5s ease}.theme-change-message .message-content {background:transparent}.theme-blue .sidebar-header {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color))}.theme-green .sidebar-header {background:linear-gradient(135deg, #56ab2f, #a8e6cf)}.theme-purple .sidebar-header {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color))}.theme-orange .sidebar-header {background:linear-gradient(135deg, #f093fb, #f5576c)}.theme-teal .sidebar-header {background:linear-gradient(135deg, var(--accent-color), #44a08d)}.sidebar-content {flex:1;display:flex;flex-direction:column;overflow-y:auto;overflow-x:hidden;padding:0}.suggested-questions {padding:20px;border-bottom:1px solid #eee}.suggested-questions h4 {margin:0 0 15px 0;color:var(--text-primary);font-size:1rem}.questions-list {display:flex;flex-direction:column;gap:8px}.question-item {padding:10px 15px;background:#f8f9fa;border-radius:var(--border-radius-sm);cursor:pointer;transition:all 0.2s ease;font-size:0.9rem;color:#555}.question-item:hover {background:#e9ecef;color:var(--text-primary)}.chat-area {flex:1;display:flex;flex-direction:column;overflow:hidden;padding:20px;min-height:0}.chat-area.hidden {display:none !important}.chat-messages {flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:16px;background:linear-gradient(to bottom, #f8fafc 0%, #ffffff 100%);scrollbar-width:thin;scrollbar-color:rgba(102, 126, 234, 0.3) transparent}.chat-messages::-webkit-scrollbar {width:6px}.chat-messages::-webkit-scrollbar-track {background:transparent}.chat-messages::-webkit-scrollbar-thumb {background:rgba(102, 126, 234, 0.3);border-radius:3px}.chat-messages::-webkit-scrollbar-thumb:hover {background:rgba(102, 126, 234, 0.5)}.user-message, .ai-message {display:flex;gap:10px;align-items:flex-start}.user-message {flex-direction:row-reverse}.message-avatar {width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}.message-content {max-width:70%;padding:12px 16px;border-radius:12px;line-height:1.4}.user-message .message-content {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:var(--text-inverse);border-bottom-right-radius:4px}.ai-message .message-content {background:#f8f9fa;color:var(--text-primary);border-bottom-left-radius:4px}.chat-input-area {padding:20px;border-top:1px solid #eee;background:#fafafa}.input-container {display:flex;gap:10px;align-items:center}#chatInput {flex:1;padding:12px 16px;border:1px solid #ddd;border-radius:25px;outline:none;font-size:0.9rem}#chatInput:focus {border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(102, 126, 234, 0.1)}#sendButton {width:40px;height:40px;border:none;background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:var(--text-inverse);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease}#sendButton:hover {transform:scale(1.05)}.input-hint {font-size:0.8rem;color:#999;margin-top:8px;text-align:center}.chat-start-area {padding:40px 20px;text-align:center}.start-chat-btn {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:var(--text-inverse);border:none;padding:15px 30px;border-radius:25px;font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.3s ease}.start-chat-btn:hover {transform:translateY(-2px);box-shadow:0 8px 25px rgba(102, 126, 234, 0.3)}.start-hint {margin-top:15px;color:#666;font-size:0.9rem}.typing-indicator .typing-dots {display:flex;gap:4px;align-items:center}.typing-dot {width:8px;height:8px;background:#999;border-radius:50%;animation:typing 1.4s infinite ease-in-out}.typing-dot:nth-child(1) {animation-delay:-0.32s}.typing-dot:nth-child(2) {animation-delay:-0.16s}@keyframes typing {0%, 80%, 100% {transform:scale(0.8);opacity:0.5}40% {transform:scale(1);opacity:1}}.api-status-message {padding:10px 15px;margin:10px 0;border-radius:var(--border-radius-sm);font-size:0.9rem;text-align:center;font-weight:500}.api-status-message.success {background:#e8f5e8;color:#2e7d32;border:1px solid #4caf50}.api-status-message.warning {background:#fff3e0;color:#f57c00;border:1px solid #ff9800}.api-status-message.error {background:#ffebee;color:#d32f2f;border:1px solid #f44336}.chatbot-avatar {width:50px;height:50px;background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem}.chatbot-info h3 {margin:0;color:var(--text-inverse);font-size:1.2rem}.chatbot-info p {margin:5px 0 0 0;color:rgba(255, 255, 255, 0.9);font-size:0.9rem}.suggested-questions {padding:20px;border-bottom:1px solid #eee;background:#f8f9fa}.suggested-questions h4 {margin:0 0 15px 0;color:var(--text-primary);font-size:1rem}.questions-list {display:flex;flex-direction:column;gap:8px}.question-item {background:#f8f9fa;border:1px solid #e9ecef;border-radius:12px;padding:10px 15px;cursor:pointer;transition:all 0.3s ease;font-size:0.9rem;color:#495057}.question-item:hover {background:#e9ecef;border-color:var(--primary-color);color:var(--text-primary)}.loading-questions {text-align:center;color:#666;font-style:italic;padding:20px}.chat-messages {flex:1;overflow-y:auto;padding:0;margin-bottom:20px}.ai-message, .user-message {display:flex;gap:10px;margin-bottom:15px}.user-message {flex-direction:row-reverse}.message-avatar {width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0}.ai-message .message-avatar {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color))}.user-message .message-avatar {background:linear-gradient(135deg, var(--accent-color), #44a08d)}.message-content {background:#f8f9fa;border-radius:12px;padding:10px 15px;max-width:80%;word-wrap:break-word}.user-message .message-content {background:linear-gradient(135deg, var(--accent-color), #44a08d);color:var(--text-inverse)}.message-content p {margin:0;line-height:1.5}.chat-input-area {border-top:1px solid #eee;padding-top:15px;margin-top:0;flex-shrink:0}.chat-start-area {padding:30px 20px;text-align:center;border-top:1px solid #eee}.start-chat-btn {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:var(--text-inverse);border:none;padding:15px 30px;border-radius:25px;font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(102, 126, 234, 0.3)}.start-chat-btn:hover {transform:translateY(-2px);box-shadow:0 8px 25px rgba(102, 126, 234, 0.4)}.start-hint {margin-top:10px;color:#666;font-size:0.9rem}.input-container {display:flex;gap:10px;align-items:center}#chatInput {flex:1;padding:12px 15px;border:1px solid #ddd;border-radius:25px;font-size:0.9rem;outline:none;transition:border-color 0.3s ease}#chatInput:focus {border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1)}#sendButton {width:40px;height:40px;border:none;border-radius:50%;background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:var(--text-inverse);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease}#sendButton:hover {transform:scale(1.1);box-shadow:0 4px 12px rgba(102, 126, 234, 0.3)}.input-hint {font-size:0.8rem;color:#999;margin-top:8px;text-align:center}.typing-indicator {display:flex;align-items:center;gap:10px;padding:10px 0;color:#666;font-style:italic}.typing-dots {display:flex;gap:3px}.typing-dot {width:6px;height:6px;border-radius:50%;background:var(--primary-color);animation:typing 1.4s infinite}.typing-dot:nth-child(2) {animation-delay:0.2s}.typing-dot:nth-child(3) {animation-delay:0.4s}@keyframes typing {0%, 60%, 100% {transform:translateY(0);opacity:0.4}30% {transform:translateY(-10px);opacity:1}}@media (max-width:1024px) and (min-width:769px) {.daily-term-container {padding:24px 20px}.today-term-container.with-sidebar {grid-template-columns:1fr;gap:32px}.chatbot-sidebar {position:relative;top:0;width:100%;min-width:100%;max-width:100%;height:600px}}@media (min-width:1200px) {.daily-term-container {max-width:1600px;padding:32px}.today-term-container.with-sidebar {grid-template-columns:1fr 480px;gap:48px}.chatbot-sidebar {width:480px;min-width:480px;max-width:480px;height:750px}.page-header {padding:48px}.page-title {font-size:3.2rem}.today-term-card {padding:48px}.term-title {font-size:2.6rem}}@media (min-width:1600px) {.daily-term-container {max-width:1800px}.today-term-container.with-sidebar {grid-template-columns:1fr 520px;gap:56px}.chatbot-sidebar {width:520px;min-width:520px;max-width:520px}}@keyframes fadeInUp {from {opacity:0;transform:translateY(30px)}to {opacity:1;transform:translateY(0)}}@keyframes slideInRight {from {opacity:0;transform:translateX(30px)}to {opacity:1;transform:translateX(0)}}@keyframes pulse {0%, 100% {transform:scale(1)}50% {transform:scale(1.05)}}.daily-term-container {animation:fadeInUp 0.8s ease-out}.today-term-card {animation:fadeInUp 0.8s ease-out 0.2s both}.chatbot-sidebar.show {animation:slideInRight 0.5s ease-out}.history-card {animation:fadeInUp 0.6s ease-out both}.history-card:nth-child(1) {animation-delay:0.1s}.history-card:nth-child(2) {animation-delay:0.2s}.history-card:nth-child(3) {animation-delay:0.3s}.history-card:nth-child(4) {animation-delay:0.4s}.history-card:nth-child(5) {animation-delay:0.5s}.history-card:nth-child(6) {animation-delay:0.6s}.btn:focus, .nav-btn:focus, .breadcrumb-item:focus {outline:3px solid rgba(78, 205, 196, 0.5);outline-offset:2px}::-webkit-scrollbar {width:8px}::-webkit-scrollbar-track {background:rgba(255, 255, 255, 0.1);border-radius:4px}::-webkit-scrollbar-thumb {background:rgba(78, 205, 196, 0.6);border-radius:4px}::-webkit-scrollbar-thumb:hover {background:rgba(78, 205, 196, 0.8)}.today-term-card, .history-card, .chatbot-sidebar {will-change:transform}@media (prefers-reduced-motion:reduce) {*, *::before, *::after {animation-duration:0.01ms !important;animation-iteration-count:1 !important;transition-duration:0.01ms !important}}</style>
{% endblock %}

{% block content %}
<main class="page-layout" role="main"><!-- 主内容区域 --><div class="main-content"><div class="daily-term-container"><!-- 页面头部 --><header class="page-header"><!-- 面包屑导航 --><nav class="breadcrumb" aria-label="面包屑导航"><a href="{% url 'knowledge_app:index' %}" class="breadcrumb-item" aria-label="返回首页">
                        🏠 首页
                    </a><span class="breadcrumb-separator" aria-hidden="true">›</span><span class="breadcrumb-current" aria-current="page">📚 每日名词</span></nav><h1 class="page-title">
                    📚 每日名词
                </h1><p class="page-subtitle">每天学习一个计算机专业名词，积累专业知识</p><time class="current-date" datetime="{{ current_date|date:'Y-m-d' }}">
                    📅 {{ current_date|date:"Y年m月d日" }}
                </time><!-- 快速导航 --><nav class="quick-nav" aria-label="快速导航"><a href="{% url 'knowledge_app:index' %}" class="nav-btn" aria-label="返回首页">
                        🏠 返回首页
                    </a><a href="{% url 'knowledge_app:cs_universe' %}" class="nav-btn" aria-label="进入CS宇宙">
                        🌌 CS宇宙
                    </a><button class="nav-btn" onclick="scrollToHistory()" aria-label="跳转到历史记录">
                        📜 历史记录
                    </button></nav></header><!-- 今日名词 -->
            {% if today_term %}
            <section class="today-term-container" aria-labelledby="today-term-title"><article class="today-term-card"><header class="term-header"><h2 id="today-term-title" class="term-title">{{ today_term.term }}</h2><div class="term-meta" role="group" aria-label="名词标签">
                            {% if today_term.category %}
                            <span class="meta-badge category-badge" aria-label="分类">{{ today_term.category }}</span>
                            {% endif %}
                            <span class="meta-badge difficulty-badge difficulty-{{ today_term.difficulty_level }}" aria-label="难度级别">
                                {{ today_term.get_difficulty_level_display }}
                            </span></div></header><div class="term-explanation" role="definition">
                        {% with parsed_explanation=today_term.explanation|parse_explanation %}
                            {% if parsed_explanation.core_concept %}
                            <div class="explanation-section"><h3 class="section-title"><span class="section-icon">💡</span><span>核心概念</span></h3><div class="section-content">{{ parsed_explanation.core_concept|clean_text }}</div></div>
                            {% endif %}

                            {% if parsed_explanation.term_info %}
                            <div class="explanation-section"><h3 class="section-title"><span class="section-icon">📖</span><span>术语信息</span></h3><div class="section-content">{{ parsed_explanation.term_info|clean_text }}</div></div>
                            {% endif %}

                            {% if parsed_explanation.working_principle %}
                            <div class="explanation-section"><h3 class="section-title"><span class="section-icon">⚙️</span><span>工作原理</span></h3><div class="section-content">{{ parsed_explanation.working_principle|clean_text }}</div></div>
                            {% endif %}

                            {% if parsed_explanation.practical_application %}
                            <div class="explanation-section"><h3 class="section-title"><span class="section-icon">🚀</span><span>实际应用</span></h3><div class="section-content">{{ parsed_explanation.practical_application|clean_text }}</div></div>
                            {% endif %}

                            {% if parsed_explanation.learning_points %}
                            <div class="explanation-section"><h3 class="section-title"><span class="section-icon">📝</span><span>学习要点</span></h3><div class="section-content">{{ parsed_explanation.learning_points|clean_text }}</div></div>
                            {% endif %}

                            {% if not parsed_explanation.core_concept and not parsed_explanation.term_info and not parsed_explanation.working_principle and not parsed_explanation.practical_application and not parsed_explanation.learning_points %}
                            <div class="explanation-section"><div class="section-content">{{ today_term.explanation|clean_text }}</div></div>
                            {% endif %}
                        {% endwith %}
                    </div><footer class="term-actions"><div class="action-buttons" role="group" aria-label="操作按钮"><button class="btn btn-primary" onclick="likeTerm({{ today_term.id }})" aria-label="为这个名词点赞">
                                👍 点赞 (<span id="like-count" aria-live="polite">{{ today_term.like_count }}</span>)
                            </button><button class="btn btn-secondary" onclick="showTermDetail({{ today_term.id }}, '{{ today_term.term }}', '{{ today_term.explanation|escapejs }}', '{{ today_term.category }}', '{{ today_term.difficulty_level }}')" aria-label="查看名词详细信息">
                                📖 查看详情
                            </button><a href="{% url 'knowledge_app:export_daily_term_pdf' today_term.id %}"
                               class="btn btn-pdf"
                               target="_blank"
                               onclick="return handlePdfExport(this)"
                               aria-label="导出PDF名词卡片">
                                📄 导出PDF
                            </a><button class="btn btn-ai" onclick="toggleChatbot()" id="aiToggleBtn" aria-label="打开AI助手" aria-expanded="false">
                                🤖 AI助手
                            </button></div><div class="term-stats" role="group" aria-label="统计信息"><div class="stat-item"><span aria-hidden="true">👀</span><span>{{ today_term.view_count }} 次浏览</span></div><div class="stat-item"><span aria-hidden="true">📅</span><time datetime="{{ today_term.display_date|date:'Y-m-d' }}">{{ today_term.display_date|date:"m月d日" }}</time></div></div></footer></article><!-- AI助手侧边栏 --><div class="chatbot-sidebar" id="chatbotSidebar"><div class="sidebar-header"><div class="chatbot-header"><div class="chatbot-avatar" id="chatbotAvatar">🤖</div><div class="chatbot-info"><h3 id="chatbotName">AI学习助手</h3><p>专门解答关于"{{ today_term.term }}"的问题</p></div></div><button class="sidebar-close" onclick="toggleChatbot()">×</button></div><div class="sidebar-content"><!-- 推荐问题区域 --><div id="suggestedQuestions" class="suggested-questions"><h4>💡 推荐问题</h4><div id="questionsList" class="questions-list"><div class="loading-questions">点击下方按钮开始使用AI助手</div></div></div><!-- 聊天区域 --><div id="chatArea" class="chat-area hidden"><div id="chatMessages" class="chat-messages"><div class="welcome-message"><div class="ai-message"><div class="message-avatar">🤖</div><div class="message-content"><p>你好！我是AI学习助手，专门帮助你理解计算机专业名词。</p><p>你可以问我任何关于"{{ today_term.term }}"的问题，我会尽力为你解答！</p></div></div></div></div><!-- 输入区域 --><div class="chat-input-area"><div class="input-container"><input type="text" id="chatInput" placeholder="请输入你的问题..." maxlength="200"><button id="sendButton" onclick="sendMessage()"><span class="send-icon">📤</span></button></div><div class="input-hint">
                            按 Enter 发送，Shift+Enter 换行
                        </div></div></div><!-- 启动按钮 --><div class="chat-start-area" id="chatStartArea"><button class="start-chat-btn" onclick="startChatbot()">
                        🚀 启动AI助手
                    </button><p class="start-hint">点击启动后开始智能问答</p></div></div></div></section>
            {% else %}
            <section class="no-term-message" role="status" aria-live="polite"><div class="no-term-icon" aria-hidden="true">🤔</div><h2>今日名词正在准备中...</h2><p>我们正在为您生成今天的专业名词，请稍后刷新页面。</p><button class="btn btn-primary" onclick="location.reload()" aria-label="刷新页面以获取最新内容">🔄 刷新页面</button></section>
            {% endif %}

            <!-- 历史名词 -->
            {% if history_terms %}
            <section class="history-section" aria-labelledby="history-title"><h2 id="history-title" class="section-title">
                    📖 最近名词
                </h2><div class="history-grid" role="grid" aria-label="历史名词列表">
                    {% for term in history_terms %}
                    <article class="history-card"
                             role="gridcell"
                             tabindex="0"
                             onclick="showTermDetail({{ term.id }}, '{{ term.term }}', '{{ term.explanation|escapejs }}', '{{ term.category }}', '{{ term.difficulty_level }}')"><h3 class="history-term">{{ term.term }}</h3><time class="history-date" datetime="{{ term.display_date|date:'Y-m-d' }}">{{ term.display_date|date:"Y年m月d日" }}</time><p class="history-preview">{{ term.explanation|truncatewords:20 }}</p></article>
                    {% endfor %}
                </div><div style="text-align: center; margin-top: 40px;"><a href="{% url 'knowledge_app:daily_term_history' %}" class="btn btn-primary" aria-label="查看更多历史名词">
                        📚 查看更多历史名词
                    </a></div></section>
            {% endif %}
        </div></div></main><!-- 名词详情模态框 --><div id="termModal" class="modal-overlay" onclick="closeTermModal()"><div class="modal-card" onclick="event.stopPropagation()"><div class="modal-header"><div class="modal-icon">📚</div><div class="modal-title-section"><h2 class="modal-title" id="termModalTitle">名词标题</h2><div class="modal-meta"><span class="modal-category" id="termModalCategory">分类</span><span class="modal-difficulty" id="termModalDifficulty">难度</span></div></div><button class="modal-close" onclick="closeTermModal()">×</button></div><div class="modal-content"><div class="modal-description" id="termModalDescription">
                名词详细解释...
            </div><div class="modal-actions"><button class="modal-btn primary" onclick="likeTermFromModal()">
                    👍 点赞
                </button><button class="modal-btn secondary" onclick="closeTermModal()">
                    📚 关闭
                </button></div></div></div></div></div>
{% endblock %}

{% block extra_js %}
<script>async function likeTerm(termId) { try { const response = await fetch(`/api/daily-term/like/${termId}/`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') } }); const data = await response.json(); if (data.success) { document.getElementById('like-count').textContent = data.like_count; showMessage('点赞成功！', 'success'); } else { showMessage(data.message || '点赞失败', 'error'); } } catch (error) { console.error('Like error:', error); showMessage('网络错误，请稍后重试', 'error'); } } let currentTermId = null; function showTermDetail(termId, title, explanation, category, difficulty) { currentTermId = termId; document.getElementById('termModalTitle').textContent = title; document.getElementById('termModalDescription').textContent = explanation; document.getElementById('termModalCategory').textContent = getCategoryDisplayName(category); const difficultyElement = document.getElementById('termModalDifficulty'); difficultyElement.textContent = getDifficultyDisplayName(difficulty); difficultyElement.className = `modal-difficulty ${difficulty}`; const modal = document.getElementById('termModal'); modal.classList.add('show'); document.body.style.overflow = 'hidden'; } function closeTermModal() { const modal = document.getElementById('termModal'); modal.classList.remove('show'); document.body.style.overflow = ''; currentTermId = null; } function likeTermFromModal() { if (currentTermId) { likeTerm(currentTermId); } } function getCategoryDisplayName(category) { const categoryMap = { '算法设计': '算法设计', '数据结构': '数据结构', '计算机网络': '计算机网络', '操作系统': '操作系统', '数据库系统': '数据库系统', '信息安全': '信息安全', '软件工程': '软件工程', '人工智能': '人工智能', '编程基础': '编程基础', '计算机基础': '计算机基础' }; return categoryMap[category] || category || '计算机基础'; } function getDifficultyDisplayName(difficulty) { const difficultyMap = { 'beginner': '初级', 'intermediate': '中级', 'advanced': '高级' }; return difficultyMap[difficulty] || difficulty || '中级'; } function getCookie(name) { let cookieValue = null; if (document.cookie && document.cookie !== '') { const cookies = document.cookie.split(';'); for (let i = 0; i < cookies.length; i++) { const cookie = cookies[i].trim(); if (cookie.substring(0, name.length + 1) === (name + '=')) { cookieValue = decodeURIComponent(cookie.substring(name.length + 1)); break; } } } return cookieValue; } function showMessage(message, type) { const messageDiv = document.createElement('div'); messageDiv.style.cssText = ` position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: var(--border-radius-sm); color: var(--text-inverse); font-weight: 600; z-index: 10000; animation: slideIn 0.3s ease; background: ${type === 'success' ? 'var(--accent-color)' : '#e74c3c'}; `; messageDiv.textContent = message; document.body.appendChild(messageDiv); setTimeout(() => { messageDiv.remove(); }, 3000); } function scrollToHistory() { const historySection = document.querySelector('.history-section'); if (historySection) { historySection.scrollIntoView({ behavior: 'smooth', block: 'start' }); } } function testChatbot() { console.log('🧪 开始测试AI助手功能'); const elements = { sidebar: document.getElementById('chatbotSidebar'), toggleBtn: document.getElementById('aiToggleBtn'), container: document.querySelector('.today-term-container'), startArea: document.getElementById('chatStartArea'), chatArea: document.getElementById('chatArea'), chatInput: document.getElementById('chatInput'), sendButton: document.getElementById('sendButton') }; console.log('🔍 元素检查结果:', elements); const allElementsExist = Object.values(elements).every(el => el !== null); if (allElementsExist) { console.log('✅ 所有关键元素检查通过！'); return true; } else { console.error('❌ 缺少关键元素，AI助手可能无法正常工作'); return false; } } document.addEventListener('DOMContentLoaded', function() { console.log('📄 页面加载完成，开始初始化'); initializeChatInput(); setTimeout(() => { testChatbot(); }, 1000); preloadResources(); document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { closeTermModal(); if (chatbotVisible) { toggleChatbot(); } } }); document.querySelectorAll('.history-card').forEach(card => { card.addEventListener('keydown', function(e) { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.click(); } }); }); const aiToggleBtn = document.getElementById('aiToggleBtn'); if (aiToggleBtn) { console.log('✅ AI切换按钮找到'); aiToggleBtn.addEventListener('click', function() { console.log('🖱️ AI按钮被点击'); const expanded = this.getAttribute('aria-expanded') === 'true'; this.setAttribute('aria-expanded', !expanded); }); } else { console.error('❌ 找不到AI切换按钮'); } console.log('✅ 页面初始化完成'); }); let currentTerm = ''; let currentExplanation = ''; let chatbotVisible = false; let chatbotInitialized = false; let availableThemes = {}; let currentTheme = 'friendly'; function generateConversationId() { if (!window.conversationId) { window.conversationId = 'conv_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9); } return window.conversationId; } function initializeChatInput() { const chatInput = document.getElementById('chatInput'); const sendButton = document.getElementById('sendButton'); if (!chatInput || !sendButton) return; chatInput.addEventListener('input', function() { const text = this.value.trim(); sendButton.disabled = text.length === 0; this.style.height = 'auto'; this.style.height = Math.min(this.scrollHeight, 100) + 'px'; }); chatInput.addEventListener('keydown', function(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (!sendButton.disabled) { sendMessage(); } } }); sendButton.disabled = true; } function prepareSendMessage() { const chatInput = document.getElementById('chatInput'); const sendButton = document.getElementById('sendButton'); if (!chatInput || !sendButton) return false; const message = chatInput.value.trim(); if (!message) return false; chatInput.style.height = 'auto'; return true; } function addUserMessage(message) { const chatMessages = document.getElementById('chatMessages'); if (!chatMessages) return; const messageDiv = document.createElement('div'); messageDiv.className = 'user-message'; messageDiv.innerHTML = ` <div class="message-avatar">👤</div><div class="message-content">${escapeHtml(message)}</div> `; chatMessages.appendChild(messageDiv); chatMessages.scrollTop = chatMessages.scrollHeight; } function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; } function openChatbot(term, explanation) { toggleChatbot(); } function toggleChatbot() { console.log('🤖 toggleChatbot 被调用，当前状态:', chatbotVisible); const sidebar = document.getElementById('chatbotSidebar'); const container = document.querySelector('.today-term-container'); const toggleBtn = document.getElementById('aiToggleBtn'); console.log('🔍 元素检查:', { sidebar: !!sidebar, container: !!container, toggleBtn: !!toggleBtn }); if (!sidebar) { console.error('❌ 找不到AI助手侧边栏元素！'); alert('找不到AI助手侧边栏！请检查页面是否正确加载。'); return; } if (!chatbotVisible) { console.log('📖 显示AI助手侧边栏'); sidebar.classList.add('show'); sidebar.style.display = 'flex'; sidebar.style.visibility = 'visible'; if (container) { container.classList.add('with-sidebar'); console.log('✅ 容器添加了 with-sidebar 类'); } if (toggleBtn) { toggleBtn.innerHTML = '🤖 关闭助手'; toggleBtn.classList.add('active'); toggleBtn.setAttribute('aria-expanded', 'true'); } chatbotVisible = true; if (!chatbotInitialized) { console.log('🚀 初始化聊天机器人'); startChatbot(); } console.log('✅ AI助手已显示'); } else { console.log('📖 隐藏AI助手侧边栏'); sidebar.classList.remove('show'); sidebar.style.display = 'none'; if (container) { container.classList.remove('with-sidebar'); } if (toggleBtn) { toggleBtn.innerHTML = '🤖 AI助手'; toggleBtn.classList.remove('active'); toggleBtn.setAttribute('aria-expanded', 'false'); } chatbotVisible = false; console.log('✅ AI助手已隐藏'); } } function startChatbot() { console.log('🚀 startChatbot 被调用，已初始化:', chatbotInitialized); if (chatbotInitialized) { console.log('⚠️ 聊天机器人已经初始化，跳过'); return; } const term = '{{ today_term.term|default:"" }}'; const explanation = '{{ today_term.explanation|escapejs|default:"" }}'; console.log('📚 当前名词:', term); currentTerm = term; currentExplanation = explanation; const startArea = document.getElementById('chatStartArea'); const chatArea = document.getElementById('chatArea'); console.log('🔍 UI元素检查:', { startArea: !!startArea, chatArea: !!chatArea }); if (startArea) { startArea.style.display = 'none'; console.log('✅ 隐藏启动按钮'); } if (chatArea) { chatArea.classList.remove('hidden'); chatArea.style.display = 'flex'; console.log('✅ 显示聊天区域'); } loadSuggestedQuestions(term, explanation); setTimeout(() => { const chatInput = document.getElementById('chatInput'); if (chatInput) { chatInput.focus(); console.log('✅ 输入框已聚焦'); chatInput.addEventListener('keypress', function(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } }); } }, 300); chatbotInitialized = true; console.log('✅ 聊天机器人初始化完成'); } async function loadChatbotThemes() { availableThemes = { 'friendly': { name: '友好助手', avatar: '🤖', description: '友好耐心的学习伙伴' } }; currentTheme = 'friendly'; console.log('AI助手主题已加载'); } async function checkAPIStatus() { try { const response = await fetch('/api/chatbot/status/'); const data = await response.json(); if (data.success && data.status.available) { console.log('✅ GLM API服务可用'); const statusMessage = document.createElement('div'); statusMessage.className = 'api-status-message success'; statusMessage.innerHTML = '✅ GLM AI服务已连接'; document.getElementById('chatMessages').appendChild(statusMessage); } else { console.warn('⚠️ GLM API服务不可用，将使用本地回复'); const statusMessage = document.createElement('div'); statusMessage.className = 'api-status-message warning'; statusMessage.innerHTML = '⚠️ AI服务暂时不可用，将提供本地智能回复'; document.getElementById('chatMessages').appendChild(statusMessage); } } catch (error) { console.error('❌ 无法检查API状态:', error); const statusMessage = document.createElement('div'); statusMessage.className = 'api-status-message error'; statusMessage.innerHTML = '❌ 无法连接AI服务，将使用本地回复模式'; document.getElementById('chatMessages').appendChild(statusMessage); } } function updateThemeUI(themeInfo) { const avatar = document.getElementById('chatbotAvatar'); const name = document.getElementById('chatbotName'); if (avatar && themeInfo) { avatar.textContent = themeInfo.avatar; } if (name && themeInfo) { name.textContent = themeInfo.name; } } function renderThemeOptions() { const optionsContainer = document.getElementById('themeOptions'); if (!optionsContainer || !availableThemes) return; optionsContainer.innerHTML = ''; Object.keys(availableThemes).forEach(themeKey => { const theme = availableThemes[themeKey]; const option = document.createElement('div'); option.className = `theme-option ${themeKey === currentTheme ? 'active' : ''}`; option.onclick = () => selectTheme(themeKey); option.innerHTML = ` <div class="theme-avatar">${theme.avatar}</div><div class="theme-info"><div class="theme-name">${theme.name}</div><div class="theme-description">${theme.personality}</div></div> `; optionsContainer.appendChild(option); }); } async function selectTheme(themeKey) { try { const response = await fetch('/api/themes/chatbot/set/', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') }, body: JSON.stringify({ theme: themeKey }) }); const data = await response.json(); if (data.success) { currentTheme = themeKey; updateThemeUI(data.theme_info); renderThemeOptions(); showThemeChangeMessage(data.theme_info); toggleThemeSelector(); } else { console.error('切换主题失败:', data.error); } } catch (error) { console.error('切换主题出错:', error); } } function toggleThemeSelector() { const selector = document.getElementById('themeSelector'); if (selector) { selector.classList.toggle('show'); } } function showThemeChangeMessage(themeInfo) { const chatMessages = document.getElementById('chatMessages'); if (chatMessages && themeInfo) { const messageElement = document.createElement('div'); messageElement.className = 'ai-message theme-change-message'; messageElement.innerHTML = ` <div class="message-avatar">${themeInfo.avatar}</div><div class="message-content"><p>🎨 已切换到"${themeInfo.name}"模式</p><p>${themeInfo.greeting}</p></div> `; chatMessages.appendChild(messageElement); scrollToBottom(); setTimeout(() => { messageElement.style.opacity = '0.6'; }, 3000); } } function closeChatbot() { toggleChatbot(); } function loadSuggestedQuestions(term, explanation) { const questionsList = document.getElementById('questionsList'); if (!questionsList) return; const questions = [ `${term}的主要作用是什么？`, `${term}在实际项目中如何应用？`, `学习${term}需要什么基础知识？`, `${term}有哪些常见的误区？`, `如何更好地理解${term}这个概念？` ]; questionsList.innerHTML = ''; questions.forEach(question => { const questionElement = document.createElement('div'); questionElement.className = 'question-item'; questionElement.textContent = question; questionElement.onclick = () => askQuestion(question); questionsList.appendChild(questionElement); }); } function askQuestion(question) { document.getElementById('chatInput').value = question; sendMessage(); } async function sendMessage() { const input = document.getElementById('chatInput'); const sendButton = document.getElementById('sendButton'); if (!input) return; const message = input.value.trim(); if (!message) return; input.disabled = true; if (sendButton) sendButton.disabled = true; input.value = ''; input.style.height = 'auto'; addUserMessage(message); showTypingIndicator(); try { console.log('🤖 正在调用GLM API...'); const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), 30000); const response = await fetch('/api/chatbot/ask/', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken'), 'Accept': 'application/json' }, body: JSON.stringify({ term: currentTerm, explanation: currentExplanation, question: message, theme: currentTheme || 'friendly' }), signal: controller.signal }); clearTimeout(timeoutId); hideTypingIndicator(); if (!response.ok) { throw new Error(`HTTP ${response.status}: ${response.statusText}`); } const data = await response.json(); console.log('✅ GLM API响应:', data); if (data.success && data.answer) { addAIMessage(data.answer); } else if (data.error) { console.warn('⚠️ API返回错误:', data.error); const fallbackResponse = generateSmartResponse(message, currentTerm, currentExplanation); addAIMessage(`AI服务暂时不可用，为您提供智能回复：\n\n${fallbackResponse}`); } else { throw new Error('API响应格式不正确'); } } catch (error) { hideTypingIndicator(); console.error('❌ GLM API调用失败:', error); let errorMessage = ''; if (error.name === 'AbortError') { errorMessage = '请求超时，请稍后重试'; } else if (error.message.includes('HTTP')) { errorMessage = '服务暂时不可用'; } else { errorMessage = '网络连接问题'; } const fallbackResponse = generateSmartResponse(message, currentTerm, currentExplanation); addAIMessage(`${errorMessage}，为您提供智能回复：\n\n${fallbackResponse}`); } } function generateSmartResponse(question, term, explanation) { const questionLower = question.toLowerCase(); const isWhatQuestion = questionLower.includes('什么') || questionLower.includes('是什么') || questionLower.includes('what'); const isHowQuestion = questionLower.includes('怎么') || questionLower.includes('如何') || questionLower.includes('how'); const isWhyQuestion = questionLower.includes('为什么') || questionLower.includes('why'); const isExampleQuestion = questionLower.includes('例子') || questionLower.includes('举例') || questionLower.includes('example'); let response = ''; if (isWhatQuestion) { response = `关于"${term}"的定义：\n\n${explanation}\n\n这个概念在计算机科学中扮演着重要角色，它帮助我们理解和解决相关的技术问题。`; } else if (isHowQuestion) { response = `关于如何理解"${term}"：\n\n首先，${explanation}\n\n在实际应用中，你可以通过以下方式来掌握这个概念：\n1. 理解基本定义\n2. 学习相关示例\n3. 实践应用场景`; } else if (isWhyQuestion) { response = `"${term}"之所以重要，是因为：\n\n${explanation}\n\n它在计算机科学领域中解决了特定的问题，为我们提供了有效的解决方案和思维框架。`; } else if (isExampleQuestion) { response = `关于"${term}"的例子：\n\n基本概念：${explanation}\n\n在实际应用中，这个概念经常出现在各种计算机系统和软件开发场景中，帮助开发者更好地设计和实现解决方案。`; } else { const responses = [ `关于"${term}"，这是一个很好的问题！\n\n${explanation}\n\n如果你想了解更多细节，建议深入学习相关的理论基础和实践应用。`, `让我来帮你理解"${term}"：\n\n${explanation}\n\n这个概念在计算机科学中有着广泛的应用，掌握它对于理解相关技术非常重要。`, `你问的关于"${term}"的问题很有意思！\n\n${explanation}\n\n建议你可以通过实际案例和练习来加深对这个概念的理解。` ]; response = responses[Math.floor(Math.random() * responses.length)]; } return response; } function addUserMessage(message) { const chatMessages = document.getElementById('chatMessages'); const messageElement = document.createElement('div'); messageElement.className = 'user-message'; messageElement.innerHTML = ` <div class="message-avatar">👤</div><div class="message-content"><p>${escapeHtml(message)}</p></div> `; chatMessages.appendChild(messageElement); scrollToBottom(); } function addAIMessage(message) { const chatMessages = document.getElementById('chatMessages'); const messageElement = document.createElement('div'); messageElement.className = 'ai-message'; messageElement.innerHTML = ` <div class="message-avatar">🤖</div><div class="message-content"><p>${escapeHtml(message).replace(/\n/g, '</p><p>')}</p></div> `; chatMessages.appendChild(messageElement); scrollToBottom(); enableChatInput(); } function enableChatInput() { const chatInput = document.getElementById('chatInput'); const sendButton = document.getElementById('sendButton'); if (chatInput) { chatInput.disabled = false; chatInput.focus(); } if (sendButton) { const hasText = chatInput && chatInput.value.trim().length > 0; sendButton.disabled = !hasText; } } function showTypingIndicator() { const chatMessages = document.getElementById('chatMessages'); const typingElement = document.createElement('div'); typingElement.id = 'typingIndicator'; typingElement.className = 'ai-message typing-indicator'; typingElement.innerHTML = ` <div class="message-avatar">🤖</div><div class="message-content"><div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div> `; chatMessages.appendChild(typingElement); scrollToBottom(); } function hideTypingIndicator() { const typingIndicator = document.getElementById('typingIndicator'); if (typingIndicator) { typingIndicator.remove(); } } function scrollToBottom() { const chatMessages = document.getElementById('chatMessages'); chatMessages.scrollTop = chatMessages.scrollHeight; } function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; } document.addEventListener('DOMContentLoaded', function() { const chatInput = document.getElementById('chatInput'); if (chatInput) { chatInput.addEventListener('keypress', function(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } }); } document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { const sidebar = document.getElementById('chatbotSidebar'); if (sidebar && chatbotVisible) { toggleChatbot(); } } }); }); function scrollToHistory() { const historySection = document.querySelector('.history-section'); if (historySection) { historySection.scrollIntoView({ behavior: 'smooth', block: 'start' }); } else { showMessage('历史记录区域不存在', 'info'); } } document.addEventListener('DOMContentLoaded', function() { addBackToTopButton(); optimizeScrolling(); preloadResources(); }); function addBackToTopButton() { const backToTop = document.createElement('button'); backToTop.innerHTML = '↑'; backToTop.className = 'back-to-top'; backToTop.onclick = () => { window.scrollTo({ top: 0, behavior: 'smooth' }); }; const style = document.createElement('style'); style.textContent = ` .back-to-top { position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: var(--text-inverse); border: none; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease; opacity: 0; visibility: hidden; z-index: 1000; } .back-to-top.show { opacity: 1; visibility: visible; } .back-to-top:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); } `; document.head.appendChild(style); document.body.appendChild(backToTop); window.addEventListener('scroll', () => { if (window.pageYOffset > 300) { backToTop.classList.add('show'); } else { backToTop.classList.remove('show'); } }); } function optimizeScrolling() { document.querySelectorAll('a[href^="#"]').forEach(anchor => { anchor.addEventListener('click', function (e) { e.preventDefault(); const target = document.querySelector(this.getAttribute('href')); if (target) { target.scrollIntoView({ behavior: 'smooth', block: 'start' }); } }); }); } function preloadResources() { const criticalPages = [ '{% url "knowledge_app:index" %}', '{% url "knowledge_app:cs_universe" %}' ]; criticalPages.forEach(url => { const link = document.createElement('link'); link.rel = 'prefetch'; link.href = url; document.head.appendChild(link); }); const fontLink = document.createElement('link'); fontLink.rel = 'preload'; fontLink.as = 'font'; fontLink.type = 'font/woff2'; fontLink.crossOrigin = 'anonymous'; document.head.appendChild(fontLink); } function trackPerformance() { if ('performance' in window) { window.addEventListener('load', function() { setTimeout(function() { const perfData = performance.getEntriesByType('navigation')[0]; console.log('页面加载时间:', perfData.loadEventEnd - perfData.fetchStart, 'ms'); }, 0); }); } } trackPerformance(); function navigateWithTransition(url) { document.body.style.opacity = '0.8'; document.body.style.transform = 'scale(0.98)'; document.body.style.transition = 'all 0.3s ease'; setTimeout(() => { window.location.href = url; }, 150); } function handlePdfExport(element) { console.log('PDF导出按钮被点击'); console.log('导出URL:', element.href); const originalText = element.innerHTML; element.innerHTML = '<span>⏳</span><span>导出中...</span>'; element.style.pointerEvents = 'none'; setTimeout(() => { element.innerHTML = originalText; element.style.pointerEvents = 'auto'; }, 3000); return true; } document.addEventListener('DOMContentLoaded', function() { document.querySelectorAll('.breadcrumb-item, .nav-btn').forEach(link => { if (link.href && !link.href.startsWith('#')) { link.addEventListener('click', function(e) { e.preventDefault(); navigateWithTransition(this.href); }); } }); });</script>
{% endblock %}
