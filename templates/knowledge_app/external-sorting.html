{% extends 'knowledge_app/base.html' %}

{% block title %}{{ page_title|default:"å¤–éƒ¨æ’åº" }} - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<div class="page-container fade-in">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a>
        <span>></span>
        <span>{{ breadcrumb_category|default:"ç®—æ³•è®¾è®¡" }}</span>
        <span>></span>
        <span>{{ page_title|default:"å¤–éƒ¨æ’åº" }}</span>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header slide-in-left">
        <h1>
            <span class="page-icon">ğŸ—‚ï¸</span>
            å¤–éƒ¨æ’åº (External Sorting)
        </h1>
        <p>æŒæ¡å¤„ç†è¶…å¤§æ•°æ®é›†æ’åºçš„æ ¸å¿ƒç®—æ³•</p>
    </div>

    <!-- ğŸ“‹ çŸ¥è¯†ç‚¹æ¦‚è¿° -->
    <div class="content-card slide-in-right">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“‹</span>
                çŸ¥è¯†ç‚¹æ¦‚è¿°
            </h2>

            <div class="concept-overview">
                <div class="core-concept">
                    <h3>ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ</h3>
                    <p><strong>å¤–éƒ¨æ’åº</strong>æ˜¯ç”¨äºæ’åºæ— æ³•å®Œå…¨è£…å…¥å†…å­˜çš„å¤§å‹æ•°æ®é›†çš„ç®—æ³•ã€‚å®ƒé€šè¿‡åˆ†æ²»ç­–ç•¥ï¼Œå°†å¤§æ–‡ä»¶åˆ†æˆå°å—ï¼Œåˆ†åˆ«æ’åºåå†åˆå¹¶ï¼Œæœ‰æ•ˆè§£å†³å†…å­˜é™åˆ¶é—®é¢˜ã€‚</p>
                </div>

                <div class="unified-grid unified-grid-3">
                    <div class="grid-card">
                        <span class="card-icon">ğŸ“</span>
                        <h4>åˆ†å—æ’åº (Block Sort)</h4>
                        <p>å°†å¤§æ–‡ä»¶åˆ†æˆå¯è£…å…¥å†…å­˜çš„å°å—è¿›è¡Œæ’åº</p>
                    </div>
                    <div class="grid-card">
                        <span class="card-icon">ğŸ”„</span>
                        <h4>å¤šè·¯å½’å¹¶ (K-way Merge)</h4>
                        <p>åŒæ—¶åˆå¹¶å¤šä¸ªå·²æ’åºçš„æ•°æ®å—</p>
                    </div>
                    <div class="grid-card">
                        <span class="card-icon">ğŸ’¾</span>
                        <h4>I/Oä¼˜åŒ– (I/O Optimization)</h4>
                        <p>æœ€å°åŒ–ç£ç›˜è¯»å†™æ“ä½œï¼Œæé«˜æ•´ä½“æ•ˆç‡</p>
                    </div>
                </div>

                <div class="unified-grid unified-grid-2">
                    <div class="info-box info-box-info">
                        <span class="info-icon">ğŸ“ˆ</span>
                        <strong>å­¦ä¹ éš¾åº¦ï¼š</strong>è¿›é˜¶çº§ - éœ€è¦ç†è§£åˆ†æ²»ç®—æ³•å’ŒI/Oç³»ç»Ÿ
                    </div>
                    <div class="info-box info-box-warning">
                        <span class="info-icon">ğŸ“š</span>
                        <strong>å‰ç½®çŸ¥è¯†ï¼š</strong>å†…éƒ¨æ’åºç®—æ³•ã€åˆ†æ²»æ€æƒ³ã€æ–‡ä»¶ç³»ç»ŸåŸºç¡€
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ” æ¦‚å¿µè¯¦è§£ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ”</span>
                æ¦‚å¿µè¯¦è§£
            </h2>

            <div class="concept-breakdown">
                <div class="concept-item">
                    <h3>1ï¸âƒ£ ä¸ºä»€ä¹ˆéœ€è¦å¤–éƒ¨æ’åºï¼Ÿ</h3>
                    <p>å½“æ•°æ®é‡è¶…è¿‡å¯ç”¨å†…å­˜æ—¶ï¼Œä¼ ç»Ÿçš„å†…éƒ¨æ’åºç®—æ³•å°±æ— æ³•å·¥ä½œã€‚å°±åƒ<strong>æ•´ç†ä¸€ä¸ªå·¨å¤§çš„å›¾ä¹¦é¦†</strong>ï¼Œæ— æ³•åŒæ—¶æŠŠæ‰€æœ‰ä¹¦æ¬åˆ°æ¡Œå­ä¸Šï¼Œåªèƒ½åˆ†æ‰¹å¤„ç†ï¼Œæ¯æ¬¡æ•´ç†ä¸€å°éƒ¨åˆ†ï¼Œæœ€åå†æŒ‰é¡ºåºåˆå¹¶ã€‚</p>
                </div>

                <div class="concept-item">
                    <h3>2ï¸âƒ£ åˆ†æ²»ç­–ç•¥</h3>
                    <p>å¤–éƒ¨æ’åºé‡‡ç”¨<strong>ä¸¤é˜¶æ®µåˆ†æ²»æ³•</strong>ï¼šç¬¬ä¸€é˜¶æ®µå°†å¤§æ–‡ä»¶åˆ†å‰²æˆå°å—å¹¶æ’åºï¼Œç¬¬äºŒé˜¶æ®µå°†æ’åºå¥½çš„å°å—åˆå¹¶ã€‚å¦‚åŒ<strong>æµæ°´çº¿ç”Ÿäº§</strong>ï¼Œå…ˆåœ¨å„ä¸ªå·¥ä½œç«™å®Œæˆé›¶ä»¶åŠ å·¥ï¼Œå†ç»„è£…æˆæœ€ç»ˆäº§å“ã€‚</p>
                </div>

                <div class="concept-item">
                    <h3>3ï¸âƒ£ å¤šè·¯å½’å¹¶</h3>
                    <p>åŒæ—¶å¤„ç†å¤šä¸ªå·²æ’åºçš„æ•°æ®æµï¼Œé€‰æ‹©å½“å‰æœ€å°å€¼è¾“å‡ºã€‚ç±»ä¼¼äº<strong>å¤šæ¡é«˜é€Ÿå…¬è·¯æ±‡åˆ</strong>ï¼Œéœ€è¦æ™ºèƒ½è°ƒåº¦ç¡®ä¿è½¦æµæœ‰åºåˆå¹¶è€Œä¸å‘ç”Ÿæ‹¥å µã€‚</p>
                </div>

                <div class="concept-item">
                    <h3>4ï¸âƒ£ I/Oä¼˜åŒ–ç­–ç•¥</h3>
                    <p>åˆç†ä½¿ç”¨ç¼“å†²åŒºï¼Œå‡å°‘ç£ç›˜è®¿é—®æ¬¡æ•°ã€‚å°±åƒ<strong>æ‰¹å‘é‡‡è´­</strong>ï¼Œä¸€æ¬¡æ€§ä¹°æ›´å¤šå•†å“æ¯”é¢‘ç¹å°æ‰¹é‡é‡‡è´­æ›´ç»æµé«˜æ•ˆã€‚</p>
                </div>

                <div class="common-mistakes">
                    <h4>ğŸš¨ å¸¸è§è¯¯åŒº</h4>
                    <ul>
                        <li><strong>è¯¯åŒº1ï¼š</strong>è®¤ä¸ºåˆ†å—è¶Šå°è¶Šå¥½ â†’ è¿‡å°çš„å—ä¼šå¢åŠ å½’å¹¶å¤æ‚åº¦å’ŒI/Oå¼€é”€</li>
                        <li><strong>è¯¯åŒº2ï¼š</strong>å¿½ç•¥ç¼“å†²åŒºç®¡ç† â†’ ä¸åˆç†çš„ç¼“å†²åŒºä½¿ç”¨ä¼šä¸¥é‡å½±å“æ€§èƒ½</li>
                        <li><strong>è¯¯åŒº3ï¼š</strong>åªè€ƒè™‘æ—¶é—´å¤æ‚åº¦ â†’ å¤–éƒ¨æ’åºæ›´éœ€è¦å…³æ³¨I/Oå¤æ‚åº¦å’Œç©ºé—´ä½¿ç”¨</li>
                        <li><strong>è¯¯åŒº4ï¼š</strong>å½’å¹¶è·¯æ•°è¶Šå¤šè¶Šå¥½ â†’ è¿‡å¤šçš„å½’å¹¶è·¯æ•°ä¼šå¢åŠ å†…å­˜å‹åŠ›</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“Š å¯è§†åŒ–å±•ç¤º -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“Š</span>
                å¯è§†åŒ–å±•ç¤º
            </h2>

            <!-- é™æ€ç»“æ„å›¾ -->
            <div class="visualization-container">
                <h3>ğŸ“ˆ å¤–éƒ¨æ’åºæµç¨‹å›¾</h3>
                <div class="static-diagram">
                    <canvas id="sortingCanvas" width="900" height="500" style="border: 1px solid #ddd; border-radius: 8px;"></canvas>
                </div>
            </div>

            <!-- åŠ¨æ€æ¼”ç¤ºæ§åˆ¶å™¨ -->
            <div class="demo-controls">
                <h3>ğŸ® äº¤äº’å¼æ¼”ç¤º</h3>
                <div class="data-input-section">
                    <h4>ğŸ“ è¾“å…¥æ•°æ®é…ç½®</h4>
                    <div class="input-controls">
                        <label>æ•°æ®è§„æ¨¡ï¼š
                            <select id="dataSize">
                                <option value="20">å°æ•°æ®é›†(20ä¸ª)</option>
                                <option value="50" selected>ä¸­æ•°æ®é›†(50ä¸ª)</option>
                                <option value="100">å¤§æ•°æ®é›†(100ä¸ª)</option>
                            </select>
                        </label>
                        <label>å†…å­˜å¤§å°ï¼š
                            <select id="memorySize">
                                <option value="5">5ä¸ªå…ƒç´ </option>
                                <option value="10" selected>10ä¸ªå…ƒç´ </option>
                                <option value="15">15ä¸ªå…ƒç´ </option>
                            </select>
                        </label>
                        <label>å½’å¹¶è·¯æ•°ï¼š
                            <select id="mergeWays">
                                <option value="2" selected>2è·¯å½’å¹¶</option>
                                <option value="3">3è·¯å½’å¹¶</option>
                                <option value="4">4è·¯å½’å¹¶</option>
                            </select>
                        </label>
                        <button id="generateData" class="unified-btn unified-btn-secondary">ğŸ² ç”Ÿæˆéšæœºæ•°æ®</button>
                    </div>
                </div>
                <div class="control-panel">
                    <button id="startDemo" class="unified-btn unified-btn-primary">å¼€å§‹æ¼”ç¤º</button>
                    <button id="stepPhase1" class="unified-btn unified-btn-secondary">é˜¶æ®µ1ï¼šåˆ†å—æ’åº</button>
                    <button id="stepPhase2" class="unified-btn unified-btn-secondary">é˜¶æ®µ2ï¼šå¤šè·¯å½’å¹¶</button>
                    <button id="showComplexity" class="unified-btn unified-btn-success">å¤æ‚åº¦åˆ†æ</button>
                    <button id="resetDemo" class="unified-btn unified-btn-warning">é‡ç½®</button>
                </div>
                <div id="stepInfo" class="step-info"></div>
            </div>

            <!-- å®æ—¶çŠ¶æ€æ˜¾ç¤º -->
            <div class="status-display">
                <div class="status-grid">
                    <div class="status-card">
                        <h4>ğŸ“ ç£ç›˜çŠ¶æ€</h4>
                        <div id="diskStatus" class="status-content"></div>
                    </div>
                    <div class="status-card">
                        <h4>ğŸ’¾ å†…å­˜çŠ¶æ€</h4>
                        <div id="memoryStatus" class="status-content"></div>
                    </div>
                    <div class="status-card">
                        <h4>ğŸ“Š I/Oç»Ÿè®¡</h4>
                        <div id="ioStats" class="status-content"></div>
                    </div>
                </div>
            </div>

            <!-- è®¡ç®—è¿‡ç¨‹å±•ç¤º -->
            <div class="calculation-display">
                <h3>ğŸ“ ç®—æ³•æ‰§è¡Œè¿‡ç¨‹</h3>
                <div id="calculationSteps" class="calculation-steps"></div>
            </div>
        </div>
    </div>

    <!-- ğŸŒŸ å®é™…åº”ç”¨ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸŒŸ</span>
                å®é™…åº”ç”¨
            </h2>

            <div class="applications">
                <div class="app-example">
                    <h3>ğŸ—„ï¸ å¤§å‹æ•°æ®åº“æ’åº</h3>
                    <p>åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå½“éœ€è¦å¯¹TBçº§åˆ«çš„æ•°æ®è¿›è¡ŒORDER BYæ“ä½œæ—¶ï¼ŒDBMSä¼šä½¿ç”¨å¤–éƒ¨æ’åºç®—æ³•ï¼Œç¡®ä¿å³ä½¿æ•°æ®é‡è¿œè¶…å†…å­˜å®¹é‡ä¹Ÿèƒ½é«˜æ•ˆå®Œæˆæ’åºã€‚</p>
                </div>

                <div class="app-example">
                    <h3>ğŸ“ˆ å¤§æ•°æ®åˆ†æ</h3>
                    <p>Hadoop MapReduceæ¡†æ¶ä¸­çš„Shuffleé˜¶æ®µä½¿ç”¨å¤–éƒ¨æ’åºå¯¹ä¸­é—´ç»“æœè¿›è¡Œæ’åºï¼Œä½¿å¾—åˆ†å¸ƒå¼ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†PBçº§æ•°æ®çš„æ’åºå’Œèšåˆæ“ä½œã€‚</p>
                </div>

                <div class="app-example">
                    <h3>ğŸ” æœç´¢å¼•æ“ç´¢å¼•</h3>
                    <p>æ„å»ºæœç´¢å¼•æ“çš„å€’æ’ç´¢å¼•æ—¶ï¼Œéœ€è¦å¯¹æµ·é‡ç½‘é¡µè¯æ±‡è¿›è¡Œæ’åºã€‚å¤–éƒ¨æ’åºç¡®ä¿åœ¨å†…å­˜æœ‰é™çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤Ÿå¤„ç†æ•´ä¸ªäº’è”ç½‘çš„è¯æ±‡ç´¢å¼•ã€‚</p>
                </div>
            </div>

            <!-- ä»£ç ç¤ºä¾‹ -->
            <div class="code-examples">
                <h3>ğŸ’» ç®—æ³•å®ç°</h3>

                <!-- è¯­è¨€é€‰æ‹©å™¨ -->
                <div class="language-selector">
                    <button class="lang-btn active" data-lang="python">Python</button>
                    <button class="lang-btn" data-lang="java">Java</button>
                    <button class="lang-btn" data-lang="cpp">C++</button>
                </div>

                <!-- Pythonä»£ç  -->
                <div id="code-python" class="code-container active">
                    <div class="code-header">
                        <span>Pythonå®ç°</span>
                        <button class="copy-btn" data-code="python">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code class="python">import heapq
import tempfile
import os
from typing import List, Iterator, TextIO

class ExternalSort:
    def __init__(self, memory_size: int = 1000000):
        """
        å¤–éƒ¨æ’åºå®ç°
        :param memory_size: å¯ç”¨å†…å­˜å¤§å°ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰
        """
        self.memory_size = memory_size
        self.temp_files = []
        self.io_operations = 0

    def sort_file(self, input_file: str, output_file: str) -> None:
        """å¯¹å¤§æ–‡ä»¶è¿›è¡Œå¤–éƒ¨æ’åº"""
        print(f"å¼€å§‹å¤–éƒ¨æ’åºï¼š{input_file} -> {output_file}")

        # é˜¶æ®µ1ï¼šåˆ†å—æ’åº
        sorted_chunks = self._create_sorted_chunks(input_file)
        print(f"åˆ›å»ºäº† {len(sorted_chunks)} ä¸ªæ’åºå—")

        # é˜¶æ®µ2ï¼šå¤šè·¯å½’å¹¶
        self._merge_chunks(sorted_chunks, output_file)
        print("å½’å¹¶å®Œæˆï¼Œæ¸…ç†ä¸´æ—¶æ–‡ä»¶")

        # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        self._cleanup_temp_files()

        print(f"æ’åºå®Œæˆï¼Œæ€»I/Oæ“ä½œæ¬¡æ•°ï¼š{self.io_operations}")

    def _create_sorted_chunks(self, input_file: str) -> List[str]:
        """å°†è¾“å…¥æ–‡ä»¶åˆ†æˆæ’åºå¥½çš„å°å—"""
        sorted_chunks = []

        with open(input_file, 'r') as file:
            while True:
                # è¯»å–ä¸€ä¸ªå†…å­˜å—å¤§å°çš„æ•°æ®
                chunk = []
                for _ in range(self.memory_size):
                    line = file.readline()
                    if not line:
                        break
                    chunk.append(int(line.strip()))

                if not chunk:
                    break

                self.io_operations += len(chunk)  # è®°å½•è¯»æ“ä½œ

                # åœ¨å†…å­˜ä¸­æ’åº
                chunk.sort()

                # å†™å…¥ä¸´æ—¶æ–‡ä»¶
                temp_file = tempfile.NamedTemporaryFile(
                    mode='w', delete=False, suffix='.tmp'
                )
                for num in chunk:
                    temp_file.write(f"{num}\n")
                temp_file.close()

                self.io_operations += len(chunk)  # è®°å½•å†™æ“ä½œ
                sorted_chunks.append(temp_file.name)
                self.temp_files.append(temp_file.name)

        return sorted_chunks

    def _merge_chunks(self, chunk_files: List[str], output_file: str) -> None:
        """ä½¿ç”¨kè·¯å½’å¹¶åˆå¹¶æ’åºå¥½çš„å—"""
        # æ‰“å¼€æ‰€æœ‰å—æ–‡ä»¶
        file_handles = []
        for filename in chunk_files:
            file_handles.append(open(filename, 'r'))

        # ä½¿ç”¨æœ€å°å †è¿›è¡Œkè·¯å½’å¹¶
        heap = []

        # åˆå§‹åŒ–å †ï¼šä»æ¯ä¸ªæ–‡ä»¶è¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ 
        for i, file_handle in enumerate(file_handles):
            line = file_handle.readline()
            if line:
                heapq.heappush(heap, (int(line.strip()), i))
                self.io_operations += 1

        # æ‰§è¡Œå½’å¹¶è¿‡ç¨‹
        with open(output_file, 'w') as output:
            while heap:
                # å–å‡ºæœ€å°å…ƒç´ 
                min_val, file_idx = heapq.heappop(heap)
                output.write(f"{min_val}\n")
                self.io_operations += 1

                # ä»ç›¸åº”æ–‡ä»¶è¯»å–ä¸‹ä¸€ä¸ªå…ƒç´ 
                next_line = file_handles[file_idx].readline()
                if next_line:
                    heapq.heappush(heap, (int(next_line.strip()), file_idx))
                    self.io_operations += 1

        # å…³é—­æ‰€æœ‰æ–‡ä»¶å¥æŸ„
        for file_handle in file_handles:
            file_handle.close()

    def _cleanup_temp_files(self) -> None:
        """æ¸…ç†ä¸´æ—¶æ–‡ä»¶"""
        for temp_file in self.temp_files:
            try:
                os.unlink(temp_file)
            except OSError:
                pass
        self.temp_files.clear()

# ä½¿ç”¨ç¤ºä¾‹å’Œæ€§èƒ½æµ‹è¯•
def generate_test_data(filename: str, size: int) -> None:
    """ç”Ÿæˆæµ‹è¯•æ•°æ®"""
    import random
    with open(filename, 'w') as file:
        for _ in range(size):
            file.write(f"{random.randint(1, 1000000)}\n")

def verify_sorted(filename: str) -> bool:
    """éªŒè¯æ–‡ä»¶æ˜¯å¦å·²æ’åº"""
    with open(filename, 'r') as file:
        prev = float('-inf')
        for line in file:
            current = int(line.strip())
            if current < prev:
                return False
            prev = current
    return True

# æ€§èƒ½æµ‹è¯•å‡½æ•°
def benchmark_external_sort():
    """å¤–éƒ¨æ’åºæ€§èƒ½åŸºå‡†æµ‹è¯•"""
    test_sizes = [10000, 50000, 100000]
    memory_sizes = [1000, 5000, 10000]

    print("å¤–éƒ¨æ’åºæ€§èƒ½æµ‹è¯•")
    print("=" * 50)

    for data_size in test_sizes:
        print(f"\næ•°æ®è§„æ¨¡: {data_size:,} ä¸ªå…ƒç´ ")

        # ç”Ÿæˆæµ‹è¯•æ•°æ®
        input_file = f"test_input_{data_size}.txt"
        generate_test_data(input_file, data_size)

        for mem_size in memory_sizes:
            if mem_size >= data_size:
                continue

            print(f"  å†…å­˜å¤§å°: {mem_size:,} ä¸ªå…ƒç´ ")

            # æ‰§è¡Œå¤–éƒ¨æ’åº
            import time
            start_time = time.time()

            sorter = ExternalSort(memory_size=mem_size)
            output_file = f"sorted_output_{data_size}_{mem_size}.txt"
            sorter.sort_file(input_file, output_file)

            end_time = time.time()

            # éªŒè¯ç»“æœ
            is_sorted = verify_sorted(output_file)

            print(f"    æ—¶é—´: {end_time - start_time:.2f}s")
            print(f"    I/Oæ“ä½œ: {sorter.io_operations:,}")
            print(f"    å—æ•°: {len(sorter.temp_files)}")
            print(f"    æ­£ç¡®æ€§: {'âœ“' if is_sorted else 'âœ—'}")

            # æ¸…ç†æ–‡ä»¶
            os.unlink(output_file)

        os.unlink(input_file)

if __name__ == "__main__":
    # ç®€å•ç¤ºä¾‹
    sorter = ExternalSort(memory_size=5)  # å†…å­˜åªèƒ½å®¹çº³5ä¸ªå…ƒç´ 

    # åˆ›å»ºæµ‹è¯•æ–‡ä»¶
    generate_test_data("large_input.txt", 20)

    # æ‰§è¡Œæ’åº
    sorter.sort_file("large_input.txt", "sorted_output.txt")

    # éªŒè¯ç»“æœ
    print("æ’åºç»“æœéªŒè¯:", "æˆåŠŸ" if verify_sorted("sorted_output.txt") else "å¤±è´¥")

    # è¿è¡Œæ€§èƒ½æµ‹è¯•
    benchmark_external_sort()</code></pre>
                </div>

                <!-- Javaä»£ç  -->
                <div id="code-java" class="code-container">
                    <div class="code-header">
                        <span>Javaå®ç°</span>
                        <button class="copy-btn" data-code="java">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code class="java">import java.io.*;
import java.util.*;
import java.util.concurrent.atomic.AtomicInteger;

public class ExternalSort {
    private final int memorySize;
    private final List&lt;String&gt; tempFiles;
    private final AtomicInteger ioOperations;

    public ExternalSort(int memorySize) {
        this.memorySize = memorySize;
        this.tempFiles = new ArrayList&lt;&gt;();
        this.ioOperations = new AtomicInteger(0);
    }

    /**
     * å¯¹å¤§æ–‡ä»¶è¿›è¡Œå¤–éƒ¨æ’åº
     */
    public void sortFile(String inputFile, String outputFile) throws IOException {
        System.out.println("å¼€å§‹å¤–éƒ¨æ’åºï¼š" + inputFile + " -> " + outputFile);

        // é˜¶æ®µ1ï¼šåˆ›å»ºæ’åºå—
        List&lt;String&gt; sortedChunks = createSortedChunks(inputFile);
        System.out.println("åˆ›å»ºäº† " + sortedChunks.size() + " ä¸ªæ’åºå—");

        // é˜¶æ®µ2ï¼šå¤šè·¯å½’å¹¶
        mergeChunks(sortedChunks, outputFile);

        // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        cleanupTempFiles();

        System.out.println("æ’åºå®Œæˆï¼Œæ€»I/Oæ“ä½œæ¬¡æ•°ï¼š" + ioOperations.get());
    }

    /**
     * åˆ›å»ºæ’åºå¥½çš„æ•°æ®å—
     */
    private List&lt;String&gt; createSortedChunks(String inputFile) throws IOException {
        List&lt;String&gt; chunks = new ArrayList&lt;&gt;();

        try (BufferedReader reader = new BufferedReader(new FileReader(inputFile))) {
            List&lt;Integer&gt; buffer = new ArrayList&lt;&gt;();
            String line;

            while ((line = reader.readLine()) != null) {
                buffer.add(Integer.parseInt(line.trim()));
                ioOperations.incrementAndGet();

                // å½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œæ’åºå¹¶å†™å…¥ä¸´æ—¶æ–‡ä»¶
                if (buffer.size() >= memorySize) {
                    String chunkFile = writeChunkToFile(buffer);
                    chunks.add(chunkFile);
                    buffer.clear();
                }
            }

            // å¤„ç†å‰©ä½™æ•°æ®
            if (!buffer.isEmpty()) {
                String chunkFile = writeChunkToFile(buffer);
                chunks.add(chunkFile);
            }
        }

        return chunks;
    }

    /**
     * å°†ç¼“å†²åŒºæ•°æ®æ’åºå¹¶å†™å…¥æ–‡ä»¶
     */
    private String writeChunkToFile(List&lt;Integer&gt; buffer) throws IOException {
        // æ’åº
        Collections.sort(buffer);

        // åˆ›å»ºä¸´æ—¶æ–‡ä»¶
        File tempFile = File.createTempFile("chunk_", ".tmp");
        tempFile.deleteOnExit();
        tempFiles.add(tempFile.getAbsolutePath());

        // å†™å…¥æ–‡ä»¶
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(tempFile))) {
            for (Integer num : buffer) {
                writer.write(num.toString());
                writer.newLine();
                ioOperations.incrementAndGet();
            }
        }

        return tempFile.getAbsolutePath();
    }

    /**
     * ä½¿ç”¨kè·¯å½’å¹¶åˆå¹¶æ‰€æœ‰æ’åºå—
     */
    private void mergeChunks(List&lt;String&gt; chunkFiles, String outputFile) throws IOException {
        // ä¼˜å…ˆé˜Ÿåˆ—ç”¨äºkè·¯å½’å¹¶
        PriorityQueue&lt;ChunkReader&gt; minHeap = new PriorityQueue&lt;&gt;();

        // åˆå§‹åŒ–æ‰€æœ‰å—çš„è¯»å–å™¨
        for (String chunkFile : chunkFiles) {
            ChunkReader reader = new ChunkReader(chunkFile);
            if (reader.hasNext()) {
                minHeap.offer(reader);
            }
        }

        // æ‰§è¡Œå½’å¹¶
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile))) {
            while (!minHeap.isEmpty()) {
                ChunkReader minReader = minHeap.poll();
                int minValue = minReader.getCurrentValue();

                // å†™å…¥æœ€å°å€¼
                writer.write(String.valueOf(minValue));
                writer.newLine();
                ioOperations.incrementAndGet();

                // ä»åŒä¸€å—è¯»å–ä¸‹ä¸€ä¸ªå€¼
                if (minReader.nextValue()) {
                    minHeap.offer(minReader);
                } else {
                    minReader.close();
                }
            }
        }
    }

    /**
     * æ•°æ®å—è¯»å–å™¨
     */
    private class ChunkReader implements Comparable&lt;ChunkReader&gt;, Closeable {
        private final BufferedReader reader;
        private Integer currentValue;

        public ChunkReader(String filename) throws IOException {
            this.reader = new BufferedReader(new FileReader(filename));
            nextValue();
        }

        public boolean hasNext() {
            return currentValue != null;
        }

        public int getCurrentValue() {
            return currentValue;
        }

        public boolean nextValue() throws IOException {
            String line = reader.readLine();
            if (line != null) {
                currentValue = Integer.parseInt(line.trim());
                ioOperations.incrementAndGet();
                return true;
            } else {
                currentValue = null;
                return false;
            }
        }

        @Override
        public int compareTo(ChunkReader other) {
            return Integer.compare(this.currentValue, other.currentValue);
        }

        @Override
        public void close() throws IOException {
            reader.close();
        }
    }

    /**
     * æ¸…ç†ä¸´æ—¶æ–‡ä»¶
     */
    private void cleanupTempFiles() {
        for (String tempFile : tempFiles) {
            new File(tempFile).delete();
        }
        tempFiles.clear();
    }

    // å·¥å…·æ–¹æ³•
    public static void generateTestData(String filename, int size) throws IOException {
        Random random = new Random();
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(filename))) {
            for (int i = 0; i < size; i++) {
                writer.write(String.valueOf(random.nextInt(1000000)));
                writer.newLine();
            }
        }
    }

    public static boolean verifySorted(String filename) throws IOException {
        try (BufferedReader reader = new BufferedReader(new FileReader(filename))) {
            String line = reader.readLine();
            if (line == null) return true;

            int prev = Integer.parseInt(line.trim());
            while ((line = reader.readLine()) != null) {
                int current = Integer.parseInt(line.trim());
                if (current < prev) {
                    return false;
                }
                prev = current;
            }
        }
        return true;
    }

    // æ€§èƒ½æµ‹è¯•
    public static void benchmarkExternalSort() throws IOException {
        int[] dataSizes = {10000, 50000, 100000};
        int[] memorySizes = {1000, 5000, 10000};

        System.out.println("å¤–éƒ¨æ’åºæ€§èƒ½æµ‹è¯•");
        System.out.println("=".repeat(50));

        for (int dataSize : dataSizes) {
            System.out.println("\næ•°æ®è§„æ¨¡: " + String.format("%,d", dataSize) + " ä¸ªå…ƒç´ ");

            String inputFile = "test_input_" + dataSize + ".txt";
            generateTestData(inputFile, dataSize);

            for (int memSize : memorySizes) {
                if (memSize >= dataSize) continue;

                System.out.println("  å†…å­˜å¤§å°: " + String.format("%,d", memSize) + " ä¸ªå…ƒç´ ");

                long startTime = System.currentTimeMillis();

                ExternalSort sorter = new ExternalSort(memSize);
                String outputFile = "sorted_output_" + dataSize + "_" + memSize + ".txt";
                sorter.sortFile(inputFile, outputFile);

                long endTime = System.currentTimeMillis();
                boolean isSorted = verifySorted(outputFile);

                System.out.printf("    æ—¶é—´: %.2fs\n", (endTime - startTime) / 1000.0);
                System.out.println("    I/Oæ“ä½œ: " + String.format("%,d", sorter.ioOperations.get()));
                System.out.println("    å—æ•°: " + sorter.tempFiles.size());
                System.out.println("    æ­£ç¡®æ€§: " + (isSorted ? "âœ“" : "âœ—"));

                new File(outputFile).delete();
            }

            new File(inputFile).delete();
        }
    }

    public static void main(String[] args) throws IOException {
        // ç®€å•ç¤ºä¾‹
        ExternalSort sorter = new ExternalSort(5);  // å†…å­˜åªèƒ½å®¹çº³5ä¸ªå…ƒç´ 

        // åˆ›å»ºæµ‹è¯•æ–‡ä»¶
        generateTestData("large_input.txt", 20);

        // æ‰§è¡Œæ’åº
        sorter.sortFile("large_input.txt", "sorted_output.txt");

        // éªŒè¯ç»“æœ
        boolean isSorted = verifySorted("sorted_output.txt");
        System.out.println("æ’åºç»“æœéªŒè¯: " + (isSorted ? "æˆåŠŸ" : "å¤±è´¥"));

        // è¿è¡Œæ€§èƒ½æµ‹è¯•
        benchmarkExternalSort();

        // æ¸…ç†æµ‹è¯•æ–‡ä»¶
        new File("large_input.txt").delete();
        new File("sorted_output.txt").delete();
    }
}</code></pre>
                </div>

                <!-- C++ä»£ç  -->
                <div id="code-cpp" class="code-container">
                    <div class="code-header">
                        <span>C++å®ç°</span>
                        <button class="copy-btn" data-code="cpp">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code class="cpp">#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;vector&gt;
#include &lt;queue&gt;
#include &lt;algorithm&gt;
#include &lt;string&gt;
#include &lt;random&gt;
#include &lt;chrono&gt;
#include &lt;iomanip&gt;

class ExternalSort {
private:
    int memorySize;
    std::vector&lt;std::string&gt; tempFiles;
    int ioOperations;

    struct ChunkReader {
        std::ifstream file;
        int currentValue;
        bool hasValue;
        int chunkId;

        ChunkReader(const std::string&amp; filename, int id) : chunkId(id), hasValue(false) {
            file.open(filename);
            if (file.is_open()) {
                nextValue();
            }
        }

        bool nextValue() {
            if (file &gt;&gt; currentValue) {
                hasValue = true;
                return true;
            } else {
                hasValue = false;
                return false;
            }
        }

        bool operator&gt;(const ChunkReader&amp; other) const {
            return currentValue &gt; other.currentValue;
        }

        ~ChunkReader() {
            if (file.is_open()) {
                file.close();
            }
        }
    };

public:
    ExternalSort(int memSize) : memorySize(memSize), ioOperations(0) {}

    /**
     * å¯¹å¤§æ–‡ä»¶è¿›è¡Œå¤–éƒ¨æ’åº
     */
    void sortFile(const std::string&amp; inputFile, const std::string&amp; outputFile) {
        std::cout &lt;&lt; "å¼€å§‹å¤–éƒ¨æ’åºï¼š" &lt;&lt; inputFile &lt;&lt; " -> " &lt;&lt; outputFile &lt;&lt; std::endl;

        // é˜¶æ®µ1ï¼šåˆ›å»ºæ’åºå—
        std::vector&lt;std::string&gt; sortedChunks = createSortedChunks(inputFile);
        std::cout &lt;&lt; "åˆ›å»ºäº† " &lt;&lt; sortedChunks.size() &lt;&lt; " ä¸ªæ’åºå—" &lt;&lt; std::endl;

        // é˜¶æ®µ2ï¼šå¤šè·¯å½’å¹¶
        mergeChunks(sortedChunks, outputFile);

        // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        cleanupTempFiles();

        std::cout &lt;&lt; "æ’åºå®Œæˆï¼Œæ€»I/Oæ“ä½œæ¬¡æ•°ï¼š" &lt;&lt; ioOperations &lt;&lt; std::endl;
    }

private:
    /**
     * åˆ›å»ºæ’åºå¥½çš„æ•°æ®å—
     */
    std::vector&lt;std::string&gt; createSortedChunks(const std::string&amp; inputFile) {
        std::vector&lt;std::string&gt; chunks;
        std::ifstream input(inputFile);

        if (!input.is_open()) {
            throw std::runtime_error("æ— æ³•æ‰“å¼€è¾“å…¥æ–‡ä»¶");
        }

        std::vector&lt;int&gt; buffer;
        buffer.reserve(memorySize);
        int value;
        int chunkIndex = 0;

        while (input &gt;&gt; value) {
            buffer.push_back(value);
            ioOperations++;

            if (buffer.size() &gt;= memorySize) {
                std::string chunkFile = writeChunkToFile(buffer, chunkIndex++);
                chunks.push_back(chunkFile);
                buffer.clear();
            }
        }

        // å¤„ç†å‰©ä½™æ•°æ®
        if (!buffer.empty()) {
            std::string chunkFile = writeChunkToFile(buffer, chunkIndex);
            chunks.push_back(chunkFile);
        }

        input.close();
        return chunks;
    }

    /**
     * å°†ç¼“å†²åŒºæ•°æ®æ’åºå¹¶å†™å…¥æ–‡ä»¶
     */
    std::string writeChunkToFile(std::vector&lt;int&gt;&amp; buffer, int chunkIndex) {
        // æ’åº
        std::sort(buffer.begin(), buffer.end());

        // åˆ›å»ºä¸´æ—¶æ–‡ä»¶
        std::string filename = "temp_chunk_" + std::to_string(chunkIndex) + ".tmp";
        tempFiles.push_back(filename);

        std::ofstream output(filename);
        if (!output.is_open()) {
            throw std::runtime_error("æ— æ³•åˆ›å»ºä¸´æ—¶æ–‡ä»¶");
        }

        // å†™å…¥æ•°æ®
        for (int num : buffer) {
            output &lt;&lt; num &lt;&lt; '\n';
            ioOperations++;
        }

        output.close();
        return filename;
    }

    /**
     * ä½¿ç”¨kè·¯å½’å¹¶åˆå¹¶æ‰€æœ‰æ’åºå—
     */
    void mergeChunks(const std::vector&lt;std::string&gt;&amp; chunkFiles, const std::string&amp; outputFile) {
        std::priority_queue&lt;ChunkReader*, std::vector&lt;ChunkReader*&gt;,
                          std::function&lt;bool(ChunkReader*, ChunkReader*)&gt;&gt; minHeap(
            [](ChunkReader* a, ChunkReader* b) {
                return a-&gt;currentValue &gt; b-&gt;currentValue;
            }
        );

        // åˆå§‹åŒ–æ‰€æœ‰å—è¯»å–å™¨
        std::vector&lt;std::unique_ptr&lt;ChunkReader&gt;&gt; readers;
        for (size_t i = 0; i &lt; chunkFiles.size(); ++i) {
            auto reader = std::make_unique&lt;ChunkReader&gt;(chunkFiles[i], i);
            if (reader-&gt;hasValue) {
                minHeap.push(reader.get());
            }
            readers.push_back(std::move(reader));
        }

        // æ‰§è¡Œå½’å¹¶
        std::ofstream output(outputFile);
        if (!output.is_open()) {
            throw std::runtime_error("æ— æ³•åˆ›å»ºè¾“å‡ºæ–‡ä»¶");
        }

        while (!minHeap.empty()) {
            ChunkReader* minReader = minHeap.top();
            minHeap.pop();

            // å†™å…¥æœ€å°å€¼
            output &lt;&lt; minReader-&gt;currentValue &lt;&lt; '\n';
            ioOperations++;

            // ä»åŒä¸€å—è¯»å–ä¸‹ä¸€ä¸ªå€¼
            if (minReader-&gt;nextValue()) {
                ioOperations++;
                minHeap.push(minReader);
            }
        }

        output.close();
    }

    /**
     * æ¸…ç†ä¸´æ—¶æ–‡ä»¶
     */
    void cleanupTempFiles() {
        for (const std::string&amp; filename : tempFiles) {
            std::remove(filename.c_str());
        }
        tempFiles.clear();
    }

public:
    // å·¥å…·æ–¹æ³•
    static void generateTestData(const std::string&amp; filename, int size) {
        std::ofstream output(filename);
        std::random_device rd;
        std::mt19937 gen(rd());
        std::uniform_int_distribution&lt;int&gt; dis(1, 1000000);

        for (int i = 0; i &lt; size; ++i) {
            output &lt;&lt; dis(gen) &lt;&lt; '\n';
        }
        output.close();
    }

    static bool verifySorted(const std::string&amp; filename) {
        std::ifstream input(filename);
        if (!input.is_open()) return false;

        int prev = INT_MIN;
        int current;

        while (input &gt;&gt; current) {
            if (current &lt; prev) {
                return false;
            }
            prev = current;
        }

        return true;
    }

    static void benchmarkExternalSort() {
        std::vector&lt;int&gt; dataSizes = {10000, 50000, 100000};
        std::vector&lt;int&gt; memorySizes = {1000, 5000, 10000};

        std::cout &lt;&lt; "å¤–éƒ¨æ’åºæ€§èƒ½æµ‹è¯•" &lt;&lt; std::endl;
        std::cout &lt;&lt; std::string(50, '=') &lt;&lt; std::endl;

        for (int dataSize : dataSizes) {
            std::cout &lt;&lt; "\næ•°æ®è§„æ¨¡: " &lt;&lt; dataSize &lt;&lt; " ä¸ªå…ƒç´ " &lt;&lt; std::endl;

            std::string inputFile = "test_input_" + std::to_string(dataSize) + ".txt";
            generateTestData(inputFile, dataSize);

            for (int memSize : memorySizes) {
                if (memSize &gt;= dataSize) continue;

                std::cout &lt;&lt; "  å†…å­˜å¤§å°: " &lt;&lt; memSize &lt;&lt; " ä¸ªå…ƒç´ " &lt;&lt; std::endl;

                auto startTime = std::chrono::high_resolution_clock::now();

                ExternalSort sorter(memSize);
                std::string outputFile = "sorted_output_" + std::to_string(dataSize)
                                       + "_" + std::to_string(memSize) + ".txt";
                sorter.sortFile(inputFile, outputFile);

                auto endTime = std::chrono::high_resolution_clock::now();
                auto duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(
                    endTime - startTime
                );

                bool isSorted = verifySorted(outputFile);

                std::cout &lt;&lt; "    æ—¶é—´: " &lt;&lt; std::fixed &lt;&lt; std::setprecision(2)
                         &lt;&lt; duration.count() / 1000.0 &lt;&lt; "s" &lt;&lt; std::endl;
                std::cout &lt;&lt; "    I/Oæ“ä½œ: " &lt;&lt; sorter.ioOperations &lt;&lt; std::endl;
                std::cout &lt;&lt; "    å—æ•°: " &lt;&lt; sorter.tempFiles.size() &lt;&lt; std::endl;
                std::cout &lt;&lt; "    æ­£ç¡®æ€§: " &lt;&lt; (isSorted ? "âœ“" : "âœ—") &lt;&lt; std::endl;

                std::remove(outputFile.c_str());
            }

            std::remove(inputFile.c_str());
        }
    }
};

int main() {
    try {
        // ç®€å•ç¤ºä¾‹
        ExternalSort sorter(5);  // å†…å­˜åªèƒ½å®¹çº³5ä¸ªå…ƒç´ 

        // åˆ›å»ºæµ‹è¯•æ–‡ä»¶
        ExternalSort::generateTestData("large_input.txt", 20);

        // æ‰§è¡Œæ’åº
        sorter.sortFile("large_input.txt", "sorted_output.txt");

        // éªŒè¯ç»“æœ
        bool isSorted = ExternalSort::verifySorted("sorted_output.txt");
        std::cout &lt;&lt; "æ’åºç»“æœéªŒè¯: " &lt;&lt; (isSorted ? "æˆåŠŸ" : "å¤±è´¥") &lt;&lt; std::endl;

        // è¿è¡Œæ€§èƒ½æµ‹è¯•
        ExternalSort::benchmarkExternalSort();

        // æ¸…ç†æµ‹è¯•æ–‡ä»¶
        std::remove("large_input.txt");
        std::remove("sorted_output.txt");

    } catch (const std::exception&amp; e) {
        std::cerr &lt;&lt; "é”™è¯¯: " &lt;&lt; e.what() &lt;&lt; std::endl;
        return 1;
    }

    return 0;
}</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… å­¦ä¹ æ£€éªŒ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">âœ…</span>
                å­¦ä¹ æ£€éªŒ
            </h2>

            <div class="quiz-section">
                <h3>ğŸ¯ å¸¸è§é—®é¢˜è§£ç­”</h3>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ ä¸ºä»€ä¹ˆä¸èƒ½ç®€å•åœ°å¢åŠ å†…å­˜æ¥è§£å†³å¤§æ•°æ®æ’åºé—®é¢˜ï¼Ÿå®é™…åº”ç”¨ä¸­æœ‰å“ªäº›é™åˆ¶ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer1">
                        <button class="show-answer-btn" onclick="showAnswer(1)">ğŸ“– æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>å†…å­˜é™åˆ¶çš„ç°å®è€ƒé‡ï¼š</strong><br><br>
                            <strong>1. ç»æµæˆæœ¬é™åˆ¶ï¼š</strong><br>
                            â€¢ å¤§å®¹é‡å†…å­˜ä»·æ ¼æ˜‚è´µï¼Œç‰¹åˆ«æ˜¯å¯¹äºTBçº§æ•°æ®å¤„ç†<br>
                            â€¢ äº‘è®¡ç®—ç¯å¢ƒä¸­ï¼Œå†…å­˜æ˜¯æŒ‰ä½¿ç”¨é‡è®¡è´¹çš„é‡è¦èµ„æº<br>
                            â€¢ å¯¹äºæ‰¹å¤„ç†ä½œä¸šï¼Œé•¿æ—¶é—´å ç”¨å¤§é‡å†…å­˜ä¸ç»æµ<br><br>
                            <strong>2. ç³»ç»Ÿæ¶æ„é™åˆ¶ï¼š</strong><br>
                            â€¢ 32ä½ç³»ç»Ÿçš„åœ°å€ç©ºé—´é™åˆ¶ï¼ˆæœ€å¤š4GBï¼‰<br>
                            â€¢ æ“ä½œç³»ç»Ÿå¯¹å•ä¸ªè¿›ç¨‹çš„å†…å­˜é™åˆ¶<br>
                            â€¢ è™šæ‹Ÿå†…å­˜ç®¡ç†çš„å¼€é”€ä¼šå½±å“æ€§èƒ½<br><br>
                            <strong>3. å¹¶å‘éœ€æ±‚ï¼š</strong><br>
                            â€¢ ç³»ç»Ÿéœ€è¦ä¸ºå…¶ä»–è¿›ç¨‹ä¿ç•™å†…å­˜<br>
                            â€¢ æ•°æ®åº“ç³»ç»Ÿéœ€è¦åŒæ—¶å¤„ç†å¤šä¸ªæŸ¥è¯¢<br>
                            â€¢ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜æœ‰é™<br><br>
                            <strong>4. æ•°æ®æŒä¹…æ€§ï¼š</strong><br>
                            â€¢ å†…å­˜æ˜¯æ˜“å¤±æ€§å­˜å‚¨ï¼Œç³»ç»Ÿå´©æºƒä¼šä¸¢å¤±æ•°æ®<br>
                            â€¢ å¤–éƒ¨æ’åºçš„ä¸­é—´ç»“æœå¯ä»¥æŒä¹…åŒ–ï¼Œæé«˜å¯é æ€§<br><br>
                            <strong>å®é™…åº”ç”¨ç¤ºä¾‹ï¼š</strong><br>
                            â€¢ Hadoopå¤„ç†PBçº§æ•°æ®æ—¶ï¼Œå•æœºå†…å­˜é€šå¸¸åªæœ‰å‡ åGB<br>
                            â€¢ æ•°æ®åº“çš„ORDER BYæ“ä½œå¿…é¡»è€ƒè™‘å†…å­˜é™åˆ¶<br>
                            â€¢ æœç´¢å¼•æ“æ„å»ºç´¢å¼•æ—¶æ•°æ®é‡è¿œè¶…å•æœºå†…å­˜å®¹é‡
                        </div>
                    </div>
                </div>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ å¦‚ä½•é€‰æ‹©æœ€ä¼˜çš„å†…å­˜å—å¤§å°å’Œå½’å¹¶è·¯æ•°ï¼Ÿè¿™ä¸¤ä¸ªå‚æ•°å¦‚ä½•å½±å“æ€§èƒ½ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer2">
                        <button class="show-answer-btn" onclick="showAnswer(2)">ğŸ“– æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>å‚æ•°ä¼˜åŒ–çš„æƒè¡¡åˆ†æï¼š</strong><br><br>
                            <strong>å†…å­˜å—å¤§å°ä¼˜åŒ–ï¼š</strong><br>
                            <table style="width:100%; border-collapse: collapse; margin: 15px 0;">
                                <tr style="background:#f3f4f6;">
                                    <th style="border:1px solid #ddd; padding:8px;">å—å¤§å°</th>
                                    <th style="border:1px solid #ddd; padding:8px;">ä¼˜ç‚¹</th>
                                    <th style="border:1px solid #ddd; padding:8px;">ç¼ºç‚¹</th>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>å¤§å—</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">â€¢ å‡å°‘I/Oæ¬¡æ•°<br>â€¢ æ›´å¥½çš„å±€éƒ¨æ€§<br>â€¢ å†…éƒ¨æ’åºæ•ˆç‡é«˜</td>
                                    <td style="border:1px solid #ddd; padding:8px;">â€¢ éœ€è¦æ›´å¤šå†…å­˜<br>â€¢ å¢åŠ å½’å¹¶å¤æ‚åº¦</td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>å°å—</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">â€¢ å†…å­˜éœ€æ±‚å°<br>â€¢ å¯å¹¶è¡Œå¤„ç†<br>â€¢ çµæ´»æ€§é«˜</td>
                                    <td style="border:1px solid #ddd; padding:8px;">â€¢ å¢åŠ I/Oå¼€é”€<br>â€¢ æ›´å¤šä¸´æ—¶æ–‡ä»¶</td>
                                </tr>
                            </table>
                            <strong>å½’å¹¶è·¯æ•°é€‰æ‹©ï¼š</strong><br>
                            â€¢ <strong>ç†è®ºæœ€ä¼˜ï¼š</strong>k = âŒˆM/BâŒ‰ - 1ï¼ˆM=å†…å­˜é¡µæ•°ï¼ŒB=ç¼“å†²åŒºé¡µæ•°ï¼‰<br>
                            â€¢ <strong>å®è·µè€ƒè™‘ï¼š</strong>é€šå¸¸é€‰æ‹©2-16è·¯ï¼Œå¹³è¡¡å†…å­˜ä½¿ç”¨å’Œå½’å¹¶æ•ˆç‡<br>
                            â€¢ <strong>å†…å­˜åˆ†é…ï¼š</strong>æ¯è·¯éœ€è¦ä¸€ä¸ªè¾“å…¥ç¼“å†²åŒº + ä¸€ä¸ªè¾“å‡ºç¼“å†²åŒº<br><br>
                            <strong>æ€§èƒ½å½±å“åˆ†æï¼š</strong><br>
                            â€¢ <strong>I/Oå¤æ‚åº¦ï¼š</strong>O((N/B) * log_{k}(N/M)) æ¬¡ç£ç›˜è®¿é—®<br>
                            â€¢ <strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>O(N log N)ï¼Œä½†å¸¸æ•°å› å­å—kå’Œå—å¤§å°å½±å“<br>
                            â€¢ <strong>ç©ºé—´å¤æ‚åº¦ï¼š</strong>O(k * B + M)<br><br>
                            <strong>å®é™…è°ƒä¼˜å»ºè®®ï¼š</strong><br>
                            â€¢ æ ¹æ®å¯ç”¨å†…å­˜çš„80%ç¡®å®šæ€»ç¼“å†²åŒºå¤§å°<br>
                            â€¢ å—å¤§å° = æ€»ç¼“å†²åŒºå¤§å° / (k + 1)<br>
                            â€¢ å¯¹äºSSDå­˜å‚¨ï¼Œå¯ä»¥é€‚å½“å¢åŠ kå€¼<br>
                            â€¢ å¯¹äºç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œå¢å¤§å—å¤§å°å‡å°‘ç½‘ç»œå¾€è¿”
                        </div>
                    </div>
                </div>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ å¤–éƒ¨æ’åºåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¦‚ä½•å®ç°ï¼Ÿä¸å•æœºç‰ˆæœ¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer3">
                        <button class="show-answer-btn" onclick="showAnswer(3)">ğŸ“– æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>åˆ†å¸ƒå¼å¤–éƒ¨æ’åºæ¶æ„ï¼š</strong><br><br>
                            <strong>1. æ•°æ®åˆ†ç‰‡ (Data Partitioning)ï¼š</strong><br>
                            â€¢ <strong>èŒƒå›´åˆ†ç‰‡ï¼š</strong>æ ¹æ®é”®å€¼èŒƒå›´å°†æ•°æ®åˆ†é…åˆ°ä¸åŒèŠ‚ç‚¹<br>
                            â€¢ <strong>å“ˆå¸Œåˆ†ç‰‡ï¼š</strong>ä½¿ç”¨å“ˆå¸Œå‡½æ•°å‡åŒ€åˆ†å¸ƒæ•°æ®<br>
                            â€¢ <strong>é‡‡æ ·åˆ†ç‰‡ï¼š</strong>å…ˆé‡‡æ ·ç¡®å®šåˆ†ç‰‡è¾¹ç•Œï¼Œç„¶ååˆ†é…æ•°æ®<br><br>
                            <strong>2. åˆ†å¸ƒå¼æ’åºæµç¨‹ï¼š</strong><br>
                            <div style="background:#f0f9ff; padding:15px; border-radius:8px; margin:10px 0;">
                                <strong>Phase 1 - æœ¬åœ°æ’åºï¼š</strong><br>
                                â”” æ¯ä¸ªèŠ‚ç‚¹å¯¹æœ¬åœ°æ•°æ®æ‰§è¡Œå¤–éƒ¨æ’åº<br><br>
                                <strong>Phase 2 - æ•°æ®é‡åˆ†å¸ƒï¼š</strong><br>
                                â”œ æ ¹æ®å…¨å±€æ’åºé”®é‡æ–°åˆ†ç‰‡<br>
                                â”” ç½‘ç»œä¼ è¾“æ•°æ®åˆ°ç›®æ ‡èŠ‚ç‚¹<br><br>
                                <strong>Phase 3 - æœ€ç»ˆå½’å¹¶ï¼š</strong><br>
                                â”” æ¯ä¸ªèŠ‚ç‚¹å½’å¹¶æ”¶åˆ°çš„å·²æ’åºæ•°æ®
                            </div>
                            <strong>3. ä¸å•æœºç‰ˆæœ¬çš„å…³é”®åŒºåˆ«ï¼š</strong><br>
                            <table style="width:100%; border-collapse: collapse; margin: 15px 0;">
                                <tr style="background:#f3f4f6;">
                                    <th style="border:1px solid #ddd; padding:8px;">æ–¹é¢</th>
                                    <th style="border:1px solid #ddd; padding:8px;">å•æœºç‰ˆæœ¬</th>
                                    <th style="border:1px solid #ddd; padding:8px;">åˆ†å¸ƒå¼ç‰ˆæœ¬</th>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>ç“¶é¢ˆ</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">ç£ç›˜I/O</td>
                                    <td style="border:1px solid #ddd; padding:8px;">ç½‘ç»œé€šä¿¡ + è´Ÿè½½å‡è¡¡</td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>å®¹é”™æ€§</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">å•ç‚¹æ•…éšœ</td>
                                    <td style="border:1px solid #ddd; padding:8px;">éœ€è¦å‰¯æœ¬å’Œæ•…éšœæ¢å¤æœºåˆ¶</td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>æ‰©å±•æ€§</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">å—å•æœºèµ„æºé™åˆ¶</td>
                                    <td style="border:1px solid #ddd; padding:8px;">æ°´å¹³æ‰©å±•ï¼Œç†è®ºä¸Šæ— é™</td>
                                </tr>
                            </table>
                            <strong>4. å®é™…ç³»ç»Ÿå®ç°ï¼š</strong><br>
                            â€¢ <strong>Hadoop MapReduceï¼š</strong>ä½¿ç”¨TeraSortç®—æ³•<br>
                            â€¢ <strong>Sparkï¼š</strong>åŸºäºRDDçš„åˆ†å¸ƒå¼æ’åº<br>
                            â€¢ <strong>Flinkï¼š</strong>æµå¼å’Œæ‰¹å¤„ç†ç»Ÿä¸€çš„æ’åºæ¡†æ¶<br><br>
                            <strong>5. æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼š</strong><br>
                            â€¢ <strong>é¢„é‡‡æ ·ï¼š</strong>é¿å…æ•°æ®å€¾æ–œï¼Œç¡®ä¿å‡åŒ€åˆ†ç‰‡<br>
                            â€¢ <strong>æµæ°´çº¿å¤„ç†ï¼š</strong>é‡å è®¡ç®—ã€é€šä¿¡å’ŒI/Oæ“ä½œ<br>
                            â€¢ <strong>å‹ç¼©ä¼ è¾“ï¼š</strong>å‡å°‘ç½‘ç»œä¼ è¾“å¼€é”€<br>
                            â€¢ <strong>æœ¬åœ°æ€§ä¼˜åŒ–ï¼š</strong>å°½é‡åœ¨æ•°æ®æ‰€åœ¨èŠ‚ç‚¹æ‰§è¡Œè®¡ç®—
                        </div>
                    </div>
                </div>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ å¦‚ä½•å¤„ç†å¤–éƒ¨æ’åºä¸­çš„ç‰¹æ®Šæƒ…å†µï¼Œå¦‚é‡å¤å…ƒç´ å¾ˆå¤šã€æ•°æ®å€¾æ–œã€éƒ¨åˆ†æœ‰åºç­‰ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer4">
                        <button class="show-answer-btn" onclick="showAnswer(4)">ğŸ“– æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>ç‰¹æ®Šæƒ…å†µä¼˜åŒ–ç­–ç•¥ï¼š</strong><br><br>
                            <strong>1. å¤„ç†å¤§é‡é‡å¤å…ƒç´ ï¼š</strong><br>
                            â€¢ <strong>è®¡æ•°æ’åºæ€æƒ³ï¼š</strong>ç»Ÿè®¡æ¯ä¸ªå€¼çš„å‡ºç°æ¬¡æ•°ï¼Œè€Œä¸æ˜¯å­˜å‚¨é‡å¤å€¼<br>
                            â€¢ <strong>å‹ç¼©å­˜å‚¨ï¼š</strong>ä½¿ç”¨(value, count)å¯¹å‡å°‘å­˜å‚¨ç©ºé—´<br>
                            â€¢ <strong>ä¸‰è·¯å¿«æ’ï¼š</strong>å†…éƒ¨æ’åºæ—¶å°†ç›¸ç­‰å…ƒç´ èšé›†åœ¨ä¸­é—´<br>
                            â€¢ <strong>é‡å¤å€¼åˆå¹¶ï¼š</strong>åœ¨å½’å¹¶æ—¶åˆå¹¶ç›¸åŒå€¼çš„è®¡æ•°<br><br>
                            <div style="background:#f0f9ff; padding:15px; border-radius:8px; margin:10px 0;">
                                <strong>ç¤ºä¾‹ä¼˜åŒ–ï¼š</strong><br>
                                åŸå§‹: [5,5,5,5,3,3,7,7,7] â†’ å‹ç¼©: [(3,2), (5,4), (7,3)]<br>
                                å­˜å‚¨ç©ºé—´ä»9ä¸ªå…ƒç´ å‡å°‘åˆ°3ä¸ªå…ƒç»„
                            </div>
                            <strong>2. åº”å¯¹æ•°æ®å€¾æ–œï¼š</strong><br>
                            â€¢ <strong>åŠ¨æ€åˆ†ç‰‡ï¼š</strong>æ ¹æ®å®é™…æ•°æ®åˆ†å¸ƒè°ƒæ•´åˆ†ç‰‡ç­–ç•¥<br>
                            â€¢ <strong>äºŒçº§é‡‡æ ·ï¼š</strong>å…ˆç²—é‡‡æ ·ç¡®å®šçƒ­ç‚¹ï¼Œå†ç»†åŒ–åˆ†ç‰‡<br>
                            â€¢ <strong>å€¾æ–œæ£€æµ‹ï¼š</strong>ç›‘æ§å„åˆ†ç‰‡å¤§å°ï¼ŒåŠ¨æ€è°ƒæ•´<br>
                            â€¢ <strong>è´Ÿè½½å‡è¡¡ï¼š</strong>å°†å¤§åˆ†ç‰‡è¿›ä¸€æ­¥ç»†åˆ†<br><br>
                            <strong>3. åˆ©ç”¨éƒ¨åˆ†æœ‰åºæ€§ï¼š</strong><br>
                            â€¢ <strong>è¿è¡Œæ£€æµ‹ï¼š</strong>è¯†åˆ«å·²ç»æ’åºçš„æ•°æ®æ®µ<br>
                            â€¢ <strong>è‡ªç„¶å½’å¹¶ï¼š</strong>åˆå¹¶ç›¸é‚»çš„æœ‰åºæ®µï¼Œå‡å°‘å½’å¹¶å±‚æ•°<br>
                            â€¢ <strong>Timæ’åºæ€æƒ³ï¼š</strong>ç»“åˆæ’å…¥æ’åºå’Œå½’å¹¶æ’åº<br>
                            â€¢ <strong>è·³è·ƒå¼å½’å¹¶ï¼š</strong>è·³è¿‡å·²ç»æœ‰åºçš„éƒ¨åˆ†<br><br>
                            <div style="background:#fef2f2; padding:15px; border-radius:8px; margin:10px 0;">
                                <strong>éƒ¨åˆ†æœ‰åºä¼˜åŒ–ç¤ºä¾‹ï¼š</strong><br>
                                æ•°æ®: [1,2,3,8,4,5,6,7] <br>
                                è¯†åˆ«: [1,2,3,8] å’Œ [4,5,6,7] ä¸¤ä¸ªæœ‰åºæ®µ<br>
                                ç›´æ¥å½’å¹¶è€Œä¸éœ€è¦å†…éƒ¨æ’åº
                            </div>
                            <strong>4. å†…å­˜è‡ªé€‚åº”ç­–ç•¥ï¼š</strong><br>
                            â€¢ <strong>åŠ¨æ€å—å¤§å°ï¼š</strong>æ ¹æ®å¯ç”¨å†…å­˜åŠ¨æ€è°ƒæ•´å—å¤§å°<br>
                            â€¢ <strong>å‹ç¼©ç¼“å†²ï¼š</strong>å¯¹é‡å¤æ•°æ®ä½¿ç”¨å‹ç¼©ç¼“å†²åŒº<br>
                            â€¢ <strong>æ‡’åŠ è½½ï¼š</strong>éœ€è¦æ—¶æ‰åŠ è½½æ•°æ®åˆ°å†…å­˜<br>
                            â€¢ <strong>LRUæ·˜æ±°ï¼š</strong>æ™ºèƒ½ç®¡ç†ç¼“å†²åŒºå†…å®¹<br><br>
                            <strong>5. I/Oä¼˜åŒ–æŠ€æœ¯ï¼š</strong><br>
                            â€¢ <strong>é¢„è¯»ç­–ç•¥ï¼š</strong>é¢„æµ‹éœ€è¦çš„æ•°æ®å¹¶æå‰è¯»å–<br>
                            â€¢ <strong>æ‰¹é‡å†™å…¥ï¼š</strong>ç´¯ç§¯åˆ°ä¸€å®šé‡åæ‰¹é‡å†™å…¥ç£ç›˜<br>
                            â€¢ <strong>å¹¶è¡ŒI/Oï¼š</strong>ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œè¯»å†™ä¸åŒæ–‡ä»¶<br>
                            â€¢ <strong>SSDä¼˜åŒ–ï¼š</strong>é’ˆå¯¹SSDéšæœºè®¿é—®æ€§èƒ½å¥½çš„ç‰¹ç‚¹ä¼˜åŒ–<br><br>
                            <strong>å®é™…åº”ç”¨æ¡ˆä¾‹ï¼š</strong><br>
                            â€¢ <strong>æ—¥å¿—å¤„ç†ï¼š</strong>æ—¶é—´æˆ³æ•°æ®é€šå¸¸éƒ¨åˆ†æœ‰åºï¼Œå¯ä¼˜åŒ–å½’å¹¶<br>
                            â€¢ <strong>ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼š</strong>ç”¨æˆ·IDé‡å¤å¤šï¼Œé€‚åˆè®¡æ•°å‹ç¼©<br>
                            â€¢ <strong>ä¼ æ„Ÿå™¨æ•°æ®ï¼š</strong>è¯»æ•°å¯èƒ½é›†ä¸­åœ¨æŸäº›åŒºé—´ï¼Œå®¹æ˜“å€¾æ–œ
                        </div>
                    </div>
                </div>

                <div class="quiz-item">
                    <div class="question">
                        <h4>â“ å¤–éƒ¨æ’åºçš„I/Oå¤æ‚åº¦å¦‚ä½•è®¡ç®—ï¼Ÿä¸å†…éƒ¨æ’åºçš„æ—¶é—´å¤æ‚åº¦æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h4>
                    </div>
                    <div class="answer" id="answer5">
                        <button class="show-answer-btn" onclick="showAnswer(5)">ğŸ“– æŸ¥çœ‹ç­”æ¡ˆ</button>
                        <div class="answer-content" style="display: none;">
                            <strong>I/Oå¤æ‚åº¦è¯¦ç»†åˆ†æï¼š</strong><br><br>
                            <strong>åŸºæœ¬ç¬¦å·å®šä¹‰ï¼š</strong><br>
                            â€¢ N = æ•°æ®æ€»é‡ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰<br>
                            â€¢ M = å¯ç”¨å†…å­˜å¤§å°ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰<br>
                            â€¢ B = ç£ç›˜å—å¤§å°ï¼ˆæ¯æ¬¡I/Oæ“ä½œçš„å…ƒç´ ä¸ªæ•°ï¼‰<br>
                            â€¢ k = å½’å¹¶è·¯æ•°<br><br>
                            <strong>1. ä¸¤é˜¶æ®µI/Oå¤æ‚åº¦è®¡ç®—ï¼š</strong><br>
                            <div style="background:#f0f9ff; padding:15px; border-radius:8px; margin:10px 0;">
                                <strong>é˜¶æ®µ1 - åˆ›å»ºæ’åºå—ï¼š</strong><br>
                                â€¢ è¯»å–æ‰€æœ‰æ•°æ®: N/B æ¬¡ç£ç›˜è¯»æ“ä½œ<br>
                                â€¢ å†™å…¥æ’åºå—: N/B æ¬¡ç£ç›˜å†™æ“ä½œ<br>
                                â€¢ æ€»å—æ•°: âŒˆN/MâŒ‰<br>
                                â€¢ é˜¶æ®µ1 I/O: 2N/B<br><br>
                                <strong>é˜¶æ®µ2 - å¤šè·¯å½’å¹¶ï¼š</strong><br>
                                â€¢ å½’å¹¶å±‚æ•°: âŒˆlog_k(âŒˆN/MâŒ‰)âŒ‰<br>
                                â€¢ æ¯å±‚è¯»å†™æ‰€æœ‰æ•°æ®: 2N/B<br>
                                â€¢ é˜¶æ®µ2 I/O: 2N/B * âŒˆlog_k(âŒˆN/MâŒ‰)âŒ‰
                            </div>
                            <strong>æ€»I/Oå¤æ‚åº¦ï¼š</strong><br>
                            <span style="background:#dcfce7; padding:8px; border-radius:4px; font-family:monospace;">
                                <strong>O((N/B) * log_k(N/M))</strong>
                            </span><br><br>
                            <strong>2. ä¸å†…éƒ¨æ’åºçš„å…³ç³»ï¼š</strong><br>
                            <table style="width:100%; border-collapse: collapse; margin: 15px 0;">
                                <tr style="background:#f3f4f6;">
                                    <th style="border:1px solid #ddd; padding:8px;">å¤æ‚åº¦ç±»å‹</th>
                                    <th style="border:1px solid #ddd; padding:8px;">å†…éƒ¨æ’åº</th>
                                    <th style="border:1px solid #ddd; padding:8px;">å¤–éƒ¨æ’åº</th>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>æ—¶é—´å¤æ‚åº¦</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">O(N log N) æ¯”è¾ƒ</td>
                                    <td style="border:1px solid #ddd; padding:8px;">O(N log N) æ¯”è¾ƒ + I/Oå¼€é”€</td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>ç©ºé—´å¤æ‚åº¦</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">O(N) æˆ– O(log N)</td>
                                    <td style="border:1px solid #ddd; padding:8px;">O(M + k*B)</td>
                                </tr>
                                <tr>
                                    <td style="border:1px solid #ddd; padding:8px;"><strong>ç“¶é¢ˆ</strong></td>
                                    <td style="border:1px solid #ddd; padding:8px;">CPUè®¡ç®—</td>
                                    <td style="border:1px solid #ddd; padding:8px;">ç£ç›˜I/O</td>
                                </tr>
                            </table>
                            <strong>3. å®é™…æ€§èƒ½åˆ†æï¼š</strong><br>
                            å‡è®¾å‚æ•°ï¼šN=1äº¿ï¼ŒM=100ä¸‡ï¼ŒB=1000ï¼Œk=10<br>
                            <div style="background:#fef2f2; padding:15px; border-radius:8px; margin:10px 0;">
                                â€¢ æ’åºå—æ•°é‡: âŒˆ10^8/10^6âŒ‰ = 100ä¸ª<br>
                                â€¢ å½’å¹¶å±‚æ•°: âŒˆlog_{10}(100)âŒ‰ = 2å±‚<br>
                                â€¢ I/Oæ“ä½œæ¬¡æ•°: (10^8/1000) * (1 + 2) = 30ä¸‡æ¬¡<br>
                                â€¢ å¦‚æœç£ç›˜å»¶è¿Ÿ10msï¼Œæ€»I/Oæ—¶é—´: 3000ç§’ â‰ˆ 50åˆ†é’Ÿ
                            </div>
                            <strong>4. ä¼˜åŒ–ç­–ç•¥å¯¹å¤æ‚åº¦çš„å½±å“ï¼š</strong><br>
                            â€¢ <strong>å¢å¤§å†…å­˜Mï¼š</strong>å‡å°‘å—æ•°é‡ï¼Œé™ä½å½’å¹¶å±‚æ•°<br>
                            â€¢ <strong>å¢å¤§å—å¤§å°Bï¼š</strong>å‡å°‘I/Oæ“ä½œæ¬¡æ•°<br>
                            â€¢ <strong>å¢å¤§å½’å¹¶è·¯æ•°kï¼š</strong>å‡å°‘å½’å¹¶å±‚æ•°ï¼Œä½†å¢åŠ å†…å­˜éœ€æ±‚<br>
                            â€¢ <strong>ä½¿ç”¨SSDï¼š</strong>é™ä½æ¯æ¬¡I/Oçš„æ—¶é—´æˆæœ¬<br><br>
                            <strong>5. ç†è®ºæœ€ä¼˜é…ç½®ï¼š</strong><br>
                            â€¢ <strong>æœ€ä¼˜å½’å¹¶è·¯æ•°ï¼š</strong>k* = âŒˆ(M-1)/2âŒ‰ + 1<br>
                            â€¢ <strong>æœ€å°I/Oæ¬¡æ•°ï¼š</strong>å½“ k = N/M æ—¶è¾¾åˆ°ç†è®ºä¸‹ç•Œ<br>
                            â€¢ <strong>å®é™…çº¦æŸï¼š</strong>å—å†…å­˜é™åˆ¶ï¼Œé€šå¸¸k = 2-16<br><br>
                            <strong>å®é™…ç³»ç»Ÿæ€§èƒ½å¯¹æ¯”ï¼š</strong><br>
                            â€¢ <strong>å¿«é€Ÿæ’åºï¼š</strong>å†…å­˜å†…O(N log N)ï¼Œå‡ ç§’å®Œæˆ<br>
                            â€¢ <strong>å¤–éƒ¨æ’åºï¼š</strong>I/Oå—é™ï¼ŒåŒæ ·æ•°æ®å¯èƒ½éœ€è¦å‡ ååˆ†é’Ÿ<br>
                            â€¢ <strong>æ€§èƒ½å·®è·ï¼š</strong>ä¸»è¦æ¥è‡ªç£ç›˜è®¿é—®å»¶è¿Ÿï¼ˆmsçº§ vs nsçº§ï¼‰
                        </div>
                    </div>
                </div>
            </div>

            <div class="learning-path">
                <h3>ğŸ›¤ï¸ æ¸è¿›å¼å­¦ä¹ å»ºè®®</h3>
                <div class="unified-grid unified-grid-2">
                    <div class="path-card">
                        <h4>ğŸ¯ åŸºç¡€æŒæ¡</h4>
                        <ul>
                            <li>ç†è§£å¤–éƒ¨æ’åºçš„å¿…è¦æ€§å’ŒåŸºæœ¬åŸç†</li>
                            <li>æŒæ¡ä¸¤é˜¶æ®µæ’åºçš„æ‰§è¡Œæµç¨‹</li>
                            <li>å®ç°ç®€å•çš„äºŒè·¯å½’å¹¶å¤–éƒ¨æ’åº</li>
                            <li>åˆ†æI/Oå¤æ‚åº¦å’Œæ€§èƒ½ç“¶é¢ˆ</li>
                        </ul>
                    </div>
                    <div class="path-card">
                        <h4>ğŸ“ˆ è¿›é˜¶åº”ç”¨</h4>
                        <ul>
                            <li>å­¦ä¹ å¤šè·¯å½’å¹¶å’Œå‚æ•°ä¼˜åŒ–</li>
                            <li>å¤„ç†ç‰¹æ®Šæ•°æ®åˆ†å¸ƒæƒ…å†µ</li>
                            <li>å®ç°åˆ†å¸ƒå¼å¤–éƒ¨æ’åºç®—æ³•</li>
                            <li>ç ”ç©¶ç°ä»£å­˜å‚¨è®¾å¤‡çš„ä¼˜åŒ–ç­–ç•¥</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="resources">
                <h3>ğŸ“š æ¨èå­¦ä¹ èµ„æº</h3>
                <div class="unified-grid unified-grid-3">
                    <div class="resource-card">
                        <span class="card-icon">ğŸ› ï¸</span>
                        <h4>å®è·µå·¥å…·</h4>
                        <p>GNU Sort, Hadoop TeraSort, Apache Spark, è‡ªå®ç°å¤–éƒ¨æ’åºå™¨</p>
                    </div>
                    <div class="resource-card">
                        <span class="card-icon">ğŸ“–</span>
                        <h4>ç›¸å…³ä¸»é¢˜</h4>
                        <p>åˆ†æ²»ç®—æ³•ã€å †æ’åºã€B+æ ‘ç´¢å¼•ã€MapReduceæ¨¡å‹</p>
                    </div>
                    <div class="resource-card">
                        <span class="card-icon">ğŸ“</span>
                        <h4>åç»­å­¦ä¹ </h4>
                        <p>åˆ†å¸ƒå¼ç³»ç»Ÿã€æ•°æ®åº“å†…æ ¸ã€å¤§æ•°æ®å¤„ç†æ¡†æ¶</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary">
            <span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a>
        <a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary">
            <span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a>
    </div>
</div>

<style>
/* åŸºç¡€æ ·å¼ */
.concept-overview {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 15px;
    padding: 25px;
    color: #1f2937 !important;
    margin-bottom: 20px;
    border: 2px solid #e5e7eb;
}

.concept-overview * {
    color: #1f2937 !important;
}

.core-concept {
    text-align: center;
    margin-bottom: 20px;
}

.core-concept h3 {
    margin-bottom: 10px;
    font-size: 1.3em;
    color: #1f2937 !important;
}

.core-concept p {
    color: #374151 !important;
    line-height: 1.6;
}

.core-concept strong {
    color: #111827 !important;
}

.concept-breakdown .concept-item {
    background: #f8f9ff;
    border-left: 4px solid #4f46e5;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 0 10px 10px 0;
}

.common-mistakes {
    background: #fef2f2;
    border: 2px solid #fecaca;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
}

.common-mistakes h4 {
    color: #dc2626;
    margin-bottom: 15px;
}

/* å¯è§†åŒ–å®¹å™¨æ ·å¼ */
.visualization-container {
    text-align: center;
    margin-bottom: 30px;
}

.static-diagram {
    display: flex;
    justify-content: center;
    margin: 20px 0;
    position: relative;
}

#sortingCanvas {
    border: 2px solid #e5e7eb;
    border-radius: 15px;
    background: linear-gradient(135deg, #f8fafc, #f1f5f9);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

#sortingCanvas:hover {
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    transform: translateY(-2px);
}

/* æ•°æ®è¾“å…¥æ§åˆ¶ */
.data-input-section {
    background: #f8f9ff;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    border: 2px solid #e2e8f0;
}

.input-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    align-items: center;
    justify-content: center;
}

.input-controls label {
    display: flex;
    flex-direction: column;
    gap: 8px;
    font-weight: 600;
    color: #374151;
}

.input-controls select {
    padding: 8px 12px;
    border: 2px solid #d1d5db;
    border-radius: 8px;
    background: white;
    min-width: 150px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.input-controls select:focus {
    outline: none;
    border-color: #4f46e5;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

/* æ§åˆ¶é¢æ¿å¢å¼º */
.demo-controls {
    background: linear-gradient(135deg, #f0f4f8, #e2e8f0);
    border-radius: 20px;
    padding: 30px;
    margin: 20px 0;
    text-align: center;
    border: 2px solid #cbd5e0;
}

.control-panel {
    margin-bottom: 25px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
}

.control-panel button {
    margin: 5px;
    padding: 12px 24px;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    min-width: 140px;
}

.control-panel button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.control-panel button:active {
    transform: translateY(0);
}

/* çŠ¶æ€æ˜¾ç¤ºé¢æ¿ */
.status-display {
    background: #f9fafb;
    border-radius: 15px;
    padding: 25px;
    margin: 20px 0;
    border: 2px solid #e5e7eb;
}

.status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.status-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    border: 2px solid #e5e7eb;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
}

.status-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.1);
}

.status-card h4 {
    color: #1f2937;
    margin-bottom: 15px;
    font-size: 1.1em;
    display: flex;
    align-items: center;
    gap: 8px;
}

.status-content {
    color: #6b7280;
    font-family: 'Monaco', 'Menlo', monospace;
    font-size: 0.9em;
    line-height: 1.5;
    min-height: 80px;
    background: #f3f4f6;
    padding: 15px;
    border-radius: 8px;
    overflow-y: auto;
    max-height: 200px;
}

/* è®¡ç®—è¿‡ç¨‹å±•ç¤ºå¢å¼º */
.calculation-display {
    background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
    color: white;
    border-radius: 15px;
    padding: 25px;
    margin-top: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.calculation-steps {
    font-family: 'Monaco', 'Menlo', monospace;
    line-height: 1.8;
}

/* æ­¥éª¤ä¿¡æ¯å¢å¼º */
.step-info {
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    border: 2px solid #0ea5e9;
    border-radius: 12px;
    padding: 20px;
    margin-top: 15px;
    min-height: 60px;
    position: relative;
    overflow: hidden;
}

.step-info.calculating::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(16, 185, 129, 0.3), transparent);
    animation: shimmer 2s infinite;
}

.step-message {
    font-size: 1.1em;
    font-weight: 600;
    color: #1e40af;
    position: relative;
    z-index: 1;
}

/* åº”ç”¨ç¤ºä¾‹æ ·å¼ */
.applications {
    display: grid;
    gap: 20px;
    margin-bottom: 30px;
}

.app-example {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
}

.app-example h3 {
    margin-bottom: 15px;
    font-size: 1.2em;
    color: white;
}

.app-example p {
    color: white;
    line-height: 1.6;
}

/* ä»£ç ç¤ºä¾‹æ ·å¼ */
.code-examples {
    margin-top: 30px;
}

.language-selector {
    display: flex;
    background: #f3f4f6;
    border-radius: 10px;
    padding: 5px;
    margin-bottom: 15px;
    justify-content: center;
}

.lang-btn {
    flex: 1;
    max-width: 150px;
    padding: 10px 20px;
    border: none;
    background: transparent;
    cursor: pointer;
    border-radius: 6px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.lang-btn.active {
    background: white;
    color: #4f46e5;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.code-container {
    display: none;
    background: #1e1e1e;
    border-radius: 15px;
    overflow: hidden;
    margin-bottom: 20px;
}

.code-container.active {
    display: block;
}

.code-header {
    background: #2d2d2d;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
}

.copy-btn {
    background: #4f46e5;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    transition: background 0.3s ease;
}

.copy-btn:hover {
    background: #4338ca;
}

pre {
    margin: 0;
    padding: 20px;
    background: #1e1e1e;
    color: #d4d4d4;
    overflow-x: auto;
    line-height: 1.5;
    font-family: 'Monaco', 'Menlo', monospace;
}

/* å­¦ä¹ æ£€éªŒæ ·å¼å¢å¼º */
.quiz-section {
    margin-bottom: 40px;
}

.quiz-item {
    background: linear-gradient(135deg, #f8f9ff, #f0f4f8);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 25px;
    border: 2px solid #e2e8f0;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.quiz-item::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 5px;
    height: 100%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    transition: width 0.3s ease;
}

.quiz-item:hover::before {
    width: 8px;
}

.quiz-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.question h4 {
    color: #1f2937;
    margin-bottom: 20px;
    font-size: 1.2em;
    line-height: 1.4;
}

.show-answer-btn {
    background: linear-gradient(135deg, #4f46e5, #7c3aed);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    position: relative;
    overflow: hidden;
}

.show-answer-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
}

.answer-content {
    margin-top: 20px;
    padding: 25px;
    background: linear-gradient(135deg, #ecfdf5, #d1fae5);
    border-left: 5px solid #10b981;
    border-radius: 0 15px 15px 0;
    animation: slideInUp 0.5s ease-out;
}

.answer-content table {
    background: white;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border-radius: 8px;
    margin: 15px 0;
}

.answer-content th {
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    font-weight: bold;
    color: #374151;
}

.answer-content strong {
    color: #059669;
}

/* å­¦ä¹ è·¯å¾„æ ·å¼ */
.learning-path {
    margin: 30px 0;
}

.path-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
}

.path-card h4 {
    margin-bottom: 15px;
    color: white;
}

.path-card ul {
    list-style: none;
    padding: 0;
}

.path-card li {
    padding: 5px 0;
    position: relative;
    padding-left: 20px;
    color: white;
}

.path-card li:before {
    content: "âœ…";
    position: absolute;
    left: 0;
}

/* èµ„æºå¡ç‰‡æ ·å¼ */
.resources {
    margin-top: 30px;
}

.resource-card {
    text-align: center;
    padding: 25px;
    background: #f8f9ff;
    border-radius: 15px;
    border: 2px solid #e5e7eb;
    transition: transform 0.3s ease;
}

.resource-card:hover {
    transform: translateY(-5px);
}

/* åŠ¨ç”»å®šä¹‰ */
@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeInLeft {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .unified-grid {
        grid-template-columns: 1fr !important;
    }

    .language-selector {
        flex-direction: column;
    }

    .lang-btn {
        max-width: none;
        margin: 2px 0;
    }

    .control-panel {
        flex-direction: column;
        align-items: center;
    }

    .control-panel button {
        width: 100%;
        max-width: 280px;
        margin: 5px 0;
    }

    .input-controls {
        flex-direction: column;
        gap: 15px;
    }

    #sortingCanvas {
        width: 100%;
        height: 350px;
    }

    .quiz-item {
        padding: 20px;
    }

    .answer-content {
        padding: 20px;
    }

    .status-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// Canvasç»˜å›¾ç›¸å…³å˜é‡
let canvas, ctx;
let animationFrame;
let currentStep = 0;
let isAnimating = false;

// å¤–éƒ¨æ’åºç›¸å…³å˜é‡
let originalData = [];
let currentData = [];
let sortedBlocks = [];
let memorySize = 10;
let mergeWays = 2;
let ioOperations = 0;
let currentPhase = 'idle';

// å¯è§†åŒ–å…ƒç´ 
let dataElements = [];
let mergeTree = [];

// åŠ¨ç”»é…ç½®
const COLORS = {
    unsorted: '#94a3b8',
    sorting: '#f59e0b',
    sorted: '#10b981',
    memory: '#3b82f6',
    disk: '#6b7280',
    merging: '#ef4444',
    background: '#f8fafc'
};

// æ•°æ®å…ƒç´ ç±»
class DataElement {
    constructor(value, x, y, type = 'unsorted') {
        this.value = value;
        this.x = x;
        this.y = y;
        this.targetX = x;
        this.targetY = y;
        this.type = type;
        this.size = 20;
        this.alpha = 1;
        this.scale = 1;
    }

    update() {
        // ç®€å•çš„å¹³æ»‘ç§»åŠ¨
        if (Math.abs(this.x - this.targetX) > 0.5) {
            this.x += (this.targetX - this.x) * 0.1;
        }
        if (Math.abs(this.y - this.targetY) > 0.5) {
            this.y += (this.targetY - this.y) * 0.1;
        }
    }

    draw(ctx) {
        if (!ctx) return;

        ctx.save();

        // é€‰æ‹©é¢œè‰²
        let color = COLORS.unsorted;
        switch (this.type) {
            case 'sorting':
                color = COLORS.sorting;
                break;
            case 'sorted':
                color = COLORS.sorted;
                break;
            case 'merging':
                color = COLORS.merging;
                break;
        }

        // ç»˜åˆ¶åœ†å½¢
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();

        // ç»˜åˆ¶è¾¹æ¡†
        ctx.strokeStyle = '#1f2937';
        ctx.lineWidth = 2;
        ctx.stroke();

        // ç»˜åˆ¶æ•°å€¼
        ctx.fillStyle = 'white';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(this.value.toString(), this.x, this.y);

        ctx.restore();
    }

    moveTo(x, y) {
        this.targetX = x;
        this.targetY = y;
    }

    setType(type) {
        this.type = type;
    }
}

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');

    canvas = document.getElementById('sortingCanvas');
    if (!canvas) {
        console.error('Canvaså…ƒç´ æœªæ‰¾åˆ°ï¼');
        return;
    }

    ctx = canvas.getContext('2d');
    if (!ctx) {
        console.error('æ— æ³•è·å–Canvasä¸Šä¸‹æ–‡ï¼');
        return;
    }

    console.log('Canvasåˆå§‹åŒ–æˆåŠŸ');

    // è®¾ç½®Canvaså°ºå¯¸
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;

    console.log('Canvaså°ºå¯¸:', canvas.width, 'x', canvas.height);

    // åˆå§‹åŒ–æ•°æ®
    generateRandomData();

    // å¯åŠ¨åŠ¨ç”»å¾ªç¯
    animate();

    // ç»‘å®šäº‹ä»¶
    bindEvents();

    // åˆå§‹åŒ–ç•Œé¢
    updateInterface();

    console.log('åˆå§‹åŒ–å®Œæˆ');
});

// äº‹ä»¶ç»‘å®š
function bindEvents() {
    console.log('ç»‘å®šäº‹ä»¶...');

    const generateBtn = document.getElementById('generateData');
    const startBtn = document.getElementById('startDemo');
    const phase1Btn = document.getElementById('stepPhase1');
    const phase2Btn = document.getElementById('stepPhase2');
    const complexityBtn = document.getElementById('showComplexity');
    const resetBtn = document.getElementById('resetDemo');

    if (generateBtn) generateBtn.addEventListener('click', generateRandomData);
    if (startBtn) startBtn.addEventListener('click', startDemo);
    if (phase1Btn) phase1Btn.addEventListener('click', executePhase1);
    if (phase2Btn) phase2Btn.addEventListener('click', executePhase2);
    if (complexityBtn) complexityBtn.addEventListener('click', showComplexityAnalysis);
    if (resetBtn) resetBtn.addEventListener('click', resetDemo);

    // å‚æ•°å˜åŒ–ç›‘å¬
    const dataSizeSelect = document.getElementById('dataSize');
    const memorySizeSelect = document.getElementById('memorySize');
    const mergeWaysSelect = document.getElementById('mergeWays');

    if (dataSizeSelect) dataSizeSelect.addEventListener('change', generateRandomData);
    if (memorySizeSelect) memorySizeSelect.addEventListener('change', updateParameters);
    if (mergeWaysSelect) mergeWaysSelect.addEventListener('change', updateParameters);

    // ä»£ç åˆ‡æ¢
    setupCodeTabs();
    setupCopyButtons();

    console.log('äº‹ä»¶ç»‘å®šå®Œæˆ');
}

// ç”Ÿæˆéšæœºæ•°æ®
function generateRandomData() {
    const dataSize = parseInt(document.getElementById('dataSize').value);
    const memSize = parseInt(document.getElementById('memorySize').value);
    const mergeWs = parseInt(document.getElementById('mergeWays').value);

    // æ›´æ–°å‚æ•°
    memorySize = memSize;
    mergeWays = mergeWs;

    // ç”Ÿæˆéšæœºæ•°æ®
    originalData = [];
    for (let i = 0; i < dataSize; i++) {
        originalData.push(Math.floor(Math.random() * 99) + 1);
    }

    currentData = [...originalData];

    // é‡ç½®çŠ¶æ€
    resetState();

    // åˆ›å»ºå¯è§†åŒ–å…ƒç´ 
    createDataElements();

    updateInterface();
    updateStepInfo(`ç”Ÿæˆäº† ${dataSize} ä¸ªéšæœºæ•°æ®ï¼Œå†…å­˜å¤§å°é™åˆ¶ä¸º ${memorySize} ä¸ªå…ƒç´ `);
}

// æ›´æ–°å‚æ•°
function updateParameters() {
    memorySize = parseInt(document.getElementById('memorySize').value);
    mergeWays = parseInt(document.getElementById('mergeWays').value);
    updateInterface();
}

// åˆ›å»ºæ•°æ®å…ƒç´ 
function createDataElements() {
    dataElements = [];
    const startX = 100;
    const startY = 80;
    const spacing = 35;
    const maxPerRow = Math.floor((canvas.width - 200) / spacing);

    for (let i = 0; i < currentData.length; i++) {
        const row = Math.floor(i / maxPerRow);
        const col = i % maxPerRow;
        const x = startX + col * spacing;
        const y = startY + row * 40;

        dataElements.push(new DataElement(currentData[i], x, y));
    }
}

// é‡ç½®çŠ¶æ€
function resetState() {
    currentStep = 0;
    currentPhase = 'idle';
    sortedBlocks = [];
    ioOperations = 0;
    isAnimating = false;

    // æ¸…é™¤å®šæ—¶å™¨
    if (animationFrame) {
        cancelAnimationFrame(animationFrame);
    }
}

// ä¸»åŠ¨ç”»å¾ªç¯
function animate() {
    if (!canvas || !ctx) {
        console.error('Canvasæˆ–ä¸Šä¸‹æ–‡ä¸¢å¤±');
        return;
    }

    // æ¸…é™¤ç”»å¸ƒ
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // ç»˜åˆ¶èƒŒæ™¯
    drawBackground();

    // ç»˜åˆ¶æ•°æ®å…ƒç´ 
    if (dataElements && dataElements.length > 0) {
        dataElements.forEach(element => {
            element.update();
            element.draw(ctx);
        });
    }

    // ç»˜åˆ¶åŒºåŸŸæ ‡è¯†
    drawMemoryArea();
    drawDiskArea();

    // ç»˜åˆ¶çŠ¶æ€æŒ‡ç¤ºå™¨
    drawPhaseIndicator();

    animationFrame = requestAnimationFrame(animate);
}

// ç»˜åˆ¶èƒŒæ™¯
function drawBackground() {
    ctx.save();

    // å¡«å……èƒŒæ™¯è‰²
    ctx.fillStyle = '#f8fafc';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ç»˜åˆ¶ç½‘æ ¼
    ctx.globalAlpha = 0.1;
    ctx.strokeStyle = '#6b7280';
    ctx.lineWidth = 1;

    for (let x = 0; x < canvas.width; x += 40) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
    }

    for (let y = 0; y < canvas.height; y += 40) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }

    ctx.restore();
}

// ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼
function drawGrid() {
    ctx.save();
    ctx.globalAlpha = 0.1;
    ctx.strokeStyle = '#6b7280';
    ctx.lineWidth = 1;

    for (let x = 0; x < canvas.width; x += 40) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
    }

    for (let y = 0; y < canvas.height; y += 40) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }

    ctx.restore();
}

// ç»˜åˆ¶å†…å­˜åŒºåŸŸ
function drawMemoryArea() {
    const memoryY = canvas.height - 120;
    const memoryWidth = Math.min(600, canvas.width - 100);

    ctx.save();
    ctx.fillStyle = 'rgba(59, 130, 246, 0.1)';
    ctx.strokeStyle = '#3b82f6';
    ctx.lineWidth = 2;
    ctx.setLineDash([5, 5]);

    ctx.fillRect(50, memoryY, memoryWidth, 60);
    ctx.strokeRect(50, memoryY, memoryWidth, 60);

    // æ ‡ç­¾
    ctx.setLineDash([]);
    ctx.fillStyle = '#3b82f6';
    ctx.font = 'bold 14px Arial';
    ctx.fillText('å†…å­˜åŒºåŸŸ (Memory)', 60, memoryY - 10);

    ctx.restore();
}

// ç»˜åˆ¶ç£ç›˜åŒºåŸŸ
function drawDiskArea() {
    const diskY = canvas.height - 200;
    const diskWidth = Math.min(600, canvas.width - 100);

    ctx.save();
    ctx.fillStyle = 'rgba(107, 114, 128, 0.1)';
    ctx.strokeStyle = '#6b7280';
    ctx.lineWidth = 2;
    ctx.setLineDash([5, 5]);

    ctx.fillRect(50, diskY, diskWidth, 60);
    ctx.strokeRect(50, diskY, diskWidth, 60);

    // æ ‡ç­¾
    ctx.setLineDash([]);
    ctx.fillStyle = '#6b7280';
    ctx.font = 'bold 14px Arial';
    ctx.fillText('ç£ç›˜å­˜å‚¨ (Disk)', 60, diskY - 10);

    ctx.restore();
}

// ç»˜åˆ¶å½’å¹¶æ ‘
function drawMergeTree() {
    if (mergeTree.length === 0) return;

    ctx.save();
    ctx.strokeStyle = '#ef4444';
    ctx.lineWidth = 2;
    ctx.fillStyle = '#ef4444';
    ctx.font = '12px Arial';
    ctx.textAlign = 'center';

    const treeY = 250;
    const treeWidth = canvas.width - 200;

    // ç»˜åˆ¶æ ‘ç»“æ„
    mergeTree.forEach((level, levelIndex) => {
        const y = treeY + levelIndex * 50;
        const nodeWidth = treeWidth / level.length;

        level.forEach((node, nodeIndex) => {
            const x = 100 + (nodeIndex + 0.5) * nodeWidth;

            // ç»˜åˆ¶èŠ‚ç‚¹
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI * 2);
            ctx.stroke();

            // ç»˜åˆ¶æ–‡æœ¬
            ctx.fillText(node.toString(), x, y + 4);

            // ç»˜åˆ¶è¿çº¿åˆ°ä¸‹ä¸€å±‚
            if (levelIndex < mergeTree.length - 1) {
                const nextLevel = mergeTree[levelIndex + 1];
                const nextNodeIndex = Math.floor(nodeIndex / mergeWays);
                if (nextNodeIndex < nextLevel.length) {
                    const nextX = 100 + (nextNodeIndex + 0.5) * (treeWidth / nextLevel.length);
                    const nextY = treeY + (levelIndex + 1) * 50;

                    ctx.beginPath();
                    ctx.moveTo(x, y + 20);
                    ctx.lineTo(nextX, nextY - 20);
                    ctx.stroke();
                }
            }
        });
    });

    ctx.restore();
}

// ç»˜åˆ¶é˜¶æ®µæŒ‡ç¤ºå™¨
function drawPhaseIndicator() {
    ctx.save();
    ctx.fillStyle = '#1f2937';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'left';

    let phaseText = '';
    switch (currentPhase) {
        case 'idle':
            phaseText = 'ç­‰å¾…å¼€å§‹';
            break;
        case 'phase1':
            phaseText = 'é˜¶æ®µ1ï¼šåˆ†å—æ’åº';
            break;
        case 'phase2':
            phaseText = 'é˜¶æ®µ2ï¼šå¤šè·¯å½’å¹¶';
            break;
        case 'completed':
            phaseText = 'æ’åºå®Œæˆ';
            break;
    }

    ctx.fillText(`å½“å‰é˜¶æ®µ: ${phaseText}`, 20, 30);
    ctx.restore();
}

// å¼€å§‹æ¼”ç¤º
async function startDemo() {
    console.log('å¼€å§‹æ¼”ç¤º');
    if (isAnimating) return;

    isAnimating = true;
    currentStep = 0;
    currentPhase = 'idle';

    updateStepInfo('å¼€å§‹å¤–éƒ¨æ’åºæ¼”ç¤ºï¼Œæ•°æ®è§„æ¨¡: ' + currentData.length + ' ä¸ªå…ƒç´ ');

    // é‡ç½®æ‰€æœ‰å…ƒç´ çŠ¶æ€
    if (dataElements) {
        dataElements.forEach(element => {
            element.setType('unsorted');
        });
    }

    await delay(1000);
    isAnimating = false;
    console.log('æ¼”ç¤ºå¯åŠ¨å®Œæˆ');
}

// æ‰§è¡Œç¬¬ä¸€é˜¶æ®µï¼šåˆ†å—æ’åº
async function executePhase1() {
    console.log('æ‰§è¡Œé˜¶æ®µ1');
    if (isAnimating) return;

    isAnimating = true;
    currentPhase = 'phase1';
    sortedBlocks = [];

    updateStepInfo('å¼€å§‹é˜¶æ®µ1ï¼šå°†æ•°æ®åˆ†æˆå°å—å¹¶åˆ†åˆ«æ’åº');
    updateCalculationSteps('åˆ†å—æ’åºå¼€å§‹...\næ­£åœ¨å°†æ•°æ®åˆ†æˆ' + memorySize + 'ä¸ªå…ƒç´ çš„å°å—');

    const blockCount = Math.ceil(currentData.length / memorySize);
    console.log('éœ€è¦åˆ›å»º', blockCount, 'ä¸ªå—');

    for (let i = 0; i < blockCount; i++) {
        const blockStart = i * memorySize;
        const blockEnd = Math.min(blockStart + memorySize, currentData.length);
        const blockData = currentData.slice(blockStart, blockEnd);

        updateStepInfo(`æ­£åœ¨å¤„ç†ç¬¬ ${i + 1} å—ï¼ŒåŒ…å« ${blockData.length} ä¸ªå…ƒç´ `);

        // é«˜äº®å½“å‰å—
        for (let j = blockStart; j < blockEnd; j++) {
            if (dataElements && dataElements[j]) {
                dataElements[j].setType('sorting');
            }
        }

        await delay(800);

        // æ’åº
        const sortedBlock = [...blockData].sort((a, b) => a - b);
        sortedBlocks.push(sortedBlock);

        // æ›´æ–°ä¸ºå·²æ’åºçŠ¶æ€
        for (let j = blockStart; j < blockEnd; j++) {
            if (dataElements && dataElements[j]) {
                dataElements[j].value = sortedBlock[j - blockStart];
                dataElements[j].setType('sorted');
            }
        }

        ioOperations += blockData.length * 2; // è¯»å–+å†™å…¥
        updateIOStats();

        await delay(600);
    }

    updateStepInfo(`é˜¶æ®µ1å®Œæˆï¼šåˆ›å»ºäº† ${blockCount} ä¸ªæ’åºå—`);
    updateCalculationSteps(`åˆ†å—æ’åºå®Œæˆï¼š
â€¢ æ€»å—æ•°: ${blockCount}
â€¢ æ¯å—å¤§å°: ${memorySize} ä¸ªå…ƒç´ 
â€¢ I/Oæ“ä½œæ¬¡æ•°: ${ioOperations}
â€¢ ä¸‹ä¸€æ­¥ï¼šå¤šè·¯å½’å¹¶`);

    isAnimating = false;
    console.log('é˜¶æ®µ1å®Œæˆ');
}

// æ‰§è¡Œç¬¬äºŒé˜¶æ®µï¼šå¤šè·¯å½’å¹¶
async function executePhase2() {
    console.log('æ‰§è¡Œé˜¶æ®µ2');
    if (isAnimating || sortedBlocks.length === 0) {
        updateStepInfo('è¯·å…ˆæ‰§è¡Œé˜¶æ®µ1ï¼šåˆ†å—æ’åº');
        return;
    }

    isAnimating = true;
    currentPhase = 'phase2';

    updateStepInfo(`å¼€å§‹é˜¶æ®µ2ï¼š${mergeWays}è·¯å½’å¹¶`);

    // ç®€åŒ–çš„å½’å¹¶è¿‡ç¨‹
    await performSimpleMerge();

    currentPhase = 'completed';
    updateStepInfo('å¤–éƒ¨æ’åºå®Œæˆï¼æ•°æ®å·²æŒ‰å‡åºæ’åˆ—');

    isAnimating = false;
    console.log('é˜¶æ®µ2å®Œæˆ');
}

// ç®€åŒ–çš„å½’å¹¶è¿‡ç¨‹
async function performSimpleMerge() {
    updateCalculationSteps('å¼€å§‹å¤šè·¯å½’å¹¶è¿‡ç¨‹...\næ­£åœ¨åˆå¹¶' + sortedBlocks.length + 'ä¸ªæ’åºå—');

    // åˆ›å»ºæœ€ç»ˆç»“æœ
    const result = [];
    const blockPointers = new Array(sortedBlocks.length).fill(0);

    // é€ä¸ªé€‰æ‹©æœ€å°å…ƒç´ 
    while (result.length < currentData.length) {
        let minVal = Infinity;
        let minBlockIndex = -1;

        // æ‰¾åˆ°æ‰€æœ‰å—ä¸­çš„æœ€å°å€¼
        for (let i = 0; i < sortedBlocks.length; i++) {
            if (blockPointers[i] < sortedBlocks[i].length) {
                const val = sortedBlocks[i][blockPointers[i]];
                if (val < minVal) {
                    minVal = val;
                    minBlockIndex = i;
                }
            }
        }

        if (minBlockIndex !== -1) {
            result.push(minVal);
            blockPointers[minBlockIndex]++;

            // æ›´æ–°å¯è§†åŒ–
            const resultIndex = result.length - 1;
            if (dataElements && dataElements[resultIndex]) {
                dataElements[resultIndex].value = minVal;
                dataElements[resultIndex].setType('sorted');
            }

            ioOperations++;

            // æ¯å¤„ç†10ä¸ªå…ƒç´ æ›´æ–°ä¸€æ¬¡ç•Œé¢
            if (result.length % 10 === 0) {
                updateIOStats();
                updateStepInfo(`å½’å¹¶è¿›åº¦: ${result.length}/${currentData.length}`);
                await delay(200);
            }
        }
    }

    updateCalculationSteps(`å¤šè·¯å½’å¹¶å®Œæˆï¼š
â€¢ æœ€ç»ˆç»“æœ: ${result.length} ä¸ªå…ƒç´ 
â€¢ æ€»I/Oæ“ä½œæ¬¡æ•°: ${ioOperations}
â€¢ æ’åºå®Œæˆï¼`);
}

// æ˜¾ç¤ºå¤æ‚åº¦åˆ†æ
function showComplexityAnalysis() {
    const n = currentData.length;
    const m = memorySize;
    const k = mergeWays;
    const blocks = Math.ceil(n / m);
    const passes = Math.ceil(Math.log(blocks) / Math.log(k));

    updateCalculationSteps(`å¤–éƒ¨æ’åºå¤æ‚åº¦åˆ†æï¼š

    ğŸ“Š å½“å‰å‚æ•°ï¼š
    â€¢ æ•°æ®é‡ (N): ${n}
    â€¢ å†…å­˜å¤§å° (M): ${m}
    â€¢ å½’å¹¶è·¯æ•° (K): ${k}
    â€¢ å—æ•°é‡: ${blocks}

    ğŸ§® ç†è®ºåˆ†æï¼š
    â€¢ I/Oå¤æ‚åº¦: O(N/B Ã— log_k(N/M))
    â€¢ å½’å¹¶å±‚æ•°: ${passes} å±‚
    â€¢ é¢„è®¡I/Oæ¬¡æ•°: ${2 * n * (1 + passes)}
    â€¢ å®é™…I/Oæ¬¡æ•°: ${ioOperations}

    âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼š
    â€¢ å¢å¤§å†…å­˜å¤§å°å¯å‡å°‘å—æ•°é‡
    â€¢ é€‚å½“å¢åŠ å½’å¹¶è·¯æ•°å¯å‡å°‘å±‚æ•°
    â€¢ ä½¿ç”¨SSDå¯é™ä½I/Oå»¶è¿Ÿ
    â€¢ åˆç†çš„ç¼“å†²åŒºç®¡ç†å¾ˆå…³é”®`);
}

// é‡ç½®æ¼”ç¤º
function resetDemo() {
    if (isAnimating) return;

    resetState();
    createDataElements();
    mergeTree = [];

    updateStepInfo('æ¼”ç¤ºå·²é‡ç½®ï¼Œå‡†å¤‡å¼€å§‹æ–°çš„æ’åº');
    updateCalculationSteps('');
    updateInterface();
}

// æ›´æ–°ç•Œé¢
function updateInterface() {
    // æ›´æ–°ç£ç›˜çŠ¶æ€
    updateDiskStatus();
    updateMemoryStatus();
    updateIOStats();
}

// æ›´æ–°ç£ç›˜çŠ¶æ€
function updateDiskStatus() {
    const diskStatus = document.getElementById('diskStatus');
    if (sortedBlocks.length === 0) {
        diskStatus.innerHTML = 'æ— æ’åºå—';
    } else {
        let status = `æ’åºå—æ•°é‡: ${sortedBlocks.length}\n`;
        sortedBlocks.forEach((block, i) => {
            status += `å—${i + 1}: [${block.slice(0, 5).join(',')}${block.length > 5 ? '...' : ''}]\n`;
        });
        diskStatus.innerHTML = status;
    }
}

// æ›´æ–°å†…å­˜çŠ¶æ€
function updateMemoryStatus() {
    const memoryStatus = document.getElementById('memoryStatus');
    memoryStatus.innerHTML = `å¯ç”¨å†…å­˜: ${memorySize} ä¸ªå…ƒç´ \nå½“å‰é˜¶æ®µ: ${currentPhase}\nå½’å¹¶è·¯æ•°: ${mergeWays}`;
}

// æ›´æ–°I/Oç»Ÿè®¡
function updateIOStats() {
    const ioStats = document.getElementById('ioStats');
    ioStats.innerHTML = `I/Oæ“ä½œæ¬¡æ•°: ${ioOperations}\nè¯»æ“ä½œ: ${Math.floor(ioOperations * 0.6)}\nå†™æ“ä½œ: ${Math.floor(ioOperations * 0.4)}`;
}

// æ›´æ–°æ­¥éª¤ä¿¡æ¯
function updateStepInfo(message) {
    const stepInfo = document.getElementById('stepInfo');
    stepInfo.innerHTML = `<div class="step-message">${message}</div>`;

    if (message.includes('é˜¶æ®µ') || message.includes('å¤„ç†')) {
        stepInfo.classList.add('calculating');
    } else {
        stepInfo.classList.remove('calculating');
    }
}

// æ›´æ–°è®¡ç®—è¿‡ç¨‹
function updateCalculationSteps(steps) {
    document.getElementById('calculationSteps').innerHTML = steps.replace(/\n/g, '<br>');
}

// ä»£ç åˆ‡æ¢åŠŸèƒ½
function setupCodeTabs() {
    const langBtns = document.querySelectorAll('.lang-btn');
    const codeContainers = document.querySelectorAll('.code-container');

    langBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');

            langBtns.forEach(b => b.classList.remove('active'));
            codeContainers.forEach(c => c.classList.remove('active'));

            btn.classList.add('active');
            document.getElementById(`code-${lang}`).classList.add('active');
        });
    });
}

// å¤åˆ¶ä»£ç åŠŸèƒ½
function setupCopyButtons() {
    const copyBtns = document.querySelectorAll('.copy-btn');

    copyBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-code');
            const codeElement = document.querySelector(`#code-${lang} code`);
            const text = codeElement.textContent;

            navigator.clipboard.writeText(text).then(() => {
                btn.textContent = 'âœ… å·²å¤åˆ¶';
                btn.style.background = '#10b981';

                setTimeout(() => {
                    btn.textContent = 'ğŸ“‹ å¤åˆ¶ä»£ç ';
                    btn.style.background = '#4f46e5';
                }, 2000);
            });
        });
    });
}

// ç­”æ¡ˆæ˜¾ç¤ºåŠŸèƒ½
function showAnswer(questionNum) {
    const answer = document.querySelector(`#answer${questionNum} .answer-content`);
    const btn = document.querySelector(`#answer${questionNum} .show-answer-btn`);

    if (answer.style.display === 'none') {
        answer.style.display = 'block';
        btn.textContent = 'ğŸ”¼ éšè—ç­”æ¡ˆ';
        btn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';

        answer.style.animation = 'slideInUp 0.5s ease-out';

        setTimeout(() => {
            answer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 300);

    } else {
        answer.style.display = 'none';
        btn.textContent = 'ğŸ“– æŸ¥çœ‹ç­”æ¡ˆ';
        btn.style.background = 'linear-gradient(135deg, #4f46e5, #7c3aed)';
    }
}

// è¾…åŠ©å‡½æ•°
function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
</script>
{% endblock %}