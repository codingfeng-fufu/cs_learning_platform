{% extends 'knowledge_app/base.html' %}

{% block title %}Floyd-Warshallå…¨æºæœ€çŸ­è·¯å¾„ç®—æ³• - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<style>
    .visualization-container {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 30px;
        margin: 20px 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .concept-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin: 15px 0;
        border-left: 4px solid #6f42c1;
    }

    .key-term {
        display: inline-block;
        background: #f3e5f5;
        padding: 4px 8px;
        border-radius: 4px;
        margin: 2px;
        font-weight: 600;
    }

    .difficulty-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: bold;
        margin: 10px 0;
    }

    .difficulty-hard {
        background: #f8d7da;
        color: #721c24;
    }

    .code-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
    }

    .code-tab {
        padding: 10px 20px;
        cursor: pointer;
        background: #f5f5f5;
        border: none;
        border-radius: 8px 8px 0 0;
        transition: all 0.3s;
    }

    .code-tab.active {
        background: #6f42c1;
        color: white;
    }

    .code-content {
        display: none;
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 20px;
        border-radius: 0 8px 8px 8px;
        position: relative;
        font-family: 'Courier New', monospace;
        overflow-x: auto;
    }

    .code-content.active {
        display: block;
    }

    .copy-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 6px 12px;
        background: #6f42c1;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }

    .copy-btn:hover {
        background: #5a32a3;
    }

    #floydCanvas {
        border: 2px solid #ddd;
        border-radius: 8px;
        margin: 20px auto;
        display: block;
        background: white;
    }

    .matrix-container {
        display: flex;
        justify-content: space-around;
        margin: 20px 0;
        flex-wrap: wrap;
    }

    .matrix-wrapper {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        margin: 10px;
    }

    .matrix-title {
        font-weight: bold;
        margin-bottom: 10px;
        text-align: center;
        color: #6f42c1;
    }

    .distance-matrix {
        border-collapse: collapse;
        margin: 0 auto;
    }

    .distance-matrix td, .distance-matrix th {
        border: 1px solid #dee2e6;
        padding: 8px 12px;
        text-align: center;
        min-width: 40px;
    }

    .distance-matrix th {
        background: #f0f0f0;
        font-weight: 600;
    }

    .matrix-cell-updating {
        background: #fff3cd !important;
        font-weight: bold;
        animation: pulse 0.5s;
    }

    .matrix-cell-updated {
        background: #d4edda !important;
        font-weight: bold;
    }

    .matrix-cell-current-k {
        background: #cfe2ff !important;
    }

    .matrix-cell-current-i {
        background: #f8d7da !important;
    }

    .matrix-cell-current-j {
        background: #fff3cd !important;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .control-panel {
        text-align: center;
        margin: 20px 0;
    }

    .control-btn {
        padding: 10px 20px;
        margin: 0 5px;
        background: #6f42c1;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
    }

    .control-btn:hover {
        background: #5a32a3;
        transform: translateY(-2px);
    }

    .control-btn.danger {
        background: #dc3545;
    }

    .control-btn.danger:hover {
        background: #c82333;
    }

    .speed-control {
        display: inline-block;
        margin: 0 15px;
    }

    .speed-control label {
        margin-right: 10px;
        font-weight: 600;
    }

    .quiz-item {
        background: #f8f9fa;
        padding: 20px;
        margin: 15px 0;
        border-radius: 8px;
        border: 2px solid #e9ecef;
    }

    .quiz-question {
        font-weight: 600;
        margin-bottom: 10px;
        color: #333;
    }

    .show-answer-btn {
        padding: 8px 16px;
        background: #17a2b8;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
    }

    .quiz-answer {
        display: none;
        background: #d4edda;
        padding: 15px;
        border-radius: 6px;
        margin-top: 10px;
        border-left: 4px solid #28a745;
    }

    .analogy-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        margin: 20px 0;
    }

    .application-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .app-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: transform 0.3s;
    }

    .app-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .highlight {
        background: #ffeb3b;
        padding: 2px 4px;
        border-radius: 3px;
    }

    .algorithm-step {
        background: #f8f9fa;
        padding: 15px;
        margin: 10px 0;
        border-radius: 8px;
        border-left: 4px solid #6f42c1;
    }

    .step-number {
        display: inline-block;
        width: 30px;
        height: 30px;
        background: #6f42c1;
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 30px;
        margin-right: 10px;
        font-weight: bold;
    }

    .formula-box {
        background: #f0f0f0;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        font-family: 'Courier New', monospace;
        font-size: 16px;
        margin: 15px 0;
    }
</style>

<div class="page-container fade-in">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a>
        <span>></span>
        <span>ç®—æ³•</span>
        <span>></span>
        <span>Floyd-Warshallç®—æ³•</span>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header slide-in-left">
        <h1>
            <span class="page-icon">ğŸŒ</span>
            Floyd-Warshallå…¨æºæœ€çŸ­è·¯å¾„ç®—æ³•
        </h1>
        <p>ä¸€æ¬¡è®¡ç®—æ‰€æœ‰è·¯å¾„çš„åŠ¨æ€è§„åˆ’ç®—æ³• - è®©æ¯ä¸ªèŠ‚ç‚¹éƒ½æˆä¸ºæ¡¥æ¢</p>
    </div>

    <!-- çŸ¥è¯†ç‚¹æ¦‚è¿° -->
    <div class="content-card slide-in-right">
        <h2 class="section-title">
            <span class="section-icon">ğŸ“‹</span>
            çŸ¥è¯†ç‚¹æ¦‚è¿°
        </h2>

        <div class="concept-card">
            <p style="font-size: 18px; line-height: 1.6;">
                <strong>æ ¸å¿ƒæ¦‚å¿µï¼š</strong>Floydç®—æ³•å°±åƒä¸€ä¸ª<span class="highlight">å…¨èƒ½è·¯çº¿è§„åˆ’å¸ˆ</span>ï¼Œå®ƒé€šè¿‡å°è¯•æ¯ä¸ªèŠ‚ç‚¹ä½œä¸º"ä¸­è½¬ç«™"ï¼Œæ‰¾å‡ºæ‰€æœ‰åœ°ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰è·¯å¾„é—®é¢˜ï¼
            </p>

            <div style="margin: 20px 0;">
                <h4>ğŸ”¤ å…³é”®æœ¯è¯­ï¼š</h4>
                <span class="key-term">å…¨æºæœ€çŸ­è·¯å¾„</span> - æ±‚æ‰€æœ‰èŠ‚ç‚¹å¯¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„<br>
                <span class="key-term">åŠ¨æ€è§„åˆ’</span> - é€šè¿‡å­é—®é¢˜çš„æœ€ä¼˜è§£æ„å»ºæ•´ä½“æœ€ä¼˜è§£<br>
                <span class="key-term">ä¸­é—´èŠ‚ç‚¹</span> - ä½œä¸º"ä¸­è½¬ç«™"çš„èŠ‚ç‚¹<br>
                <span class="key-term">è·ç¦»çŸ©é˜µ</span> - å­˜å‚¨æ‰€æœ‰èŠ‚ç‚¹é—´è·ç¦»çš„äºŒç»´æ•°ç»„<br>
                <span class="key-term">è·¯å¾„çŸ©é˜µ</span> - è®°å½•æœ€çŸ­è·¯å¾„ç»è¿‡çš„ä¸­é—´èŠ‚ç‚¹
            </div>

            <div class="difficulty-badge difficulty-hard">
                ğŸ“Š å­¦ä¹ éš¾åº¦ï¼šé«˜çº§
            </div>

            <div style="margin-top: 15px;">
                <strong>å‰ç½®çŸ¥è¯†ï¼š</strong>å›¾è®ºåŸºç¡€ã€åŠ¨æ€è§„åˆ’ã€çŸ©é˜µè¿ç®—
            </div>
        </div>
    </div>

    <!-- æ¦‚å¿µè¯¦è§£ -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">ğŸ”</span>
            æ¦‚å¿µè¯¦è§£
        </h2>

        <div class="analogy-box">
            <h3>âœˆï¸ ç”Ÿæ´»ç±»æ¯”ï¼šèˆªç©ºä¸­è½¬ç½‘ç»œ</h3>
            <p>æƒ³è±¡ä½ è¦è§„åˆ’å…¨çƒæ‰€æœ‰æœºåœºä¹‹é—´çš„æœ€çŸ­é£è¡Œè·¯çº¿ï¼š</p>
            <ul style="list-style: none; padding-left: 0;">
                <li>ğŸ¢ æ¯ä¸ªæœºåœºæ˜¯ä¸€ä¸ªèŠ‚ç‚¹</li>
                <li>âœˆï¸ ç›´é£èˆªçº¿æ˜¯è¾¹ï¼Œé£è¡Œæ—¶é—´æ˜¯æƒé‡</li>
                <li>ğŸ”„ æœ‰äº›åŸå¸‚ä¹‹é—´æ²¡æœ‰ç›´é£ï¼Œéœ€è¦ä¸­è½¬</li>
                <li>ğŸ“Š ä½ éœ€è¦ä¸€å¼ è¡¨è®°å½•ä»»æ„ä¸¤ä¸ªåŸå¸‚é—´çš„æœ€çŸ­é£è¡Œæ—¶é—´</li>
                <li>ğŸ¯ Floydç®—æ³•ä¼šå°è¯•æ¯ä¸ªåŸå¸‚ä½œä¸ºä¸­è½¬ç«™</li>
                <li>âš¡ å¦‚æœç»è¿‡ä¸­è½¬æ›´å¿«ï¼Œå°±æ›´æ–°è·¯çº¿</li>
            </ul>
        </div>

        <div class="concept-card">
            <h4>1ï¸âƒ£ æ ¸å¿ƒæ€æƒ³ï¼šåŠ¨æ€è§„åˆ’</h4>
            <p><strong>é—®é¢˜å®šä¹‰ï¼š</strong>dist[i][j] = ä»èŠ‚ç‚¹iåˆ°èŠ‚ç‚¹jçš„æœ€çŸ­è·ç¦»</p>
            <p><strong>çŠ¶æ€è½¬ç§»ï¼š</strong>è€ƒè™‘æ˜¯å¦ç»è¿‡èŠ‚ç‚¹kä½œä¸ºä¸­é—´èŠ‚ç‚¹</p>

            <div class="formula-box">
                dist[i][j] = min(dist[i][j], dist[i][k] + dist[k][j])
            </div>

            <p>è¿™ä¸ªå…¬å¼çš„å«ä¹‰ï¼š</p>
            <ul>
                <li>è¦ä¹ˆç›´æ¥ä»iåˆ°jï¼ˆä¸ç»è¿‡kï¼‰</li>
                <li>è¦ä¹ˆä»iå…ˆåˆ°kï¼Œå†ä»kåˆ°j</li>
                <li>é€‰æ‹©ä¸¤è€…ä¸­æ›´çŸ­çš„è·¯å¾„</li>
            </ul>
        </div>

        <div class="concept-card">
            <h4>2ï¸âƒ£ ä¸‰å±‚å¾ªç¯çš„æ„ä¹‰</h4>
            <pre style="background: #f0f0f0; padding: 10px; border-radius: 5px;">
for k in range(n):        # å°è¯•æ¯ä¸ªèŠ‚ç‚¹ä½œä¸ºä¸­é—´èŠ‚ç‚¹
    for i in range(n):    # å¯¹äºæ¯ä¸ªèµ·ç‚¹
        for j in range(n):  # å¯¹äºæ¯ä¸ªç»ˆç‚¹
            # æ£€æŸ¥ç»è¿‡kæ˜¯å¦æ›´çŸ­
            </pre>
            <p><strong>å…³é”®ï¼š</strong>kå¿…é¡»åœ¨æœ€å¤–å±‚ï¼å› ä¸ºæˆ‘ä»¬è¦ç¡®ä¿åœ¨è€ƒè™‘kä½œä¸ºä¸­é—´èŠ‚ç‚¹æ—¶ï¼Œæ‰€æœ‰ç»è¿‡å‰k-1ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„å·²ç»è®¡ç®—å®Œæ¯•ã€‚</p>
        </div>

        <div class="concept-card">
            <h4>3ï¸âƒ£ ç®—æ³•æ‰§è¡Œæ­¥éª¤</h4>
            <div class="algorithm-step">
                <span class="step-number">1</span>
                åˆå§‹åŒ–è·ç¦»çŸ©é˜µï¼šç›´æ¥è¿æ¥çš„ç”¨è¾¹æƒé‡ï¼Œå…¶ä»–è®¾ä¸ºâˆ
            </div>
            <div class="algorithm-step">
                <span class="step-number">2</span>
                k=0ï¼šå°è¯•é€šè¿‡èŠ‚ç‚¹0ä¸­è½¬ï¼Œæ›´æ–°æ‰€æœ‰è·¯å¾„
            </div>
            <div class="algorithm-step">
                <span class="step-number">3</span>
                k=1ï¼šå°è¯•é€šè¿‡èŠ‚ç‚¹1ä¸­è½¬ï¼Œæ›´æ–°æ‰€æœ‰è·¯å¾„
            </div>
            <div class="algorithm-step">
                <span class="step-number">4</span>
                ç»§ç»­å¢åŠ kï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½å°è¯•è¿‡
            </div>
            <div class="algorithm-step">
                <span class="step-number">5</span>
                æœ€ç»ˆçŸ©é˜µåŒ…å«æ‰€æœ‰æœ€çŸ­è·¯å¾„
            </div>
        </div>

        <div class="concept-card" style="background: #fff3cd; border-left-color: #ffc107;">
            <h4>âš ï¸ åˆå­¦è€…æ˜“æ··æ·†ç‚¹</h4>
            <ul>
                <li>Floydå¯ä»¥å¤„ç†<strong>è´Ÿæƒè¾¹</strong>ï¼Œä½†ä¸èƒ½æœ‰è´Ÿæƒç¯</li>
                <li>æ—¶é—´å¤æ‚åº¦O(nÂ³)ï¼Œé€‚åˆå°è§„æ¨¡å›¾ï¼ˆn<500ï¼‰</li>
                <li>ç©ºé—´å¤æ‚åº¦O(nÂ²)ï¼Œéœ€è¦å­˜å‚¨å®Œæ•´è·ç¦»çŸ©é˜µ</li>
                <li>ä¸DijkstraåŒºåˆ«ï¼šFloydæ±‚æ‰€æœ‰å¯¹ï¼ŒDijkstraæ±‚å•æº</li>
            </ul>
        </div>
    </div>

    <!-- å¯è§†åŒ–å±•ç¤º -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">ğŸ“Š</span>
            å¯è§†åŒ–å±•ç¤º
        </h2>

        <div class="visualization-container">
            <h3 style="text-align: center;">ğŸ¯ Floyd-Warshallç®—æ³•åŠ¨æ€æ¼”ç¤º</h3>

            <canvas id="floydCanvas" width="400" height="400"></canvas>

            <div class="control-panel">
                <button class="control-btn" onclick="startAlgorithm()">â–¶ï¸ å¼€å§‹ç®—æ³•</button>
                <button class="control-btn" onclick="stepAlgorithm()">â­ï¸ å•æ­¥æ‰§è¡Œ</button>
                <button class="control-btn" onclick="pauseAlgorithm()">â¸ï¸ æš‚åœ</button>
                <button class="control-btn" onclick="resetGraph()">ğŸ”„ é‡ç½®</button>
                <button class="control-btn" onclick="generateRandomGraph()">ğŸ² éšæœºå›¾</button>
                <button class="control-btn danger" onclick="clearGraph()">ğŸ—‘ï¸ æ¸…ç©º</button>

                <div class="speed-control">
                    <label for="speedSlider">åŠ¨ç”»é€Ÿåº¦ï¼š</label>
                    <input type="range" id="speedSlider" min="200" max="2000" value="1000" step="100">
                    <span id="speedValue">1000ms</span>
                </div>
            </div>

            <div class="matrix-container">
                <div class="matrix-wrapper">
                    <div class="matrix-title">ğŸ“Š è·ç¦»çŸ©é˜µ</div>
                    <table class="distance-matrix" id="distanceMatrix">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>

                <div class="matrix-wrapper">
                    <div class="matrix-title">ğŸ”— è·¯å¾„çŸ©é˜µ</div>
                    <table class="distance-matrix" id="pathMatrix">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>

            <div id="operationLog" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; min-height: 60px;">
                <strong>æ“ä½œæ—¥å¿—ï¼š</strong><span id="logText">ç‚¹å‡»"éšæœºå›¾"ç”Ÿæˆç¤ºä¾‹ï¼Œæˆ–"å¼€å§‹ç®—æ³•"è¿è¡Œ</span>
            </div>
        </div>
    </div>

    <!-- ä»£ç ç¤ºä¾‹ -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">ğŸ’»</span>
            ä»£ç å®ç°
        </h2>

        <div class="code-tabs">
            <button class="code-tab active" onclick="switchCode('cpp', event)">C++</button>
            <button class="code-tab" onclick="switchCode('java', event)">Java</button>
            <button class="code-tab" onclick="switchCode('python', event)">Python</button>
        </div>

        <div id="cpp-code" class="code-content active">
            <button class="copy-btn" onclick="copyCode('cpp', event)">ğŸ“‹ å¤åˆ¶ä»£ç </button>
            <pre><code>#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;limits&gt;
using namespace std;

const int INF = 1e9;  // è¡¨ç¤ºæ— ç©·å¤§

class FloydWarshall {
private:
    int n;  // èŠ‚ç‚¹æ•°
    vector&lt;vector&lt;int&gt;&gt; dist;  // è·ç¦»çŸ©é˜µ
    vector&lt;vector&lt;int&gt;&gt; next;  // è·¯å¾„çŸ©é˜µ

public:
    FloydWarshall(int vertices) : n(vertices) {
        // åˆå§‹åŒ–çŸ©é˜µ
        dist.resize(n, vector&lt;int&gt;(n, INF));
        next.resize(n, vector&lt;int&gt;(n, -1));

        // å¯¹è§’çº¿è®¾ä¸º0ï¼ˆè‡ªå·±åˆ°è‡ªå·±è·ç¦»ä¸º0ï¼‰
        for (int i = 0; i &lt; n; i++) {
            dist[i][i] = 0;
            next[i][i] = i;
        }
    }

    // æ·»åŠ è¾¹
    void addEdge(int u, int v, int weight) {
        dist[u][v] = weight;
        next[u][v] = v;  // ç›´æ¥è¿æ¥ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯ç»ˆç‚¹

        // å¦‚æœæ˜¯æ— å‘å›¾ï¼Œæ·»åŠ åå‘è¾¹
        dist[v][u] = weight;
        next[v][u] = u;
    }

    // Floyd-Warshallç®—æ³•æ ¸å¿ƒ
    void floydWarshall() {
        // k: ä¸­é—´èŠ‚ç‚¹
        for (int k = 0; k &lt; n; k++) {
            // i: èµ·ç‚¹
            for (int i = 0; i &lt; n; i++) {
                // j: ç»ˆç‚¹
                for (int j = 0; j &lt; n; j++) {
                    // å¦‚æœç»è¿‡kçš„è·¯å¾„æ›´çŸ­
                    if (dist[i][k] != INF && dist[k][j] != INF &&
                        dist[i][k] + dist[k][j] &lt; dist[i][j]) {

                        // æ›´æ–°æœ€çŸ­è·ç¦»
                        dist[i][j] = dist[i][k] + dist[k][j];

                        // æ›´æ–°è·¯å¾„ï¼šä»iåˆ°jè¦å…ˆä»iåˆ°k
                        next[i][j] = next[i][k];
                    }
                }
            }
        }

        // æ£€æµ‹è´Ÿæƒç¯
        for (int i = 0; i &lt; n; i++) {
            if (dist[i][i] &lt; 0) {
                cout &lt;&lt; "å›¾ä¸­å­˜åœ¨è´Ÿæƒç¯ï¼" &lt;&lt; endl;
                return;
            }
        }
    }

    // é‡å»ºè·¯å¾„
    vector&lt;int&gt; getPath(int start, int end) {
        vector&lt;int&gt; path;

        // æ— æ³•åˆ°è¾¾
        if (next[start][end] == -1) {
            return path;
        }

        // ä»èµ·ç‚¹å¼€å§‹é‡å»ºè·¯å¾„
        int current = start;
        path.push_back(current);

        while (current != end) {
            current = next[current][end];
            path.push_back(current);
        }

        return path;
    }

    // æ‰“å°è·ç¦»çŸ©é˜µ
    void printDistanceMatrix() {
        cout &lt;&lt; "è·ç¦»çŸ©é˜µï¼š" &lt;&lt; endl;
        cout &lt;&lt; "    ";
        for (int i = 0; i &lt; n; i++) {
            cout &lt;&lt; i &lt;&lt; "   ";
        }
        cout &lt;&lt; endl;

        for (int i = 0; i &lt; n; i++) {
            cout &lt;&lt; i &lt;&lt; ": ";
            for (int j = 0; j &lt; n; j++) {
                if (dist[i][j] == INF) {
                    cout &lt;&lt; "INF ";
                } else {
                    cout &lt;&lt; dist[i][j];
                    if (dist[i][j] &lt; 10) cout &lt;&lt; "   ";
                    else if (dist[i][j] &lt; 100) cout &lt;&lt; "  ";
                    else cout &lt;&lt; " ";
                }
            }
            cout &lt;&lt; endl;
        }
    }

    // æ‰“å°ç‰¹å®šè·¯å¾„
    void printPath(int start, int end) {
        vector&lt;int&gt; path = getPath(start, end);

        if (path.empty()) {
            cout &lt;&lt; "ä» " &lt;&lt; start &lt;&lt; " åˆ° " &lt;&lt; end &lt;&lt; " æ— è·¯å¾„" &lt;&lt; endl;
            return;
        }

        cout &lt;&lt; "ä» " &lt;&lt; start &lt;&lt; " åˆ° " &lt;&lt; end
             &lt;&lt; " çš„æœ€çŸ­è·¯å¾„ (è·ç¦»: " &lt;&lt; dist[start][end] &lt;&lt; "): ";

        for (int i = 0; i &lt; path.size(); i++) {
            cout &lt;&lt; path[i];
            if (i &lt; path.size() - 1) cout &lt;&lt; " -> ";
        }
        cout &lt;&lt; endl;
    }
};

int main() {
    // åˆ›å»ºå›¾ï¼ˆ4ä¸ªèŠ‚ç‚¹ï¼‰
    FloydWarshall graph(4);

    // æ·»åŠ è¾¹
    graph.addEdge(0, 1, 5);
    graph.addEdge(0, 3, 10);
    graph.addEdge(1, 2, 3);
    graph.addEdge(2, 3, 1);

    // è¿è¡ŒFloyd-Warshallç®—æ³•
    graph.floydWarshall();

    // æ‰“å°ç»“æœ
    graph.printDistanceMatrix();
    cout &lt;&lt; endl;

    // æ‰“å°ä¸€äº›å…·ä½“è·¯å¾„
    graph.printPath(0, 2);
    graph.printPath(0, 3);
    graph.printPath(1, 3);

    return 0;
}</code></pre>
        </div>

        <div id="java-code" class="code-content">
            <button class="copy-btn" onclick="copyCode('java', event)">ğŸ“‹ å¤åˆ¶ä»£ç </button>
            <pre><code>import java.util.*;

public class FloydWarshall {
    private int n;  // èŠ‚ç‚¹æ•°
    private int[][] dist;  // è·ç¦»çŸ©é˜µ
    private int[][] next;  // è·¯å¾„çŸ©é˜µ
    private static final int INF = Integer.MAX_VALUE / 2;  // é¿å…æº¢å‡º

    public FloydWarshall(int vertices) {
        this.n = vertices;
        this.dist = new int[n][n];
        this.next = new int[n][n];

        // åˆå§‹åŒ–çŸ©é˜µ
        for (int i = 0; i < n; i++) {
            for (int j = 0; j < n; j++) {
                if (i == j) {
                    dist[i][j] = 0;
                    next[i][j] = j;
                } else {
                    dist[i][j] = INF;
                    next[i][j] = -1;
                }
            }
        }
    }

    // æ·»åŠ è¾¹ï¼ˆæ— å‘å›¾ï¼‰
    public void addEdge(int u, int v, int weight) {
        dist[u][v] = weight;
        next[u][v] = v;

        // æ— å‘å›¾ï¼šæ·»åŠ åå‘è¾¹
        dist[v][u] = weight;
        next[v][u] = u;
    }

    // Floyd-Warshallç®—æ³•å®ç°
    public void floydWarshall() {
        // k: ä¸­é—´èŠ‚ç‚¹
        for (int k = 0; k < n; k++) {
            // i: èµ·ç‚¹
            for (int i = 0; i < n; i++) {
                // j: ç»ˆç‚¹
                for (int j = 0; j < n; j++) {
                    // é¿å…æº¢å‡ºæ£€æŸ¥
                    if (dist[i][k] != INF && dist[k][j] != INF) {
                        // å¦‚æœç»è¿‡kçš„è·¯å¾„æ›´çŸ­
                        if (dist[i][k] + dist[k][j] < dist[i][j]) {
                            dist[i][j] = dist[i][k] + dist[k][j];
                            next[i][j] = next[i][k];
                        }
                    }
                }
            }

            // å¯ä»¥åœ¨è¿™é‡Œæ‰“å°æ¯ä¸€æ­¥çš„çŠ¶æ€
            System.out.println("k = " + k + " å®Œæˆ");
        }

        // æ£€æµ‹è´Ÿæƒç¯
        for (int i = 0; i < n; i++) {
            if (dist[i][i] < 0) {
                System.out.println("è­¦å‘Šï¼šå›¾ä¸­å­˜åœ¨è´Ÿæƒç¯ï¼");
                return;
            }
        }
    }

    // é‡å»ºè·¯å¾„
    public List<Integer> getPath(int start, int end) {
        List<Integer> path = new ArrayList<>();

        // æ— æ³•åˆ°è¾¾
        if (next[start][end] == -1) {
            return path;
        }

        // ä»èµ·ç‚¹å¼€å§‹é‡å»ºè·¯å¾„
        int current = start;
        path.add(current);

        while (current != end) {
            current = next[current][end];
            path.add(current);
        }

        return path;
    }

    // æ‰“å°è·ç¦»çŸ©é˜µ
    public void printDistanceMatrix() {
        System.out.println("è·ç¦»çŸ©é˜µï¼š");
        System.out.print("     ");
        for (int i = 0; i < n; i++) {
            System.out.printf("%3d ", i);
        }
        System.out.println();

        for (int i = 0; i < n; i++) {
            System.out.printf("%2d: ", i);
            for (int j = 0; j < n; j++) {
                if (dist[i][j] == INF) {
                    System.out.print("INF ");
                } else {
                    System.out.printf("%3d ", dist[i][j]);
                }
            }
            System.out.println();
        }
    }

    // æ‰“å°è·¯å¾„çŸ©é˜µ
    public void printNextMatrix() {
        System.out.println("è·¯å¾„çŸ©é˜µï¼ˆnextï¼‰ï¼š");
        System.out.print("     ");
        for (int i = 0; i < n; i++) {
            System.out.printf("%3d ", i);
        }
        System.out.println();

        for (int i = 0; i < n; i++) {
            System.out.printf("%2d: ", i);
            for (int j = 0; j < n; j++) {
                if (next[i][j] == -1) {
                    System.out.print("  - ");
                } else {
                    System.out.printf("%3d ", next[i][j]);
                }
            }
            System.out.println();
        }
    }

    // æ‰“å°ç‰¹å®šè·¯å¾„
    public void printPath(int start, int end) {
        List<Integer> path = getPath(start, end);

        if (path.isEmpty()) {
            System.out.println("ä» " + start + " åˆ° " + end + " æ— è·¯å¾„");
            return;
        }

        System.out.print("ä» " + start + " åˆ° " + end +
                        " çš„æœ€çŸ­è·¯å¾„ (è·ç¦»: " + dist[start][end] + "): ");

        for (int i = 0; i < path.size(); i++) {
            System.out.print(path.get(i));
            if (i < path.size() - 1) {
                System.out.print(" -> ");
            }
        }
        System.out.println();
    }

    public static void main(String[] args) {
        // åˆ›å»ºå›¾ï¼ˆ4ä¸ªèŠ‚ç‚¹ï¼‰
        FloydWarshall graph = new FloydWarshall(4);

        // æ·»åŠ è¾¹
        graph.addEdge(0, 1, 5);
        graph.addEdge(0, 3, 10);
        graph.addEdge(1, 2, 3);
        graph.addEdge(2, 3, 1);

        System.out.println("åˆå§‹çŠ¶æ€ï¼š");
        graph.printDistanceMatrix();
        System.out.println();

        // è¿è¡ŒFloyd-Warshallç®—æ³•
        graph.floydWarshall();

        System.out.println("\nç®—æ³•æ‰§è¡Œåï¼š");
        graph.printDistanceMatrix();
        System.out.println();
        graph.printNextMatrix();
        System.out.println();

        // æ‰“å°ä¸€äº›å…·ä½“è·¯å¾„
        graph.printPath(0, 2);
        graph.printPath(0, 3);
        graph.printPath(1, 3);
    }
}</code></pre>
        </div>

        <div id="python-code" class="code-content">
            <button class="copy-btn" onclick="copyCode('python', event)">ğŸ“‹ å¤åˆ¶ä»£ç </button>
            <pre><code>import sys
from typing import List, Optional

class FloydWarshall:
    def __init__(self, vertices: int):
        """åˆå§‹åŒ–Floyd-Warshallç®—æ³•
        Args:
            vertices: èŠ‚ç‚¹æ•°é‡
        """
        self.n = vertices
        self.INF = float('inf')

        # åˆå§‹åŒ–è·ç¦»çŸ©é˜µ
        self.dist = [[self.INF] * self.n for _ in range(self.n)]
        # åˆå§‹åŒ–è·¯å¾„çŸ©é˜µ
        self.next = [[None] * self.n for _ in range(self.n)]

        # å¯¹è§’çº¿è®¾ä¸º0ï¼ˆè‡ªå·±åˆ°è‡ªå·±ï¼‰
        for i in range(self.n):
            self.dist[i][i] = 0
            self.next[i][i] = i

    def add_edge(self, u: int, v: int, weight: int):
        """æ·»åŠ è¾¹ï¼ˆæ— å‘å›¾ï¼‰
        Args:
            u: èµ·ç‚¹
            v: ç»ˆç‚¹
            weight: æƒé‡
        """
        self.dist[u][v] = weight
        self.next[u][v] = v

        # æ— å‘å›¾ï¼šæ·»åŠ åå‘è¾¹
        self.dist[v][u] = weight
        self.next[v][u] = u

    def floyd_warshall(self, verbose: bool = False) -> bool:
        """æ‰§è¡ŒFloyd-Warshallç®—æ³•
        Args:
            verbose: æ˜¯å¦æ‰“å°è¯¦ç»†è¿‡ç¨‹
        Returns:
            bool: Trueè¡¨ç¤ºæˆåŠŸï¼ŒFalseè¡¨ç¤ºå­˜åœ¨è´Ÿæƒç¯
        """
        # ä¸‰å±‚å¾ªç¯
        for k in range(self.n):
            if verbose:
                print(f"\n=== k = {k} (å°è¯•é€šè¿‡èŠ‚ç‚¹{k}ä¸­è½¬) ===")

            for i in range(self.n):
                for j in range(self.n):
                    # è®¡ç®—ç»è¿‡kçš„è·¯å¾„é•¿åº¦
                    if self.dist[i][k] != self.INF and self.dist[k][j] != self.INF:
                        new_dist = self.dist[i][k] + self.dist[k][j]

                        # å¦‚æœæ›´çŸ­ï¼Œæ›´æ–°
                        if new_dist < self.dist[i][j]:
                            if verbose:
                                print(f"  æ›´æ–°: [{i}â†’{j}] ä» {self.dist[i][j]} æ”¹ä¸º {new_dist}")
                                print(f"        è·¯å¾„: {i}â†’{k}â†’{j}")

                            self.dist[i][j] = new_dist
                            self.next[i][j] = self.next[i][k]

        # æ£€æµ‹è´Ÿæƒç¯
        for i in range(self.n):
            if self.dist[i][i] < 0:
                print("è­¦å‘Šï¼šå›¾ä¸­å­˜åœ¨è´Ÿæƒç¯ï¼")
                return False

        return True

    def get_path(self, start: int, end: int) -> List[int]:
        """è·å–æœ€çŸ­è·¯å¾„
        Args:
            start: èµ·ç‚¹
            end: ç»ˆç‚¹
        Returns:
            è·¯å¾„åˆ—è¡¨ï¼Œå¦‚æœä¸å¯è¾¾åˆ™è¿”å›ç©ºåˆ—è¡¨
        """
        # ä¸å¯è¾¾
        if self.next[start][end] is None:
            return []

        # é‡å»ºè·¯å¾„
        path = [start]
        current = start

        while current != end:
            current = self.next[current][end]
            path.append(current)

        return path

    def print_distance_matrix(self):
        """æ‰“å°è·ç¦»çŸ©é˜µ"""
        print("\nè·ç¦»çŸ©é˜µï¼š")
        print("     ", end="")
        for i in range(self.n):
            print(f"{i:4}", end="")
        print()

        for i in range(self.n):
            print(f"{i:2}: ", end="")
            for j in range(self.n):
                if self.dist[i][j] == self.INF:
                    print(" INF", end="")
                else:
                    print(f"{self.dist[i][j]:4}", end="")
            print()

    def print_path_matrix(self):
        """æ‰“å°è·¯å¾„çŸ©é˜µ"""
        print("\nè·¯å¾„çŸ©é˜µï¼ˆnextï¼‰ï¼š")
        print("     ", end="")
        for i in range(self.n):
            print(f"{i:4}", end="")
        print()

        for i in range(self.n):
            print(f"{i:2}: ", end="")
            for j in range(self.n):
                if self.next[i][j] is None:
                    print("   -", end="")
                else:
                    print(f"{self.next[i][j]:4}", end="")
            print()

    def print_path(self, start: int, end: int):
        """æ‰“å°å…·ä½“è·¯å¾„"""
        path = self.get_path(start, end)

        if not path:
            print(f"ä» {start} åˆ° {end}: ä¸å¯è¾¾")
            return

        distance = self.dist[start][end]
        path_str = " â†’ ".join(map(str, path))
        print(f"ä» {start} åˆ° {end}: è·ç¦»={distance}, è·¯å¾„: {path_str}")

    def print_all_shortest_paths(self):
        """æ‰“å°æ‰€æœ‰æœ€çŸ­è·¯å¾„"""
        print("\næ‰€æœ‰æœ€çŸ­è·¯å¾„ï¼š")
        for i in range(self.n):
            for j in range(self.n):
                if i != j:
                    self.print_path(i, j)


def example1_basic():
    """åŸºç¡€ç¤ºä¾‹"""
    print("=== åŸºç¡€ç¤ºä¾‹ ===")

    # åˆ›å»º4ä¸ªèŠ‚ç‚¹çš„å›¾
    graph = FloydWarshall(4)

    # æ·»åŠ è¾¹
    graph.add_edge(0, 1, 5)
    graph.add_edge(0, 3, 10)
    graph.add_edge(1, 2, 3)
    graph.add_edge(2, 3, 1)

    print("åˆå§‹å›¾ï¼š")
    print("è¾¹: (0,1,5), (0,3,10), (1,2,3), (2,3,1)")

    # æ‰§è¡Œç®—æ³•
    graph.floyd_warshall(verbose=True)

    # æ‰“å°ç»“æœ
    graph.print_distance_matrix()
    graph.print_path_matrix()

    print("\nå…·ä½“è·¯å¾„ï¼š")
    graph.print_path(0, 2)
    graph.print_path(0, 3)
    graph.print_path(1, 3)


def example2_negative_edge():
    """åŒ…å«è´Ÿæƒè¾¹çš„ç¤ºä¾‹"""
    print("\n=== è´Ÿæƒè¾¹ç¤ºä¾‹ ===")

    graph = FloydWarshall(3)

    # æ·»åŠ è¾¹ï¼ˆåŒ…å«è´Ÿæƒï¼‰
    graph.dist[0][1] = 4
    graph.next[0][1] = 1
    graph.dist[1][2] = -5
    graph.next[1][2] = 2
    graph.dist[2][0] = 2
    graph.next[2][0] = 0

    print("è¾¹: (0â†’1: 4), (1â†’2: -5), (2â†’0: 2)")

    # æ‰§è¡Œç®—æ³•
    if graph.floyd_warshall():
        graph.print_distance_matrix()
        print("\næ‰€æœ‰è·¯å¾„ï¼š")
        graph.print_all_shortest_paths()


def example3_disconnected():
    """éè¿é€šå›¾ç¤ºä¾‹"""
    print("\n=== éè¿é€šå›¾ç¤ºä¾‹ ===")

    graph = FloydWarshall(5)

    # æ·»åŠ è¾¹ï¼ˆä¸¤ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†ï¼‰
    graph.add_edge(0, 1, 1)
    graph.add_edge(1, 2, 2)
    graph.add_edge(3, 4, 3)

    print("è¾¹: (0,1,1), (1,2,2), (3,4,3)")
    print("æ³¨æ„ï¼šå›¾åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹éƒ¨åˆ†")

    # æ‰§è¡Œç®—æ³•
    graph.floyd_warshall()

    # æ‰“å°ç»“æœ
    graph.print_distance_matrix()

    print("\næµ‹è¯•è·¯å¾„ï¼š")
    graph.print_path(0, 2)  # å¯è¾¾
    graph.print_path(0, 3)  # ä¸å¯è¾¾
    graph.print_path(3, 4)  # å¯è¾¾


if __name__ == "__main__":
    example1_basic()
    example2_negative_edge()
    example3_disconnected()</code></pre>
        </div>
    </div>

    <!-- å®é™…åº”ç”¨ -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">ğŸŒŸ</span>
            å®é™…åº”ç”¨
        </h2>

        <div class="application-grid">
            <div class="app-card">
                <h3>ğŸ—ºï¸ åœ°å›¾æœåŠ¡</h3>
                <p>Google Mapsé¢„è®¡ç®—çƒ­é—¨åœ°ç‚¹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œæä¾›å¿«é€Ÿè·¯çº¿æŸ¥è¯¢</p>
            </div>

            <div class="app-card">
                <h3>ğŸŒ ç½‘ç»œè·¯ç”±</h3>
                <p>è®¡ç®—æœºç½‘ç»œä¸­è·¯ç”±è¡¨çš„æ„å»ºï¼Œæ‰¾åˆ°æ•°æ®åŒ…çš„æœ€ä¼˜ä¼ è¾“è·¯å¾„</p>
            </div>

            <div class="app-card">
                <h3>âœˆï¸ èˆªç©ºè°ƒåº¦</h3>
                <p>èˆªç©ºå…¬å¸è®¡ç®—æ‰€æœ‰æœºåœºé—´çš„æœ€çŸ­é£è¡Œè·¯çº¿å’Œä¸­è½¬æ–¹æ¡ˆ</p>
            </div>

            <div class="app-card">
                <h3>ğŸ® æ¸¸æˆAI</h3>
                <p>ç­–ç•¥æ¸¸æˆä¸­è®¡ç®—æ‰€æœ‰å•ä½é—´çš„ç§»åŠ¨æˆæœ¬ï¼Œä¼˜åŒ–AIå†³ç­–</p>
            </div>

            <div class="app-card">
                <h3>ğŸ“Š å…³ç³»åˆ†æ</h3>
                <p>ç¤¾äº¤ç½‘ç»œä¸­åˆ†æç”¨æˆ·é—´çš„æœ€çŸ­å…³ç³»é“¾ï¼Œæ¨èå…±åŒå¥½å‹</p>
            </div>

            <div class="app-card">
                <h3>ğŸ’° å¥—æ±‡æ£€æµ‹</h3>
                <p>å¤–æ±‡å¸‚åœºæ£€æµ‹è´§å¸å…‘æ¢ä¸­çš„å¥—åˆ©æœºä¼šï¼ˆè´Ÿæƒç¯æ£€æµ‹ï¼‰</p>
            </div>
        </div>
    </div>

    <!-- å­¦ä¹ æ£€éªŒ -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">âœ…</span>
            å­¦ä¹ æ£€éªŒ
        </h2>

        <div class="quiz-item">
            <div class="quiz-question">
                â“ é—®é¢˜1ï¼šä¸ºä»€ä¹ˆFloydç®—æ³•çš„ä¸‰å±‚å¾ªç¯ä¸­ï¼Œkå¿…é¡»åœ¨æœ€å¤–å±‚ï¼Ÿ
            </div>
            <button class="show-answer-btn" onclick="toggleAnswer(1, event)">æŸ¥çœ‹ç­”æ¡ˆ</button>
            <div id="answer1" class="quiz-answer">
                <strong>ç­”æ¡ˆï¼š</strong>è¿™æ˜¯åŠ¨æ€è§„åˆ’çš„è¦æ±‚ï¼Œç¡®ä¿å­é—®é¢˜å·²ç»è§£å†³ã€‚
                <p><strong>è¯¦ç»†è§£é‡Šï¼š</strong></p>
                <ul>
                    <li>å½“æˆ‘ä»¬è€ƒè™‘"æ˜¯å¦é€šè¿‡èŠ‚ç‚¹k"æ—¶ï¼Œéœ€è¦çŸ¥é“ï¼š
                        <ul>
                            <li>ä¸ç»è¿‡kçš„iåˆ°jæœ€çŸ­è·¯å¾„ï¼ˆå·²çŸ¥ï¼‰</li>
                            <li>iåˆ°kçš„æœ€çŸ­è·¯å¾„ï¼ˆå¯èƒ½ç»è¿‡0åˆ°k-1ï¼‰</li>
                            <li>kåˆ°jçš„æœ€çŸ­è·¯å¾„ï¼ˆå¯èƒ½ç»è¿‡0åˆ°k-1ï¼‰</li>
                        </ul>
                    </li>
                    <li>å¦‚æœkä¸åœ¨æœ€å¤–å±‚ï¼Œæˆ‘ä»¬å¯èƒ½ä½¿ç”¨è¿˜æœªä¼˜åŒ–çš„è·¯å¾„</li>
                </ul>
                <p><strong>é”™è¯¯ç¤ºä¾‹ï¼š</strong></p>
                <pre style="background: #f0f0f0; padding: 10px;">
// é”™è¯¯ï¼
for i in range(n):
    for j in range(n):
        for k in range(n):  // kåœ¨å†…å±‚
            dist[i][j] = min(dist[i][j], dist[i][k] + dist[k][j])
// è¿™æ ·ä¼šå¯¼è‡´ä½¿ç”¨æœªå®Œå…¨ä¼˜åŒ–çš„è·¯å¾„
                </pre>
            </div>
        </div>

        <div class="quiz-item">
            <div class="quiz-question">
                â“ é—®é¢˜2ï¼šFloydç®—æ³•ä¸Dijkstraç®—æ³•çš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯ï¼Ÿ
            </div>
            <button class="show-answer-btn" onclick="toggleAnswer(2, event)">æŸ¥çœ‹ç­”æ¡ˆ</button>
            <div id="answer2" class="quiz-answer">
                <strong>ç­”æ¡ˆï¼š</strong>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: #f0f0f0;">
                        <th style="padding: 10px; border: 1px solid #ddd;">ç‰¹æ€§</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">Floyd-Warshall</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">Dijkstra</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">é—®é¢˜ç±»å‹</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">å…¨æºæœ€çŸ­è·¯å¾„</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">å•æºæœ€çŸ­è·¯å¾„</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">æ—¶é—´å¤æ‚åº¦</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(VÂ³)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O((V+E)logV)</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">ç©ºé—´å¤æ‚åº¦</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(VÂ²)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(V)</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">è´Ÿæƒè¾¹</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">âœ… æ”¯æŒ</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">âŒ ä¸æ”¯æŒ</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">é€‚ç”¨è§„æ¨¡</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">å°å›¾ï¼ˆV < 500ï¼‰</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">å¤§å›¾ä¹Ÿå¯ä»¥</td>
                    </tr>
                </table>
                <p><strong>é€‰æ‹©å»ºè®®ï¼š</strong></p>
                <ul>
                    <li>éœ€è¦æ‰€æœ‰ç‚¹å¯¹è·¯å¾„ â†’ Floyd</li>
                    <li>åªéœ€è¦å•æºè·¯å¾„ â†’ Dijkstra</li>
                    <li>æœ‰è´Ÿæƒè¾¹ â†’ Floydæˆ–Bellman-Ford</li>
                    <li>å›¾å¾ˆå¤§ â†’ å¤šæ¬¡Dijkstraå¯èƒ½æ¯”Floydå¿«</li>
                </ul>
            </div>
        </div>

        <div class="quiz-item">
            <div class="quiz-question">
                â“ é—®é¢˜3ï¼šå¦‚ä½•ç”¨Floydç®—æ³•æ£€æµ‹è´Ÿæƒç¯ï¼Ÿ
            </div>
            <button class="show-answer-btn" onclick="toggleAnswer(3, event)">æŸ¥çœ‹ç­”æ¡ˆ</button>
            <div id="answer3" class="quiz-answer">
                <strong>ç­”æ¡ˆï¼š</strong>ç®—æ³•æ‰§è¡Œåï¼Œæ£€æŸ¥å¯¹è§’çº¿å…ƒç´ æ˜¯å¦ä¸ºè´Ÿæ•°ã€‚
                <p><strong>åŸç†ï¼š</strong></p>
                <ul>
                    <li>dist[i][i]è¡¨ç¤ºä»iå‡ºå‘å›åˆ°içš„æœ€çŸ­è·ç¦»</li>
                    <li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸ç»è¿‡ä»»ä½•è¾¹å›åˆ°è‡ªå·±ï¼Œè·ç¦»åº”è¯¥æ˜¯0</li>
                    <li>å¦‚æœdist[i][i] < 0ï¼Œè¯´æ˜å­˜åœ¨ä¸€ä¸ªä»iå‡ºå‘çš„è´Ÿæƒç¯</li>
                </ul>
                <p><strong>ä»£ç å®ç°ï¼š</strong></p>
                <pre style="background: #f0f0f0; padding: 10px;">
// Floydç®—æ³•æ‰§è¡Œå
for (int i = 0; i < n; i++) {
    if (dist[i][i] < 0) {
        cout << "å­˜åœ¨è´Ÿæƒç¯ï¼ŒåŒ…å«èŠ‚ç‚¹ " << i << endl;
        return false;
    }
}
                </pre>
                <p><strong>åº”ç”¨ï¼š</strong>å¤–æ±‡å¥—æ±‡æ£€æµ‹ã€æ¸¸æˆç»æµç³»ç»Ÿæ¼æ´æ£€æµ‹ç­‰</p>
            </div>
        </div>

        <div class="quiz-item">
            <div class="quiz-question">
                â“ é—®é¢˜4ï¼šå¦‚ä½•é‡å»ºFloydç®—æ³•æ‰¾åˆ°çš„æœ€çŸ­è·¯å¾„ï¼Ÿ
            </div>
            <button class="show-answer-btn" onclick="toggleAnswer(4, event)">æŸ¥çœ‹ç­”æ¡ˆ</button>
            <div id="answer4" class="quiz-answer">
                <strong>ç­”æ¡ˆï¼š</strong>ä½¿ç”¨è·¯å¾„çŸ©é˜µnext[i][j]è®°å½•ä»iåˆ°jè·¯å¾„ä¸Šçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚
                <p><strong>æ–¹æ³•1ï¼šnextçŸ©é˜µæ³•</strong></p>
                <pre style="background: #f0f0f0; padding: 10px;">
// åˆå§‹åŒ–
next[i][j] = j;  // ç›´æ¥è¿æ¥

// æ›´æ–°æ—¶
if (dist[i][k] + dist[k][j] < dist[i][j]) {
    dist[i][j] = dist[i][k] + dist[k][j];
    next[i][j] = next[i][k];  // å…³é”®ï¼šä»iåˆ°jè¦å…ˆèµ°åˆ°kæ–¹å‘
}

// é‡å»ºè·¯å¾„
path = [start];
current = start;
while (current != end) {
    current = next[current][end];
    path.append(current);
}
                </pre>
                <p><strong>æ–¹æ³•2ï¼šparentçŸ©é˜µæ³•</strong></p>
                <p>è®°å½•åˆ°è¾¾jçš„å‰é©±èŠ‚ç‚¹ï¼Œç„¶ååå‘é‡å»ºè·¯å¾„ã€‚</p>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #e3f2fd; border-radius: 8px;">
            <h4>ğŸ“š è¿›é˜¶å­¦ä¹ å»ºè®®</h4>
            <ol>
                <li><strong>ä¼˜åŒ–å®ç°ï¼š</strong>ç©ºé—´ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆåŸåœ°æ›´æ–°ï¼‰</li>
                <li><strong>æ‰©å±•åº”ç”¨ï¼š</strong>ä¼ é€’é—­åŒ…ã€å¯è¾¾æ€§çŸ©é˜µ</li>
                <li><strong>å˜ç§ç®—æ³•ï¼š</strong>Johnsonç®—æ³•ï¼ˆç¨€ç–å›¾çš„å…¨æºæœ€çŸ­è·¯å¾„ï¼‰</li>
                <li><strong>ä¸‹ä¸€æ­¥å­¦ä¹ ï¼š</strong>æœ€å°ç”Ÿæˆæ ‘ã€ç½‘ç»œæµã€å›¾çš„è¿é€šæ€§</li>
            </ol>
        </div>
    </div>

    <!-- è¿”å›å¯¼èˆª -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary">
            <span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a>
        <a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary">
            <span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a>
    </div>
</div>

<script>
// CanvasåŠ¨ç”»ç›¸å…³ä»£ç 
const canvas = document.getElementById('floydCanvas');
const ctx = canvas.getContext('2d');

// å›¾æ•°æ®ç»“æ„
class FloydVisualization {
    constructor() {
        this.nodes = [];
        this.n = 0;
        this.dist = [];      // è·ç¦»çŸ©é˜µ
        this.next = [];      // è·¯å¾„çŸ©é˜µ
        this.original = [];  // åŸå§‹é‚»æ¥çŸ©é˜µ

        // åŠ¨ç”»çŠ¶æ€
        this.k = -1;         // å½“å‰ä¸­é—´èŠ‚ç‚¹
        this.i = -1;         // å½“å‰èµ·ç‚¹
        this.j = -1;         // å½“å‰ç»ˆç‚¹
        this.animationRunning = false;
        this.animationPaused = false;
        this.step = 0;
        this.INF = 999;
    }

    init(n) {
        this.n = n;
        this.nodes = [];

        // åœ¨ç”»å¸ƒä¸Šå‡åŒ€åˆ†å¸ƒèŠ‚ç‚¹ï¼ˆåœ†å½¢å¸ƒå±€ï¼‰
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 120;

        for (let i = 0; i < n; i++) {
            const angle = (i / n) * Math.PI * 2 - Math.PI / 2;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            this.nodes.push({
                x, y,
                label: String.fromCharCode(65 + i)
            });
        }

        // åˆå§‹åŒ–çŸ©é˜µ
        this.dist = Array(n).fill().map(() => Array(n).fill(this.INF));
        this.next = Array(n).fill().map(() => Array(n).fill(-1));
        this.original = Array(n).fill().map(() => Array(n).fill(this.INF));

        // å¯¹è§’çº¿è®¾ä¸º0
        for (let i = 0; i < n; i++) {
            this.dist[i][i] = 0;
            this.original[i][i] = 0;
            this.next[i][i] = i;
        }
    }

    addEdge(from, to, weight) {
        this.dist[from][to] = weight;
        this.dist[to][from] = weight;  // æ— å‘å›¾
        this.original[from][to] = weight;
        this.original[to][from] = weight;
        this.next[from][to] = to;
        this.next[to][from] = from;
    }

    clear() {
        this.nodes = [];
        this.n = 0;
        this.dist = [];
        this.next = [];
        this.original = [];
        this.k = -1;
        this.i = -1;
        this.j = -1;
        this.step = 0;
        this.animationRunning = false;
        this.animationPaused = false;
    }

    reset() {
        // é‡ç½®ä¸ºåŸå§‹çŠ¶æ€
        for (let i = 0; i < this.n; i++) {
            for (let j = 0; j < this.n; j++) {
                this.dist[i][j] = this.original[i][j];
                if (this.original[i][j] !== this.INF) {
                    this.next[i][j] = j;
                } else {
                    this.next[i][j] = -1;
                }
            }
        }
        this.k = -1;
        this.i = -1;
        this.j = -1;
        this.step = 0;
        this.animationRunning = false;
        this.animationPaused = false;
    }
}

const graph = new FloydVisualization();
let animationSpeed = 1000;

// ç»˜åˆ¶èŠ‚ç‚¹
function drawNode(node, index, highlight = '') {
    const x = node.x;
    const y = node.y;
    const radius = 25;

    // æ ¹æ®é«˜äº®ç±»å‹è®¾ç½®é¢œè‰²
    let fillColor = '#e0e0e0';
    let strokeColor = '#999';

    if (highlight === 'k') {
        fillColor = '#cfe2ff';
        strokeColor = '#084298';
    } else if (highlight === 'i') {
        fillColor = '#f8d7da';
        strokeColor = '#842029';
    } else if (highlight === 'j') {
        fillColor = '#fff3cd';
        strokeColor = '#664d03';
    }

    // ç»˜åˆ¶èŠ‚ç‚¹
    ctx.fillStyle = fillColor;
    ctx.strokeStyle = strokeColor;
    ctx.lineWidth = 2;

    ctx.beginPath();
    ctx.arc(x, y, radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();

    // èŠ‚ç‚¹æ ‡ç­¾
    ctx.fillStyle = '#333';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(node.label, x, y);
}

// ç»˜åˆ¶è¾¹
function drawEdge(from, to, weight, highlight = false) {
    ctx.strokeStyle = highlight ? '#ff6b6b' : '#999';
    ctx.lineWidth = highlight ? 3 : 1;

    ctx.beginPath();
    ctx.moveTo(from.x, from.y);
    ctx.lineTo(to.x, to.y);
    ctx.stroke();

    // ç»˜åˆ¶æƒé‡
    const midX = (from.x + to.x) / 2;
    const midY = (from.y + to.y) / 2;

    ctx.fillStyle = highlight ? '#ffe6e6' : 'white';
    ctx.strokeStyle = highlight ? '#ff6b6b' : '#999';
    ctx.lineWidth = 1;

    ctx.beginPath();
    ctx.arc(midX, midY, 15, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = '#333';
    ctx.font = highlight ? 'bold 12px Arial' : '12px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(weight, midX, midY);
}

// ä¸»ç»˜åˆ¶å‡½æ•°
function drawGraph() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // ç»˜åˆ¶æ ‡é¢˜
    ctx.fillStyle = '#333';
    ctx.font = 'bold 18px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Floyd-Warshallç®—æ³•', canvas.width / 2, 30);

    if (graph.k >= 0) {
        ctx.font = '14px Arial';
        ctx.fillText(`k=${graph.k} (ä¸­é—´èŠ‚ç‚¹: ${graph.nodes[graph.k].label})`, canvas.width / 2, 50);
    }

    // ç»˜åˆ¶è¾¹
    for (let i = 0; i < graph.n; i++) {
        for (let j = i + 1; j < graph.n; j++) {
            if (graph.original[i][j] !== graph.INF) {
                const highlight = (i === graph.i && graph.k === graph.k && j === graph.j) ||
                                (i === graph.k && j === graph.j) ||
                                (i === graph.i && j === graph.k);
                drawEdge(graph.nodes[i], graph.nodes[j], graph.original[i][j], highlight);
            }
        }
    }

    // ç»˜åˆ¶èŠ‚ç‚¹
    for (let i = 0; i < graph.n; i++) {
        let highlight = '';
        if (i === graph.k) highlight = 'k';
        else if (i === graph.i) highlight = 'i';
        else if (i === graph.j) highlight = 'j';

        drawNode(graph.nodes[i], i, highlight);
    }

    // ç»˜åˆ¶å½“å‰æ£€æŸ¥çš„è·¯å¾„
    if (graph.i >= 0 && graph.j >= 0 && graph.k >= 0) {
        ctx.strokeStyle = '#6f42c1';
        ctx.lineWidth = 2;
        ctx.setLineDash([5, 5]);

        // i -> k -> j è·¯å¾„
        if (graph.i !== graph.k && graph.k !== graph.j) {
            ctx.beginPath();
            ctx.moveTo(graph.nodes[graph.i].x, graph.nodes[graph.i].y);
            ctx.lineTo(graph.nodes[graph.k].x, graph.nodes[graph.k].y);
            ctx.lineTo(graph.nodes[graph.j].x, graph.nodes[graph.j].y);
            ctx.stroke();
        }

        ctx.setLineDash([]);
    }
}

// æ›´æ–°çŸ©é˜µæ˜¾ç¤º
function updateMatrices() {
    // æ›´æ–°è·ç¦»çŸ©é˜µ
    const distTable = document.getElementById('distanceMatrix');
    let html = '<tr><th></th>';
    for (let i = 0; i < graph.n; i++) {
        html += `<th>${graph.nodes[i].label}</th>`;
    }
    html += '</tr>';

    for (let i = 0; i < graph.n; i++) {
        html += `<tr><th>${graph.nodes[i].label}</th>`;
        for (let j = 0; j < graph.n; j++) {
            let cellClass = '';
            if (i === graph.i && j === graph.j) {
                cellClass = 'matrix-cell-updating';
            } else if (i === graph.i) {
                cellClass = 'matrix-cell-current-i';
            } else if (j === graph.j) {
                cellClass = 'matrix-cell-current-j';
            } else if (i === graph.k || j === graph.k) {
                cellClass = 'matrix-cell-current-k';
            }

            const value = graph.dist[i][j] === graph.INF ? 'âˆ' : graph.dist[i][j];
            html += `<td class="${cellClass}">${value}</td>`;
        }
        html += '</tr>';
    }
    distTable.innerHTML = html;

    // æ›´æ–°è·¯å¾„çŸ©é˜µ
    const pathTable = document.getElementById('pathMatrix');
    html = '<tr><th></th>';
    for (let i = 0; i < graph.n; i++) {
        html += `<th>${graph.nodes[i].label}</th>`;
    }
    html += '</tr>';

    for (let i = 0; i < graph.n; i++) {
        html += `<tr><th>${graph.nodes[i].label}</th>`;
        for (let j = 0; j < graph.n; j++) {
            const value = graph.next[i][j] === -1 ? '-' : graph.nodes[graph.next[i][j]].label;
            html += `<td>${value}</td>`;
        }
        html += '</tr>';
    }
    pathTable.innerHTML = html;
}

// Floydç®—æ³•æ­¥è¿›æ‰§è¡Œ
async function floydStep() {
    if (graph.k === -1) {
        graph.k = 0;
        graph.i = 0;
        graph.j = 0;
        updateLog(`ğŸš€ å¼€å§‹ç®—æ³•ï¼šk=0ï¼Œå°è¯•é€šè¿‡èŠ‚ç‚¹ ${graph.nodes[0].label} ä¸­è½¬`);
    } else {
        // ç§»åŠ¨åˆ°ä¸‹ä¸€æ­¥
        graph.j++;
        if (graph.j >= graph.n) {
            graph.j = 0;
            graph.i++;
            if (graph.i >= graph.n) {
                graph.i = 0;
                graph.k++;
                if (graph.k >= graph.n) {
                    // ç®—æ³•ç»“æŸ
                    graph.k = -1;
                    graph.i = -1;
                    graph.j = -1;
                    updateLog('âœ… ç®—æ³•å®Œæˆï¼æ‰€æœ‰æœ€çŸ­è·¯å¾„å·²è®¡ç®—å®Œæ¯•');
                    return false;
                }
                updateLog(`ğŸ“ k=${graph.k}ï¼Œå°è¯•é€šè¿‡èŠ‚ç‚¹ ${graph.nodes[graph.k].label} ä¸­è½¬`);
            }
        }
    }

    // æ‰§è¡Œå½“å‰æ­¥éª¤
    if (graph.i !== graph.j) {
        const oldDist = graph.dist[graph.i][graph.j];
        const newDist = graph.dist[graph.i][graph.k] + graph.dist[graph.k][graph.j];

        if (graph.dist[graph.i][graph.k] !== graph.INF &&
            graph.dist[graph.k][graph.j] !== graph.INF &&
            newDist < oldDist) {
            graph.dist[graph.i][graph.j] = newDist;
            graph.next[graph.i][graph.j] = graph.next[graph.i][graph.k];

            updateLog(`âœ… æ›´æ–° [${graph.nodes[graph.i].label}â†’${graph.nodes[graph.j].label}]: ${oldDist === graph.INF ? 'âˆ' : oldDist} â†’ ${newDist} (ç»è¿‡${graph.nodes[graph.k].label})`);
        } else {
            const oldStr = oldDist === graph.INF ? 'âˆ' : oldDist;
            const newStr = (graph.dist[graph.i][graph.k] === graph.INF || graph.dist[graph.k][graph.j] === graph.INF) ? 'âˆ' : newDist;
            updateLog(`â© ä¿æŒ [${graph.nodes[graph.i].label}â†’${graph.nodes[graph.j].label}]: ${oldStr} (ä¸ç»è¿‡${graph.nodes[graph.k].label}: ${newStr})`);
        }
    }

    drawGraph();
    updateMatrices();
    return true;
}

// Floydç®—æ³•å®Œæ•´æ‰§è¡Œ
async function floydWarshall() {
    graph.reset();
    graph.animationRunning = true;

    while (await floydStep()) {
        if (graph.animationPaused) {
            await new Promise(resolve => {
                const checkPause = setInterval(() => {
                    if (!graph.animationPaused) {
                        clearInterval(checkPause);
                        resolve();
                    }
                }, 100);
            });
        }
        await sleep(animationSpeed);
    }

    graph.animationRunning = false;
}

// ç”Ÿæˆéšæœºå›¾
function generateRandomGraph() {
    graph.clear();
    graph.init(4);

    // æ·»åŠ è¾¹
    graph.addEdge(0, 1, 5);
    graph.addEdge(0, 3, 10);
    graph.addEdge(1, 2, 3);
    graph.addEdge(2, 3, 1);

    drawGraph();
    updateMatrices();
    updateLog('ğŸ“Š å·²ç”Ÿæˆç¤ºä¾‹å›¾ï¼ˆ4ä¸ªèŠ‚ç‚¹ï¼‰');
}

// æ§åˆ¶å‡½æ•°
function startAlgorithm() {
    if (graph.n === 0) {
        updateLog('âŒ è¯·å…ˆç”Ÿæˆå›¾ï¼');
        return;
    }

    if (graph.animationRunning) {
        updateLog('âš ï¸ ç®—æ³•æ­£åœ¨è¿è¡Œä¸­...');
        return;
    }

    floydWarshall();
}

function stepAlgorithm() {
    if (graph.n === 0) {
        updateLog('âŒ è¯·å…ˆç”Ÿæˆå›¾ï¼');
        return;
    }

    floydStep();
}

function pauseAlgorithm() {
    graph.animationPaused = !graph.animationPaused;
    updateLog(graph.animationPaused ? 'â¸ï¸ å·²æš‚åœ' : 'â–¶ï¸ ç»§ç»­è¿è¡Œ');
}

function resetGraph() {
    if (graph.n === 0) {
        updateLog('âŒ è¯·å…ˆç”Ÿæˆå›¾ï¼');
        return;
    }

    graph.reset();
    drawGraph();
    updateMatrices();
    updateLog('ğŸ”„ å·²é‡ç½®åˆ°åˆå§‹çŠ¶æ€');
}

function clearGraph() {
    graph.clear();
    drawGraph();
    updateMatrices();
    updateLog('ğŸ—‘ï¸ å·²æ¸…ç©º');
}

// è¾…åŠ©å‡½æ•°
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

function updateLog(message) {
    document.getElementById('logText').innerHTML = message;
}

// ä»£ç åˆ‡æ¢
function switchCode(lang, event) {
    document.querySelectorAll('.code-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.code-content').forEach(content => content.classList.remove('active'));

    event.target.classList.add('active');
    document.getElementById(`${lang}-code`).classList.add('active');
}

// å¤åˆ¶ä»£ç 
function copyCode(lang, event) {
    const codeElement = document.getElementById(`${lang}-code`).querySelector('code');
    const text = codeElement.textContent;

    navigator.clipboard.writeText(text).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'âœ… å·²å¤åˆ¶ï¼';
        setTimeout(() => {
            btn.textContent = originalText;
        }, 2000);
    }).catch(err => {
        // é™çº§æ–¹æ¡ˆ
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-9999px';
        document.body.appendChild(textArea);
        textArea.select();

        try {
            document.execCommand('copy');
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'âœ… å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        } catch (err) {
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»£ç ');
        }

        document.body.removeChild(textArea);
    });
}

// æ˜¾ç¤º/éšè—ç­”æ¡ˆ
function toggleAnswer(num, event) {
    const answer = document.getElementById(`answer${num}`);
    const btn = event.target;

    if (answer.style.display === 'block') {
        answer.style.display = 'none';
        btn.textContent = 'æŸ¥çœ‹ç­”æ¡ˆ';
    } else {
        answer.style.display = 'block';
        btn.textContent = 'éšè—ç­”æ¡ˆ';
    }
}

// é€Ÿåº¦æ§åˆ¶
document.getElementById('speedSlider').addEventListener('input', (e) => {
    animationSpeed = parseInt(e.target.value);
    document.getElementById('speedValue').textContent = `${animationSpeed}ms`;
});

// åˆå§‹åŒ–
generateRandomGraph();
</script>

{% endblock %}