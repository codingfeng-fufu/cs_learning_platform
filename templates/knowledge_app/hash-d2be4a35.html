{% extends 'knowledge_app/base.html' %}

{% block title %}å“ˆå¸Œè¡¨ - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<style>
    .visualization-container {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 30px;
        margin: 20px 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .concept-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin: 15px 0;
        border-left: 4px solid #007bff;
    }

    .key-term {
        display: inline-block;
        background: #e3f2fd;
        padding: 4px 8px;
        border-radius: 4px;
        margin: 2px;
        font-weight: 600;
    }

    .difficulty-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: bold;
        margin: 10px 0;
    }

    .difficulty-medium {
        background: #fff3cd;
        color: #856404;
    }

    .code-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        border-bottom: 2px solid #e0e0e0;
    }

    .code-tab {
        padding: 10px 20px;
        cursor: pointer;
        background: #f5f5f5;
        border: none;
        border-radius: 8px 8px 0 0;
        transition: all 0.3s;
    }

    .code-tab.active {
        background: #007bff;
        color: white;
    }

    .code-content {
        display: none;
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 20px;
        border-radius: 0 8px 8px 8px;
        position: relative;
        font-family: 'Courier New', monospace;
        overflow-x: auto;
    }

    .code-content.active {
        display: block;
    }

    .copy-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 6px 12px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }

    .copy-btn:hover {
        background: #0056b3;
    }

    #hashCanvas {
        border: 2px solid #ddd;
        border-radius: 8px;
        margin: 20px auto;
        display: block;
        background: white;
    }

    .control-panel {
        text-align: center;
        margin: 20px 0;
    }

    .control-btn {
        padding: 10px 20px;
        margin: 0 5px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
    }

    .control-btn:hover {
        background: #218838;
        transform: translateY(-2px);
    }

    .input-field {
        padding: 8px 12px;
        margin: 0 5px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
    }

    .quiz-item {
        background: #f8f9fa;
        padding: 20px;
        margin: 15px 0;
        border-radius: 8px;
        border: 2px solid #e9ecef;
    }

    .quiz-question {
        font-weight: 600;
        margin-bottom: 10px;
        color: #333;
    }

    .show-answer-btn {
        padding: 8px 16px;
        background: #17a2b8;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
    }

    .quiz-answer {
        display: none;
        background: #d4edda;
        padding: 15px;
        border-radius: 6px;
        margin-top: 10px;
        border-left: 4px solid #28a745;
    }

    .analogy-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 25px;
        border-radius: 12px;
        margin: 20px 0;
    }

    .application-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .app-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: transform 0.3s;
    }

    .app-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .highlight {
        background: #ffeb3b;
        padding: 2px 4px;
        border-radius: 3px;
    }
</style>

<div class="page-container fade-in">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a>
        <span>></span>
        <span>æ•°æ®ç»“æ„</span>
        <span>></span>
        <span>å“ˆå¸Œè¡¨</span>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header slide-in-left">
        <h1>
            <span class="page-icon">ğŸ”‘</span>
            å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰
        </h1>
        <p>é«˜æ•ˆæŸ¥æ‰¾çš„é­”æ³•æ•°æ®ç»“æ„ - è®©æŸ¥æ‰¾åƒæŸ¥å­—å…¸ä¸€æ ·å¿«é€Ÿ</p>
    </div>

    <!-- çŸ¥è¯†ç‚¹æ¦‚è¿° -->
    <div class="content-card slide-in-right">
        <h2 class="section-title">
            <span class="section-icon">ğŸ“‹</span>
            çŸ¥è¯†ç‚¹æ¦‚è¿°
        </h2>

        <div class="concept-card">
            <p style="font-size: 18px; line-height: 1.6;">
                <strong>æ ¸å¿ƒæ¦‚å¿µï¼š</strong>å“ˆå¸Œè¡¨å°±åƒä¸€ä¸ª<span class="highlight">æ™ºèƒ½å‚¨ç‰©æŸœ</span>ï¼Œä½ ç»™å®ƒä¸€ä¸ªé’¥åŒ™ï¼ˆkeyï¼‰ï¼Œå®ƒèƒ½ç¬é—´æ‰¾åˆ°å¯¹åº”çš„å‚¨ç‰©æ ¼ï¼ˆvalueï¼‰ï¼ŒæŸ¥æ‰¾é€Ÿåº¦æ¥è¿‘O(1)ï¼
            </p>

            <div style="margin: 20px 0;">
                <h4>ğŸ”¤ å…³é”®æœ¯è¯­ï¼š</h4>
                <span class="key-term">å“ˆå¸Œå‡½æ•°</span> - å°†é’¥åŒ™è½¬æ¢æˆå‚¨ç‰©æ ¼ç¼–å·çš„"ç¿»è¯‘å™¨"<br>
                <span class="key-term">æ¡¶(Bucket)</span> - å­˜å‚¨æ•°æ®çš„"å‚¨ç‰©æ ¼"<br>
                <span class="key-term">å“ˆå¸Œå†²çª</span> - ä¸¤ä¸ªä¸åŒçš„é’¥åŒ™ç®—å‡ºäº†åŒä¸€ä¸ªå‚¨ç‰©æ ¼ç¼–å·<br>
                <span class="key-term">é“¾åœ°å€æ³•</span> - è§£å†³å†²çªçš„æ–¹æ³•ï¼Œè®©ä¸€ä¸ªæ ¼å­èƒ½å­˜å¤šä¸ªç‰©å“<br>
                <span class="key-term">è´Ÿè½½å› å­</span> - å·²ç”¨æ ¼å­æ•°/æ€»æ ¼å­æ•°ï¼Œè¡¡é‡æ‹¥æŒ¤ç¨‹åº¦
            </div>

            <div class="difficulty-badge difficulty-medium">
                ğŸ“Š å­¦ä¹ éš¾åº¦ï¼šè¿›é˜¶
            </div>

            <div style="margin-top: 15px;">
                <strong>å‰ç½®çŸ¥è¯†ï¼š</strong>æ•°ç»„ã€é“¾è¡¨ã€åŸºç¡€ç®—æ³•å¤æ‚åº¦åˆ†æ
            </div>
        </div>
    </div>

    <!-- æ¦‚å¿µè¯¦è§£ -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">ğŸ”</span>
            æ¦‚å¿µè¯¦è§£
        </h2>

        <div class="analogy-box">
            <h3>ğŸ« ç”Ÿæ´»ç±»æ¯”ï¼šå›¾ä¹¦é¦†æ‰¾ä¹¦ç³»ç»Ÿ</h3>
            <p>æƒ³è±¡ä¸€ä¸ªå›¾ä¹¦é¦†ï¼š</p>
            <ul style="list-style: none; padding-left: 0;">
                <li>ğŸ“š æ¯æœ¬ä¹¦éƒ½æœ‰ISBNå·ï¼ˆKeyï¼‰</li>
                <li>ğŸ—‚ï¸ é€šè¿‡ISBNçš„å‰å‡ ä½ï¼Œç¡®å®šä¹¦åœ¨å“ªä¸ªä¹¦æ¶ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰</li>
                <li>ğŸ“ ç›´æ¥å»å¯¹åº”ä¹¦æ¶æ‰¾ä¹¦ï¼ˆO(1)æŸ¥æ‰¾ï¼‰</li>
                <li>ğŸ”„ å¦‚æœå¤šæœ¬ä¹¦è¢«åˆ†åˆ°åŒä¸€ä¹¦æ¶ï¼Œå°±æŒ‰é¡ºåºæ‘†æ”¾ï¼ˆå¤„ç†å†²çªï¼‰</li>
            </ul>
        </div>

        <div class="concept-card">
            <h4>1ï¸âƒ£ å“ˆå¸Œå‡½æ•°çš„é­”æ³•</h4>
            <p>å“ˆå¸Œå‡½æ•°å°±åƒä¸€ä¸ªæ•°å­¦é­”æœ¯å¸ˆï¼ŒæŠŠä»»æ„é•¿åº¦çš„è¾“å…¥å˜æˆå›ºå®šèŒƒå›´çš„æ•°å­—ã€‚</p>
            <p><strong>å¸¸è§æ–¹æ³•ï¼š</strong></p>
            <ul>
                <li>é™¤æ³•æ•£åˆ—ï¼š<code>index = key % tableSize</code></li>
                <li>ä¹˜æ³•æ•£åˆ—ï¼š<code>index = (key * A) % tableSize</code></li>
                <li>å­—ç¬¦ä¸²å“ˆå¸Œï¼šæŠŠæ¯ä¸ªå­—ç¬¦çš„ASCIIå€¼åŠ èµ·æ¥</li>
            </ul>
        </div>

        <div class="concept-card">
            <h4>2ï¸âƒ£ å†²çªè§£å†³ç­–ç•¥</h4>
            <p>å½“ä¸¤ä¸ªé’¥åŒ™æŒ‡å‘åŒä¸€ä¸ªæ ¼å­æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³å†²çªï¼š</p>
            <ul>
                <li><strong>é“¾åœ°å€æ³•ï¼š</strong>åœ¨æ¯ä¸ªæ ¼å­åé¢æ¥ä¸€ä¸ªé“¾è¡¨</li>
                <li><strong>å¼€æ”¾åœ°å€æ³•ï¼š</strong>æ‰¾ä¸‹ä¸€ä¸ªç©ºæ ¼å­</li>
                <li><strong>å†å“ˆå¸Œæ³•ï¼š</strong>ç”¨å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°é‡æ–°è®¡ç®—</li>
            </ul>
        </div>

        <div class="concept-card" style="background: #fff3cd; border-left-color: #ffc107;">
            <h4>âš ï¸ åˆå­¦è€…æ˜“æ··æ·†ç‚¹</h4>
            <ul>
                <li>å“ˆå¸Œè¡¨ â‰  å“ˆå¸Œå‡½æ•°ï¼ˆå“ˆå¸Œè¡¨åŒ…å«å“ˆå¸Œå‡½æ•°ï¼‰</li>
                <li>O(1)æ˜¯å¹³å‡æƒ…å†µï¼Œæœ€åæƒ…å†µå¯èƒ½æ˜¯O(n)</li>
                <li>è´Ÿè½½å› å­è¿‡é«˜ä¼šä¸¥é‡å½±å“æ€§èƒ½</li>
            </ul>
        </div>
    </div>

    <!-- å¯è§†åŒ–å±•ç¤º -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">ğŸ“Š</span>
            å¯è§†åŒ–å±•ç¤º
        </h2>

        <div class="visualization-container">
            <h3 style="text-align: center;">ğŸ¯ å“ˆå¸Œè¡¨åŠ¨æ€æ“ä½œæ¼”ç¤º</h3>

            <canvas id="hashCanvas" width="800" height="480"></canvas>

            <div class="control-panel">
                <input type="text" id="keyInput" class="input-field" placeholder="è¾“å…¥é”®(å¦‚: Apple)">
                <input type="text" id="valueInput" class="input-field" placeholder="è¾“å…¥å€¼(å¦‚: çº¢è‰²æ°´æœ)">
                <button class="control-btn" onclick="insertItem()">â• æ’å…¥</button>
                <button class="control-btn" onclick="searchItem()">ğŸ” æŸ¥æ‰¾</button>
                <button class="control-btn" onclick="deleteItem()">âŒ åˆ é™¤</button>
                <button class="control-btn" onclick="clearTable()">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>

            <div id="operationLog" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; min-height: 60px;">
                <strong>æ“ä½œæ—¥å¿—ï¼š</strong><span id="logText">ç­‰å¾…æ“ä½œ...</span>
            </div>
        </div>
    </div>

    <!-- ä»£ç ç¤ºä¾‹ -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">ğŸ’»</span>
            ä»£ç å®ç°
        </h2>

        <div class="code-tabs">
            <button class="code-tab active" onclick="switchCode('cpp', event)">C++</button>
            <button class="code-tab" onclick="switchCode('java', event)">Java</button>
            <button class="code-tab" onclick="switchCode('python', event)">Python</button>
        </div>

        <div id="cpp-code" class="code-content active">
            <button class="copy-btn" onclick="copyCode('cpp', event)">ğŸ“‹ å¤åˆ¶ä»£ç </button>
            <pre><code>#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;list&gt;
using namespace std;

class HashTable {
private:
    static const int TABLE_SIZE = 10;
    vector&lt;list&lt;pair&lt;string, string&gt;&gt;&gt; table;

    int hashFunction(string key) {
        int hash = 0;
        for (char c : key) {
            hash += c;
        }
        return hash % TABLE_SIZE;
    }

public:
    HashTable() : table(TABLE_SIZE) {}

    void insert(string key, string value) {
        int index = hashFunction(key);

        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        for (auto& pair : table[index]) {
            if (pair.first == key) {
                pair.second = value;  // æ›´æ–°å€¼
                return;
            }
        }

        // ä¸å­˜åœ¨åˆ™æ·»åŠ 
        table[index].push_back({key, value});
        cout &lt;&lt; "æ’å…¥æˆåŠŸ: " &lt;&lt; key &lt;&lt; " -> " &lt;&lt; value &lt;&lt; endl;
    }

    string search(string key) {
        int index = hashFunction(key);

        for (auto& pair : table[index]) {
            if (pair.first == key) {
                return pair.second;
            }
        }

        return "æœªæ‰¾åˆ°";
    }

    void remove(string key) {
        int index = hashFunction(key);

        table[index].remove_if([key](auto& pair) {
            return pair.first == key;
        });

        cout &lt;&lt; "åˆ é™¤æˆåŠŸ: " &lt;&lt; key &lt;&lt; endl;
    }
};

int main() {
    HashTable ht;

    ht.insert("apple", "è‹¹æœ");
    ht.insert("banana", "é¦™è•‰");
    ht.insert("orange", "æ©™å­");

    cout &lt;&lt; "æŸ¥æ‰¾apple: " &lt;&lt; ht.search("apple") &lt;&lt; endl;
    cout &lt;&lt; "æŸ¥æ‰¾grape: " &lt;&lt; ht.search("grape") &lt;&lt; endl;

    ht.remove("banana");

    return 0;
}</code></pre>
        </div>

        <div id="java-code" class="code-content">
            <button class="copy-btn" onclick="copyCode('java', event)">ğŸ“‹ å¤åˆ¶ä»£ç </button>
            <pre><code>import java.util.*;

public class HashTable {
    private static final int TABLE_SIZE = 10;
    private LinkedList&lt;Entry&gt;[] table;

    class Entry {
        String key;
        String value;

        Entry(String key, String value) {
            this.key = key;
            this.value = value;
        }
    }

    @SuppressWarnings("unchecked")
    public HashTable() {
        table = new LinkedList[TABLE_SIZE];
        for (int i = 0; i &lt; TABLE_SIZE; i++) {
            table[i] = new LinkedList&lt;&gt;();
        }
    }

    private int hashFunction(String key) {
        int hash = 0;
        for (char c : key.toCharArray()) {
            hash += c;
        }
        return hash % TABLE_SIZE;
    }

    public void insert(String key, String value) {
        int index = hashFunction(key);

        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        for (Entry entry : table[index]) {
            if (entry.key.equals(key)) {
                entry.value = value;  // æ›´æ–°å€¼
                return;
            }
        }

        // ä¸å­˜åœ¨åˆ™æ·»åŠ 
        table[index].add(new Entry(key, value));
        System.out.println("æ’å…¥æˆåŠŸ: " + key + " -> " + value);
    }

    public String search(String key) {
        int index = hashFunction(key);

        for (Entry entry : table[index]) {
            if (entry.key.equals(key)) {
                return entry.value;
            }
        }

        return "æœªæ‰¾åˆ°";
    }

    public void remove(String key) {
        int index = hashFunction(key);

        table[index].removeIf(entry -> entry.key.equals(key));
        System.out.println("åˆ é™¤æˆåŠŸ: " + key);
    }

    public static void main(String[] args) {
        HashTable ht = new HashTable();

        ht.insert("apple", "è‹¹æœ");
        ht.insert("banana", "é¦™è•‰");
        ht.insert("orange", "æ©™å­");

        System.out.println("æŸ¥æ‰¾apple: " + ht.search("apple"));
        System.out.println("æŸ¥æ‰¾grape: " + ht.search("grape"));

        ht.remove("banana");
    }
}</code></pre>
        </div>

        <div id="python-code" class="code-content">
            <button class="copy-btn" onclick="copyCode('python', event)">ğŸ“‹ å¤åˆ¶ä»£ç </button>
            <pre><code>class HashTable:
    def __init__(self, size=10):
        self.size = size
        self.table = [[] for _ in range(size)]

    def _hash_function(self, key):
        """ç®€å•çš„å“ˆå¸Œå‡½æ•°ï¼šå­—ç¬¦ASCIIå€¼ä¹‹å’Œå–æ¨¡"""
        return sum(ord(c) for c in str(key)) % self.size

    def insert(self, key, value):
        """æ’å…¥é”®å€¼å¯¹"""
        index = self._hash_function(key)

        # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æ›´æ–°
        for i, (k, v) in enumerate(self.table[index]):
            if k == key:
                self.table[index][i] = (key, value)
                print(f"æ›´æ–°æˆåŠŸ: {key} -> {value}")
                return

        # ä¸å­˜åœ¨åˆ™æ·»åŠ 
        self.table[index].append((key, value))
        print(f"æ’å…¥æˆåŠŸ: {key} -> {value}")

    def search(self, key):
        """æŸ¥æ‰¾é”®å¯¹åº”çš„å€¼"""
        index = self._hash_function(key)

        for k, v in self.table[index]:
            if k == key:
                return v

        return "æœªæ‰¾åˆ°"

    def delete(self, key):
        """åˆ é™¤é”®å€¼å¯¹"""
        index = self._hash_function(key)

        for i, (k, v) in enumerate(self.table[index]):
            if k == key:
                del self.table[index][i]
                print(f"åˆ é™¤æˆåŠŸ: {key}")
                return

        print(f"åˆ é™¤å¤±è´¥: é”® {key} ä¸å­˜åœ¨")

    def display(self):
        """æ˜¾ç¤ºå“ˆå¸Œè¡¨å†…å®¹"""
        print("\nå“ˆå¸Œè¡¨å†…å®¹ï¼š")
        for i, bucket in enumerate(self.table):
            if bucket:
                print(f"æ¡¶[{i}]: {bucket}")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    ht = HashTable()

    # æ’å…¥æ•°æ®
    ht.insert("apple", "è‹¹æœ")
    ht.insert("banana", "é¦™è•‰")
    ht.insert("orange", "æ©™å­")
    ht.insert("grape", "è‘¡è„")

    # æŸ¥æ‰¾æ•°æ®
    print(f"\næŸ¥æ‰¾'apple': {ht.search('apple')}")
    print(f"æŸ¥æ‰¾'watermelon': {ht.search('watermelon')}")

    # æ˜¾ç¤ºå“ˆå¸Œè¡¨
    ht.display()

    # åˆ é™¤æ•°æ®
    ht.delete("banana")

    # å†æ¬¡æ˜¾ç¤º
    ht.display()</code></pre>
        </div>
    </div>

    <!-- å®é™…åº”ç”¨ -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">ğŸŒŸ</span>
            å®é™…åº”ç”¨
        </h2>

        <div class="application-grid">
            <div class="app-card">
                <h3>ğŸ—„ï¸ æ•°æ®åº“ç´¢å¼•</h3>
                <p>MySQLã€PostgreSQLç­‰æ•°æ®åº“ä½¿ç”¨å“ˆå¸Œç´¢å¼•åŠ é€ŸæŸ¥è¯¢ï¼Œç‰¹åˆ«æ˜¯ç­‰å€¼æŸ¥è¯¢ï¼ˆWHERE id = 123ï¼‰</p>
            </div>

            <div class="app-card">
                <h3>ğŸŒ ç¼“å­˜ç³»ç»Ÿ</h3>
                <p>Redisã€Memcachedç­‰ç¼“å­˜ç³»ç»Ÿæ ¸å¿ƒå°±æ˜¯å“ˆå¸Œè¡¨ï¼Œå®ç°æ¯«ç§’çº§çš„æ•°æ®å­˜å–</p>
            </div>

            <div class="app-card">
                <h3>ğŸ” å¯†ç å­˜å‚¨</h3>
                <p>ç½‘ç«™ä¸ç›´æ¥å­˜å‚¨å¯†ç ï¼Œè€Œæ˜¯å­˜å‚¨å¯†ç çš„å“ˆå¸Œå€¼ï¼Œä¿è¯å³ä½¿æ•°æ®æ³„éœ²ä¹Ÿæ— æ³•è¿˜åŸå¯†ç </p>
            </div>

            <div class="app-card">
                <h3>ğŸ“ ç¼–è¯‘å™¨ç¬¦å·è¡¨</h3>
                <p>ç¼–ç¨‹è¯­è¨€ç¼–è¯‘å™¨ç”¨å“ˆå¸Œè¡¨å­˜å‚¨å˜é‡åå’Œå†…å­˜åœ°å€çš„å¯¹åº”å…³ç³»</p>
            </div>

            <div class="app-card">
                <h3>ğŸ¯ è´Ÿè½½å‡è¡¡</h3>
                <p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è´Ÿè½½å‡è¡¡ï¼Œå¦‚CDNèŠ‚ç‚¹é€‰æ‹©</p>
            </div>

            <div class="app-card">
                <h3>ğŸ” å»é‡ç®—æ³•</h3>
                <p>åˆ¤æ–­å…ƒç´ æ˜¯å¦é‡å¤ï¼Œå¦‚ç½‘ç»œçˆ¬è™«URLå»é‡ã€å¤§æ•°æ®å¤„ç†ä¸­çš„å»é‡</p>
            </div>
        </div>
    </div>

    <!-- å­¦ä¹ æ£€éªŒ -->
    <div class="content-card">
        <h2 class="section-title">
            <span class="section-icon">âœ…</span>
            å­¦ä¹ æ£€éªŒ
        </h2>

        <div class="quiz-item">
            <div class="quiz-question">
                â“ é—®é¢˜1ï¼šä¸ºä»€ä¹ˆå“ˆå¸Œè¡¨çš„å¹³å‡æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Ÿ
            </div>
            <button class="show-answer-btn" onclick="toggleAnswer(1, event)">æŸ¥çœ‹ç­”æ¡ˆ</button>
            <div id="answer1" class="quiz-answer">
                <strong>ç­”æ¡ˆï¼š</strong>å› ä¸ºå“ˆå¸Œå‡½æ•°å¯ä»¥ç›´æ¥è®¡ç®—å‡ºæ•°æ®å­˜å‚¨çš„ä½ç½®ï¼ˆæ•°ç»„ä¸‹æ ‡ï¼‰ï¼Œä¸éœ€è¦éå†æŸ¥æ‰¾ã€‚å…·ä½“è¿‡ç¨‹ï¼š
                <ol>
                    <li>é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼šO(1)</li>
                    <li>ç”¨å“ˆå¸Œå€¼å®šä½åˆ°æ•°ç»„ä½ç½®ï¼šO(1)</li>
                    <li>å¦‚æœæ²¡æœ‰å†²çªï¼Œç›´æ¥è¿”å›ï¼šO(1)</li>
                </ol>
                å³ä½¿æœ‰å†²çªï¼Œåœ¨è´Ÿè½½å› å­åˆç†çš„æƒ…å†µä¸‹ï¼Œé“¾è¡¨é•¿åº¦å¾ˆçŸ­ï¼Œä»å¯è§†ä¸ºO(1)ã€‚
            </div>
        </div>

        <div class="quiz-item">
            <div class="quiz-question">
                â“ é—®é¢˜2ï¼šä»€ä¹ˆæƒ…å†µä¸‹å“ˆå¸Œè¡¨çš„æ€§èƒ½ä¼šé€€åŒ–åˆ°O(n)ï¼Ÿå¦‚ä½•é¿å…ï¼Ÿ
            </div>
            <button class="show-answer-btn" onclick="toggleAnswer(2, event)">æŸ¥çœ‹ç­”æ¡ˆ</button>
            <div id="answer2" class="quiz-answer">
                <strong>ç­”æ¡ˆï¼š</strong>
                <p><strong>é€€åŒ–æƒ…å†µï¼š</strong></p>
                <ul>
                    <li>å“ˆå¸Œå‡½æ•°è®¾è®¡ä¸å½“ï¼Œå¯¼è‡´å¤§é‡å†²çª</li>
                    <li>è´Ÿè½½å› å­è¿‡é«˜ï¼ˆ>0.75ï¼‰ï¼Œå†²çªæ¿€å¢</li>
                    <li>æ¶æ„æ”»å‡»ï¼ˆå“ˆå¸Œç¢°æ’æ”»å‡»ï¼‰</li>
                </ul>
                <p><strong>é¿å…æ–¹æ³•ï¼š</strong></p>
                <ul>
                    <li>ä½¿ç”¨å¥½çš„å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚MurmurHashï¼‰</li>
                    <li>åŠ¨æ€æ‰©å®¹ï¼šå½“è´Ÿè½½å› å­è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‰©å¤§æ•°ç»„å¹¶é‡æ–°å“ˆå¸Œ</li>
                    <li>ä½¿ç”¨çº¢é»‘æ ‘ä»£æ›¿é“¾è¡¨ï¼ˆJava 8çš„HashMapï¼‰</li>
                </ul>
            </div>
        </div>

        <div class="quiz-item">
            <div class="quiz-question">
                â“ é—®é¢˜3ï¼šå“ˆå¸Œè¡¨å’Œæ•°ç»„ã€é“¾è¡¨ç›¸æ¯”ï¼Œå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ
            </div>
            <button class="show-answer-btn" onclick="toggleAnswer(3, event)">æŸ¥çœ‹ç­”æ¡ˆ</button>
            <div id="answer3" class="quiz-answer">
                <strong>ç­”æ¡ˆï¼š</strong>
                <table style="width: 100%; border-collapse: collapse;">
                    <tr style="background: #f0f0f0;">
                        <th style="padding: 10px; border: 1px solid #ddd;">æ•°æ®ç»“æ„</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">æŸ¥æ‰¾</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">æ’å…¥</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">åˆ é™¤</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">ä¼˜ç‚¹</th>
                        <th style="padding: 10px; border: 1px solid #ddd;">ç¼ºç‚¹</th>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">æ•°ç»„</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(n)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(1)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(n)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">è¿ç»­å­˜å‚¨ï¼Œç¼“å­˜å‹å¥½</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">å¤§å°å›ºå®šï¼Œæ’å…¥åˆ é™¤æ…¢</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">é“¾è¡¨</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(n)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(1)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(1)*</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">åŠ¨æ€å¤§å°ï¼Œæ’å…¥åˆ é™¤å¿«</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">æŸ¥æ‰¾æ…¢ï¼Œé¢å¤–ç©ºé—´</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">å“ˆå¸Œè¡¨</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(1)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(1)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">O(1)</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">æå¿«çš„æŸ¥æ‰¾é€Ÿåº¦</td>
                        <td style="padding: 10px; border: 1px solid #ddd;">æ— åºï¼Œç©ºé—´å¼€é”€å¤§</td>
                    </tr>
                </table>
                <p>*é“¾è¡¨çš„O(1)åˆ é™¤éœ€è¦å·²çŸ¥èŠ‚ç‚¹ä½ç½®</p>
            </div>
        </div>

        <div class="quiz-item">
            <div class="quiz-question">
                â“ é—®é¢˜4ï¼šå®ç°ä¸€ä¸ªLRUç¼“å­˜éœ€è¦ç”¨åˆ°å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ
            </div>
            <button class="show-answer-btn" onclick="toggleAnswer(4, event)">æŸ¥çœ‹ç­”æ¡ˆ</button>
            <div id="answer4" class="quiz-answer">
                <strong>ç­”æ¡ˆï¼š</strong>å“ˆå¸Œè¡¨ + åŒå‘é“¾è¡¨
                <ul>
                    <li><strong>å“ˆå¸Œè¡¨ï¼š</strong>å®ç°O(1)çš„æŸ¥æ‰¾ï¼Œå­˜å‚¨keyåˆ°é“¾è¡¨èŠ‚ç‚¹çš„æ˜ å°„</li>
                    <li><strong>åŒå‘é“¾è¡¨ï¼š</strong>ç»´æŠ¤è®¿é—®é¡ºåºï¼Œæœ€è¿‘è®¿é—®çš„åœ¨å¤´éƒ¨ï¼Œæœ€ä¹…æœªè®¿é—®çš„åœ¨å°¾éƒ¨</li>
                </ul>
                <p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
                <ol>
                    <li>è®¿é—®æ•°æ®æ—¶ï¼Œé€šè¿‡å“ˆå¸Œè¡¨O(1)æ‰¾åˆ°èŠ‚ç‚¹</li>
                    <li>å°†è¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨</li>
                    <li>ç¼“å­˜æ»¡æ—¶ï¼Œåˆ é™¤é“¾è¡¨å°¾éƒ¨èŠ‚ç‚¹</li>
                </ol>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #e3f2fd; border-radius: 8px;">
            <h4>ğŸ“š è¿›é˜¶å­¦ä¹ å»ºè®®</h4>
            <ol>
                <li><strong>ç»ƒä¹ å®ç°ï¼š</strong>è‡ªå·±å®ç°ä¸€ä¸ªå®Œæ•´çš„å“ˆå¸Œè¡¨ï¼ŒåŒ…æ‹¬åŠ¨æ€æ‰©å®¹</li>
                <li><strong>æ·±å…¥ç ”ç©¶ï¼š</strong>å­¦ä¹ ä¸åŒçš„å“ˆå¸Œå‡½æ•°ï¼ˆMD5ã€SHAã€MurmurHashï¼‰</li>
                <li><strong>æ€§èƒ½ä¼˜åŒ–ï¼š</strong>äº†è§£å¸ƒéš†è¿‡æ»¤å™¨ã€ä¸€è‡´æ€§å“ˆå¸Œç­‰é«˜çº§åº”ç”¨</li>
                <li><strong>ä¸‹ä¸€æ­¥å­¦ä¹ ï¼š</strong>çº¢é»‘æ ‘ã€B+æ ‘ç­‰æ›´å¤æ‚çš„æ•°æ®ç»“æ„</li>
            </ol>
        </div>
    </div>

    <!-- è¿”å›å¯¼èˆª -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary">
            <span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a>
        <a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary">
            <span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a>
    </div>
</div>

<script>
// CanvasåŠ¨ç”»ç›¸å…³ä»£ç 
const canvas = document.getElementById('hashCanvas');
const ctx = canvas.getContext('2d');

// å“ˆå¸Œè¡¨æ•°æ®ç»“æ„
class VisualHashTable {
    constructor() {
        this.size = 8;
        this.table = Array(this.size).fill(null).map(() => []);
        this.animationQueue = [];
    }

    hash(key) {
        let hash = 0;
        for (let char of key) {
            hash += char.charCodeAt(0);
        }
        return hash % this.size;
    }

    insert(key, value) {
        const index = this.hash(key);

        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        for (let item of this.table[index]) {
            if (item.key === key) {
                item.value = value;
                return { type: 'update', index, key, value };
            }
        }

        this.table[index].push({ key, value });
        return { type: 'insert', index, key, value };
    }

    search(key) {
        const index = this.hash(key);
        for (let item of this.table[index]) {
            if (item.key === key) {
                return { found: true, index, value: item.value };
            }
        }
        return { found: false, index };
    }

    delete(key) {
        const index = this.hash(key);
        const initialLength = this.table[index].length;
        this.table[index] = this.table[index].filter(item => item.key !== key);
        return {
            success: this.table[index].length < initialLength,
            index
        };
    }

    clear() {
        this.table = Array(this.size).fill(null).map(() => []);
    }
}

const hashTable = new VisualHashTable();
let highlightedIndex = -1;
let animationFrame = 0;

// ç»˜åˆ¶å“ˆå¸Œè¡¨
function drawHashTable() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const bucketWidth = 80;
    const bucketHeight = 40;
    const startX = 50;
    const startY = 60;  // å¢åŠ é¡¶éƒ¨ç©ºé—´
    const bucketSpacing = 50;  // å¢åŠ æ¡¶ä¹‹é—´çš„é—´è·

    // ç»˜åˆ¶æ ‡é¢˜
    ctx.font = '18px Arial';
    ctx.fillStyle = '#333';
    ctx.fillText('å“ˆå¸Œè¡¨å¯è§†åŒ–', canvas.width / 2 - 50, 30);

    // ç»˜åˆ¶æ¡¶
    for (let i = 0; i < hashTable.size; i++) {
        const x = startX;
        const y = startY + i * bucketSpacing;

        // ç»˜åˆ¶æ¡¶çš„ç´¢å¼•
        ctx.font = '14px Arial';
        ctx.fillStyle = '#666';
        ctx.fillText(`[${i}]`, x - 25, y + 25);

        // ç»˜åˆ¶æ¡¶
        ctx.strokeStyle = highlightedIndex === i ? '#ff6b6b' : '#007bff';
        ctx.lineWidth = highlightedIndex === i ? 3 : 2;
        ctx.strokeRect(x, y, bucketWidth, bucketHeight);

        // å¡«å……é¢œè‰²
        if (highlightedIndex === i) {
            ctx.fillStyle = 'rgba(255, 107, 107, 0.1)';
            ctx.fillRect(x, y, bucketWidth, bucketHeight);
        }

        // ç»˜åˆ¶é“¾è¡¨
        let nodeX = x + bucketWidth + 20;
        for (let j = 0; j < hashTable.table[i].length; j++) {
            const item = hashTable.table[i][j];

            // ç»˜åˆ¶ç®­å¤´
            if (j === 0) {
                drawArrow(x + bucketWidth, y + bucketHeight / 2, nodeX, y + bucketHeight / 2);
            }

            // ç»˜åˆ¶èŠ‚ç‚¹
            ctx.fillStyle = '#e3f2fd';
            ctx.fillRect(nodeX, y, 100, bucketHeight);
            ctx.strokeStyle = '#007bff';
            ctx.strokeRect(nodeX, y, 100, bucketHeight);

            // ç»˜åˆ¶é”®å€¼
            ctx.font = '12px Arial';
            ctx.fillStyle = '#333';
            ctx.fillText(`${item.key}:${item.value}`, nodeX + 5, y + 25);

            // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
            if (j < hashTable.table[i].length - 1) {
                drawArrow(nodeX + 100, y + bucketHeight / 2, nodeX + 120, y + bucketHeight / 2);
            }

            nodeX += 120;
        }
    }
}

// ç»˜åˆ¶ç®­å¤´
function drawArrow(fromX, fromY, toX, toY) {
    ctx.beginPath();
    ctx.moveTo(fromX, fromY);
    ctx.lineTo(toX, toY);
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 1;
    ctx.stroke();

    // ç®­å¤´å¤´éƒ¨
    const angle = Math.atan2(toY - fromY, toX - fromX);
    ctx.beginPath();
    ctx.moveTo(toX, toY);
    ctx.lineTo(toX - 8 * Math.cos(angle - Math.PI / 6), toY - 8 * Math.sin(angle - Math.PI / 6));
    ctx.lineTo(toX - 8 * Math.cos(angle + Math.PI / 6), toY - 8 * Math.sin(angle + Math.PI / 6));
    ctx.closePath();
    ctx.fill();
}

// åŠ¨ç”»å¾ªç¯
function animate() {
    drawHashTable();

    if (highlightedIndex >= 0) {
        animationFrame++;
        if (animationFrame > 60) {
            highlightedIndex = -1;
            animationFrame = 0;
        }
    }

    requestAnimationFrame(animate);
}

// æ“ä½œå‡½æ•°
function insertItem() {
    const key = document.getElementById('keyInput').value.trim();
    const value = document.getElementById('valueInput').value.trim();

    if (!key || !value) {
        updateLog('âŒ è¯·è¾“å…¥é”®å’Œå€¼ï¼');
        return;
    }

    const result = hashTable.insert(key, value);
    highlightedIndex = result.index;
    animationFrame = 0;

    if (result.type === 'insert') {
        updateLog(`âœ… æ’å…¥æˆåŠŸï¼é”®"${key}"è¢«å“ˆå¸Œåˆ°ç´¢å¼•[${result.index}]`);
    } else {
        updateLog(`ğŸ”„ æ›´æ–°æˆåŠŸï¼é”®"${key}"çš„å€¼å·²æ›´æ–°`);
    }

    document.getElementById('keyInput').value = '';
    document.getElementById('valueInput').value = '';
}

function searchItem() {
    const key = document.getElementById('keyInput').value.trim();

    if (!key) {
        updateLog('âŒ è¯·è¾“å…¥è¦æŸ¥æ‰¾çš„é”®ï¼');
        return;
    }

    const result = hashTable.search(key);
    highlightedIndex = result.index;
    animationFrame = 0;

    if (result.found) {
        updateLog(`ğŸ” æŸ¥æ‰¾æˆåŠŸï¼é”®"${key}"çš„å€¼ä¸ºï¼š"${result.value}"`);
    } else {
        updateLog(`â“ æœªæ‰¾åˆ°é”®"${key}"`);
    }
}

function deleteItem() {
    const key = document.getElementById('keyInput').value.trim();

    if (!key) {
        updateLog('âŒ è¯·è¾“å…¥è¦åˆ é™¤çš„é”®ï¼');
        return;
    }

    const result = hashTable.delete(key);
    highlightedIndex = result.index;
    animationFrame = 0;

    if (result.success) {
        updateLog(`ğŸ—‘ï¸ åˆ é™¤æˆåŠŸï¼é”®"${key}"å·²è¢«ç§»é™¤`);
    } else {
        updateLog(`â“ åˆ é™¤å¤±è´¥ï¼é”®"${key}"ä¸å­˜åœ¨`);
    }
}

function clearTable() {
    hashTable.clear();
    updateLog('ğŸ§¹ å“ˆå¸Œè¡¨å·²æ¸…ç©ºï¼');
}

function updateLog(message) {
    document.getElementById('logText').innerHTML = message;
}

// ä»£ç åˆ‡æ¢
function switchCode(lang, event) {
    document.querySelectorAll('.code-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.code-content').forEach(content => content.classList.remove('active'));

    event.target.classList.add('active');
    document.getElementById(`${lang}-code`).classList.add('active');
}

// å¤åˆ¶ä»£ç 
function copyCode(lang, event) {
    const codeElement = document.getElementById(`${lang}-code`).querySelector('code');
    const text = codeElement.textContent;

    navigator.clipboard.writeText(text).then(() => {
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'âœ… å·²å¤åˆ¶ï¼';
        setTimeout(() => {
            btn.textContent = originalText;
        }, 2000);
    }).catch(err => {
        // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿçš„å¤åˆ¶æ–¹æ³•
        const textArea = document.createElement('textarea');
        textArea.value = text;
        textArea.style.position = 'fixed';
        textArea.style.left = '-9999px';
        document.body.appendChild(textArea);
        textArea.select();

        try {
            document.execCommand('copy');
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'âœ… å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        } catch (err) {
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»£ç ');
        }

        document.body.removeChild(textArea);
    });
}

// æ˜¾ç¤º/éšè—ç­”æ¡ˆ
function toggleAnswer(num, event) {
    const answer = document.getElementById(`answer${num}`);
    const btn = event.target;

    if (answer.style.display === 'block') {
        answer.style.display = 'none';
        btn.textContent = 'æŸ¥çœ‹ç­”æ¡ˆ';
    } else {
        answer.style.display = 'block';
        btn.textContent = 'éšè—ç­”æ¡ˆ';
    }
}

// å¯åŠ¨åŠ¨ç”»
animate();

// æ·»åŠ ä¸€äº›åˆå§‹æ•°æ®
hashTable.insert('Apple', 'è‹¹æœ');
hashTable.insert('Book', 'ä¹¦ç±');
hashTable.insert('Cat', 'çŒ«å’ª');
updateLog('ğŸ“Š å·²åŠ è½½ç¤ºä¾‹æ•°æ®ï¼šApple, Book, Cat');
</script>

{% endblock %}