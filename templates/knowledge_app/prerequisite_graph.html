{% extends 'knowledge_app/base.html' %}

{% block title %}å‰ç½®å…³ç³»å›¾è°± - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block extra_css %}
<style>.graph-container {max-width:1400px;margin:0 auto;padding:20px}.graph-header {background:linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);backdrop-filter:blur(20px);border-radius:var(--border-radius-lg);padding:40px;margin-bottom:30px;text-align:center;color:var(--text-inverse)}.controls-panel {background:var(--bg-card);border-radius:var(--border-radius);padding:20px;margin-bottom:30px;box-shadow:var(--shadow-md);display:flex;gap:20px;align-items:center;flex-wrap:wrap}.control-group {display:flex;align-items:center;gap:10px}.control-label {font-weight:600;color:var(--text-primary)}.control-select {padding:8px 12px;border:2px solid #e2e8f0;border-radius:var(--border-radius-sm);background:var(--bg-card);color:var(--text-primary);font-size:0.9rem}.control-select:focus {outline:none;border-color:var(--primary-color)}.graph-canvas {background:var(--bg-card);border-radius:var(--border-radius-lg);padding:20px;box-shadow:var(--shadow-md);min-height:600px;position:relative}#prerequisite-graph {width:100%;height:600px;border:1px solid var(--border-color);border-radius:var(--border-radius)}.legend {position:absolute;top:30px;right:30px;background:var(--bg-card);border-radius:var(--border-radius);padding:15px;box-shadow:var(--shadow-md);font-size:0.8rem}.legend-item {display:flex;align-items:center;gap:8px;margin-bottom:8px}.legend-color {width:16px;height:16px;border-radius:50%}.info-panel {background:var(--bg-card);border-radius:var(--border-radius);padding:20px;margin-top:30px;box-shadow:var(--shadow-md)}.concept-details {display:none;background:#f8fafc;border-radius:var(--border-radius);padding:20px;margin-top:15px;border-left:4px solid var(--primary-color)}.concept-name {font-size:1.3rem;font-weight:700;color:var(--text-primary);margin-bottom:10px}.concept-description {color:var(--text-secondary);margin-bottom:15px;line-height:1.6}.concept-meta {display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:15px;margin-bottom:15px}.meta-item {display:flex;align-items:center;gap:8px;font-size:0.9rem;color:var(--text-muted)}.prerequisites-list, .dependents-list {margin-top:15px}.list-title {font-weight:600;color:var(--text-primary);margin-bottom:8px}.concept-tag {display:inline-block;background:#edf2f7;color:var(--text-secondary);padding:4px 8px;border-radius:12px;font-size:0.8rem;margin:2px}.loading-spinner {display:flex;justify-content:center;align-items:center;height:200px;color:var(--primary-color)}@keyframes spin {0% {transform:rotate(0deg)}100% {transform:rotate(360deg)}}.spinner {border:4px solid #f3f3f3;border-top:4px solid var(--primary-color);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin-right:10px}@media (max-width:768px) {.graph-container {padding:10px}.controls-panel {flex-direction:column;align-items:stretch}.control-group {justify-content:space-between}#prerequisite-graph {height:400px}.legend {position:static;margin-top:15px}}</style>
{% endblock %}

{% block content %}
<div class="graph-container"><!-- é¡µé¢å¤´éƒ¨ --><div class="graph-header"><h1>ğŸ•¸ï¸ å‰ç½®å…³ç³»å›¾è°±</h1><p>å¯è§†åŒ–å±•ç¤ºçŸ¥è¯†ç‚¹ä¹‹é—´çš„å‰ç½®ä¾èµ–å…³ç³»ï¼Œå¸®åŠ©ç†è§£å­¦ä¹ é¡ºåº</p></div><!-- æ§åˆ¶é¢æ¿ --><div class="controls-panel"><div class="control-group"><label class="control-label">åˆ†ç±»:</label><select id="category-select" class="control-select"><option value="all">å…¨éƒ¨</option><option value="data_structure">æ•°æ®ç»“æ„</option><option value="algorithm">ç®—æ³•</option><option value="programming">ç¼–ç¨‹</option><option value="system">ç³»ç»Ÿ</option></select></div><div class="control-group"><label class="control-label">å¸ƒå±€:</label><select id="layout-select" class="control-select"><option value="hierarchical">å±‚æ¬¡å¸ƒå±€</option><option value="force">åŠ›å¯¼å‘å¸ƒå±€</option><option value="circular">ç¯å½¢å¸ƒå±€</option></select></div><div class="control-group"><label class="control-label">æ˜¾ç¤º:</label><select id="display-select" class="control-select"><option value="all">æ‰€æœ‰å…³ç³»</option><option value="prerequisite">ä»…å‰ç½®å…³ç³»</option><option value="related">ä»…ç›¸å…³å…³ç³»</option></select></div><button id="reset-view" class="control-select" style="background: var(--primary-color); color: var(--text-inverse); border: none; cursor: pointer;">
            é‡ç½®è§†å›¾
        </button></div><!-- å›¾è°±ç”»å¸ƒ --><div class="graph-canvas"><div id="loading" class="loading-spinner"><div class="spinner"></div><span>æ­£åœ¨åŠ è½½çŸ¥è¯†å›¾è°±...</span></div><div id="prerequisite-graph" style="display: none;"></div><!-- å›¾ä¾‹ --><div class="legend"><div class="legend-item"><div class="legend-color" style="background: var(--accent-color);"></div><span>å…¥é—¨çº§</span></div><div class="legend-item"><div class="legend-color" style="background: #45b7d1;"></div><span>ä¸­çº§</span></div><div class="legend-item"><div class="legend-color" style="background: #9b59b6;"></div><span>é«˜çº§</span></div><div class="legend-item"><div class="legend-color" style="background: #e74c3c;"></div><span>ä¸“å®¶çº§</span></div><hr style="margin: 10px 0; border: none; border-top: 1px solid #e2e8f0;"><div class="legend-item"><div style="width: 20px; height: 2px; background: var(--primary-color);"></div><span>å‰ç½®å…³ç³»</span></div><div class="legend-item"><div style="width: 20px; height: 2px; background: #95a5a6; border-style: dashed;"></div><span>ç›¸å…³å…³ç³»</span></div></div></div><!-- ä¿¡æ¯é¢æ¿ --><div class="info-panel"><h3>ğŸ“‹ æ¦‚å¿µè¯¦æƒ…</h3><p id="no-selection" style="color: var(--text-muted);">ç‚¹å‡»å›¾ä¸­çš„èŠ‚ç‚¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p><div id="concept-details" class="concept-details"><div class="concept-name" id="concept-name"></div><div class="concept-description" id="concept-description"></div><div class="concept-meta"><div class="meta-item"><span>ğŸ“Š</span><span id="concept-difficulty"></span></div><div class="meta-item"><span>â±ï¸</span><span id="concept-time"></span></div><div class="meta-item"><span>â­</span><span id="concept-importance"></span></div><div class="meta-item"><span>ğŸ“š</span><span id="concept-category"></span></div></div><div class="prerequisites-list"><div class="list-title">ğŸ”— å‰ç½®çŸ¥è¯†:</div><div id="prerequisites-tags"></div></div><div class="dependents-list"><div class="list-title">ğŸ“ˆ åç»­æ¦‚å¿µ:</div><div id="dependents-tags"></div></div></div></div></div><script></script><script>let network = null; let nodes = null; let edges = null; let graphData = null; const difficultyColors = { 'beginner': 'var(--accent-color)', 'intermediate': '#45b7d1', 'advanced': '#9b59b6', 'expert': '#e74c3c' }; async function initGraph() { try { const response = await fetch('/api/graph/data/'); graphData = await response.json(); if (graphData.success) { renderGraph(graphData.data); } else { showError('åŠ è½½æ•°æ®å¤±è´¥: ' + graphData.message); } } catch (error) { showError('ç½‘ç»œé”™è¯¯: ' + error.message); } } function renderGraph(data) { const nodeArray = data.nodes.map(node => ({ id: node.id, label: node.name, color: { background: difficultyColors[node.difficulty_level] || '#95a5a6', border: '#2c3e50', highlight: { background: '#f39c12', border: '#e67e22' } }, font: { color: '#2c3e50', size: 12, face: 'Arial' }, shape: 'dot', size: Math.max(15, node.importance_weight * 3), title: `${node.name}\néš¾åº¦: ${node.difficulty_level}\né¢„è®¡å­¦æ—¶: ${node.estimated_learning_time}å°æ—¶`, ...node })); const edgeArray = data.edges.map(edge => ({ id: edge.id, from: edge.source, to: edge.target, color: { color: edge.relation_type === 'prerequisite' ? 'var(--primary-color)' : '#95a5a6', highlight: '#e74c3c' }, width: edge.strength * 3, arrows: { to: { enabled: true, scaleFactor: 0.8 } }, dashes: edge.relation_type === 'related', title: `${edge.relation_type}: ${edge.description || ''}`, ...edge })); nodes = new vis.DataSet(nodeArray); edges = new vis.DataSet(edgeArray); const container = document.getElementById('prerequisite-graph'); const graphData = { nodes: nodes, edges: edges }; const options = { layout: { hierarchical: { enabled: true, direction: 'UD', sortMethod: 'directed', levelSeparation: 150, nodeSpacing: 200 } }, physics: { enabled: false }, interaction: { hover: true, selectConnectedEdges: true }, nodes: { borderWidth: 2, shadow: true }, edges: { shadow: true, smooth: { type: 'cubicBezier', forceDirection: 'vertical', roundness: 0.4 } } }; network = new vis.Network(container, graphData, options); network.on('click', function(params) { if (params.nodes.length > 0) { const nodeId = params.nodes[0]; showConceptDetails(nodeId); } else { hideConceptDetails(); } }); document.getElementById('loading').style.display = 'none'; document.getElementById('prerequisite-graph').style.display = 'block'; } function showConceptDetails(nodeId) { const node = nodes.get(nodeId); if (!node) return; document.getElementById('no-selection').style.display = 'none'; document.getElementById('concept-details').style.display = 'block'; document.getElementById('concept-name').textContent = node.name; document.getElementById('concept-description').textContent = node.description || 'æš‚æ— æè¿°'; document.getElementById('concept-difficulty').textContent = `éš¾åº¦: ${node.difficulty_level}`; document.getElementById('concept-time').textContent = `é¢„è®¡å­¦æ—¶: ${node.estimated_learning_time}å°æ—¶`; document.getElementById('concept-importance').textContent = `é‡è¦åº¦: ${node.importance_weight}`; document.getElementById('concept-category').textContent = `åˆ†ç±»: ${node.category}`; const connectedEdges = edges.get({ filter: edge => edge.from === nodeId || edge.to === nodeId }); const prerequisites = []; const dependents = []; connectedEdges.forEach(edge => { if (edge.to === nodeId && edge.relation_type === 'prerequisite') { const prereqNode = nodes.get(edge.from); if (prereqNode) prerequisites.push(prereqNode.name); } else if (edge.from === nodeId && edge.relation_type === 'prerequisite') { const depNode = nodes.get(edge.to); if (depNode) dependents.push(depNode.name); } }); const prereqContainer = document.getElementById('prerequisites-tags'); prereqContainer.innerHTML = prerequisites.length > 0 ? prerequisites.map(name => `<span class="concept-tag">${name}</span>`).join('') : '<span style="color: #a0aec0;">æ— å‰ç½®è¦æ±‚</span>'; const depContainer = document.getElementById('dependents-tags'); depContainer.innerHTML = dependents.length > 0 ? dependents.map(name => `<span class="concept-tag">${name}</span>`).join('') : '<span style="color: #a0aec0;">æ— åç»­æ¦‚å¿µ</span>'; } function hideConceptDetails() { document.getElementById('no-selection').style.display = 'block'; document.getElementById('concept-details').style.display = 'none'; } function showError(message) { document.getElementById('loading').innerHTML = ` <div style="color: #e74c3c;"><span>âŒ ${message}</span></div> `; } document.getElementById('category-select').addEventListener('change', function() { console.log('åˆ†ç±»åˆ‡æ¢:', this.value); }); document.getElementById('layout-select').addEventListener('change', function() { if (!network) return; const layout = this.value; let options = {}; switch(layout) { case 'hierarchical': options = { layout: { hierarchical: { enabled: true, direction: 'UD', sortMethod: 'directed' } }, physics: { enabled: false } }; break; case 'force': options = { layout: { hierarchical: { enabled: false } }, physics: { enabled: true } }; break; case 'circular': options = { layout: { hierarchical: { enabled: false } }, physics: { enabled: false } }; break; } network.setOptions(options); }); document.getElementById('reset-view').addEventListener('click', function() { if (network) { network.fit(); } }); document.addEventListener('DOMContentLoaded', function() { initGraph(); });</script>
{% endblock %}
