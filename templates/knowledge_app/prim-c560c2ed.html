{% extends 'knowledge_app/base.html' %}

{% block title %}{{ page_title|default:"æœ€å°ç”Ÿæˆæ ‘â€”â€”Primç®—æ³•" }} - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<div class="page-container fade-in">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a>
        <span>></span>
        <span>{{ breadcrumb_category|default:"æ•°æ®ç»“æ„" }}</span>
        <span>></span>
        <span>{{ page_title|default:"æœ€å°ç”Ÿæˆæ ‘â€”â€”Primç®—æ³•" }}</span>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header slide-in-left">
        <h1>
            <span class="page-icon">{{ page_icon|default:"ğŸŒ²" }}</span>
            {{ page_title|default:"æœ€å°ç”Ÿæˆæ ‘â€”â€”Primç®—æ³•" }}
        </h1>
        <p>{{ page_description|default:"ä»ç‚¹å¼€å§‹é€æ­¥ç”Ÿé•¿çš„æœ€å°ç”Ÿæˆæ ‘ç®—æ³•ï¼Œä½“éªŒç‚¹ä¼˜å…ˆçš„è´ªå¿ƒç­–ç•¥" }}</p>
    </div>

    <!-- ğŸ“‹ ç®—æ³•æ¦‚è¿° -->
    <div class="content-card slide-in-right">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“‹</span>
                ç®—æ³•æ¦‚è¿°
            </h2>
            <div class="overview-content">
                <div class="concept-intro">
                    <p><strong>æ ¸å¿ƒæ€æƒ³ï¼š</strong>Primç®—æ³•å°±åƒç§æ¤ä¸€æ£µæ ‘â€”â€”ä»ä¸€ä¸ªæ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæ¯æ¬¡é€‰æ‹©èƒ½ä»¥æœ€å°ä»£ä»·è¿æ¥åˆ°å·²æœ‰æ ‘çš„æ–°èŠ‚ç‚¹ï¼Œè®©æ ‘é€æ­¥"ç”Ÿé•¿"ç›´åˆ°è¦†ç›–æ‰€æœ‰èŠ‚ç‚¹ï¼</p>
                </div>

                <div class="unified-grid unified-grid-2">
                    <div class="info-box info-box-info">
                        <h3>ğŸ·ï¸ ç®—æ³•ç‰¹ç‚¹</h3>
                        <ul>
                            <li><strong>ç‚¹ä¼˜å…ˆç­–ç•¥ï¼š</strong>ç»´æŠ¤å·²é€‰é¡¶ç‚¹é›†åˆï¼Œé€ç‚¹æ‰©å±•</li>
                            <li><strong>è´ªå¿ƒé€‰æ‹©ï¼š</strong>æ¯æ¬¡é€‰æ‹©æœ€å°æƒé‡çš„å‰²è¾¹</li>
                            <li><strong>è¿é€šæ€§ä¿è¯ï¼š</strong>å§‹ç»ˆä¿æŒç”Ÿæˆçš„å­å›¾è¿é€š</li>
                            <li><strong>ä¼˜å…ˆé˜Ÿåˆ—ï¼š</strong>é«˜æ•ˆç»´æŠ¤å€™é€‰è¾¹é›†åˆ</li>
                            <li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong>ç¨ å¯†å›¾ä¸­è¡¨ç°æ›´ä¼˜</li>
                        </ul>
                    </div>

                    <div class="info-box info-box-success">
                        <h3>ğŸ“Š å¤æ‚åº¦åˆ†æ</h3>
                        <div class="complexity-table">
                            <div class="complexity-row">
                                <span class="complexity-label">æ—¶é—´å¤æ‚åº¦ï¼š</span>
                                <span class="complexity-value">O(VÂ²) æˆ– O(E log V)</span>
                            </div>
                            <div class="complexity-row">
                                <span class="complexity-label">ç©ºé—´å¤æ‚åº¦ï¼š</span>
                                <span class="complexity-value">O(V)</span>
                            </div>
                            <div class="complexity-row">
                                <span class="complexity-label">æœ€ä¼˜åœºæ™¯ï¼š</span>
                                <span class="complexity-value">ç¨ å¯†å›¾</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”„ Prim vs Kruskalå¯¹æ¯” -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ”„</span>
                Prim vs Kruskal ç®—æ³•å¯¹æ¯”
            </h2>

            <div class="algorithm-comparison">
                <div class="comparison-grid">
                    <div class="algorithm-card prim-card">
                        <h3>ğŸŒ² Primç®—æ³•</h3>
                        <div class="algorithm-features">
                            <div class="feature-item">
                                <span class="feature-icon">ğŸ¯</span>
                                <div>
                                    <strong>ç­–ç•¥ï¼š</strong>ç‚¹ä¼˜å…ˆï¼ˆé¡¶ç‚¹é©±åŠ¨ï¼‰
                                    <p>ä»èµ·ç‚¹å¼€å§‹ï¼Œé€æ­¥æ‰©å±•å·²é€‰é¡¶ç‚¹é›†åˆ</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ğŸŒ±</span>
                                <div>
                                    <strong>ç”Ÿé•¿æ¨¡å¼ï¼š</strong>ä»å†…å‘å¤–
                                    <p>åƒæ ‘ä¸€æ ·ä»æ ¹éƒ¨å¼€å§‹ç”Ÿé•¿</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ğŸ”—</span>
                                <div>
                                    <strong>è¿é€šæ€§ï¼š</strong>å§‹ç»ˆä¿æŒè¿é€š
                                    <p>ä»»ä½•æ—¶åˆ»éƒ½æ˜¯ä¸€æ£µæ ‘</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ğŸ“ˆ</span>
                                <div>
                                    <strong>é€‚ç”¨ï¼š</strong>ç¨ å¯†å›¾
                                    <p>è¾¹å¤šæ—¶ä¼˜åŠ¿æ˜æ˜¾</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="algorithm-card kruskal-card">
                        <h3>ğŸŒ³ Kruskalç®—æ³•</h3>
                        <div class="algorithm-features">
                            <div class="feature-item">
                                <span class="feature-icon">ğŸ¯</span>
                                <div>
                                    <strong>ç­–ç•¥ï¼š</strong>è¾¹ä¼˜å…ˆï¼ˆè¾¹é©±åŠ¨ï¼‰
                                    <p>æŒ‰è¾¹æƒé‡æ’åºï¼Œé€è¾¹æ·»åŠ </p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ğŸ§©</span>
                                <div>
                                    <strong>ç”Ÿé•¿æ¨¡å¼ï¼š</strong>åˆ†æ•£åˆå¹¶
                                    <p>å¤šä¸ªè¿é€šåˆ†é‡é€æ¸åˆå¹¶</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ğŸ”</span>
                                <div>
                                    <strong>ç¯æ£€æµ‹ï¼š</strong>å¹¶æŸ¥é›†
                                    <p>ä½¿ç”¨å¹¶æŸ¥é›†é¿å…å½¢æˆç¯</p>
                                </div>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ğŸ“‰</span>
                                <div>
                                    <strong>é€‚ç”¨ï¼š</strong>ç¨€ç–å›¾
                                    <p>è¾¹å°‘æ—¶æ•ˆç‡æ›´é«˜</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="comparison-summary">
                    <h4>ğŸ¯ é€‰æ‹©å»ºè®®</h4>
                    <div class="selection-guide">
                        <div class="guide-item">
                            <strong>é€‰æ‹©Primï¼š</strong>ç¨ å¯†å›¾(Eæ¥è¿‘VÂ²)ã€éœ€è¦ä»ç‰¹å®šèµ·ç‚¹å¼€å§‹ã€å†…å­˜å—é™
                        </div>
                        <div class="guide-item">
                            <strong>é€‰æ‹©Kruskalï¼š</strong>ç¨€ç–å›¾(Eè¿œå°äºVÂ²)ã€è¾¹æƒé‡åˆ†å¸ƒå¹¿æ³›ã€å¹¶è¡Œå¤„ç†
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“Š å¯è§†åŒ–å±•ç¤º -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“Š</span>
                å¯è§†åŒ–æ¼”ç¤º
            </h2>

            <div class="visualization-container">
                <h3>ğŸ¬ Primç®—æ³•åŠ¨ç”»æ¼”ç¤º</h3>

                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="demo-controls">
                    <div class="control-panel">
                        <button id="autoDemo" class="unified-btn unified-btn-success">ğŸš€ è‡ªåŠ¨æ¼”ç¤º</button>
                        <button id="stepDemo" class="unified-btn unified-btn-primary">ğŸ‘† å•æ­¥æ‰§è¡Œ</button>
                        <button id="resetDemo" class="unified-btn unified-btn-secondary">ğŸ”„ é‡ç½®</button>
                        <button id="randomGraph" class="unified-btn unified-btn-warning">ğŸ² éšæœºå›¾</button>
                    </div>
                    <div class="graph-options">
                        <label>èµ·å§‹èŠ‚ç‚¹ï¼š</label>
                        <select id="startNode">
                            <option value="0">èŠ‚ç‚¹ A (0)</option>
                            <option value="1">èŠ‚ç‚¹ B (1)</option>
                            <option value="2">èŠ‚ç‚¹ C (2)</option>
                            <option value="3">èŠ‚ç‚¹ D (3)</option>
                            <option value="4">èŠ‚ç‚¹ E (4)</option>
                        </select>
                        <label>é€Ÿåº¦ï¼š</label>
                        <input type="range" id="speedSlider" min="500" max="3000" value="1500" step="250">
                        <span id="speedLabel">æ­£å¸¸</span>
                    </div>
                </div>

                <div class="demo-info" id="demoInfo">
                    ç‚¹å‡»"è‡ªåŠ¨æ¼”ç¤º"è§‚çœ‹Primç®—æ³•çš„å®Œæ•´æ‰§è¡Œè¿‡ç¨‹
                </div>

                <!-- ä¸»è¦å¯è§†åŒ–åŒºåŸŸ -->
                <div class="visualization-area">
                    <!-- å›¾ç»“æ„å±•ç¤º -->
                    <div class="graph-display">
                        <canvas id="primCanvas" width="600" height="450"></canvas>
                        <div class="graph-legend">
                            <div class="legend-item">
                                <div class="legend-dot unvisited"></div>
                                <span>æœªè®¿é—®èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot visited"></div>
                                <span>å·²è®¿é—®èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-dot current"></div>
                                <span>å½“å‰èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-line mst-edge"></div>
                                <span>MSTè¾¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-line candidate-edge"></div>
                                <span>å€™é€‰è¾¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-line current-edge"></div>
                                <span>å½“å‰é€‰æ‹©çš„è¾¹</span>
                            </div>
                        </div>
                    </div>

                    <!-- ä¼˜å…ˆé˜Ÿåˆ—çŠ¶æ€ -->
                    <div class="priority-queue-panel">
                        <h4>ğŸ” ä¼˜å…ˆé˜Ÿåˆ—çŠ¶æ€</h4>
                        <div class="queue-display" id="queueDisplay">
                            <div class="queue-header">
                                <span>æƒé‡</span>
                                <span>è¾¹</span>
                                <span>çŠ¶æ€</span>
                            </div>
                            <div class="queue-body" id="queueBody">
                                <div class="empty-queue">é˜Ÿåˆ—ä¸ºç©º</div>
                            </div>
                        </div>
                        <div class="algorithm-stats" id="algorithmStats">
                            <div>å·²è®¿é—®èŠ‚ç‚¹: <span id="visitedCount">0</span></div>
                            <div>MSTè¾¹æ•°: <span id="mstEdgeCount">0</span></div>
                            <div>å½“å‰æ€»æƒé‡: <span id="currentWeight">0</span></div>
                        </div>
                    </div>
                </div>

                <!-- æ­¥éª¤è¯¦è§£ -->
                <div class="step-details" id="stepDetails">
                    <h4>ğŸ“ æ‰§è¡Œæ­¥éª¤</h4>
                    <div class="step-list" id="stepList">
                        <div class="step-item">å‡†å¤‡å¼€å§‹Primç®—æ³•...</div>
                    </div>
                </div>
            </div>

            <!-- ç®—æ³•ä¼ªä»£ç  -->
            <div class="algorithm-pseudocode">
                <h3>ğŸ”§ Primç®—æ³•ä¼ªä»£ç </h3>
                <div class="pseudocode-container">
                    <pre class="pseudocode" id="pseudocode">
<span class="keyword">function</span> <span class="function">PrimMST</span>(<span class="param">graph, start</span>):
    <span class="comment">// 1. åˆå§‹åŒ–</span>
    <span class="variable">visited</span> â† <span class="function">æ–°å»ºç©ºé›†åˆ()</span>
    <span class="variable">mstEdges</span> â† <span class="function">æ–°å»ºç©ºåˆ—è¡¨()</span>
    <span class="variable">priorityQueue</span> â† <span class="function">æ–°å»ºä¼˜å…ˆé˜Ÿåˆ—()</span>

    <span class="comment">// 2. ä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹</span>
    <span class="function">visited.add</span>(<span class="variable">start</span>)

    <span class="comment">// 3. å°†èµ·å§‹èŠ‚ç‚¹çš„æ‰€æœ‰é‚»è¾¹åŠ å…¥é˜Ÿåˆ—</span>
    <span class="keyword">for each</span> <span class="variable">edge</span> <span class="keyword">from</span> <span class="variable">start</span>:
        <span class="function">priorityQueue.add</span>(<span class="variable">edge</span>, <span class="variable">edge.weight</span>)

    <span class="comment">// 4. é‡å¤ç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®</span>
    <span class="keyword">while</span> <span class="variable">visited.size</span> &lt; <span class="variable">graph.nodeCount</span>:
        <span class="comment">// 5. å–å‡ºæƒé‡æœ€å°çš„è¾¹</span>
        <span class="variable">minEdge</span> â† <span class="function">priorityQueue.extractMin</span>()

        <span class="comment">// 6. æ£€æŸ¥è¾¹çš„ç›®æ ‡èŠ‚ç‚¹æ˜¯å¦å·²è®¿é—®</span>
        <span class="keyword">if</span> <span class="variable">minEdge.to</span> <span class="keyword">not in</span> <span class="variable">visited</span>:
            <span class="comment">// 7. æ·»åŠ åˆ°MST</span>
            <span class="function">mstEdges.add</span>(<span class="variable">minEdge</span>)
            <span class="function">visited.add</span>(<span class="variable">minEdge.to</span>)

            <span class="comment">// 8. æ·»åŠ æ–°èŠ‚ç‚¹çš„é‚»è¾¹åˆ°é˜Ÿåˆ—</span>
            <span class="keyword">for each</span> <span class="variable">edge</span> <span class="keyword">from</span> <span class="variable">minEdge.to</span>:
                <span class="keyword">if</span> <span class="variable">edge.to</span> <span class="keyword">not in</span> <span class="variable">visited</span>:
                    <span class="function">priorityQueue.add</span>(<span class="variable">edge</span>, <span class="variable">edge.weight</span>)

    <span class="keyword">return</span> <span class="variable">mstEdges</span>
                    </pre>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ’» ä»£ç å®ç° -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ’»</span>
                ä»£ç å®ç°
            </h2>

            <div class="code-examples">
                <div class="code-tabs">
                    <button class="tab-btn active" data-lang="python">Python</button>
                    <button class="tab-btn" data-lang="java">Java</button>
                    <button class="tab-btn" data-lang="cpp">C++</button>
                </div>

                <!-- Python ä»£ç  -->
                <div class="code-content active" data-lang="python">
                    <div class="code-header">
                        <span>Primç®—æ³•å®ç° - Python</span>
                        <button class="copy-btn" data-clipboard-target="python-code">ğŸ“‹ å¤åˆ¶</button>
                    </div>
                    <pre id="python-code"><code>
import heapq
from collections import defaultdict

class Graph:
    def __init__(self):
        self.graph = defaultdict(list)
        self.vertices = set()

    def add_edge(self, u, v, weight):
        """æ·»åŠ æ— å‘è¾¹"""
        self.graph[u].append((v, weight))
        self.graph[v].append((u, weight))
        self.vertices.add(u)
        self.vertices.add(v)

    def prim_mst(self, start=None):
        """Primç®—æ³•æ±‚æœ€å°ç”Ÿæˆæ ‘"""
        if not self.vertices:
            return [], 0

        # é€‰æ‹©èµ·å§‹èŠ‚ç‚¹
        start = start if start is not None else next(iter(self.vertices))

        visited = set()
        mst_edges = []
        total_weight = 0

        # ä¼˜å…ˆé˜Ÿåˆ—å­˜å‚¨ (æƒé‡, èµ·ç‚¹, ç»ˆç‚¹)
        priority_queue = []

        # ä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹
        visited.add(start)

        # å°†èµ·å§‹èŠ‚ç‚¹çš„æ‰€æœ‰é‚»è¾¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—
        for neighbor, weight in self.graph[start]:
            heapq.heappush(priority_queue, (weight, start, neighbor))

        while priority_queue and len(visited) < len(self.vertices):
            weight, u, v = heapq.heappop(priority_queue)

            # å¦‚æœç›®æ ‡èŠ‚ç‚¹å·²ç»åœ¨MSTä¸­ï¼Œè·³è¿‡
            if v in visited:
                continue

            # æ·»åŠ è¾¹åˆ°MST
            visited.add(v)
            mst_edges.append((u, v, weight))
            total_weight += weight

            # å°†æ–°èŠ‚ç‚¹çš„é‚»è¾¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—
            for neighbor, edge_weight in self.graph[v]:
                if neighbor not in visited:
                    heapq.heappush(priority_queue, (edge_weight, v, neighbor))

        return mst_edges, total_weight

    def prim_mst_matrix(self, adj_matrix):
        """ä½¿ç”¨é‚»æ¥çŸ©é˜µçš„Primç®—æ³•å®ç°"""
        n = len(adj_matrix)
        if n == 0:
            return [], 0

        # åˆå§‹åŒ–
        visited = [False] * n
        min_weight = [float('inf')] * n
        parent = [-1] * n

        # ä»èŠ‚ç‚¹0å¼€å§‹
        min_weight[0] = 0
        mst_edges = []
        total_weight = 0

        for _ in range(n):
            # æ‰¾åˆ°æœªè®¿é—®èŠ‚ç‚¹ä¸­æƒé‡æœ€å°çš„
            min_val = float('inf')
            min_index = -1

            for v in range(n):
                if not visited[v] and min_weight[v] < min_val:
                    min_val = min_weight[v]
                    min_index = v

            # å°†èŠ‚ç‚¹åŠ å…¥MST
            visited[min_index] = True

            # æ·»åŠ è¾¹åˆ°ç»“æœï¼ˆé™¤äº†èµ·å§‹èŠ‚ç‚¹ï¼‰
            if parent[min_index] != -1:
                mst_edges.append((parent[min_index], min_index, min_val))
                total_weight += min_val

            # æ›´æ–°ç›¸é‚»èŠ‚ç‚¹çš„æœ€å°æƒé‡
            for v in range(n):
                if (not visited[v] and adj_matrix[min_index][v] > 0 and
                    adj_matrix[min_index][v] < min_weight[v]):
                    min_weight[v] = adj_matrix[min_index][v]
                    parent[v] = min_index

        return mst_edges, total_weight

def compare_algorithms():
    """æ¯”è¾ƒPrimå’ŒKruskalç®—æ³•"""
    # åˆ›å»ºæµ‹è¯•å›¾
    g = Graph()
    edges = [
        (0, 1, 2), (0, 3, 6), (1, 2, 3), (1, 3, 8),
        (1, 4, 5), (2, 4, 7), (3, 4, 9)
    ]

    for u, v, w in edges:
        g.add_edge(u, v, w)

    # Primç®—æ³•
    prim_mst, prim_weight = g.prim_mst(0)
    print("Primç®—æ³•ç»“æœ:")
    print(f"MSTè¾¹: {prim_mst}")
    print(f"æ€»æƒé‡: {prim_weight}")

    # ä¹Ÿå¯ä»¥å®ç°Kruskalè¿›è¡Œå¯¹æ¯”...

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # åˆ›å»ºå›¾
    g = Graph()

    # æ·»åŠ è¾¹ (èµ·ç‚¹, ç»ˆç‚¹, æƒé‡)
    edges = [
        ('A', 'B', 2), ('A', 'D', 6), ('B', 'C', 3),
        ('B', 'D', 8), ('B', 'E', 5), ('C', 'E', 7), ('D', 'E', 9)
    ]

    for u, v, weight in edges:
        g.add_edge(u, v, weight)

    # è¿è¡ŒPrimç®—æ³•
    mst, total_weight = g.prim_mst('A')

    print("æœ€å°ç”Ÿæˆæ ‘ (Primç®—æ³•):")
    for u, v, weight in mst:
        print(f"  {u} - {v} : {weight}")
    print(f"æ€»æƒé‡: {total_weight}")

    # ä½¿ç”¨é‚»æ¥çŸ©é˜µç‰ˆæœ¬
    adj_matrix = [
        [0, 2, 0, 6, 0],
        [2, 0, 3, 8, 5],
        [0, 3, 0, 0, 7],
        [6, 8, 0, 0, 9],
        [0, 5, 7, 9, 0]
    ]

    mst_matrix, weight_matrix = g.prim_mst_matrix(adj_matrix)
    print("\né‚»æ¥çŸ©é˜µç‰ˆæœ¬ç»“æœ:")
    print(f"MSTè¾¹: {mst_matrix}")
    print(f"æ€»æƒé‡: {weight_matrix}")
                    </code></pre>
                </div>

                <!-- Java ä»£ç  -->
                <div class="code-content" data-lang="java">
                    <div class="code-header">
                        <span>Primç®—æ³•å®ç° - Java</span>
                        <button class="copy-btn" data-clipboard-target="java-code">ğŸ“‹ å¤åˆ¶</button>
                    </div>
                    <pre id="java-code"><code>
import java.util.*;

class Edge implements Comparable&lt;Edge&gt; {
    int from, to, weight;

    public Edge(int from, int to, int weight) {
        this.from = from;
        this.to = to;
        this.weight = weight;
    }

    @Override
    public int compareTo(Edge other) {
        return Integer.compare(this.weight, other.weight);
    }

    @Override
    public String toString() {
        return String.format("(%d-%d:%d)", from, to, weight);
    }
}

public class PrimAlgorithm {

    // ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—çš„Primç®—æ³•
    public static List&lt;Edge&gt; primMST(List&lt;List&lt;Edge&gt;&gt; graph, int start) {
        int n = graph.size();
        boolean[] visited = new boolean[n];
        List&lt;Edge&gt; mst = new ArrayList&lt;&gt;();
        PriorityQueue&lt;Edge&gt; pq = new PriorityQueue&lt;&gt;();

        // ä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹
        visited[start] = true;

        // å°†èµ·å§‹èŠ‚ç‚¹çš„æ‰€æœ‰é‚»è¾¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—
        for (Edge edge : graph.get(start)) {
            pq.offer(edge);
        }

        while (!pq.isEmpty() && mst.size() < n - 1) {
            Edge minEdge = pq.poll();

            // å¦‚æœç›®æ ‡èŠ‚ç‚¹å·²è®¿é—®ï¼Œè·³è¿‡
            if (visited[minEdge.to]) {
                continue;
            }

            // æ·»åŠ è¾¹åˆ°MST
            mst.add(minEdge);
            visited[minEdge.to] = true;

            // æ·»åŠ æ–°èŠ‚ç‚¹çš„é‚»è¾¹
            for (Edge edge : graph.get(minEdge.to)) {
                if (!visited[edge.to]) {
                    pq.offer(edge);
                }
            }
        }

        return mst;
    }

    // ä½¿ç”¨é‚»æ¥çŸ©é˜µçš„Primç®—æ³•
    public static List&lt;Edge&gt; primMSTMatrix(int[][] adjMatrix) {
        int n = adjMatrix.length;
        boolean[] visited = new boolean[n];
        int[] minWeight = new int[n];
        int[] parent = new int[n];
        List&lt;Edge&gt; mst = new ArrayList&lt;&gt;();

        // åˆå§‹åŒ–
        Arrays.fill(minWeight, Integer.MAX_VALUE);
        Arrays.fill(parent, -1);
        minWeight[0] = 0; // ä»èŠ‚ç‚¹0å¼€å§‹

        for (int count = 0; count < n; count++) {
            // æ‰¾åˆ°æœªè®¿é—®èŠ‚ç‚¹ä¸­æƒé‡æœ€å°çš„
            int minVal = Integer.MAX_VALUE;
            int minIndex = -1;

            for (int v = 0; v < n; v++) {
                if (!visited[v] && minWeight[v] < minVal) {
                    minVal = minWeight[v];
                    minIndex = v;
                }
            }

            // å°†èŠ‚ç‚¹åŠ å…¥MST
            visited[minIndex] = true;

            // æ·»åŠ è¾¹åˆ°ç»“æœï¼ˆé™¤äº†èµ·å§‹èŠ‚ç‚¹ï¼‰
            if (parent[minIndex] != -1) {
                mst.add(new Edge(parent[minIndex], minIndex, minVal));
            }

            // æ›´æ–°ç›¸é‚»èŠ‚ç‚¹çš„æœ€å°æƒé‡
            for (int v = 0; v < n; v++) {
                if (!visited[v] && adjMatrix[minIndex][v] > 0 &&
                    adjMatrix[minIndex][v] < minWeight[v]) {
                    minWeight[v] = adjMatrix[minIndex][v];
                    parent[v] = minIndex;
                }
            }
        }

        return mst;
    }

    // è®¡ç®—MSTæ€»æƒé‡
    public static int calculateTotalWeight(List&lt;Edge&gt; mst) {
        return mst.stream().mapToInt(edge -> edge.weight).sum();
    }

    // åˆ›å»ºé‚»æ¥è¡¨
    public static List&lt;List&lt;Edge&gt;&gt; createGraph(int vertices, int[][] edges) {
        List&lt;List&lt;Edge&gt;&gt; graph = new ArrayList&lt;&gt;();

        for (int i = 0; i < vertices; i++) {
            graph.add(new ArrayList&lt;&gt;());
        }

        for (int[] edge : edges) {
            int u = edge[0], v = edge[1], w = edge[2];
            graph.get(u).add(new Edge(u, v, w));
            graph.get(v).add(new Edge(v, u, w));
        }

        return graph;
    }

    public static void main(String[] args) {
        // æµ‹è¯•æ•°æ®
        int[][] edges = {
            {0, 1, 2}, {0, 3, 6}, {1, 2, 3}, {1, 3, 8},
            {1, 4, 5}, {2, 4, 7}, {3, 4, 9}
        };

        // æ–¹æ³•1ï¼šä½¿ç”¨é‚»æ¥è¡¨å’Œä¼˜å…ˆé˜Ÿåˆ—
        List&lt;List&lt;Edge&gt;&gt; graph = createGraph(5, edges);
        List&lt;Edge&gt; mst1 = primMST(graph, 0);

        System.out.println("Primç®—æ³•ç»“æœï¼ˆä¼˜å…ˆé˜Ÿåˆ—ç‰ˆæœ¬ï¼‰:");
        for (Edge edge : mst1) {
            System.out.println("è¾¹ " + edge.from + "-" + edge.to + " : " + edge.weight);
        }
        System.out.println("æ€»æƒé‡: " + calculateTotalWeight(mst1));

        // æ–¹æ³•2ï¼šä½¿ç”¨é‚»æ¥çŸ©é˜µ
        int[][] adjMatrix = {
            {0, 2, 0, 6, 0},
            {2, 0, 3, 8, 5},
            {0, 3, 0, 0, 7},
            {6, 8, 0, 0, 9},
            {0, 5, 7, 9, 0}
        };

        List&lt;Edge&gt; mst2 = primMSTMatrix(adjMatrix);
        System.out.println("\nPrimç®—æ³•ç»“æœï¼ˆé‚»æ¥çŸ©é˜µç‰ˆæœ¬ï¼‰:");
        for (Edge edge : mst2) {
            System.out.println("è¾¹ " + edge.from + "-" + edge.to + " : " + edge.weight);
        }
        System.out.println("æ€»æƒé‡: " + calculateTotalWeight(mst2));
    }
}

// å›¾ç±»å°è£…
class PrimGraph {
    private List&lt;List&lt;Edge&gt;&gt; adjList;
    private int vertices;

    public PrimGraph(int vertices) {
        this.vertices = vertices;
        this.adjList = new ArrayList&lt;&gt;();
        for (int i = 0; i < vertices; i++) {
            adjList.add(new ArrayList&lt;&gt;());
        }
    }

    public void addEdge(int from, int to, int weight) {
        adjList.get(from).add(new Edge(from, to, weight));
        adjList.get(to).add(new Edge(to, from, weight));
    }

    public List&lt;Edge&gt; findMST(int start) {
        return PrimAlgorithm.primMST(adjList, start);
    }

    public void printGraph() {
        for (int i = 0; i < vertices; i++) {
            System.out.print("é¡¶ç‚¹ " + i + ": ");
            for (Edge edge : adjList.get(i)) {
                System.out.print("(" + edge.to + "," + edge.weight + ") ");
            }
            System.out.println();
        }
    }
}
                    </code></pre>
                </div>

                <!-- C++ ä»£ç  -->
                <div class="code-content" data-lang="cpp">
                    <div class="code-header">
                        <span>Primç®—æ³•å®ç° - C++</span>
                        <button class="copy-btn" data-clipboard-target="cpp-code">ğŸ“‹ å¤åˆ¶</button>
                    </div>
                    <pre id="cpp-code"><code>
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;queue&gt;
#include &lt;climits&gt;
#include &lt;algorithm&gt;

using namespace std;

struct Edge {
    int from, to, weight;

    Edge(int f, int t, int w) : from(f), to(t), weight(w) {}

    bool operator>(const Edge& other) const {
        return weight > other.weight;
    }
};

class PrimAlgorithm {
private:
    vector&lt;vector&lt;Edge&gt;&gt; graph;
    int vertices;

public:
    PrimAlgorithm(int v) : vertices(v) {
        graph.resize(v);
    }

    void addEdge(int from, int to, int weight) {
        graph[from].emplace_back(from, to, weight);
        graph[to].emplace_back(to, from, weight);
    }

    // ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—çš„Primç®—æ³•
    vector&lt;Edge&gt; primMST(int start = 0) {
        vector&lt;bool&gt; visited(vertices, false);
        vector&lt;Edge&gt; mst;
        priority_queue&lt;Edge, vector&lt;Edge&gt;, greater&lt;Edge&gt;&gt; pq;

        // ä»èµ·å§‹èŠ‚ç‚¹å¼€å§‹
        visited[start] = true;

        // å°†èµ·å§‹èŠ‚ç‚¹çš„æ‰€æœ‰é‚»è¾¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—
        for (const auto& edge : graph[start]) {
            pq.push(edge);
        }

        while (!pq.empty() && mst.size() < vertices - 1) {
            Edge minEdge = pq.top();
            pq.pop();

            // å¦‚æœç›®æ ‡èŠ‚ç‚¹å·²è®¿é—®ï¼Œè·³è¿‡
            if (visited[minEdge.to]) {
                continue;
            }

            // æ·»åŠ è¾¹åˆ°MST
            mst.push_back(minEdge);
            visited[minEdge.to] = true;

            // æ·»åŠ æ–°èŠ‚ç‚¹çš„é‚»è¾¹
            for (const auto& edge : graph[minEdge.to]) {
                if (!visited[edge.to]) {
                    pq.push(edge);
                }
            }
        }

        return mst;
    }

    // ä½¿ç”¨é‚»æ¥çŸ©é˜µçš„Primç®—æ³•ï¼ˆæ›´é«˜æ•ˆçš„ç‰ˆæœ¬ï¼‰
    vector&lt;Edge&gt; primMSTMatrix(const vector&lt;vector&lt;int&gt;&gt;& adjMatrix) {
        int n = adjMatrix.size();
        vector&lt;bool&gt; visited(n, false);
        vector&lt;int&gt; minWeight(n, INT_MAX);
        vector&lt;int&gt; parent(n, -1);
        vector&lt;Edge&gt; mst;

        // ä»èŠ‚ç‚¹0å¼€å§‹
        minWeight[0] = 0;

        for (int count = 0; count < n; count++) {
            // æ‰¾åˆ°æœªè®¿é—®èŠ‚ç‚¹ä¸­æƒé‡æœ€å°çš„
            int minVal = INT_MAX;
            int minIndex = -1;

            for (int v = 0; v < n; v++) {
                if (!visited[v] && minWeight[v] < minVal) {
                    minVal = minWeight[v];
                    minIndex = v;
                }
            }

            // å°†èŠ‚ç‚¹åŠ å…¥MST
            visited[minIndex] = true;

            // æ·»åŠ è¾¹åˆ°ç»“æœï¼ˆé™¤äº†èµ·å§‹èŠ‚ç‚¹ï¼‰
            if (parent[minIndex] != -1) {
                mst.emplace_back(parent[minIndex], minIndex, minVal);
            }

            // æ›´æ–°ç›¸é‚»èŠ‚ç‚¹çš„æœ€å°æƒé‡
            for (int v = 0; v < n; v++) {
                if (!visited[v] && adjMatrix[minIndex][v] > 0 &&
                    adjMatrix[minIndex][v] < minWeight[v]) {
                    minWeight[v] = adjMatrix[minIndex][v];
                    parent[v] = minIndex;
                }
            }
        }

        return mst;
    }

    // è®¡ç®—MSTæ€»æƒé‡
    int calculateTotalWeight(const vector&lt;Edge&gt;& mst) {
        int total = 0;
        for (const auto& edge : mst) {
            total += edge.weight;
        }
        return total;
    }

    // æ‰“å°MST
    void printMST(const vector&lt;Edge&gt;& mst) {
        cout << "æœ€å°ç”Ÿæˆæ ‘çš„è¾¹:\n";
        for (const auto& edge : mst) {
            cout << "è¾¹ " << edge.from << "-" << edge.to
                 << " : æƒé‡ " << edge.weight << "\n";
        }
        cout << "æ€»æƒé‡: " << calculateTotalWeight(mst) << "\n";
    }
};

// æ¯”è¾ƒä¸¤ç§å®ç°çš„æ€§èƒ½
class PerformanceTest {
public:
    static void comparePrimImplementations() {
        // åˆ›å»ºæµ‹è¯•å›¾
        PrimAlgorithm prim(5);

        // æ·»åŠ è¾¹
        vector&lt;vector&lt;int&gt;&gt; edges = {
            {0, 1, 2}, {0, 3, 6}, {1, 2, 3}, {1, 3, 8},
            {1, 4, 5}, {2, 4, 7}, {3, 4, 9}
        };

        for (const auto& edge : edges) {
            prim.addEdge(edge[0], edge[1], edge[2]);
        }

        // æ–¹æ³•1ï¼šä¼˜å…ˆé˜Ÿåˆ—ç‰ˆæœ¬
        cout << "=== ä¼˜å…ˆé˜Ÿåˆ—ç‰ˆæœ¬ ===\n";
        auto mst1 = prim.primMST(0);
        prim.printMST(mst1);

        // æ–¹æ³•2ï¼šé‚»æ¥çŸ©é˜µç‰ˆæœ¬
        cout << "\n=== é‚»æ¥çŸ©é˜µç‰ˆæœ¬ ===\n";
        vector&lt;vector&lt;int&gt;&gt; adjMatrix = {
            {0, 2, 0, 6, 0},
            {2, 0, 3, 8, 5},
            {0, 3, 0, 0, 7},
            {6, 8, 0, 0, 9},
            {0, 5, 7, 9, 0}
        };

        auto mst2 = prim.primMSTMatrix(adjMatrix);
        prim.printMST(mst2);
    }
};

// é«˜çº§ç‰¹æ€§ï¼šå¸¦è·¯å¾„è¿½è¸ªçš„Primç®—æ³•
class AdvancedPrim {
public:
    struct MSTResult {
        vector&lt;Edge&gt; edges;
        int totalWeight;
        vector&lt;int&gt; constructionOrder;
    };

    static MSTResult primWithTrace(PrimAlgorithm& prim, int start) {
        // è¿™é‡Œå¯ä»¥å®ç°å¸¦è¯¦ç»†è¿½è¸ªä¿¡æ¯çš„ç‰ˆæœ¬
        MSTResult result;
        result.edges = prim.primMST(start);
        result.totalWeight = prim.calculateTotalWeight(result.edges);

        // è®°å½•æ„é€ é¡ºåº
        for (size_t i = 0; i < result.edges.size(); i++) {
            result.constructionOrder.push_back(i);
        }

        return result;
    }
};

int main() {
    cout << "Primç®—æ³•æ¼”ç¤º\n";
    cout << "===============\n";

    // åŸºæœ¬æµ‹è¯•
    PrimAlgorithm prim(5);

    // æ„å»ºæµ‹è¯•å›¾
    vector&lt;vector&lt;int&gt;&gt; testEdges = {
        {0, 1, 2}, {0, 3, 6}, {1, 2, 3}, {1, 3, 8},
        {1, 4, 5}, {2, 4, 7}, {3, 4, 9}
    };

    for (const auto& edge : testEdges) {
        prim.addEdge(edge[0], edge[1], edge[2]);
    }

    // ä»ä¸åŒèµ·ç‚¹è¿è¡Œç®—æ³•
    cout << "ä»èŠ‚ç‚¹0å¼€å§‹:\n";
    auto mst0 = prim.primMST(0);
    prim.printMST(mst0);

    cout << "\nä»èŠ‚ç‚¹2å¼€å§‹:\n";
    auto mst2 = prim.primMST(2);
    prim.printMST(mst2);

    // æ€§èƒ½æ¯”è¾ƒ
    cout << "\n=== æ€§èƒ½æ¯”è¾ƒ ===\n";
    PerformanceTest::comparePrimImplementations();

    return 0;
}
                    </code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… å­¦ä¹ æ£€éªŒ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">âœ…</span>
                å­¦ä¹ æ£€éªŒ
            </h2>

            <div class="quiz-container">
                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜1ï¼šç®—æ³•ç­–ç•¥å·®å¼‚</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>Primç®—æ³•ä¸ºä»€ä¹ˆè¢«ç§°ä¸º"ç‚¹ä¼˜å…ˆ"ç®—æ³•ï¼Œè€ŒKruskalè¢«ç§°ä¸º"è¾¹ä¼˜å…ˆ"ï¼Ÿå®ƒä»¬çš„æ ¹æœ¬å·®å¼‚æ˜¯ä»€ä¹ˆï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer1')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer1">
                        <p><strong>ç­”æ¡ˆï¼š</strong>Primä»èŠ‚ç‚¹è§’åº¦æ€è€ƒï¼Œæ¯æ¬¡æ‰©å±•ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼›Kruskalä»è¾¹è§’åº¦æ€è€ƒï¼Œæ¯æ¬¡é€‰æ‹©ä¸€æ¡æœ€å°è¾¹ã€‚</p>
                        <p><strong>è¯¦ç»†è§£é‡Šï¼š</strong>â‘ <strong>Primç®—æ³•ï¼š</strong>ç»´æŠ¤ä¸€ä¸ªå·²è®¿é—®èŠ‚ç‚¹é›†åˆï¼Œæ¯æ¬¡é€‰æ‹©è¿æ¥å·²è®¿é—®å’Œæœªè®¿é—®èŠ‚ç‚¹çš„æœ€å°æƒé‡è¾¹ï¼Œé€æ­¥"ç”Ÿé•¿"MSTï¼›â‘¡<strong>Kruskalç®—æ³•ï¼š</strong>å°†æ‰€æœ‰è¾¹æ’åºï¼Œæ¯æ¬¡é€‰æ‹©æƒé‡æœ€å°ä¸”ä¸å½¢æˆç¯çš„è¾¹ï¼›â‘¢<strong>æœ¬è´¨å·®å¼‚ï¼š</strong>Primä¿è¯ä»»ä½•æ—¶åˆ»éƒ½æ˜¯è¿é€šçš„ï¼ŒKruskalå…è®¸å¤šä¸ªè¿é€šåˆ†é‡æœ€ååˆå¹¶ã€‚</p>
                    </div>
                </div>

                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜2ï¼šå¤æ‚åº¦åˆ†æ</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>Primç®—æ³•æœ‰O(VÂ²)å’ŒO(E log V)ä¸¤ç§å¤æ‚åº¦ï¼Œåˆ†åˆ«å¯¹åº”ä»€ä¹ˆå®ç°æ–¹å¼ï¼Ÿä»€ä¹ˆæ—¶å€™é€‰æ‹©å“ªç§ï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer2')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer2">
                        <p><strong>ç­”æ¡ˆï¼š</strong>O(VÂ²)å¯¹åº”é‚»æ¥çŸ©é˜µå®ç°ï¼ŒO(E log V)å¯¹åº”ä¼˜å…ˆé˜Ÿåˆ—å®ç°ã€‚</p>
                        <p><strong>é€‰æ‹©ç­–ç•¥ï¼š</strong>â‘ <strong>O(VÂ²)ç‰ˆæœ¬ï¼š</strong>é€‚åˆç¨ å¯†å›¾(Eæ¥è¿‘VÂ²)ï¼Œç©ºé—´æ•ˆç‡é«˜ï¼Œä»£ç ç®€å•ï¼›â‘¡<strong>O(E log V)ç‰ˆæœ¬ï¼š</strong>é€‚åˆç¨€ç–å›¾(Eè¿œå°äºVÂ²)ï¼Œä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼›â‘¢<strong>ä¸´ç•Œç‚¹ï¼š</strong>å½“E > VÂ²/log Væ—¶é€‰æ‹©O(VÂ²)ç‰ˆæœ¬æ›´ä¼˜ã€‚</p>
                    </div>
                </div>

                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜3ï¼šèµ·ç‚¹é€‰æ‹©å½±å“</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>Primç®—æ³•çš„èµ·ç‚¹é€‰æ‹©ä¼šå½±å“æœ€ç»ˆçš„MSTç»“æœå—ï¼Ÿä¼šå½±å“ç®—æ³•æ€§èƒ½å—ï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer3')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer3">
                        <p><strong>ç­”æ¡ˆï¼š</strong>ä¸å½±å“MSTçš„æ€»æƒé‡ï¼Œä½†å¯èƒ½å½±å“å…·ä½“è¾¹çš„é€‰æ‹©é¡ºåºå’Œæ€§èƒ½ã€‚</p>
                        <p><strong>è¯¦ç»†åˆ†æï¼š</strong>â‘ <strong>ç»“æœä¸€è‡´æ€§ï¼š</strong>MSTæ€»æƒé‡ç›¸åŒï¼Œä½†å…·ä½“è¾¹å¯èƒ½ä¸åŒï¼ˆå½“æœ‰å¤šæ¡ç›¸åŒæƒé‡è¾¹æ—¶ï¼‰ï¼›â‘¡<strong>æ€§èƒ½å½±å“ï¼š</strong>èµ·ç‚¹é€‰æ‹©å¯èƒ½å½±å“ä¼˜å…ˆé˜Ÿåˆ—å¤§å°å’Œç®—æ³•è¿è¡Œæ—¶é—´ï¼›â‘¢<strong>æœ€ä¼˜é€‰æ‹©ï¼š</strong>ç†è®ºä¸Šé€‰æ‹©åº¦æ•°æœ€å¤§çš„èŠ‚ç‚¹ä½œä¸ºèµ·ç‚¹å¯èƒ½æ›´ä¼˜ï¼Œä½†å®é™…å·®å¼‚é€šå¸¸ä¸å¤§ã€‚</p>
                    </div>
                </div>

                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜4ï¼šä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>åœ¨Primç®—æ³•ä¸­ï¼Œå¦‚ä½•å¤„ç†ä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„"è¿‡æœŸè¾¹"ï¼ˆç›®æ ‡èŠ‚ç‚¹å·²è¢«è®¿é—®çš„è¾¹ï¼‰ï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer4')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer4">
                        <p><strong>ç­”æ¡ˆï¼š</strong>æƒ°æ€§åˆ é™¤ - åœ¨å¼¹å‡ºæ—¶æ£€æŸ¥ç›®æ ‡èŠ‚ç‚¹æ˜¯å¦å·²è®¿é—®ï¼Œå·²è®¿é—®åˆ™è·³è¿‡ã€‚</p>
                        <p><strong>å®ç°ç­–ç•¥ï¼š</strong>â‘ <strong>æƒ°æ€§åˆ é™¤ï¼š</strong>ä¸ä¸»åŠ¨åˆ é™¤è¿‡æœŸè¾¹ï¼Œå¼¹å‡ºæ—¶æ£€æŸ¥ï¼›â‘¡<strong>ä¸»åŠ¨åˆ é™¤ï¼š</strong>ä½¿ç”¨æ”¯æŒåˆ é™¤çš„ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå¦‚ç´¢å¼•ä¼˜å…ˆé˜Ÿåˆ—ï¼‰ï¼›â‘¢<strong>æƒè¡¡è€ƒè™‘ï¼š</strong>æƒ°æ€§åˆ é™¤å®ç°ç®€å•ä½†å¯èƒ½æµªè´¹ç©ºé—´ï¼Œä¸»åŠ¨åˆ é™¤æ•ˆç‡æ›´é«˜ä½†å®ç°å¤æ‚ï¼›â‘£<strong>å®é™…é€‰æ‹©ï¼š</strong>å¯¹äºå¤§å¤šæ•°åº”ç”¨ï¼Œæƒ°æ€§åˆ é™¤å·²è¶³å¤Ÿã€‚</p>
                    </div>
                </div>

                <div class="quiz-item">
                    <h3>ğŸ¤” æ€è€ƒé¢˜5ï¼šç®—æ³•å˜ç§åº”ç”¨</h3>
                    <p><strong>é—®é¢˜ï¼š</strong>å¦‚ä½•ä¿®æ”¹Primç®—æ³•æ¥è§£å†³"æœ€å¤§ç”Ÿæˆæ ‘"é—®é¢˜ï¼Ÿè¿˜èƒ½è§£å†³ä»€ä¹ˆå…¶ä»–é—®é¢˜ï¼Ÿ</p>
                    <button class="answer-btn" onclick="toggleAnswer('answer5')">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div class="answer-content" id="answer5">
                        <p><strong>ç­”æ¡ˆï¼š</strong>å°†æœ€å°å †æ”¹ä¸ºæœ€å¤§å †ï¼Œæˆ–è€…å°†æ‰€æœ‰æƒé‡å–è´Ÿå€¼åæ±‚MSTã€‚</p>
                        <p><strong>æ‰©å±•åº”ç”¨ï¼š</strong>â‘ <strong>æœ€å¤§ç”Ÿæˆæ ‘ï¼š</strong>ä¿®æ”¹ä¼˜å…ˆé˜Ÿåˆ—ä¸ºæœ€å¤§å †ï¼›â‘¡<strong>æ¬¡å°ç”Ÿæˆæ ‘ï¼š</strong>åœ¨MSTåŸºç¡€ä¸Šæ›¿æ¢ä¸€æ¡è¾¹ï¼›â‘¢<strong>k-MSTé—®é¢˜ï¼š</strong>æ‰¾åŒ…å«kä¸ªèŠ‚ç‚¹çš„æœ€å°ç”Ÿæˆæ ‘ï¼›â‘£<strong>ç“¶é¢ˆç”Ÿæˆæ ‘ï¼š</strong>æœ€å°åŒ–æœ€å¤§è¾¹æƒé‡çš„ç”Ÿæˆæ ‘ï¼›â‘¤<strong>æœ‰æ ¹MSTï¼š</strong>æŒ‡å®šæ ¹èŠ‚ç‚¹çš„æœ‰å‘MSTé—®é¢˜ã€‚</p>
                    </div>
                </div>
            </div>

            <!-- è¿›é˜¶å­¦ä¹ å»ºè®® -->
            <div class="learning-progress">
                <h3>ğŸ“š è¿›é˜¶å­¦ä¹ è·¯å¾„</h3>
                <div class="progress-steps">
                    <div class="progress-step completed">
                        <span class="step-number">1</span>
                        <div class="step-content">
                            <h4>Primç®—æ³•åŸºç¡€</h4>
                            <p>æŒæ¡ç‚¹ä¼˜å…ˆçš„è´ªå¿ƒç­–ç•¥</p>
                        </div>
                    </div>
                    <div class="progress-step next">
                        <span class="step-number">2</span>
                        <div class="step-content">
                            <h4>Kruskalå¯¹æ¯”</h4>
                            <p>ç†è§£ä¸¤ç§ç®—æ³•çš„é€‚ç”¨åœºæ™¯</p>
                        </div>
                    </div>
                    <div class="progress-step">
                        <span class="step-number">3</span>
                        <div class="step-content">
                            <h4>é«˜çº§MSTé—®é¢˜</h4>
                            <p>æ¬¡å°ç”Ÿæˆæ ‘ã€åŠ¨æ€MST</p>
                        </div>
                    </div>
                    <div class="progress-step">
                        <span class="step-number">4</span>
                        <div class="step-content">
                            <h4>å®é™…åº”ç”¨</h4>
                            <p>ç½‘ç»œè®¾è®¡ã€èšç±»ç®—æ³•</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary">
            <span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a>
        <a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary">
            <span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a>
    </div>
</div>

<!-- CSSæ ·å¼ -->
<style>
.overview-content {
    margin-top: 20px;
}

.concept-intro {
    background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    border-left: 4px solid #2196F3;
}

.complexity-table {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.complexity-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.complexity-label {
    font-weight: bold;
    color: #333;
}

.complexity-value {
    color: #2196F3;
    font-family: 'Monaco', 'Consolas', monospace;
    font-weight: bold;
}

.algorithm-comparison {
    margin-top: 20px;
}

.comparison-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 30px;
    margin-bottom: 30px;
}

.algorithm-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
}

.prim-card {
    border-left: 5px solid #4CAF50;
}

.kruskal-card {
    border-left: 5px solid #FF9800;
}

.algorithm-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, transparent, rgba(255,255,255,0.1));
    border-radius: 50%;
    transform: translate(30px, -30px);
}

.algorithm-card h3 {
    color: #333;
    margin-bottom: 20px;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.algorithm-features {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.feature-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.feature-item:hover {
    background: #e9ecef;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.feature-icon {
    font-size: 1.5em;
    flex-shrink: 0;
    margin-top: 2px;
}

.feature-item strong {
    color: #333;
    display: block;
    margin-bottom: 5px;
}

.feature-item p {
    color: #666;
    margin: 0;
    font-size: 14px;
    line-height: 1.4;
}

.comparison-summary {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    border-left: 5px solid #2196F3;
}

.comparison-summary h4 {
    color: #333;
    margin-bottom: 15px;
    font-size: 1.2rem;
}

.selection-guide {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.guide-item {
    padding: 12px 15px;
    background: #f0f7ff;
    border-radius: 8px;
    border-left: 3px solid #2196F3;
    font-size: 14px;
}

.visualization-container {
    margin-top: 20px;
}

.demo-controls {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

.control-panel {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.graph-options {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
}

.graph-options label {
    font-weight: bold;
    color: #333;
}

.graph-options select,
.graph-options input[type="range"] {
    padding: 6px 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.demo-info {
    text-align: center;
    padding: 15px;
    background: #e3f2fd;
    border-radius: 6px;
    font-weight: bold;
    color: #1976D2;
    margin-bottom: 20px;
}

.visualization-area {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.graph-display {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

#primCanvas {
    border: 2px solid #ddd;
    border-radius: 8px;
    display: block;
    margin: 0 auto;
}

.graph-legend {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    padding: 5px 10px;
    background: #f5f5f5;
    border-radius: 15px;
}

.legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 1px solid #333;
}

.legend-dot.unvisited {
    background: #e0e0e0;
}

.legend-dot.visited {
    background: #4CAF50;
}

.legend-dot.current {
    background: #FF5722;
}

.legend-line {
    width: 20px;
    height: 3px;
    border-radius: 2px;
}

.legend-line.mst-edge {
    background: #4CAF50;
}

.legend-line.candidate-edge {
    background: #2196F3;
}

.legend-line.current-edge {
    background: #FF9800;
}

.priority-queue-panel {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.priority-queue-panel h4 {
    margin: 0 0 15px 0;
    color: #333;
    text-align: center;
}

.queue-display {
    margin-bottom: 20px;
}

.queue-header {
    display: grid;
    grid-template-columns: 60px 1fr 60px;
    gap: 10px;
    padding: 10px;
    background: #f5f5f5;
    border-radius: 5px 5px 0 0;
    font-weight: bold;
    text-align: center;
    font-size: 12px;
}

.queue-body {
    min-height: 100px;
    max-height: 200px;
    border: 1px solid #ddd;
    border-radius: 0 0 5px 5px;
    overflow-y: auto;
}

.empty-queue {
    padding: 40px 20px;
    text-align: center;
    color: #999;
    font-style: italic;
}

.queue-item {
    display: grid;
    grid-template-columns: 60px 1fr 60px;
    gap: 10px;
    padding: 8px 10px;
    border-bottom: 1px solid #eee;
    font-size: 12px;
    text-align: center;
    align-items: center;
}

.queue-item:hover {
    background: #f0f7ff;
}

.queue-item.priority {
    background: #fff3e0;
    font-weight: bold;
}

.algorithm-stats {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.algorithm-stats div {
    padding: 8px 12px;
    background: #f5f5f5;
    border-radius: 4px;
    font-size: 14px;
    display: flex;
    justify-content: space-between;
}

.algorithm-stats span {
    font-weight: bold;
    color: #2196F3;
}

.step-details {
    grid-column: 1 / -1;
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.step-details h4 {
    margin: 0 0 15px 0;
    color: #333;
}

.step-list {
    max-height: 200px;
    overflow-y: auto;
}

.step-item {
    padding: 8px 12px;
    border-left: 4px solid #e0e0e0;
    margin-bottom: 6px;
    background: #f9f9f9;
    border-radius: 0 4px 4px 0;
    font-size: 14px;
}

.step-item.active {
    border-left-color: #FF5722;
    background: #fff3e0;
    font-weight: bold;
}

.step-item.completed {
    border-left-color: #4CAF50;
    background: #e8f5e8;
    color: #2E7D32;
}

.algorithm-pseudocode {
    margin-top: 30px;
}

.pseudocode-container {
    background: #1e1e1e;
    border-radius: 8px;
    overflow: hidden;
}

.pseudocode {
    color: #f8f8f2;
    font-family: 'Monaco', 'Consolas', monospace;
    font-size: 14px;
    line-height: 1.6;
    padding: 20px;
    margin: 0;
    overflow-x: auto;
}

.keyword {
    color: #66d9ef;
    font-weight: bold;
}

.function {
    color: #a6e22e;
}

.param {
    color: #fd971f;
}

.variable {
    color: #f92672;
}

.comment {
    color: #75715e;
    font-style: italic;
}

.code-examples {
    margin-top: 30px;
}

.code-tabs {
    display: flex;
    margin-bottom: 0;
    border-bottom: 2px solid #e0e0e0;
}

.tab-btn {
    padding: 12px 24px;
    background: #f5f5f5;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
}

.tab-btn.active {
    background: #2196F3;
    color: white;
    border-bottom-color: #2196F3;
}

.code-content {
    display: none;
    background: #1e1e1e;
    border-radius: 0 0 8px 8px;
    overflow: hidden;
}

.code-content.active {
    display: block;
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background: #333;
    color: white;
    font-size: 14px;
}

.copy-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: background 0.2s;
}

.copy-btn:hover {
    background: #45a049;
}

pre {
    margin: 0;
    overflow-x: auto;
}

code {
    color: #f8f8f2;
    font-family: 'Monaco', 'Consolas', monospace;
    font-size: 14px;
    line-height: 1.5;
    display: block;
    padding: 20px;
}

.quiz-container {
    margin-top: 20px;
}

.quiz-item {
    margin-bottom: 25px;
    padding: 20px;
    background: white;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.quiz-item h3 {
    color: #1976D2;
    margin-top: 0;
}

.answer-btn {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    margin: 10px 0;
    font-weight: bold;
    transition: background 0.2s;
}

.answer-btn:hover {
    background: #45a049;
}

.answer-content {
    display: none;
    margin-top: 15px;
    padding: 15px;
    background: #e8f5e8;
    border-radius: 5px;
    border-left: 4px solid #4CAF50;
}

.answer-content.show {
    display: block;
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.learning-progress {
    margin-top: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
    border-radius: 10px;
}

.progress-steps {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.progress-step {
    display: flex;
    align-items: center;
    padding: 15px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    opacity: 0.6;
    transition: all 0.3s;
}

.progress-step.completed {
    opacity: 1;
    border-left: 4px solid #4CAF50;
}

.progress-step.next {
    opacity: 1;
    border-left: 4px solid #FF9800;
    transform: scale(1.05);
}

.step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    background: #e0e0e0;
    color: white;
    border-radius: 50%;
    margin-right: 15px;
    font-weight: bold;
}

.progress-step.completed .step-number {
    background: #4CAF50;
}

.progress-step.next .step-number {
    background: #FF9800;
}

.step-content h4 {
    margin: 0 0 5px 0;
    color: #333;
}

.step-content p {
    margin: 0;
    color: #666;
    font-size: 14px;
}

@media (max-width: 1200px) {
    .visualization-area {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .comparison-grid {
        grid-template-columns: 1fr;
    }

    .control-panel {
        flex-direction: column;
        align-items: stretch;
    }

    .graph-options {
        flex-direction: column;
        align-items: stretch;
    }

    .progress-steps {
        grid-template-columns: 1fr;
    }

    .code-tabs {
        flex-wrap: wrap;
    }

    .tab-btn {
        flex: 1;
        min-width: 80px;
    }

    .graph-legend {
        flex-direction: column;
        align-items: center;
        gap: 8px;
    }
}
</style>

<!-- JavaScript -->
<script>
// Primç®—æ³•å¯è§†åŒ–ç›¸å…³å˜é‡
let canvas, ctx;
let demoInProgress = false;
let stepByStep = false;
let currentStep = 0;
let animationSpeed = 1500;

// å›¾æ•°æ®ç»“æ„
let nodes = [];
let edges = [];
let visitedNodes = new Set();
let mstEdges = [];
let priorityQueue = [];
let currentWeight = 0;

// é¢œè‰²é…ç½®
const colors = {
    unvisited: '#e0e0e0',
    visited: '#4CAF50',
    current: '#FF5722',
    mstEdge: '#4CAF50',
    candidateEdge: '#2196F3',
    currentEdge: '#FF9800',
    nodeText: 'white',
    edgeText: '#333'
};

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    canvas = document.getElementById('primCanvas');
    ctx = canvas.getContext('2d');

    initializeDemo();

    // ç»‘å®šäº‹ä»¶
    document.getElementById('autoDemo').addEventListener('click', startAutoDemo);
    document.getElementById('stepDemo').addEventListener('click', startStepDemo);
    document.getElementById('resetDemo').addEventListener('click', resetDemo);
    document.getElementById('randomGraph').addEventListener('click', generateRandomGraph);

    document.getElementById('startNode').addEventListener('change', resetDemo);

    document.getElementById('speedSlider').addEventListener('input', function() {
        animationSpeed = parseInt(this.value);
        updateSpeedLabel();
    });

    updateSpeedLabel();
    drawGraph();
});

function initializeDemo() {
    // åˆå§‹åŒ–èŠ‚ç‚¹
    nodes = [
        {id: 0, x: 120, y: 80, label: 'A'},
        {id: 1, x: 280, y: 120, label: 'B'},
        {id: 2, x: 400, y: 80, label: 'C'},
        {id: 3, x: 350, y: 250, label: 'D'},
        {id: 4, x: 150, y: 280, label: 'E'}
    ];

    // åˆå§‹åŒ–è¾¹
    edges = [
        {from: 0, to: 1, weight: 2},
        {from: 0, to: 4, weight: 6},
        {from: 1, to: 2, weight: 3},
        {from: 1, to: 3, weight: 8},
        {from: 1, to: 4, weight: 5},
        {from: 2, to: 3, weight: 7},
        {from: 3, to: 4, weight: 9}
    ];

    resetState();
}

function resetState() {
    visitedNodes.clear();
    mstEdges = [];
    priorityQueue = [];
    currentWeight = 0;
    currentStep = 0;
    demoInProgress = false;
    stepByStep = false;

    updateQueueDisplay();
    updateStatsDisplay();
    updateStepsDisplay();

    document.getElementById('demoInfo').textContent = 'ç‚¹å‡»"è‡ªåŠ¨æ¼”ç¤º"è§‚çœ‹Primç®—æ³•çš„å®Œæ•´æ‰§è¡Œè¿‡ç¨‹';
}

function generateRandomGraph() {
    const nodeCount = 5 + Math.floor(Math.random() * 2);
    nodes = [];
    edges = [];

    // ç”ŸæˆéšæœºèŠ‚ç‚¹ä½ç½®
    for (let i = 0; i < nodeCount; i++) {
        const angle = (2 * Math.PI * i) / nodeCount;
        const radius = 120 + Math.random() * 80;
        const centerX = 300;
        const centerY = 200;

        nodes.push({
            id: i,
            x: centerX + radius * Math.cos(angle) + (Math.random() - 0.5) * 40,
            y: centerY + radius * Math.sin(angle) + (Math.random() - 0.5) * 40,
            label: String.fromCharCode(65 + i)
        });
    }

    // ç”Ÿæˆéšæœºè¾¹ï¼Œç¡®ä¿å›¾è¿é€š
    const edgeSet = new Set();

    // å…ˆç”Ÿæˆä¸€ä¸ªç”Ÿæˆæ ‘ç¡®ä¿è¿é€š
    for (let i = 1; i < nodeCount; i++) {
        const from = Math.floor(Math.random() * i);
        const weight = Math.floor(Math.random() * 9) + 1;
        const edgeKey = from < i ? `${from}-${i}` : `${i}-${from}`;
        edgeSet.add(edgeKey);
        edges.push({from, to: i, weight});
    }

    // æ·»åŠ é¢å¤–çš„è¾¹
    const maxEdges = Math.min(nodeCount * (nodeCount - 1) / 2, nodeCount + 3);
    while (edges.length < maxEdges && edgeSet.size < maxEdges) {
        const from = Math.floor(Math.random() * nodeCount);
        const to = Math.floor(Math.random() * nodeCount);
        if (from !== to) {
            const edgeKey = from < to ? `${from}-${to}` : `${to}-${from}`;
            if (!edgeSet.has(edgeKey)) {
                edgeSet.add(edgeKey);
                const weight = Math.floor(Math.random() * 9) + 1;
                edges.push({from, to, weight});
            }
        }
    }

    // æ›´æ–°èµ·å§‹èŠ‚ç‚¹é€‰é¡¹
    updateStartNodeOptions();
    resetState();
    drawGraph();

    document.getElementById('demoInfo').textContent = 'ç”Ÿæˆäº†æ–°çš„éšæœºå›¾ï¼Œç‚¹å‡»"è‡ªåŠ¨æ¼”ç¤º"æŸ¥çœ‹ç®—æ³•æ‰§è¡Œè¿‡ç¨‹';
}

function updateStartNodeOptions() {
    const startNodeSelect = document.getElementById('startNode');
    startNodeSelect.innerHTML = '';

    for (let node of nodes) {
        const option = document.createElement('option');
        option.value = node.id;
        option.textContent = `èŠ‚ç‚¹ ${node.label} (${node.id})`;
        startNodeSelect.appendChild(option);
    }
}

async function startAutoDemo() {
    if (demoInProgress) return;

    demoInProgress = true;
    stepByStep = false;

    // ç¦ç”¨æ§åˆ¶æŒ‰é’®
    const buttons = document.querySelectorAll('.control-panel button:not(#resetDemo)');
    buttons.forEach(btn => btn.disabled = true);
    document.getElementById('autoDemo').textContent = 'æ¼”ç¤ºè¿›è¡Œä¸­...';

    await performPrimAlgorithm();

    // é‡æ–°å¯ç”¨æŒ‰é’®
    buttons.forEach(btn => btn.disabled = false);
    document.getElementById('autoDemo').textContent = 'ğŸš€ è‡ªåŠ¨æ¼”ç¤º';
    demoInProgress = false;
}

async function startStepDemo() {
    if (demoInProgress) return;

    if (!stepByStep) {
        stepByStep = true;
        document.getElementById('stepDemo').textContent = 'â–¶ï¸ ä¸‹ä¸€æ­¥';
        initializePrim();
    } else {
        await performPrimStep();

        if (visitedNodes.size === nodes.length) {
            document.getElementById('stepDemo').textContent = 'ğŸ‘† å•æ­¥æ‰§è¡Œ';
            stepByStep = false;
            addStep('Primç®—æ³•å®Œæˆï¼');
        }
    }
}

function resetDemo() {
    demoInProgress = false;
    stepByStep = false;

    document.getElementById('autoDemo').textContent = 'ğŸš€ è‡ªåŠ¨æ¼”ç¤º';
    document.getElementById('autoDemo').disabled = false;
    document.getElementById('stepDemo').textContent = 'ğŸ‘† å•æ­¥æ‰§è¡Œ';

    resetState();
    drawGraph();
}

async function performPrimAlgorithm() {
    initializePrim();

    while (visitedNodes.size < nodes.length) {
        await performPrimStep();
        if (!stepByStep) {
            await sleep(animationSpeed);
        }
    }

    addStep(`Primç®—æ³•å®Œæˆï¼æœ€å°ç”Ÿæˆæ ‘æ€»æƒé‡ï¼š${currentWeight}`);
    document.getElementById('demoInfo').textContent = 'Primç®—æ³•æ¼”ç¤ºå®Œæˆï¼ğŸ‰';
}

function initializePrim() {
    const startNodeId = parseInt(document.getElementById('startNode').value) || 0;

    // é‡ç½®çŠ¶æ€
    resetState();

    // æ·»åŠ èµ·å§‹èŠ‚ç‚¹åˆ°å·²è®¿é—®é›†åˆ
    visitedNodes.add(startNodeId);

    // å°†èµ·å§‹èŠ‚ç‚¹çš„æ‰€æœ‰é‚»è¾¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—
    for (let edge of edges) {
        if (edge.from === startNodeId && !visitedNodes.has(edge.to)) {
            priorityQueue.push({...edge});
        } else if (edge.to === startNodeId && !visitedNodes.has(edge.from)) {
            priorityQueue.push({from: edge.to, to: edge.from, weight: edge.weight});
        }
    }

    // æŒ‰æƒé‡æ’åºä¼˜å…ˆé˜Ÿåˆ—
    priorityQueue.sort((a, b) => a.weight - b.weight);

    const startNodeLabel = nodes[startNodeId].label;
    addStep(`åˆå§‹åŒ–ï¼šä»èŠ‚ç‚¹${startNodeLabel}å¼€å§‹ï¼Œå°†å…¶é‚»è¾¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—`);

    updateQueueDisplay();
    updateStatsDisplay();
    drawGraph();
}

async function performPrimStep() {
    if (priorityQueue.length === 0 || visitedNodes.size === nodes.length) {
        return;
    }

    // æ‰¾åˆ°æƒé‡æœ€å°ä¸”ç›®æ ‡èŠ‚ç‚¹æœªè®¿é—®çš„è¾¹
    let minEdgeIndex = -1;
    for (let i = 0; i < priorityQueue.length; i++) {
        if (!visitedNodes.has(priorityQueue[i].to)) {
            minEdgeIndex = i;
            break;
        }
    }

    if (minEdgeIndex === -1) {
        addStep('ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ²¡æœ‰æœ‰æ•ˆè¾¹ï¼Œç®—æ³•ç»“æŸ');
        return;
    }

    // å–å‡ºæœ€å°è¾¹
    const minEdge = priorityQueue.splice(minEdgeIndex, 1)[0];

    // æ·»åŠ åˆ°MST
    mstEdges.push(minEdge);
    visitedNodes.add(minEdge.to);
    currentWeight += minEdge.weight;

    const fromLabel = nodes[minEdge.from].label;
    const toLabel = nodes[minEdge.to].label;
    addStep(`é€‰æ‹©è¾¹ ${fromLabel}-${toLabel} (æƒé‡:${minEdge.weight})ï¼Œå°†èŠ‚ç‚¹${toLabel}åŠ å…¥MST`);

    // å°†æ–°èŠ‚ç‚¹çš„é‚»è¾¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—
    for (let edge of edges) {
        if (edge.from === minEdge.to && !visitedNodes.has(edge.to)) {
            priorityQueue.push({...edge});
        } else if (edge.to === minEdge.to && !visitedNodes.has(edge.from)) {
            priorityQueue.push({from: edge.to, to: edge.from, weight: edge.weight});
        }
    }

    // é‡æ–°æ’åºä¼˜å…ˆé˜Ÿåˆ—
    priorityQueue.sort((a, b) => a.weight - b.weight);

    updateQueueDisplay();
    updateStatsDisplay();
    drawGraph();
}

function drawGraph() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // ç»˜åˆ¶ç½‘æ ¼
    drawGrid();

    // ç»˜åˆ¶è¾¹
    for (let edge of edges) {
        drawEdge(edge);
    }

    // ç»˜åˆ¶MSTè¾¹
    for (let edge of mstEdges) {
        drawMSTEdge(edge);
    }

    // ç»˜åˆ¶å€™é€‰è¾¹
    if (priorityQueue.length > 0) {
        const nextEdge = priorityQueue.find(edge => !visitedNodes.has(edge.to));
        if (nextEdge) {
            drawCandidateEdge(nextEdge);
        }
    }

    // ç»˜åˆ¶èŠ‚ç‚¹
    for (let node of nodes) {
        drawNode(node);
    }
}

function drawGrid() {
    ctx.strokeStyle = 'rgba(200, 200, 200, 0.2)';
    ctx.lineWidth = 1;
    const gridSize = 30;

    for (let x = 0; x < canvas.width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
    }

    for (let y = 0; y < canvas.height; y += gridSize) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }
}

function drawEdge(edge) {
    const fromNode = nodes[edge.from];
    const toNode = nodes[edge.to];

    ctx.strokeStyle = '#ddd';
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';

    ctx.beginPath();
    ctx.moveTo(fromNode.x, fromNode.y);
    ctx.lineTo(toNode.x, toNode.y);
    ctx.stroke();

    // ç»˜åˆ¶æƒé‡
    drawEdgeWeight(edge, '#666', false);
}

function drawMSTEdge(edge) {
    const fromNode = nodes[edge.from];
    const toNode = nodes[edge.to];

    ctx.strokeStyle = colors.mstEdge;
    ctx.lineWidth = 5;
    ctx.lineCap = 'round';
    ctx.shadowColor = colors.mstEdge;
    ctx.shadowBlur = 10;

    ctx.beginPath();
    ctx.moveTo(fromNode.x, fromNode.y);
    ctx.lineTo(toNode.x, toNode.y);
    ctx.stroke();

    ctx.shadowBlur = 0;

    // ç»˜åˆ¶æƒé‡
    drawEdgeWeight(edge, 'white', true);
}

function drawCandidateEdge(edge) {
    const fromNode = nodes[edge.from];
    const toNode = nodes[edge.to];

    ctx.strokeStyle = colors.currentEdge;
    ctx.lineWidth = 4;
    ctx.lineCap = 'round';
    ctx.setLineDash([8, 4]);

    ctx.beginPath();
    ctx.moveTo(fromNode.x, fromNode.y);
    ctx.lineTo(toNode.x, toNode.y);
    ctx.stroke();

    ctx.setLineDash([]);

    // ç»˜åˆ¶æƒé‡
    drawEdgeWeight(edge, colors.currentEdge, true);
}

function drawEdgeWeight(edge, color, highlighted) {
    const fromNode = nodes[edge.from];
    const toNode = nodes[edge.to];
    const midX = (fromNode.x + toNode.x) / 2;
    const midY = (fromNode.y + toNode.y) / 2;

    const bgColor = highlighted ? color : 'white';
    const textColor = highlighted && color === 'white' ? '#333' :
                     highlighted ? 'white' : color;

    const padding = 8;
    const width = 24;
    const height = 18;

    ctx.fillStyle = bgColor;
    ctx.fillRect(midX - width/2, midY - height/2, width, height);

    ctx.strokeStyle = highlighted ? 'transparent' : '#ddd';
    ctx.lineWidth = 1;
    ctx.strokeRect(midX - width/2, midY - height/2, width, height);

    ctx.fillStyle = textColor;
    ctx.font = 'bold 12px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(edge.weight.toString(), midX, midY);
}

function drawNode(node) {
    let nodeColor = colors.unvisited;
    let textColor = '#333';

    if (visitedNodes.has(node.id)) {
        nodeColor = colors.visited;
        textColor = colors.nodeText;
    }

    const radius = 25;

    // ç»˜åˆ¶èŠ‚ç‚¹é˜´å½±
    if (visitedNodes.has(node.id)) {
        ctx.shadowColor = colors.visited;
        ctx.shadowBlur = 15;
    }

    // ç»˜åˆ¶èŠ‚ç‚¹
    ctx.fillStyle = nodeColor;
    ctx.beginPath();
    ctx.arc(node.x, node.y, radius, 0, 2 * Math.PI);
    ctx.fill();

    ctx.shadowBlur = 0;

    // ç»˜åˆ¶è¾¹æ¡†
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 2;
    ctx.stroke();

    // ç»˜åˆ¶æ ‡ç­¾
    ctx.fillStyle = textColor;
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(node.label, node.x, node.y);
}

function updateQueueDisplay() {
    const queueBody = document.getElementById('queueBody');

    if (priorityQueue.length === 0) {
        queueBody.innerHTML = '<div class="empty-queue">é˜Ÿåˆ—ä¸ºç©º</div>';
        return;
    }

    // è¿‡æ»¤å‡ºæœ‰æ•ˆè¾¹ï¼ˆç›®æ ‡èŠ‚ç‚¹æœªè®¿é—®ï¼‰
    const validEdges = priorityQueue.filter(edge => !visitedNodes.has(edge.to));

    if (validEdges.length === 0) {
        queueBody.innerHTML = '<div class="empty-queue">æ— æœ‰æ•ˆå€™é€‰è¾¹</div>';
        return;
    }

    queueBody.innerHTML = '';

    // æ˜¾ç¤ºå‰10ä¸ªè¾¹
    const displayEdges = validEdges.slice(0, 10);
    displayEdges.forEach((edge, index) => {
        const item = document.createElement('div');
        item.className = 'queue-item' + (index === 0 ? ' priority' : '');

        const fromLabel = nodes[edge.from].label;
        const toLabel = nodes[edge.to].label;

        item.innerHTML = `
            <span>${edge.weight}</span>
            <span>${fromLabel}-${toLabel}</span>
            <span>${index === 0 ? 'ä¸‹ä¸€ä¸ª' : 'ç­‰å¾…'}</span>
        `;

        queueBody.appendChild(item);
    });

    if (validEdges.length > 10) {
        const moreItem = document.createElement('div');
        moreItem.className = 'queue-item';
        moreItem.innerHTML = `
            <span>...</span>
            <span>è¿˜æœ‰${validEdges.length - 10}æ¡è¾¹</span>
            <span>ç­‰å¾…</span>
        `;
        queueBody.appendChild(moreItem);
    }
}

function updateStatsDisplay() {
    document.getElementById('visitedCount').textContent = visitedNodes.size;
    document.getElementById('mstEdgeCount').textContent = mstEdges.length;
    document.getElementById('currentWeight').textContent = currentWeight;
}

function updateStepsDisplay() {
    const stepList = document.getElementById('stepList');

    if (!window.stepHistory) {
        window.stepHistory = ['å‡†å¤‡å¼€å§‹Primç®—æ³•...'];
    }

    stepList.innerHTML = '';

    window.stepHistory.forEach((step, index) => {
        const item = document.createElement('div');
        let className = 'step-item';

        if (index === window.stepHistory.length - 1) {
            className += ' active';
        } else {
            className += ' completed';
        }

        item.className = className;
        item.textContent = step;
        stepList.appendChild(item);
    });

    // æ»šåŠ¨åˆ°æœ€æ–°æ­¥éª¤
    stepList.scrollTop = stepList.scrollHeight;
}

function addStep(message) {
    if (!window.stepHistory) {
        window.stepHistory = [];
    }
    window.stepHistory.push(message);
    updateStepsDisplay();
}

function updateSpeedLabel() {
    const speed = parseInt(document.getElementById('speedSlider').value);
    const label = document.getElementById('speedLabel');

    if (speed <= 750) {
        label.textContent = 'å¾ˆå¿«';
    } else if (speed <= 1250) {
        label.textContent = 'è¾ƒå¿«';
    } else if (speed <= 1750) {
        label.textContent = 'æ­£å¸¸';
    } else if (speed <= 2250) {
        label.textContent = 'è¾ƒæ…¢';
    } else {
        label.textContent = 'å¾ˆæ…¢';
    }
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// ä»£ç æ ‡ç­¾é¡µåˆ‡æ¢
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.code-content').forEach(c => c.classList.remove('active'));

        this.classList.add('active');
        const lang = this.getAttribute('data-lang');
        document.querySelector(`.code-content[data-lang="${lang}"]`).classList.add('active');
    });
});

// å¤åˆ¶ä»£ç åŠŸèƒ½
document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const targetId = this.getAttribute('data-clipboard-target');
        const codeElement = document.getElementById(targetId);

        if (codeElement) {
            const textarea = document.createElement('textarea');
            textarea.value = codeElement.textContent;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            const originalText = this.textContent;
            this.textContent = 'âœ… å·²å¤åˆ¶';
            setTimeout(() => {
                this.textContent = originalText;
            }, 2000);
        }
    });
});

// ç­”æ¡ˆåˆ‡æ¢åŠŸèƒ½
function toggleAnswer(answerId) {
    const answerElement = document.getElementById(answerId);
    const button = answerElement.previousElementSibling;

    if (answerElement.classList.contains('show')) {
        answerElement.classList.remove('show');
        button.textContent = 'ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ';
    } else {
        answerElement.classList.add('show');
        button.textContent = 'éšè—ç­”æ¡ˆ';
    }
}
</script>

{% endblock %}