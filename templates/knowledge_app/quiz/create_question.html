{% extends 'knowledge_app/quiz/base_quiz.html' %}

{% block title %}添加题目 - {{ library.name }} - {{ block.super }}{% endblock %}

{% block quiz_breadcrumb %}
<div class="quiz-breadcrumb"><a href="{% url 'knowledge_app:quiz_dashboard' %}">🏠 个人题库</a><span class="quiz-breadcrumb-separator">></span><a href="{% url 'knowledge_app:quiz_library_list' %}">📚 题库列表</a><span class="quiz-breadcrumb-separator">></span><a href="{% url 'knowledge_app:quiz_library_detail' library.id %}">{{ library.name }}</a><span class="quiz-breadcrumb-separator">></span><span>➕ 添加题目</span></div>
{% endblock %}

{% block quiz_content %}
<div class="quiz-card"><div class="quiz-card-header"><h1 class="quiz-card-title">➕ 添加题目</h1><p class="quiz-card-subtitle">为 "{{ library.name }}" 添加新题目</p></div><div class="quiz-card-body"><form method="post" id="questionForm" enctype="multipart/form-data" style="max-width: 800px; margin: 0 auto;">
            {% csrf_token %}
            
            <!-- 题目类型 --><div class="quiz-form-group"><label for="question_type" class="quiz-form-label"><span>🎯</span><span>题目类型 *</span></label><select id="question_type" name="question_type" class="quiz-form-control" required onchange="toggleOptions()"><option value="">请选择题目类型</option><option value="single_choice">🔘 单选题</option><option value="multiple_choice">☑️ 多选题</option><option value="fill_blank">📝 填空题</option><option value="short_answer">💬 简答题</option></select></div><!-- 题目标题 --><div class="quiz-form-group"><label for="title" class="quiz-form-label"><span>📋</span><span>题目标题 *</span></label><input type="text" 
                       id="title" 
                       name="title" 
                       class="quiz-form-control" 
                       placeholder="简短描述题目内容..."
                       required
                       maxlength="200"></div><!-- 题目内容 --><div class="quiz-form-group"><label for="content" class="quiz-form-label"><span>📝</span><span>题目内容 *</span></label><textarea id="content"
                          name="content"
                          class="quiz-form-control"
                          rows="4"
                          placeholder="详细的题目描述..."
                          required></textarea></div><!-- 题目图片 --><div class="quiz-form-group"><label for="question_image" class="quiz-form-label"><span>🖼️</span><span>题目图片</span></label><div style="border: 2px dashed var(--quiz-gray-300); border-radius: var(--quiz-radius-lg); padding: 2rem; text-align: center; background: var(--quiz-gray-50);"><input type="file"
                           id="question_image"
                           name="question_image"
                           accept="image/*"
                           style="display: none;"
                           onchange="previewImage(this, 'question_preview')"><div id="question_preview" style="margin-bottom: 1rem;"><div style="font-size: 3rem; color: var(--quiz-gray-400); margin-bottom: 1rem;">📷</div><p style="color: var(--quiz-gray-600); margin: 0;">点击上传题目图片</p></div><button type="button" class="quiz-btn quiz-btn-outline" onclick="document.getElementById('question_image').click()" style="color: var(--quiz-primary);"><span>📁</span><span>选择图片</span></button></div><div style="font-size: 0.9rem; color: var(--quiz-gray-500); margin-top: 0.5rem;">
                    支持 JPG、PNG、GIF 格式，建议大小不超过 5MB
                </div></div><!-- 选择题选项 --><div id="options_section" style="display: none;"><div class="quiz-form-group"><label class="quiz-form-label"><span>📋</span><span>选项设置</span></label><div id="options_container"><!-- 选项将通过JavaScript动态生成 --></div><button type="button" id="add_option" class="quiz-btn quiz-btn-outline" style="margin-top: 1rem;"><span>➕</span><span>添加选项</span></button></div></div><!-- 正确答案 --><div class="quiz-form-group"><label for="correct_answer" class="quiz-form-label"><span>✅</span><span>正确答案 *</span></label><div id="answer_input_container"><textarea id="correct_answer" 
                              name="correct_answer" 
                              class="quiz-form-control" 
                              rows="2"
                              placeholder="输入正确答案..."
                              required></textarea></div><div id="answer_help" style="font-size: 0.9rem; color: var(--quiz-gray-500); margin-top: 0.5rem;"><!-- 帮助文本将通过JavaScript动态更新 --></div></div><!-- 答案解析 --><div class="quiz-form-group"><label for="explanation" class="quiz-form-label"><span>💡</span><span>答案解析</span></label><textarea id="explanation" 
                          name="explanation" 
                          class="quiz-form-control" 
                          rows="3"
                          placeholder="解释为什么这是正确答案，提供学习要点..."></textarea></div><!-- 难度等级 --><div class="quiz-form-group"><label for="difficulty" class="quiz-form-label"><span>⭐</span><span>难度等级</span></label><select id="difficulty" name="difficulty" class="quiz-form-control"><option value="1">🟢 简单</option><option value="2" selected>🟡 中等</option><option value="3">🔴 困难</option></select></div><!-- 标签 --><div class="quiz-form-group"><label for="tags" class="quiz-form-label"><span>🏷️</span><span>题目标签</span></label><input type="text" 
                       id="tags" 
                       name="tags" 
                       class="quiz-form-control" 
                       placeholder="用逗号分隔多个标签，例如：算法,数据结构,基础"><div style="font-size: 0.9rem; color: var(--quiz-gray-500); margin-top: 0.5rem;">
                    标签有助于分类管理和筛选题目
                </div>
                {% if tags %}
                <div style="margin-top: 1rem;"><div style="font-size: 0.9rem; color: var(--quiz-gray-600); margin-bottom: 0.5rem;">常用标签：</div><div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        {% for tag in tags %}
                        <span class="quiz-tag" style="cursor: pointer;" onclick="addTag('{{ tag.name }}')">{{ tag.name }}</span>
                        {% endfor %}
                    </div></div>
                {% endif %}
            </div><!-- 提交按钮 --><div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;"><button type="submit" class="quiz-btn quiz-btn-primary" style="min-width: 120px; color: white;"><span>✨</span><span>添加题目</span></button><a href="{% url 'knowledge_app:quiz_library_detail' library.id %}" class="quiz-btn quiz-btn-outline" style="min-width: 120px; color: var(--quiz-primary);"><span>↩️</span><span>返回题库</span></a></div></form></div></div><!-- 题目类型说明 --><div class="quiz-card"><div class="quiz-card-body"><h2 style="margin-bottom: 1.5rem; color: var(--quiz-gray-800); text-align: center;">📚 题目类型说明</h2><div class="quiz-grid quiz-grid-2"><div style="padding: 1.5rem; border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg);"><h3 style="color: var(--quiz-gray-800); margin-bottom: 1rem;">🔘 单选题</h3><p style="color: var(--quiz-gray-600); margin-bottom: 1rem;">提供多个选项，只有一个正确答案</p><div style="font-size: 0.9rem; color: var(--quiz-gray-500);">
                    答案格式：A 或 B 或 C...
                </div></div><div style="padding: 1.5rem; border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg);"><h3 style="color: var(--quiz-gray-800); margin-bottom: 1rem;">☑️ 多选题</h3><p style="color: var(--quiz-gray-600); margin-bottom: 1rem;">提供多个选项，可能有多个正确答案</p><div style="font-size: 0.9rem; color: var(--quiz-gray-500);">
                    答案格式：A,B,C（用逗号分隔）
                </div></div><div style="padding: 1.5rem; border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg);"><h3 style="color: var(--quiz-gray-800); margin-bottom: 1rem;">📝 填空题</h3><p style="color: var(--quiz-gray-600); margin-bottom: 1rem;">需要填入特定的词语或短语</p><div style="font-size: 0.9rem; color: var(--quiz-gray-500);">
                    答案格式：直接输入答案文本
                </div></div><div style="padding: 1.5rem; border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg);"><h3 style="color: var(--quiz-gray-800); margin-bottom: 1rem;">💬 简答题</h3><p style="color: var(--quiz-gray-600); margin-bottom: 1rem;">需要较长的文字回答</p><div style="font-size: 0.9rem; color: var(--quiz-gray-500);">
                    答案格式：完整的答案描述
                </div></div></div></div></div><script>let optionCount = 0; function toggleOptions() { const questionType = document.getElementById('question_type').value; const optionsSection = document.getElementById('options_section'); const answerHelp = document.getElementById('answer_help'); if (questionType === 'single_choice' || questionType === 'multiple_choice') { optionsSection.style.display = 'block'; if (optionCount === 0) { addOption(); addOption(); } if (questionType === 'single_choice') { answerHelp.textContent = '输入正确选项的字母，例如：A'; } else { answerHelp.textContent = '输入所有正确选项的字母，用逗号分隔，例如：A,B,C'; } } else { optionsSection.style.display = 'none'; if (questionType === 'fill_blank') { answerHelp.textContent = '输入标准答案，系统会进行精确匹配'; } else if (questionType === 'short_answer') { answerHelp.textContent = '输入参考答案，用于对比和评分参考'; } else { answerHelp.textContent = ''; } } } function addOption() { optionCount++; const letter = String.fromCharCode(64 + optionCount); const container = document.getElementById('options_container'); const optionDiv = document.createElement('div'); optionDiv.style.cssText = 'border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg); padding: 1.5rem; margin-bottom: 1rem; background: var(--quiz-gray-50);'; optionDiv.innerHTML = ` <div style="display: flex; gap: 1rem; align-items: start; margin-bottom: 1rem;"><span style="font-weight: 600; color: var(--quiz-gray-700); min-width: 30px; margin-top: 0.75rem;">${letter}:</span><div style="flex: 1;"><input type="text" name="option_${optionCount}" class="quiz-form-control" placeholder="选项内容..." style="margin-bottom: 1rem;"><div style="border: 2px dashed var(--quiz-gray-300); border-radius: var(--quiz-radius); padding: 1rem; text-align: center; background: white;"><input type="file" id="option_image_${optionCount}" name="option_image_${optionCount}" accept="image/*" style="display: none;" onchange="previewImage(this, 'option_preview_${optionCount}')"><div id="option_preview_${optionCount}"><div style="font-size: 2rem; color: var(--quiz-gray-400); margin-bottom: 0.5rem;">🖼️</div><p style="color: var(--quiz-gray-500); margin: 0; font-size: 0.9rem;">选项图片（可选）</p></div><button type="button" class="quiz-btn quiz-btn-outline" style="margin-top: 0.5rem; font-size: 0.8rem; padding: 0.4rem 0.8rem; color: var(--quiz-primary);" onclick="document.getElementById('option_image_${optionCount}').click()"> 选择图片 </button></div></div><button type="button" class="quiz-btn quiz-btn-danger" style="padding: 0.5rem; color: white;" onclick="removeOption(this)"><span>🗑️</span></button></div> `; container.appendChild(optionDiv); if (optionCount >= 6) { document.getElementById('add_option').style.display = 'none'; } } function removeOption(button) { button.parentElement.remove(); optionCount--; const options = document.querySelectorAll('#options_container > div'); options.forEach((option, index) => { const letter = String.fromCharCode(65 + index); option.querySelector('span').textContent = letter + ':'; option.querySelector('input').name = `option_${index + 1}`; }); optionCount = options.length; if (optionCount < 6) { document.getElementById('add_option').style.display = 'inline-flex'; } } function addTag(tagName) { const tagsInput = document.getElementById('tags'); const currentTags = tagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag); if (!currentTags.includes(tagName)) { currentTags.push(tagName); tagsInput.value = currentTags.join(', '); } } document.getElementById('questionForm').addEventListener('submit', function(e) { const questionType = document.getElementById('question_type').value; const title = document.getElementById('title').value.trim(); const content = document.getElementById('content').value.trim(); const correctAnswer = document.getElementById('correct_answer').value.trim(); if (!questionType || !title || !content || !correctAnswer) { e.preventDefault(); alert('请填写所有必填字段'); return; } if (questionType === 'single_choice' || questionType === 'multiple_choice') { const options = document.querySelectorAll('#options_container input'); let hasValidOptions = false; options.forEach(option => { if (option.value.trim()) { hasValidOptions = true; } }); if (!hasValidOptions) { e.preventDefault(); alert('请至少添加一个选项'); return; } } }); function previewImage(input, previewId) { const preview = document.getElementById(previewId); if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = function(e) { preview.innerHTML = ` <div style="position: relative; display: inline-block;"><img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: var(--quiz-radius); box-shadow: var(--quiz-shadow);"><button type="button" style="position: absolute; top: -8px; right: -8px; background: var(--quiz-danger); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 0.8rem;" onclick="removeImage('${input.id}', '${previewId}')">×</button></div><p style="color: var(--quiz-gray-600); margin: 0.5rem 0 0 0; font-size: 0.9rem;">${input.files[0].name}</p> `; }; reader.readAsDataURL(input.files[0]); } } function removeImage(inputId, previewId) { const input = document.getElementById(inputId); const preview = document.getElementById(previewId); input.value = ''; if (inputId === 'question_image') { preview.innerHTML = ` <div style="font-size: 3rem; color: var(--quiz-gray-400); margin-bottom: 1rem;">📷</div><p style="color: var(--quiz-gray-600); margin: 0;">点击上传题目图片</p> `; } else { preview.innerHTML = ` <div style="font-size: 2rem; color: var(--quiz-gray-400); margin-bottom: 0.5rem;">🖼️</div><p style="color: var(--quiz-gray-500); margin: 0; font-size: 0.9rem;">选项图片（可选）</p> `; } } document.addEventListener('DOMContentLoaded', function() { document.getElementById('add_option').addEventListener('click', addOption); });</script>
{% endblock %}
