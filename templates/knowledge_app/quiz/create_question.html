{% extends 'knowledge_app/quiz/base_quiz.html' %}

{% block title %}æ·»åŠ é¢˜ç›® - {{ library.name }} - {{ block.super }}{% endblock %}

{% block quiz_breadcrumb %}
<div class="quiz-breadcrumb"><a href="{% url 'knowledge_app:quiz_dashboard' %}">ğŸ  ä¸ªäººé¢˜åº“</a><span class="quiz-breadcrumb-separator">></span><a href="{% url 'knowledge_app:quiz_library_list' %}">ğŸ“š é¢˜åº“åˆ—è¡¨</a><span class="quiz-breadcrumb-separator">></span><a href="{% url 'knowledge_app:quiz_library_detail' library.id %}">{{ library.name }}</a><span class="quiz-breadcrumb-separator">></span><span>â• æ·»åŠ é¢˜ç›®</span></div>
{% endblock %}

{% block quiz_content %}
<div class="quiz-card"><div class="quiz-card-header"><h1 class="quiz-card-title">â• æ·»åŠ é¢˜ç›®</h1><p class="quiz-card-subtitle">ä¸º "{{ library.name }}" æ·»åŠ æ–°é¢˜ç›®</p></div><div class="quiz-card-body"><form method="post" id="questionForm" enctype="multipart/form-data" style="max-width: 800px; margin: 0 auto;">
            {% csrf_token %}
            
            <!-- é¢˜ç›®ç±»å‹ --><div class="quiz-form-group"><label for="question_type" class="quiz-form-label"><span>ğŸ¯</span><span>é¢˜ç›®ç±»å‹ *</span></label><select id="question_type" name="question_type" class="quiz-form-control" required onchange="toggleOptions()"><option value="">è¯·é€‰æ‹©é¢˜ç›®ç±»å‹</option><option value="single_choice">ğŸ”˜ å•é€‰é¢˜</option><option value="multiple_choice">â˜‘ï¸ å¤šé€‰é¢˜</option><option value="fill_blank">ğŸ“ å¡«ç©ºé¢˜</option><option value="short_answer">ğŸ’¬ ç®€ç­”é¢˜</option></select></div><!-- é¢˜ç›®æ ‡é¢˜ --><div class="quiz-form-group"><label for="title" class="quiz-form-label"><span>ğŸ“‹</span><span>é¢˜ç›®æ ‡é¢˜ *</span></label><input type="text" 
                       id="title" 
                       name="title" 
                       class="quiz-form-control" 
                       placeholder="ç®€çŸ­æè¿°é¢˜ç›®å†…å®¹..."
                       required
                       maxlength="200"></div><!-- é¢˜ç›®å†…å®¹ --><div class="quiz-form-group"><label for="content" class="quiz-form-label"><span>ğŸ“</span><span>é¢˜ç›®å†…å®¹ *</span></label><textarea id="content"
                          name="content"
                          class="quiz-form-control"
                          rows="4"
                          placeholder="è¯¦ç»†çš„é¢˜ç›®æè¿°..."
                          required></textarea></div><!-- é¢˜ç›®å›¾ç‰‡ --><div class="quiz-form-group"><label for="question_image" class="quiz-form-label"><span>ğŸ–¼ï¸</span><span>é¢˜ç›®å›¾ç‰‡</span></label><div style="border: 2px dashed var(--quiz-gray-300); border-radius: var(--quiz-radius-lg); padding: 2rem; text-align: center; background: var(--quiz-gray-50);"><input type="file"
                           id="question_image"
                           name="question_image"
                           accept="image/*"
                           style="display: none;"
                           onchange="previewImage(this, 'question_preview')"><div id="question_preview" style="margin-bottom: 1rem;"><div style="font-size: 3rem; color: var(--quiz-gray-400); margin-bottom: 1rem;">ğŸ“·</div><p style="color: var(--quiz-gray-600); margin: 0;">ç‚¹å‡»ä¸Šä¼ é¢˜ç›®å›¾ç‰‡</p></div><button type="button" class="quiz-btn quiz-btn-outline" onclick="document.getElementById('question_image').click()" style="color: var(--quiz-primary);"><span>ğŸ“</span><span>é€‰æ‹©å›¾ç‰‡</span></button></div><div style="font-size: 0.9rem; color: var(--quiz-gray-500); margin-top: 0.5rem;">
                    æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œå»ºè®®å¤§å°ä¸è¶…è¿‡ 5MB
                </div></div><!-- é€‰æ‹©é¢˜é€‰é¡¹ --><div id="options_section" style="display: none;"><div class="quiz-form-group"><label class="quiz-form-label"><span>ğŸ“‹</span><span>é€‰é¡¹è®¾ç½®</span></label><div id="options_container"><!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ --></div><button type="button" id="add_option" class="quiz-btn quiz-btn-outline" style="margin-top: 1rem;"><span>â•</span><span>æ·»åŠ é€‰é¡¹</span></button></div></div><!-- æ­£ç¡®ç­”æ¡ˆ --><div class="quiz-form-group"><label for="correct_answer" class="quiz-form-label"><span>âœ…</span><span>æ­£ç¡®ç­”æ¡ˆ *</span></label><div id="answer_input_container"><textarea id="correct_answer" 
                              name="correct_answer" 
                              class="quiz-form-control" 
                              rows="2"
                              placeholder="è¾“å…¥æ­£ç¡®ç­”æ¡ˆ..."
                              required></textarea></div><div id="answer_help" style="font-size: 0.9rem; color: var(--quiz-gray-500); margin-top: 0.5rem;"><!-- å¸®åŠ©æ–‡æœ¬å°†é€šè¿‡JavaScriptåŠ¨æ€æ›´æ–° --></div></div><!-- ç­”æ¡ˆè§£æ --><div class="quiz-form-group"><label for="explanation" class="quiz-form-label"><span>ğŸ’¡</span><span>ç­”æ¡ˆè§£æ</span></label><textarea id="explanation" 
                          name="explanation" 
                          class="quiz-form-control" 
                          rows="3"
                          placeholder="è§£é‡Šä¸ºä»€ä¹ˆè¿™æ˜¯æ­£ç¡®ç­”æ¡ˆï¼Œæä¾›å­¦ä¹ è¦ç‚¹..."></textarea></div><!-- éš¾åº¦ç­‰çº§ --><div class="quiz-form-group"><label for="difficulty" class="quiz-form-label"><span>â­</span><span>éš¾åº¦ç­‰çº§</span></label><select id="difficulty" name="difficulty" class="quiz-form-control"><option value="1">ğŸŸ¢ ç®€å•</option><option value="2" selected>ğŸŸ¡ ä¸­ç­‰</option><option value="3">ğŸ”´ å›°éš¾</option></select></div><!-- æ ‡ç­¾ --><div class="quiz-form-group"><label for="tags" class="quiz-form-label"><span>ğŸ·ï¸</span><span>é¢˜ç›®æ ‡ç­¾</span></label><input type="text" 
                       id="tags" 
                       name="tags" 
                       class="quiz-form-control" 
                       placeholder="ç”¨é€—å·åˆ†éš”å¤šä¸ªæ ‡ç­¾ï¼Œä¾‹å¦‚ï¼šç®—æ³•,æ•°æ®ç»“æ„,åŸºç¡€"><div style="font-size: 0.9rem; color: var(--quiz-gray-500); margin-top: 0.5rem;">
                    æ ‡ç­¾æœ‰åŠ©äºåˆ†ç±»ç®¡ç†å’Œç­›é€‰é¢˜ç›®
                </div>
                {% if tags %}
                <div style="margin-top: 1rem;"><div style="font-size: 0.9rem; color: var(--quiz-gray-600); margin-bottom: 0.5rem;">å¸¸ç”¨æ ‡ç­¾ï¼š</div><div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        {% for tag in tags %}
                        <span class="quiz-tag" style="cursor: pointer;" onclick="addTag('{{ tag.name }}')">{{ tag.name }}</span>
                        {% endfor %}
                    </div></div>
                {% endif %}
            </div><!-- æäº¤æŒ‰é’® --><div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; flex-wrap: wrap;"><button type="submit" class="quiz-btn quiz-btn-primary" style="min-width: 120px; color: white;"><span>âœ¨</span><span>æ·»åŠ é¢˜ç›®</span></button><a href="{% url 'knowledge_app:quiz_library_detail' library.id %}" class="quiz-btn quiz-btn-outline" style="min-width: 120px; color: var(--quiz-primary);"><span>â†©ï¸</span><span>è¿”å›é¢˜åº“</span></a></div></form></div></div><!-- é¢˜ç›®ç±»å‹è¯´æ˜ --><div class="quiz-card"><div class="quiz-card-body"><h2 style="margin-bottom: 1.5rem; color: var(--quiz-gray-800); text-align: center;">ğŸ“š é¢˜ç›®ç±»å‹è¯´æ˜</h2><div class="quiz-grid quiz-grid-2"><div style="padding: 1.5rem; border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg);"><h3 style="color: var(--quiz-gray-800); margin-bottom: 1rem;">ğŸ”˜ å•é€‰é¢˜</h3><p style="color: var(--quiz-gray-600); margin-bottom: 1rem;">æä¾›å¤šä¸ªé€‰é¡¹ï¼Œåªæœ‰ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆ</p><div style="font-size: 0.9rem; color: var(--quiz-gray-500);">
                    ç­”æ¡ˆæ ¼å¼ï¼šA æˆ– B æˆ– C...
                </div></div><div style="padding: 1.5rem; border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg);"><h3 style="color: var(--quiz-gray-800); margin-bottom: 1rem;">â˜‘ï¸ å¤šé€‰é¢˜</h3><p style="color: var(--quiz-gray-600); margin-bottom: 1rem;">æä¾›å¤šä¸ªé€‰é¡¹ï¼Œå¯èƒ½æœ‰å¤šä¸ªæ­£ç¡®ç­”æ¡ˆ</p><div style="font-size: 0.9rem; color: var(--quiz-gray-500);">
                    ç­”æ¡ˆæ ¼å¼ï¼šA,B,Cï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
                </div></div><div style="padding: 1.5rem; border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg);"><h3 style="color: var(--quiz-gray-800); margin-bottom: 1rem;">ğŸ“ å¡«ç©ºé¢˜</h3><p style="color: var(--quiz-gray-600); margin-bottom: 1rem;">éœ€è¦å¡«å…¥ç‰¹å®šçš„è¯è¯­æˆ–çŸ­è¯­</p><div style="font-size: 0.9rem; color: var(--quiz-gray-500);">
                    ç­”æ¡ˆæ ¼å¼ï¼šç›´æ¥è¾“å…¥ç­”æ¡ˆæ–‡æœ¬
                </div></div><div style="padding: 1.5rem; border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg);"><h3 style="color: var(--quiz-gray-800); margin-bottom: 1rem;">ğŸ’¬ ç®€ç­”é¢˜</h3><p style="color: var(--quiz-gray-600); margin-bottom: 1rem;">éœ€è¦è¾ƒé•¿çš„æ–‡å­—å›ç­”</p><div style="font-size: 0.9rem; color: var(--quiz-gray-500);">
                    ç­”æ¡ˆæ ¼å¼ï¼šå®Œæ•´çš„ç­”æ¡ˆæè¿°
                </div></div></div></div></div><script>let optionCount = 0; function toggleOptions() { const questionType = document.getElementById('question_type').value; const optionsSection = document.getElementById('options_section'); const answerHelp = document.getElementById('answer_help'); if (questionType === 'single_choice' || questionType === 'multiple_choice') { optionsSection.style.display = 'block'; if (optionCount === 0) { addOption(); addOption(); } if (questionType === 'single_choice') { answerHelp.textContent = 'è¾“å…¥æ­£ç¡®é€‰é¡¹çš„å­—æ¯ï¼Œä¾‹å¦‚ï¼šA'; } else { answerHelp.textContent = 'è¾“å…¥æ‰€æœ‰æ­£ç¡®é€‰é¡¹çš„å­—æ¯ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¾‹å¦‚ï¼šA,B,C'; } } else { optionsSection.style.display = 'none'; if (questionType === 'fill_blank') { answerHelp.textContent = 'è¾“å…¥æ ‡å‡†ç­”æ¡ˆï¼Œç³»ç»Ÿä¼šè¿›è¡Œç²¾ç¡®åŒ¹é…'; } else if (questionType === 'short_answer') { answerHelp.textContent = 'è¾“å…¥å‚è€ƒç­”æ¡ˆï¼Œç”¨äºå¯¹æ¯”å’Œè¯„åˆ†å‚è€ƒ'; } else { answerHelp.textContent = ''; } } } function addOption() { optionCount++; const letter = String.fromCharCode(64 + optionCount); const container = document.getElementById('options_container'); const optionDiv = document.createElement('div'); optionDiv.style.cssText = 'border: 1px solid var(--quiz-gray-200); border-radius: var(--quiz-radius-lg); padding: 1.5rem; margin-bottom: 1rem; background: var(--quiz-gray-50);'; optionDiv.innerHTML = ` <div style="display: flex; gap: 1rem; align-items: start; margin-bottom: 1rem;"><span style="font-weight: 600; color: var(--quiz-gray-700); min-width: 30px; margin-top: 0.75rem;">${letter}:</span><div style="flex: 1;"><input type="text" name="option_${optionCount}" class="quiz-form-control" placeholder="é€‰é¡¹å†…å®¹..." style="margin-bottom: 1rem;"><div style="border: 2px dashed var(--quiz-gray-300); border-radius: var(--quiz-radius); padding: 1rem; text-align: center; background: white;"><input type="file" id="option_image_${optionCount}" name="option_image_${optionCount}" accept="image/*" style="display: none;" onchange="previewImage(this, 'option_preview_${optionCount}')"><div id="option_preview_${optionCount}"><div style="font-size: 2rem; color: var(--quiz-gray-400); margin-bottom: 0.5rem;">ğŸ–¼ï¸</div><p style="color: var(--quiz-gray-500); margin: 0; font-size: 0.9rem;">é€‰é¡¹å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</p></div><button type="button" class="quiz-btn quiz-btn-outline" style="margin-top: 0.5rem; font-size: 0.8rem; padding: 0.4rem 0.8rem; color: var(--quiz-primary);" onclick="document.getElementById('option_image_${optionCount}').click()"> é€‰æ‹©å›¾ç‰‡ </button></div></div><button type="button" class="quiz-btn quiz-btn-danger" style="padding: 0.5rem; color: white;" onclick="removeOption(this)"><span>ğŸ—‘ï¸</span></button></div> `; container.appendChild(optionDiv); if (optionCount >= 6) { document.getElementById('add_option').style.display = 'none'; } } function removeOption(button) { button.parentElement.remove(); optionCount--; const options = document.querySelectorAll('#options_container > div'); options.forEach((option, index) => { const letter = String.fromCharCode(65 + index); option.querySelector('span').textContent = letter + ':'; option.querySelector('input').name = `option_${index + 1}`; }); optionCount = options.length; if (optionCount < 6) { document.getElementById('add_option').style.display = 'inline-flex'; } } function addTag(tagName) { const tagsInput = document.getElementById('tags'); const currentTags = tagsInput.value.split(',').map(tag => tag.trim()).filter(tag => tag); if (!currentTags.includes(tagName)) { currentTags.push(tagName); tagsInput.value = currentTags.join(', '); } } document.getElementById('questionForm').addEventListener('submit', function(e) { const questionType = document.getElementById('question_type').value; const title = document.getElementById('title').value.trim(); const content = document.getElementById('content').value.trim(); const correctAnswer = document.getElementById('correct_answer').value.trim(); if (!questionType || !title || !content || !correctAnswer) { e.preventDefault(); alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ'); return; } if (questionType === 'single_choice' || questionType === 'multiple_choice') { const options = document.querySelectorAll('#options_container input'); let hasValidOptions = false; options.forEach(option => { if (option.value.trim()) { hasValidOptions = true; } }); if (!hasValidOptions) { e.preventDefault(); alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªé€‰é¡¹'); return; } } }); function previewImage(input, previewId) { const preview = document.getElementById(previewId); if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = function(e) { preview.innerHTML = ` <div style="position: relative; display: inline-block;"><img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: var(--quiz-radius); box-shadow: var(--quiz-shadow);"><button type="button" style="position: absolute; top: -8px; right: -8px; background: var(--quiz-danger); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 0.8rem;" onclick="removeImage('${input.id}', '${previewId}')">Ã—</button></div><p style="color: var(--quiz-gray-600); margin: 0.5rem 0 0 0; font-size: 0.9rem;">${input.files[0].name}</p> `; }; reader.readAsDataURL(input.files[0]); } } function removeImage(inputId, previewId) { const input = document.getElementById(inputId); const preview = document.getElementById(previewId); input.value = ''; if (inputId === 'question_image') { preview.innerHTML = ` <div style="font-size: 3rem; color: var(--quiz-gray-400); margin-bottom: 1rem;">ğŸ“·</div><p style="color: var(--quiz-gray-600); margin: 0;">ç‚¹å‡»ä¸Šä¼ é¢˜ç›®å›¾ç‰‡</p> `; } else { preview.innerHTML = ` <div style="font-size: 2rem; color: var(--quiz-gray-400); margin-bottom: 0.5rem;">ğŸ–¼ï¸</div><p style="color: var(--quiz-gray-500); margin: 0; font-size: 0.9rem;">é€‰é¡¹å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰</p> `; } } document.addEventListener('DOMContentLoaded', function() { document.getElementById('add_option').addEventListener('click', addOption); });</script>
{% endblock %}
