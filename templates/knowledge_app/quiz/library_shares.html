{% extends 'knowledge_app/quiz/base_quiz.html' %}

{% block title %}åˆ†äº«ç®¡ç† - {{ library.name }}{% endblock %}

{% block content %}
<div class="quiz-container"><!-- é¢åŒ…å±‘å¯¼èˆª --><div class="quiz-breadcrumb"><a href="{% url 'knowledge_app:quiz_dashboard' %}">ä¸ªäººé¢˜åº“</a><span class="quiz-breadcrumb-separator">></span><a href="{% url 'knowledge_app:quiz_library_detail' library.id %}">{{ library.name }}</a><span class="quiz-breadcrumb-separator">></span><span>åˆ†äº«ç®¡ç†</span></div><div class="quiz-card"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;"><div><h1 style="color: black !important; margin: 0;">ğŸ“¤ åˆ†äº«ç®¡ç†</h1><p style="color: black !important; margin: 0.5rem 0 0 0;">ç®¡ç† "{{ library.name }}" çš„åˆ†äº«è®°å½•</p></div><a href="{% url 'knowledge_app:share_library' library.id %}" class="quiz-btn quiz-btn-primary"><span>â•</span><span>æ–°å»ºåˆ†äº«</span></a></div>

        {% if shares %}
        <div style="display: grid; gap: 1rem;">
            {% for share in shares %}
            <div class="quiz-card" style="border: 1px solid var(--quiz-gray-200); padding: 1.5rem;"><div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;"><div style="flex: 1;"><div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            {% if share.share_type == 'private' %}
                            <span class="quiz-tag quiz-tag-primary">ğŸ‘¤ ç§å¯†åˆ†äº«</span>
                            {% elif share.share_type == 'link' %}
                            <span class="quiz-tag quiz-tag-warning">ğŸ”— é“¾æ¥åˆ†äº«</span>
                            {% elif share.share_type == 'public' %}
                            <span class="quiz-tag quiz-tag-success">ğŸŒ å…¬å¼€åˆ†äº«</span>
                            {% endif %}
                            
                            {% if share.permission == 'view' %}
                            <span class="quiz-tag">ğŸ‘€ ä»…æŸ¥çœ‹</span>
                            {% elif share.permission == 'copy' %}
                            <span class="quiz-tag">ğŸ“‹ å¯å¤åˆ¶</span>
                            {% elif share.permission == 'edit' %}
                            <span class="quiz-tag">âœï¸ å¯ç¼–è¾‘</span>
                            {% endif %}
                            
                            {% if not share.is_active %}
                            <span class="quiz-tag quiz-tag-danger">âŒ å·²ç¦ç”¨</span>
                            {% elif share.is_expired %}
                            <span class="quiz-tag quiz-tag-danger">â° å·²è¿‡æœŸ</span>
                            {% endif %}
                        </div>
                        
                        {% if share.shared_to %}
                        <p style="color: black !important; margin: 0 0 0.5rem 0;"><strong>åˆ†äº«ç»™ï¼š</strong>{{ share.shared_to.username }}
                        </p>
                        {% endif %}
                        
                        {% if share.share_code %}
                        <p style="color: black !important; margin: 0 0 0.5rem 0;"><strong>åˆ†äº«é“¾æ¥ï¼š</strong><a href="{% url 'knowledge_app:shared_library_detail' share.share_code %}" target="_blank" style="color: var(--quiz-primary) !important;">
                                {{ request.build_absolute_uri }}{% url 'knowledge_app:shared_library_detail' share.share_code %}
                            </a><button onclick="copyToClipboard('{{ request.build_absolute_uri }}{% url 'knowledge_app:shared_library_detail' share.share_code %}')" class="quiz-btn" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; margin-left: 0.5rem;">
                                ğŸ“‹ å¤åˆ¶
                            </button></p>
                        {% endif %}
                        
                        {% if share.message %}
                        <p style="color: black !important; margin: 0 0 0.5rem 0;"><strong>ç•™è¨€ï¼š</strong>{{ share.message }}
                        </p>
                        {% endif %}
                        
                        <div style="display: flex; gap: 1rem; font-size: 0.9rem; color: black !important;"><span>ğŸ“… {{ share.created_at|date:"Y-m-d H:i" }}</span><span>ğŸ‘ï¸ {{ share.access_count }} æ¬¡è®¿é—®</span>
                            {% if share.accessed_at %}
                            <span>ğŸ•’ æœ€åè®¿é—®ï¼š{{ share.accessed_at|date:"Y-m-d H:i" }}</span>
                            {% endif %}
                            {% if share.expires_at %}
                            <span>â° è¿‡æœŸæ—¶é—´ï¼š{{ share.expires_at|date:"Y-m-d H:i" }}</span>
                            {% endif %}
                        </div></div><div style="display: flex; gap: 0.5rem;"><button onclick="toggleShareStatus({{ share.id }})" class="quiz-btn {% if share.is_active %}quiz-btn-warning{% else %}quiz-btn-success{% endif %}" style="font-size: 0.8rem; padding: 0.5rem 1rem;">
                            {% if share.is_active %}
                            <span>â¸ï¸ ç¦ç”¨</span>
                            {% else %}
                            <span>â–¶ï¸ å¯ç”¨</span>
                            {% endif %}
                        </button><button onclick="deleteShare({{ share.id }})" class="quiz-btn quiz-btn-danger" style="font-size: 0.8rem; padding: 0.5rem 1rem;"><span>ğŸ—‘ï¸ åˆ é™¤</span></button></div></div></div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 3rem; color: black !important;"><div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“¤</div><h3 style="color: black !important;">è¿˜æ²¡æœ‰åˆ†äº«è®°å½•</h3><p style="color: black !important; margin-bottom: 2rem;">å¼€å§‹åˆ†äº«ä½ çš„é¢˜åº“ç»™å…¶ä»–ç”¨æˆ·å§ï¼</p><a href="{% url 'knowledge_app:share_library' library.id %}" class="quiz-btn quiz-btn-primary"><span>â•</span><span>åˆ›å»ºåˆ†äº«</span></a></div>
        {% endif %}
    </div></div><script>function copyToClipboard(text) { navigator.clipboard.writeText(text).then(function() { alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'); }, function(err) { console.error('å¤åˆ¶å¤±è´¥: ', err); const textArea = document.createElement('textarea'); textArea.value = text; document.body.appendChild(textArea); textArea.select(); document.execCommand('copy'); document.body.removeChild(textArea); alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'); }); } function toggleShareStatus(shareId) { if (!confirm('ç¡®å®šè¦åˆ‡æ¢åˆ†äº«çŠ¶æ€å—ï¼Ÿ')) { return; } fetch(`/quiz/shares/${shareId}/toggle/`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value || getCookie('csrftoken') } }) .then(response => response.json()) .then(data => { if (data.success) { alert(data.message); location.reload(); } else { alert('æ“ä½œå¤±è´¥ï¼š' + data.error); } }) .catch(error => { console.error('Error:', error); alert('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•'); }); } function deleteShare(shareId) { if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåˆ†äº«å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) { return; } fetch(`/quiz/shares/${shareId}/delete/`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value || getCookie('csrftoken') } }) .then(response => response.json()) .then(data => { if (data.success) { alert(data.message); location.reload(); } else { alert('åˆ é™¤å¤±è´¥ï¼š' + data.error); } }) .catch(error => { console.error('Error:', error); alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•'); }); } function getCookie(name) { let cookieValue = null; if (document.cookie && document.cookie !== '') { const cookies = document.cookie.split(';'); for (let i = 0; i < cookies.length; i++) { const cookie = cookies[i].trim(); if (cookie.substring(0, name.length + 1) === (name + '=')) { cookieValue = decodeURIComponent(cookie.substring(name.length + 1)); break; } } } return cookieValue; }</script>
{% endblock %}
