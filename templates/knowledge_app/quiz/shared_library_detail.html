{% extends 'knowledge_app/quiz/base_quiz.html' %}

{% block title %}{{ library.name }} - åˆ†äº«é¢˜åº“{% endblock %}

{% block content %}
<div class="quiz-container"><!-- åˆ†äº«ä¿¡æ¯æ¨ªå¹… --><div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: var(--quiz-radius-lg); margin-bottom: 2rem; text-align: center;"><div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ¤</div><h2 style="margin: 0 0 0.5rem 0; color: white !important;">{{ share.shared_by.username }} åˆ†äº«çš„é¢˜åº“</h2><p style="margin: 0; opacity: 0.9; color: white !important;">{{ share.get_share_type_display }} â€¢ {{ share.get_permission_display }}</p></div><div class="quiz-card"><!-- é¢˜åº“åŸºæœ¬ä¿¡æ¯ --><div style="text-align: center; margin-bottom: 2rem;"><h1 style="color: black !important; margin-bottom: 1rem;">ğŸ“š {{ library.name }}</h1>
            {% if library.description %}
            <p style="color: black !important; font-size: 1.1rem; margin-bottom: 1.5rem;">{{ library.description }}</p>
            {% endif %}
            
            <div style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 1.5rem; flex-wrap: wrap;"><div style="text-align: center;"><div style="font-size: 2rem; color: var(--quiz-primary);">ğŸ“Š</div><div style="font-weight: 600; color: black !important;">{{ library.total_questions }}</div><div style="font-size: 0.9rem; color: black !important;">é“é¢˜ç›®</div></div><div style="text-align: center;"><div style="font-size: 2rem; color: var(--quiz-success);">ğŸ‘¤</div><div style="font-weight: 600; color: black !important;">{{ share.shared_by.username }}</div><div style="font-size: 0.9rem; color: black !important;">åˆ†äº«è€…</div></div><div style="text-align: center;"><div style="font-size: 2rem; color: var(--quiz-warning);">ğŸ‘ï¸</div><div style="font-weight: 600; color: black !important;">{{ share.access_count }}</div><div style="font-size: 0.9rem; color: black !important;">è®¿é—®æ¬¡æ•°</div></div></div></div><!-- åˆ†äº«ç•™è¨€ -->
        {% if share.message %}
        <div style="background: rgba(99, 102, 241, 0.1); padding: 1.5rem; border-radius: var(--quiz-radius-lg); margin-bottom: 2rem; border-left: 4px solid var(--quiz-primary);"><h4 style="color: var(--quiz-primary) !important; margin: 0 0 0.5rem 0;">ğŸ’¬ åˆ†äº«è€…ç•™è¨€</h4><p style="color: black !important; margin: 0; font-style: italic;">"{{ share.message }}"</p></div>
        {% endif %}

        <!-- æ“ä½œæŒ‰é’® --><div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap;">
            {% if user.is_authenticated %}
            <a href="{% url 'knowledge_app:quiz_start' library.id %}" class="quiz-btn quiz-btn-primary"><span>ğŸ¯</span><span>å¼€å§‹ç»ƒä¹ </span></a>
            
            {% if can_copy %}
            <button onclick="copyLibrary({{ share.id }})" class="quiz-btn quiz-btn-success"><span>ğŸ“‹</span><span>å¤åˆ¶åˆ°æˆ‘çš„é¢˜åº“</span></button>
            {% endif %}
            {% else %}
            <div style="text-align: center; padding: 1rem; background: var(--quiz-gray-50); border-radius: var(--quiz-radius); color: black !important;"><p style="margin: 0 0 1rem 0; color: black !important;">ç™»å½•åå¯ä»¥ç»ƒä¹ å’Œå¤åˆ¶é¢˜åº“</p><a href="{% url 'users:login' %}" class="quiz-btn quiz-btn-primary"><span>ğŸ”‘</span><span>ç™»å½•</span></a></div>
            {% endif %}
        </div><!-- é¢˜ç›®åˆ—è¡¨ -->
        {% if questions %}
        <div style="margin-top: 2rem;"><h3 style="color: black !important; margin-bottom: 1.5rem; text-align: center;">ğŸ“ é¢˜ç›®é¢„è§ˆ</h3><div style="display: grid; gap: 1.5rem;">
                {% for question in questions %}
                <div class="quiz-card" style="border: 1px solid var(--quiz-gray-200); padding: 1.5rem;"><div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;"><h4 style="color: black !important; margin: 0; flex: 1;">{{ forloop.counter }}. {{ question.title }}</h4><div style="display: flex; gap: 0.5rem;">
                            {% if question.question_type == 'single_choice' %}
                            <span class="quiz-tag quiz-tag-primary">å•é€‰é¢˜</span>
                            {% elif question.question_type == 'multiple_choice' %}
                            <span class="quiz-tag quiz-tag-success">å¤šé€‰é¢˜</span>
                            {% elif question.question_type == 'fill_blank' %}
                            <span class="quiz-tag quiz-tag-warning">å¡«ç©ºé¢˜</span>
                            {% elif question.question_type == 'short_answer' %}
                            <span class="quiz-tag quiz-tag-danger">ç®€ç­”é¢˜</span>
                            {% endif %}
                            
                            {% if question.difficulty == 'easy' %}
                            <span class="quiz-tag">ğŸŸ¢ ç®€å•</span>
                            {% elif question.difficulty == 'medium' %}
                            <span class="quiz-tag">ğŸŸ¡ ä¸­ç­‰</span>
                            {% elif question.difficulty == 'hard' %}
                            <span class="quiz-tag">ğŸ”´ å›°éš¾</span>
                            {% endif %}
                        </div></div><p style="color: black !important; line-height: 1.6; margin-bottom: 1rem;">{{ question.content }}</p>
                    
                    {% if question.question_type in 'single_choice,multiple_choice' %}
                    <div style="margin-left: 1rem;">
                        {% for key, value in question.options.items %}
                        <div style="margin-bottom: 0.5rem; color: black !important;"><strong>{{ key }}.</strong> {{ value }}
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    {% if question.tags.all %}
                    <div style="margin-top: 1rem;">
                        {% for tag in question.tags.all %}
                        <span class="quiz-tag" style="margin-right: 0.5rem;">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div></div>
        {% endif %}

        <!-- åˆ†äº«ä¿¡æ¯ --><div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--quiz-gray-200); text-align: center; color: black !important;"><div style="display: flex; justify-content: center; gap: 2rem; font-size: 0.9rem; flex-wrap: wrap;"><span>ğŸ“… åˆ†äº«æ—¶é—´ï¼š{{ share.created_at|date:"Y-m-d H:i" }}</span>
                {% if share.expires_at %}
                <span>â° è¿‡æœŸæ—¶é—´ï¼š{{ share.expires_at|date:"Y-m-d H:i" }}</span>
                {% endif %}
                <span>ğŸ‘ï¸ è®¿é—®æ¬¡æ•°ï¼š{{ share.access_count }}</span></div></div></div></div><script>function copyLibrary(shareId) { if (!confirm('ç¡®å®šè¦å¤åˆ¶è¿™ä¸ªé¢˜åº“åˆ°ä½ çš„ä¸ªäººé¢˜åº“å—ï¼Ÿ')) { return; } const button = event.target.closest('button'); const originalText = button.innerHTML; button.innerHTML = '<span>â³</span><span>å¤åˆ¶ä¸­...</span>'; button.disabled = true; const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || getCookie('csrftoken'); console.log('CSRF Token:', csrfToken ? 'Found' : 'Not found'); fetch(`/quiz/shares/${shareId}/copy/`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken } }) .then(response => { console.log('Response status:', response.status); if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); } return response.json(); }) .then(data => { console.log('Response data:', data); if (data.success) { alert(data.message); if (data.redirect_url) { window.location.href = data.redirect_url; } } else { alert('å¤åˆ¶å¤±è´¥ï¼š' + data.error); button.innerHTML = originalText; button.disabled = false; } }) .catch(error => { console.error('Fetch error:', error); alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•: ' + error.message); button.innerHTML = originalText; button.disabled = false; }); } function getCookie(name) { let cookieValue = null; if (document.cookie && document.cookie !== '') { const cookies = document.cookie.split(';'); for (let i = 0; i < cookies.length; i++) { const cookie = cookies[i].trim(); if (cookie.substring(0, name.length + 1) === (name + '=')) { cookieValue = decodeURIComponent(cookie.substring(name.length + 1)); break; } } } return cookieValue; }</script>
{% endblock %}
