{% extends 'knowledge_app/base.html' %}

{% block title %}
{% if query %}æœç´¢: {{ query }}{% else %}æœç´¢{% endif %} - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°
{% endblock %}

{% block extra_css %}
<style>.search-container {max-width:1400px;margin:0 auto;padding:50px 40px;min-height:100vh;position:relative;z-index:1}.search-header {background:linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);backdrop-filter:blur(25px);border-radius:30px;padding:60px 50px;margin:0 20px 50px 20px;color:var(--text-inverse);text-align:center;position:relative;z-index:2;box-shadow:0 30px 80px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2);border:1px solid rgba(255, 255, 255, 0.3);overflow:hidden}.search-header::before {content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);animation:shimmer 4s infinite}@keyframes shimmer {0% {transform:translateX(-100%) translateY(-100%) rotate(45deg)}100% {transform:translateX(100%) translateY(100%) rotate(45deg)}}.search-title {font-size:3.5rem;font-weight:900;margin-bottom:25px;background:linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 4px 15px rgba(0, 0, 0, 0.3);position:relative;z-index:1}.search-subtitle {font-size:1.4rem;opacity:0.95;margin-bottom:40px;font-weight:500;color:rgba(255, 255, 255, 0.9);position:relative;z-index:1}.search-form {max-width:700px;margin:0 auto;position:relative;z-index:1}.search-input-group {position:relative;display:flex;align-items:center;margin-bottom:30px}.search-input {width:100%;padding:20px 25px 20px 60px;border:2px solid rgba(255, 255, 255, 0.4);border-radius:30px;font-size:1.2rem;background:var(--bg-card);backdrop-filter:blur(10px);color:var(--text-primary);transition:all 0.3s ease;box-shadow:var(--shadow-md);font-weight:500}.search-input:focus {outline:none;border-color:var(--primary-color);box-shadow:0 0 0 4px rgba(102, 126, 234, 0.2), 0 12px 35px rgba(0, 0, 0, 0.15);background:var(--bg-card);transform:translateY(-2px)}.search-input::placeholder {color:#a0aec0;font-weight:400}.search-icon {position:absolute;left:22px;color:var(--text-muted);font-size:1.4rem;z-index:2;filter:drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1))}.search-btn {position:absolute;right:6px;background:linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);border:none;border-radius:25px;padding:14px 25px;color:var(--text-inverse);font-weight:700;cursor:pointer;transition:all 0.3s ease;font-size:1rem;box-shadow:0 4px 15px rgba(102, 126, 234, 0.3)}.search-btn:hover {transform:translateY(-3px);box-shadow:0 8px 25px rgba(102, 126, 234, 0.4);background:linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)}.search-btn:active {transform:translateY(-1px)}.search-suggestions {position:absolute;top:100%;left:0;right:0;background:var(--bg-card);backdrop-filter:blur(20px);border-radius:var(--border-radius-lg);box-shadow:0 20px 60px rgba(0,0,0,0.15), 0 8px 25px rgba(0,0,0,0.08);z-index:1000;max-height:400px;overflow-y:auto;display:none;margin-top:8px;border:1px solid rgba(255, 255, 255, 0.3)}.suggestion-item {padding:15px 25px;cursor:pointer;border-bottom:1px solid rgba(0, 0, 0, 0.05);display:flex;align-items:center;gap:15px;transition:all 0.3s ease;position:relative;overflow:hidden}.suggestion-item::before {content:'';position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);transition:width 0.3s ease}.suggestion-item:hover {background:linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);transform:translateX(5px)}.suggestion-item:hover::before {width:4px}.suggestion-item:last-child {border-bottom:none;border-radius:0 0 20px 20px}.suggestion-item:first-child {border-radius:20px 20px 0 0}.suggestion-icon {color:var(--primary-color);font-size:1.1rem;filter:drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));position:relative;z-index:1}.suggestion-text {flex:1;color:var(--text-primary);font-size:1rem;font-weight:500;position:relative;z-index:1}.suggestion-category {font-size:0.85rem;color:var(--primary-color);background:linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);padding:4px 12px;border-radius:var(--border-radius);font-weight:600;border:1px solid rgba(102, 126, 234, 0.2);position:relative;z-index:1}.search-content {display:grid;grid-template-columns:280px 1fr;gap:40px;margin:0 25px}.search-sidebar {background:var(--bg-card);backdrop-filter:blur(20px);border-radius:25px;padding:35px 30px;box-shadow:0 20px 60px rgba(0,0,0,0.08), 0 8px 25px rgba(0,0,0,0.05);height:fit-content;position:sticky;top:30px;border:1px solid rgba(255, 255, 255, 0.3)}.sidebar-section {margin-bottom:35px;position:relative}.sidebar-section::after {content:'';position:absolute;bottom:-17px;left:0;right:0;height:1px;background:linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.2), transparent)}.sidebar-section:last-child::after {display:none}.sidebar-title {font-size:1.3rem;font-weight:700;background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:20px;display:flex;align-items:center;gap:10px}.sidebar-title span {font-size:1.4rem;filter:drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1))}.filter-group {margin-bottom:25px}.filter-label {display:block;margin-bottom:12px;color:var(--text-secondary);font-size:1rem;font-weight:600}.filter-select {width:100%;padding:12px 16px;border:2px solid rgba(102, 126, 234, 0.2);border-radius:var(--border-radius);font-size:1rem;background:var(--bg-secondary);backdrop-filter:blur(10px);color:var(--text-primary);font-weight:500;transition:all 0.3s ease;cursor:pointer}.filter-select:focus {outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1);background:var(--bg-card);transform:translateY(-1px)}.filter-select:hover {border-color:var(--primary-color);background:var(--bg-card)}.popular-item, .history-item {display:block;padding:12px 16px;color:var(--text-secondary);text-decoration:none;border-radius:12px;margin-bottom:8px;transition:all 0.3s ease;font-size:1rem;font-weight:500;position:relative;overflow:hidden;border:1px solid rgba(102, 126, 234, 0.1)}.popular-item::before, .history-item::before {content:'';position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);transition:width 0.3s ease}.popular-item:hover, .history-item:hover {background:linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);color:var(--primary-color);text-decoration:none;transform:translateX(5px);border-color:rgba(102, 126, 234, 0.3)}.popular-item:hover::before, .history-item:hover::before {width:3px}.search-results {background:var(--bg-card);backdrop-filter:blur(20px);border-radius:25px;padding:40px 35px;box-shadow:0 20px 60px rgba(0,0,0,0.08), 0 8px 25px rgba(0,0,0,0.05);border:1px solid rgba(255, 255, 255, 0.3)}.results-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid rgba(102, 126, 234, 0.1)}.results-info {color:var(--text-secondary);font-size:1rem;font-weight:600}.sort-select {padding:10px 16px;border:2px solid rgba(102, 126, 234, 0.2);border-radius:12px;font-size:1rem;background:var(--bg-secondary);backdrop-filter:blur(10px);color:var(--text-primary);font-weight:500;cursor:pointer;transition:all 0.3s ease}.sort-select:focus {outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1)}.result-item {padding:25px;border:1px solid rgba(102, 126, 234, 0.1);border-radius:var(--border-radius-lg);margin-bottom:20px;transition:all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);cursor:pointer;background:rgba(255, 255, 255, 0.5);backdrop-filter:blur(10px);position:relative;overflow:hidden}.result-item::before {content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);border-radius:20px 20px 0 0;opacity:0;transition:opacity 0.3s ease}.result-item:hover::before {opacity:1}.result-item:hover {border-color:rgba(102, 126, 234, 0.3);box-shadow:0 15px 50px rgba(102, 126, 234, 0.1), 0 8px 25px rgba(0, 0, 0, 0.05);transform:translateY(-5px) scale(1.01);background:var(--bg-secondary)}.result-title {font-size:1.4rem;font-weight:700;background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:12px;display:flex;align-items:center;gap:12px;position:relative;z-index:1}.result-icon {font-size:1.3rem;filter:drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1))}.result-description {color:var(--text-secondary);line-height:1.6;margin-bottom:18px;font-size:1rem;font-weight:500;position:relative;z-index:1}.result-meta {display:flex;gap:20px;font-size:0.9rem;flex-wrap:wrap;position:relative;z-index:1}.meta-item {display:flex;align-items:center;gap:6px;color:var(--text-muted);font-weight:500}.difficulty-badge {padding:6px 12px;border-radius:var(--border-radius);font-size:0.8rem;font-weight:600;backdrop-filter:blur(10px);border:1px solid rgba(255, 255, 255, 0.2);box-shadow:var(--shadow-md)}.difficulty-beginner {background:linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);color:#155724;border-color:rgba(21, 87, 36, 0.2)}.difficulty-intermediate {background:linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);color:#856404;border-color:rgba(133, 100, 4, 0.2)}.difficulty-advanced {background:linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);color:#721c24;border-color:rgba(114, 28, 36, 0.2)}.status-badge {padding:6px 12px;border-radius:var(--border-radius);font-size:0.8rem;font-weight:600;backdrop-filter:blur(10px);border:1px solid rgba(255, 255, 255, 0.2);box-shadow:var(--shadow-md)}.status-implemented {background:linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);color:#0c5460;border-color:rgba(12, 84, 96, 0.2)}.status-developing {background:linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);color:#721c24;border-color:rgba(114, 28, 36, 0.2)}.no-results {text-align:center;padding:60px 20px;color:#666}.no-results-icon {font-size:4rem;margin-bottom:20px;opacity:0.5}.pagination {display:flex;justify-content:center;margin-top:30px;gap:10px}.page-btn {padding:8px 12px;border:1px solid #ddd;border-radius:6px;color:#666;text-decoration:none;transition:all 0.2s ease}.page-btn:hover, .page-btn.active {background:var(--accent-color);color:var(--text-inverse);border-color:var(--accent-color);text-decoration:none}.clear-history-btn {background:#f8f9fa;border:1px solid #ddd;color:#666;padding:6px 12px;border-radius:6px;font-size:0.8rem;cursor:pointer;transition:all 0.2s ease;width:100%;margin-top:10px}.clear-history-btn:hover {background:#e9ecef}@media (max-width:768px) {.search-container {padding:30px 25px}.search-header {padding:40px 30px;margin:0 10px 40px 10px;border-radius:25px}.search-title {font-size:2.5rem}.search-subtitle {font-size:1.2rem}.search-form {max-width:100%}.search-content {grid-template-columns:1fr;gap:30px;margin:0 15px}.search-sidebar {position:static;order:2;padding:25px 20px;border-radius:var(--border-radius-lg)}.search-input {padding:16px 20px 16px 50px;font-size:1.1rem;border-radius:25px}.search-btn {padding:12px 20px;border-radius:var(--border-radius-lg)}.search-icon {left:18px;font-size:1.2rem}.result-item {padding:20px;border-radius:18px}.result-title {font-size:1.2rem}.result-meta {flex-direction:column;gap:10px}.sidebar-title {font-size:1.1rem}.filter-select {padding:10px 14px}}}</style>
{% endblock %}

{% block content %}
<div class="search-container"><!-- æœç´¢å¤´éƒ¨ --><div class="search-header"><h1 class="search-title">ğŸ” æ™ºèƒ½æœç´¢</h1><p>å¿«é€Ÿæ‰¾åˆ°æ‚¨éœ€è¦çš„è®¡ç®—æœºç§‘å­¦çŸ¥è¯†ç‚¹</p><!-- æœç´¢è¡¨å• --><form class="search-form" method="get" action="{% url 'knowledge_app:search' %}"><div class="search-input-group"><span class="search-icon">ğŸ”</span><input type="text"
                       name="q"
                       class="search-input"
                       placeholder="æœç´¢çŸ¥è¯†ç‚¹ã€ç®—æ³•ã€æ•°æ®ç»“æ„..."
                       value="{{ query }}"
                       autocomplete="off"
                       id="search-input"><button type="submit" class="search-btn">æœç´¢</button><!-- æœç´¢å»ºè®® --><div class="search-suggestions" id="search-suggestions"></div></div></form></div><!-- æœç´¢å†…å®¹ --><div class="search-content"><!-- ä¾§è¾¹æ  --><div class="search-sidebar"><!-- è¿‡æ»¤å™¨ --><div class="sidebar-section"><h3 class="sidebar-title"><span>ğŸ¯</span> ç­›é€‰æ¡ä»¶
                </h3><form method="get" action="{% url 'knowledge_app:search' %}" id="filter-form"><input type="hidden" name="q" value="{{ query }}"><div class="filter-group"><label class="filter-label">åˆ†ç±»</label><select name="category" class="filter-select" onchange="submitFilters()"><option value="">å…¨éƒ¨åˆ†ç±»</option>
                            {% for category in search_filters.categories %}
                            <option value="{{ category.value }}"
                                    {% if current_filters.category == category.value %}selected{% endif %}>
                                {{ category.label }}
                            </option>
                            {% endfor %}
                        </select></div><div class="filter-group"><label class="filter-label">éš¾åº¦</label><select name="difficulty" class="filter-select" onchange="submitFilters()"><option value="">å…¨éƒ¨éš¾åº¦</option>
                            {% for difficulty in search_filters.difficulties %}
                            <option value="{{ difficulty.value }}"
                                    {% if current_filters.difficulty == difficulty.value %}selected{% endif %}>
                                {{ difficulty.label }}
                            </option>
                            {% endfor %}
                        </select></div><div class="filter-group"><label class="filter-label">çŠ¶æ€</label><select name="implemented" class="filter-select" onchange="submitFilters()"><option value="">å…¨éƒ¨çŠ¶æ€</option><option value="true" {% if current_filters.implemented == 'true' %}selected{% endif %}>å·²å®ç°</option><option value="false" {% if current_filters.implemented == 'false' %}selected{% endif %}>å¼€å‘ä¸­</option></select></div></form></div><!-- çƒ­é—¨æœç´¢ -->
            {% if popular_searches %}
            <div class="sidebar-section"><h3 class="sidebar-title"><span>ğŸ”¥</span> çƒ­é—¨æœç´¢
                </h3>
                {% for search in popular_searches %}
                <a href="{% url 'knowledge_app:search' %}?q={{ search.query }}" class="popular-item">
                    {{ search.query }} ({{ search.count }})
                </a>
                {% endfor %}
            </div>
            {% endif %}

            <!-- æœç´¢å†å² -->
            {% if user.is_authenticated and user_history %}
            <div class="sidebar-section"><h3 class="sidebar-title"><span>ğŸ“š</span> æœç´¢å†å²
                </h3>
                {% for history in user_history %}
                <a href="{% url 'knowledge_app:search' %}?q={{ history.query }}" class="history-item">
                    {{ history.query }}
                </a>
                {% endfor %}
                <button class="clear-history-btn" onclick="clearSearchHistory()">
                    æ¸…é™¤å†å²
                </button></div>
            {% endif %}
        </div><!-- æœç´¢ç»“æœ --><div class="search-results">
            {% if query %}
            <!-- ç»“æœå¤´éƒ¨ --><div class="results-header"><div class="results-info">
                    æ‰¾åˆ° <strong>{{ total_results }}</strong> ä¸ªç»“æœ
                    {% if search_time %}(ç”¨æ—¶ {{ search_time }}ms){% endif %}
                </div><form method="get" action="{% url 'knowledge_app:search' %}" style="display: inline;"><input type="hidden" name="q" value="{{ query }}"><input type="hidden" name="category" value="{{ current_filters.category }}"><input type="hidden" name="difficulty" value="{{ current_filters.difficulty }}"><input type="hidden" name="implemented" value="{{ current_filters.implemented }}"><select name="sort" class="sort-select" onchange="this.form.submit()"><option value="relevance" {% if current_filters.sort == 'relevance' %}selected{% endif %}>ç›¸å…³æ€§</option><option value="title" {% if current_filters.sort == 'title' %}selected{% endif %}>æ ‡é¢˜</option><option value="category" {% if current_filters.sort == 'category' %}selected{% endif %}>åˆ†ç±»</option><option value="difficulty" {% if current_filters.sort == 'difficulty' %}selected{% endif %}>éš¾åº¦</option></select></form></div><!-- æœç´¢ç»“æœåˆ—è¡¨ -->
            {% if results %}
                {% for result in results %}
                <div class="result-item" onclick="window.location.href='{% url 'knowledge_app:detail' result.slug %}'"><div class="result-title"><span class="result-icon">{{ result.icon }}</span>
                        {{ result.title }}
                    </div><div class="result-description">
                        {{ result.description|truncatewords:30 }}
                    </div><div class="result-meta"><div class="meta-item"><span>ğŸ“‚</span>
                            {{ result.category_display }}
                        </div><div class="meta-item"><span class="difficulty-badge difficulty-{{ result.difficulty }}">
                                {% if result.difficulty == 'beginner' %}åˆçº§
                                {% elif result.difficulty == 'intermediate' %}ä¸­çº§
                                {% else %}é«˜çº§{% endif %}
                            </span></div><div class="meta-item"><span class="status-badge {% if result.is_implemented %}status-implemented{% else %}status-developing{% endif %}">
                                {% if result.is_implemented %}å·²å®ç°{% else %}å¼€å‘ä¸­{% endif %}
                            </span></div>
                        {% if result.search_score %}
                        <div class="meta-item"><span>â­</span>
                            åŒ¹é…åº¦: {{ result.search_score }}%
                        </div>
                        {% endif %}
                    </div></div>
                {% endfor %}

                <!-- åˆ†é¡µ -->
                {% if results.has_other_pages %}
                <div class="pagination">
                    {% if results.has_previous %}
                    <a href="?q={{ query }}&category={{ current_filters.category }}&difficulty={{ current_filters.difficulty }}&implemented={{ current_filters.implemented }}&sort={{ current_filters.sort }}&page={{ results.previous_page_number }}" class="page-btn">ä¸Šä¸€é¡µ</a>
                    {% endif %}

                    {% for num in results.paginator.page_range %}
                        {% if num == results.number %}
                        <span class="page-btn active">{{ num }}</span>
                        {% else %}
                        <a href="?q={{ query }}&category={{ current_filters.category }}&difficulty={{ current_filters.difficulty }}&implemented={{ current_filters.implemented }}&sort={{ current_filters.sort }}&page={{ num }}" class="page-btn">{{ num }}</a>
                        {% endif %}
                    {% endfor %}

                    {% if results.has_next %}
                    <a href="?q={{ query }}&category={{ current_filters.category }}&difficulty={{ current_filters.difficulty }}&implemented={{ current_filters.implemented }}&sort={{ current_filters.sort }}&page={{ results.next_page_number }}" class="page-btn">ä¸‹ä¸€é¡µ</a>
                    {% endif %}
                </div>
                {% endif %}
            {% else %}
                <!-- æ— ç»“æœ --><div class="no-results"><div class="no-results-icon">ğŸ”</div><h3>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ</h3><p>å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯æˆ–è°ƒæ•´ç­›é€‰æ¡ä»¶</p><div style="margin-top: 20px;"><strong>æœç´¢å»ºè®®ï¼š</strong><ul style="text-align: left; display: inline-block; margin-top: 10px;"><li>æ£€æŸ¥æ‹¼å†™æ˜¯å¦æ­£ç¡®</li><li>å°è¯•ä½¿ç”¨æ›´é€šç”¨çš„å…³é”®è¯</li><li>å‡å°‘ç­›é€‰æ¡ä»¶</li><li>ä½¿ç”¨åŒä¹‰è¯æˆ–ç›¸å…³æœ¯è¯­</li></ul></div></div>
            {% endif %}
            {% else %}
            <!-- é»˜è®¤é¡µé¢ --><div style="text-align: center; padding: 60px 20px;"><div style="font-size: 4rem; margin-bottom: 20px;">ğŸ¯</div><h3>å¼€å§‹æ‚¨çš„çŸ¥è¯†æ¢ç´¢ä¹‹æ—…</h3><p>åœ¨ä¸Šæ–¹æœç´¢æ¡†ä¸­è¾“å…¥æ‚¨æƒ³å­¦ä¹ çš„å†…å®¹</p>

                {% if popular_searches %}
                <div style="margin-top: 30px;"><h4>çƒ­é—¨æœç´¢ï¼š</h4><div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 15px;">
                        {% for search in popular_searches|slice:":5" %}
                        <a href="{% url 'knowledge_app:search' %}?q={{ search.query }}"
                           style="background: #f0f0f0; padding: 8px 16px; border-radius: var(--border-radius-lg); text-decoration: none; color: #666; transition: all 0.2s ease;">
                            {{ search.query }}
                        </a>
                        {% endfor %}
                    </div></div>
                {% endif %}
            </div>
            {% endif %}
        </div></div></div>
{% endblock %}

{% block extra_js %}
<script>document.addEventListener('DOMContentLoaded', function() { const searchInput = document.getElementById('search-input'); const suggestionsContainer = document.getElementById('search-suggestions'); let searchTimeout; if (searchInput) { searchInput.addEventListener('input', function() { const query = this.value.trim(); clearTimeout(searchTimeout); if (query.length < 1) { hideSuggestions(); return; } searchTimeout = setTimeout(() => { fetchSuggestions(query); }, 300); }); document.addEventListener('click', function(e) { if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) { hideSuggestions(); } }); searchInput.addEventListener('keydown', function(e) { const suggestions = suggestionsContainer.querySelectorAll('.suggestion-item'); const activeSuggestion = suggestionsContainer.querySelector('.suggestion-item.active'); if (e.key === 'ArrowDown') { e.preventDefault(); if (activeSuggestion) { activeSuggestion.classList.remove('active'); const next = activeSuggestion.nextElementSibling; if (next) { next.classList.add('active'); } else { suggestions[0]?.classList.add('active'); } } else { suggestions[0]?.classList.add('active'); } } else if (e.key === 'ArrowUp') { e.preventDefault(); if (activeSuggestion) { activeSuggestion.classList.remove('active'); const prev = activeSuggestion.previousElementSibling; if (prev) { prev.classList.add('active'); } else { suggestions[suggestions.length - 1]?.classList.add('active'); } } else { suggestions[suggestions.length - 1]?.classList.add('active'); } } else if (e.key === 'Enter') { if (activeSuggestion) { e.preventDefault(); const text = activeSuggestion.querySelector('.suggestion-text').textContent; searchInput.value = text; hideSuggestions(); searchInput.form.submit(); } } else if (e.key === 'Escape') { hideSuggestions(); } }); } function fetchSuggestions(query) { fetch(`/api/search-suggestions/?q=${encodeURIComponent(query)}`) .then(response => response.json()) .then(data => { showSuggestions(data.suggestions); }) .catch(error => { console.error('è·å–æœç´¢å»ºè®®å¤±è´¥:', error); }); } function showSuggestions(suggestions) { if (suggestions.length === 0) { hideSuggestions(); return; } const html = suggestions.map(suggestion => ` <div class="suggestion-item" onclick="selectSuggestion('${suggestion.text}')"><span class="suggestion-icon"> ${suggestion.type === 'completion' ? 'ğŸ”' : 'ğŸ’¡'} </span><span class="suggestion-text">${suggestion.text}</span><span class="suggestion-category">${suggestion.category}</span></div> `).join(''); suggestionsContainer.innerHTML = html; suggestionsContainer.style.display = 'block'; } function hideSuggestions() { suggestionsContainer.style.display = 'none'; } window.selectSuggestion = function(text) { searchInput.value = text; hideSuggestions(); searchInput.form.submit(); }; function animatePageElements() { const resultItems = document.querySelectorAll('.result-item'); resultItems.forEach((item, index) => { item.style.opacity = '0'; item.style.transform = 'translateY(30px) scale(0.95)'; setTimeout(() => { item.style.transition = 'all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)'; item.style.opacity = '1'; item.style.transform = 'translateY(0) scale(1)'; }, index * 150); }); const sidebar = document.querySelector('.search-sidebar'); if (sidebar) { sidebar.style.opacity = '0'; sidebar.style.transform = 'translateX(-30px)'; setTimeout(() => { sidebar.style.transition = 'all 0.8s ease'; sidebar.style.opacity = '1'; sidebar.style.transform = 'translateX(0)'; }, 300); } const searchForm = document.querySelector('.search-form'); if (searchForm) { searchForm.style.opacity = '0'; searchForm.style.transform = 'translateY(-20px)'; setTimeout(() => { searchForm.style.transition = 'all 0.6s ease'; searchForm.style.opacity = '1'; searchForm.style.transform = 'translateY(0)'; }, 100); } } animatePageElements(); const searchInput = document.querySelector('.search-input'); if (searchInput) { searchInput.addEventListener('focus', function() { this.parentElement.style.transform = 'scale(1.02)'; }); searchInput.addEventListener('blur', function() { this.parentElement.style.transform = 'scale(1)'; }); } }); function submitFilters() { document.getElementById('filter-form').submit(); } function clearSearchHistory() { if (confirm('ç¡®å®šè¦æ¸…é™¤æœç´¢å†å²å—ï¼Ÿ')) { fetch('/users/api/clear-search-history/', { method: 'POST', headers: { 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '', 'Content-Type': 'application/json', }, }) .then(response => response.json()) .then(data => { if (data.success) { location.reload(); } else { alert('æ¸…é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'); } }) .catch(error => { console.error('æ¸…é™¤æœç´¢å†å²å¤±è´¥:', error); alert('æ¸…é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'); }); } } if (window.location.search.includes('q=')) { const urlParams = new URLSearchParams(window.location.search); const query = urlParams.get('q'); if (query) { console.log('æœç´¢æŸ¥è¯¢:', query); } }</script>
{% endblock %}
