{% extends 'knowledge_app/base.html' %}

{% block title %}é˜Ÿåˆ—â€”â€”ç¼“å†²åŒº - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<style>.page-container {max-width:1200px;margin:0 auto;padding:20px;font-family:'Arial', sans-serif}.knowledge-section {background:white;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);margin-bottom:30px;padding:30px;border-left:5px solid #3498db}.section-header {display:flex;align-items:center;margin-bottom:25px;border-bottom:2px solid #ecf0f1;padding-bottom:15px}.section-icon {font-size:2em;margin-right:15px}.section-title {font-size:1.8em;color:#2c3e50;margin:0}.concept-grid {display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:20px;margin:20px 0}.concept-card {background:#f8f9fa;border:1px solid #e9ecef;border-radius:8px;padding:20px;text-align:center;transition:transform 0.3s ease}.concept-card:hover {transform:translateY(-5px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}.canvas-container {background:#f8f9fa;border:2px solid #dee2e6;border-radius:8px;padding:20px;margin:20px 0;text-align:center}.simulation-controls {margin:15px 0;display:flex;flex-wrap:wrap;justify-content:center;gap:15px;align-items:center}.control-group {display:flex;flex-direction:column;align-items:center;background:white;padding:15px;border-radius:8px;border:1px solid #dee2e6;min-width:120px}.control-label {font-size:12px;font-weight:bold;color:#2c3e50;margin-bottom:8px}.btn {background:#3498db;color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;margin:2px;font-size:12px;font-weight:bold;transition:all 0.3s ease;box-shadow:0 3px 10px rgba(52, 152, 219, 0.3)}.btn:hover {transform:translateY(-1px);box-shadow:0 4px 15px rgba(52, 152, 219, 0.4)}.btn:disabled {background:#95a5a6;cursor:not-allowed;transform:none;box-shadow:none}.btn-producer {background:linear-gradient(135deg, #27ae60, #2ecc71)}.btn-consumer {background:linear-gradient(135deg, #e74c3c, #ec7063)}.btn-control {background:linear-gradient(135deg, #f39c12, #f7dc6f)}.speed-control {display:flex;align-items:center;gap:10px}.speed-slider {width:80px;margin:0 5px}.stats-display {display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:10px;margin:15px 0;padding:15px;background:white;border-radius:8px;border:1px solid #dee2e6}.stat-item {text-align:center;padding:10px;background:#f8f9fa;border-radius:6px}.stat-value {font-size:18px;font-weight:bold;color:#2c3e50}.stat-label {font-size:12px;color:#7f8c8d;margin-top:5px}.code-container {background:#2c3e50;color:#ecf0f1;border-radius:8px;margin:20px 0;overflow:hidden}.code-tabs {display:flex;background:#34495e}.code-tab {padding:12px 20px;cursor:pointer;border:none;background:transparent;color:#bdc3c7;font-weight:bold;transition:all 0.3s ease}.code-tab.active {background:#3498db;color:white}.code-content {position:relative;padding:20px;font-family:'Courier New', monospace;line-height:1.6;overflow-x:auto}.copy-btn {position:absolute;top:10px;right:10px;background:#27ae60;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;font-size:12px}.analogy-box {background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;padding:25px;border-radius:12px;margin:20px 0}.highlight {color:#000000;padding:2px 4px;border-radius:3px;font-weight:bold}.difficulty-badge {display:inline-block;padding:5px 15px;border-radius:20px;font-size:0.9em;font-weight:bold;color:white;background:#e67e22}.key-point {border-left:4px solid #e74c3c;background:#fdf2f2;padding:15px;margin:15px 0;border-radius:0 8px 8px 0}.application-grid {display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:20px 0}.application-card {padding:20px;border-radius:8px;border:2px solid;position:relative;overflow:hidden}.app-network {border-color:#3498db;background:linear-gradient(135deg, #ebf3fd 0%, #f8fbff 100%)}.app-audio {border-color:#9b59b6;background:linear-gradient(135deg, #f4ecf7 0%, #faf8fc 100%)}.app-io {border-color:#e67e22;background:linear-gradient(135deg, #fef4e7 0%, #fffaf5 100%)}.app-keyboard {border-color:#27ae60;background:linear-gradient(135deg, #eafaf1 0%, #f7fdf9 100%)}.quiz-question {background:#fff3cd;border:1px solid #ffeaa7;border-radius:8px;padding:20px;margin:15px 0}.quiz-answer {background:#d1ecf1;border:1px solid #bee5eb;border-radius:8px;padding:15px;margin-top:10px;display:none}.show-answer-btn {background:#17a2b8;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;margin-top:10px}</style><div class="page-container fade-in"><!-- é¢åŒ…å±‘å¯¼èˆª --><div class="breadcrumb"><a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a><span>></span><span>æ•°æ®ç»“æ„</span><span>></span><span>é˜Ÿåˆ—ç¼“å†²åŒºåº”ç”¨</span></div><!-- é¡µé¢å¤´éƒ¨ --><div class="page-header slide-in-left"><h1><span class="page-icon">ğŸ”„</span>
            é˜Ÿåˆ—â€”â€”ç¼“å†²åŒº (Queue Buffer Applications)
        </h1><p>æ¢ç´¢é˜Ÿåˆ—åœ¨ç¼“å†²åŒºä¸­çš„æ ¸å¿ƒä½œç”¨ï¼Œç†è§£ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼</p></div><!-- ğŸ“‹ çŸ¥è¯†ç‚¹æ¦‚è¿° --><div class="knowledge-section slide-in-right"><div class="section-header"><span class="section-icon">ğŸ“‹</span><h2 class="section-title">ç¼“å†²åŒºåŸºç¡€æ¦‚å¿µ</h2></div><div class="key-point"><strong>æ ¸å¿ƒæ¦‚å¿µï¼š</strong>ç¼“å†²åŒºæ˜¯ä¸€å—ä¸´æ—¶å­˜å‚¨æ•°æ®çš„å†…å­˜åŒºåŸŸï¼Œç”¨é˜Ÿåˆ—å®ç°å¯ä»¥æœ‰æ•ˆå¹³è¡¡ä¸åŒé€Ÿåº¦çš„æ•°æ®ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„å¤„ç†å·®å¼‚ï¼Œæä¾›æµé‡æ§åˆ¶å’Œæ•°æ®æš‚å­˜åŠŸèƒ½ã€‚
        </div><div class="concept-grid"><div class="concept-card"><h3>ğŸ­ ç”Ÿäº§è€…</h3><p>å‘ç¼“å†²åŒºå†™å…¥æ•°æ®çš„ç»„ä»¶<br>ä¾‹ï¼šç½‘ç»œæ•°æ®åŒ…ã€ç”¨æˆ·è¾“å…¥</p></div><div class="concept-card"><h3>ğŸ›’ æ¶ˆè´¹è€…</h3><p>ä»ç¼“å†²åŒºè¯»å–æ•°æ®çš„ç»„ä»¶<br>ä¾‹ï¼šåº”ç”¨ç¨‹åºã€æ˜¾ç¤ºè®¾å¤‡</p></div><div class="concept-card"><h3>ğŸ“¦ ç¼“å†²åŒº</h3><p>åŸºäºé˜Ÿåˆ—çš„ä¸´æ—¶å­˜å‚¨ç©ºé—´<br>FIFOé¡ºåºä¿è¯æ•°æ®æœ‰åºå¤„ç†</p></div><div class="concept-card"><h3>âš–ï¸ æµé‡æ§åˆ¶</h3><p>å¹³è¡¡ç”Ÿäº§å’Œæ¶ˆè´¹é€Ÿåº¦å·®å¼‚<br>é˜²æ­¢æ•°æ®ä¸¢å¤±æˆ–ç³»ç»Ÿé˜»å¡</p></div></div><p><span class="difficulty-badge">åº”ç”¨çº§</span><strong>å‰ç½®çŸ¥è¯†ï¼š</strong>é˜Ÿåˆ—åŸºç¡€æ“ä½œã€å¤šçº¿ç¨‹æ¦‚å¿µã€ç³»ç»ŸI/O</p></div><!-- ğŸ” æ¦‚å¿µè¯¦è§£ --><div class="knowledge-section"><div class="section-header"><span class="section-icon">ğŸ”</span><h2 class="section-title">ç¼“å†²åŒºå·¥ä½œåŸç†</h2></div><div class="analogy-box"><h3>ğŸª ç”Ÿæ´»ç±»æ¯”ï¼šé¤å…å¨æˆ¿</h3><p>æƒ³è±¡ä¸€ä¸ªç¹å¿™çš„é¤å…ï¼š</p><ul><li><strong>å¨å¸ˆ</strong> = ç”Ÿäº§è€…ï¼ˆåˆ¶ä½œèœå“çš„é€Ÿåº¦å¯èƒ½ä¸ç¨³å®šï¼‰</li><li><strong>æœåŠ¡å‘˜</strong> = æ¶ˆè´¹è€…ï¼ˆä¸Šèœçš„é€Ÿåº¦ä¹Ÿå¯èƒ½å˜åŒ–ï¼‰</li><li><strong>ä¼ èœå°</strong> = ç¼“å†²åŒºï¼ˆæš‚æ—¶æ”¾ç½®åšå¥½çš„èœå“ï¼‰</li><li><strong>ä¼ èœé¡ºåº</strong> = FIFOï¼ˆå…ˆåšå¥½çš„èœå…ˆç«¯èµ°ï¼‰</li></ul><p>ğŸ’¡ å…³é”®ï¼š<span class="highlight">ä¼ èœå°é¿å…äº†å¨å¸ˆå’ŒæœåŠ¡å‘˜é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼</span></p></div><h3>ğŸ¯ ç¼“å†²åŒºçš„æ ¸å¿ƒä»·å€¼</h3><div class="key-point"><strong>è§£å†³çš„å…³é”®é—®é¢˜ï¼š</strong><ul><li><strong>é€Ÿåº¦åŒ¹é…</strong>ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦ä¸åŒ</li><li><strong>æ—¶é—´è§£è€¦</strong>ï¼šç”Ÿäº§å’Œæ¶ˆè´¹å¯ä»¥åœ¨ä¸åŒæ—¶é—´è¿›è¡Œ</li><li><strong>çªå‘å¤„ç†</strong>ï¼šå¤„ç†æ•°æ®æµé‡çš„çŸ­æœŸæ³¢åŠ¨</li><li><strong>ç³»ç»Ÿç¨³å®š</strong>ï¼šé˜²æ­¢å¿«é€Ÿç”Ÿäº§è€…å‹å®æ…¢é€Ÿæ¶ˆè´¹è€…</li><li><strong>èµ„æºä¼˜åŒ–</strong>ï¼šå……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œå‡å°‘ç­‰å¾…æ—¶é—´</li></ul></div><h3>âš¡ ç¼“å†²åŒºçŠ¶æ€ç®¡ç†</h3><div class="application-grid"><div class="application-card app-network"><h4>ğŸ“Š ç¼“å†²åŒºæ»¡</h4><ul><li>ç”Ÿäº§è€…é€Ÿåº¦ > æ¶ˆè´¹è€…é€Ÿåº¦</li><li>éœ€è¦æš‚åœç”Ÿäº§æˆ–ä¸¢å¼ƒæ•°æ®</li><li>å¯èƒ½è§¦å‘æµé‡æ§åˆ¶æœºåˆ¶</li></ul></div><div class="application-card app-audio"><h4>ğŸ“­ ç¼“å†²åŒºç©º</h4><ul><li>æ¶ˆè´¹è€…é€Ÿåº¦ > ç”Ÿäº§è€…é€Ÿåº¦</li><li>æ¶ˆè´¹è€…éœ€è¦ç­‰å¾…æˆ–å¤„ç†ç©ºé—²</li><li>å¯èƒ½å¯¼è‡´å¤„ç†ä¸­æ–­</li></ul></div></div></div><!-- ğŸ“Š å¯è§†åŒ–å±•ç¤º --><div class="knowledge-section"><div class="section-header"><span class="section-icon">ğŸ“Š</span><h2 class="section-title">ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡æ‹Ÿ</h2></div><div class="canvas-container"><h3>ğŸ”„ ç¼“å†²åŒºåŠ¨æ€ä»¿çœŸ</h3><canvas id="bufferCanvas" width="900" height="400" style="border: 2px solid #3498db; border-radius: 8px; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);"></canvas><div class="simulation-controls"><div class="control-group"><div class="control-label">ğŸ­ ç”Ÿäº§è€…</div><button class="btn btn-producer" onclick="toggleProducer()">å¯åŠ¨ç”Ÿäº§</button><div class="speed-control"><span style="font-size: 10px;">æ…¢</span><input type="range" id="producerSpeed" class="speed-slider" min="1" max="10" value="5"><span style="font-size: 10px;">å¿«</span></div></div><div class="control-group"><div class="control-label">ğŸ›’ æ¶ˆè´¹è€…</div><button class="btn btn-consumer" onclick="toggleConsumer()">å¯åŠ¨æ¶ˆè´¹</button><div class="speed-control"><span style="font-size: 10px;">æ…¢</span><input type="range" id="consumerSpeed" class="speed-slider" min="1" max="10" value="5"><span style="font-size: 10px;">å¿«</span></div></div><div class="control-group"><div class="control-label">ğŸ® ç³»ç»Ÿæ§åˆ¶</div><button class="btn btn-control" onclick="resetBuffer()">é‡ç½®</button><button class="btn btn-control" onclick="startDemo()">è‡ªåŠ¨æ¼”ç¤º</button></div><div class="control-group"><div class="control-label">ğŸ“ ç¼“å†²åŒºå¤§å°</div><div class="speed-control"><span style="font-size: 10px;">å°</span><input type="range" id="bufferSize" class="speed-slider" min="5" max="15" value="10" onchange="resizeBuffer()"><span style="font-size: 10px;">å¤§</span></div></div></div><div class="stats-display"><div class="stat-item"><div class="stat-value" id="producedCount">0</div><div class="stat-label">å·²ç”Ÿäº§</div></div><div class="stat-item"><div class="stat-value" id="consumedCount">0</div><div class="stat-label">å·²æ¶ˆè´¹</div></div><div class="stat-item"><div class="stat-value" id="bufferCount">0</div><div class="stat-label">ç¼“å†²åŒºå†…</div></div><div class="stat-item"><div class="stat-value" id="bufferUsage">0%</div><div class="stat-label">ç¼“å†²åŒºä½¿ç”¨ç‡</div></div><div class="stat-item"><div class="stat-value" id="blockedProducer">0</div><div class="stat-label">ç”Ÿäº§è€…é˜»å¡æ¬¡æ•°</div></div><div class="stat-item"><div class="stat-value" id="blockedConsumer">0</div><div class="stat-label">æ¶ˆè´¹è€…é˜»å¡æ¬¡æ•°</div></div></div></div></div><!-- ğŸŒŸ å®é™…åº”ç”¨åœºæ™¯ --><div class="knowledge-section"><div class="section-header"><span class="section-icon">ğŸŒŸ</span><h2 class="section-title">å®é™…åº”ç”¨åœºæ™¯</h2></div><div class="concept-grid"><div class="application-card app-network"><h3>ğŸŒ ç½‘ç»œæ•°æ®åŒ…ç¼“å†²</h3><p><strong>åœºæ™¯</strong>ï¼šç½‘ç»œä¼ è¾“ä¸­çš„æ•°æ®åŒ…å¤„ç†</p><ul><li><strong>ç”Ÿäº§è€…</strong>ï¼šç½‘ç»œæ¥å£æ¥æ”¶æ•°æ®åŒ…</li><li><strong>æ¶ˆè´¹è€…</strong>ï¼šåº”ç”¨ç¨‹åºå¤„ç†æ•°æ®åŒ…</li><li><strong>ç¼“å†²ä½œç”¨</strong>ï¼šå¹³æ»‘ç½‘ç»œæ³¢åŠ¨ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±</li></ul></div><div class="application-card app-audio"><h3>ğŸµ éŸ³é¢‘æµç¼“å†²</h3><p><strong>åœºæ™¯</strong>ï¼šéŸ³é¢‘æ’­æ”¾å’Œå½•åˆ¶</p><ul><li><strong>ç”Ÿäº§è€…</strong>ï¼šéŸ³é¢‘è§£ç å™¨æˆ–éº¦å…‹é£</li><li><strong>æ¶ˆè´¹è€…</strong>ï¼šæ‰¬å£°å™¨æˆ–éŸ³é¢‘å¤„ç†</li><li><strong>ç¼“å†²ä½œç”¨</strong>ï¼šç¡®ä¿è¿ç»­æ’­æ”¾ï¼Œé¿å…å¡é¡¿</li></ul></div><div class="application-card app-io"><h3>ğŸ’¾ ç£ç›˜I/Oç¼“å†²</h3><p><strong>åœºæ™¯</strong>ï¼šæ–‡ä»¶è¯»å†™æ“ä½œ</p><ul><li><strong>ç”Ÿäº§è€…</strong>ï¼šåº”ç”¨ç¨‹åºå†™å…¥è¯·æ±‚</li><li><strong>æ¶ˆè´¹è€…</strong>ï¼šç£ç›˜æ§åˆ¶å™¨</li><li><strong>ç¼“å†²ä½œç”¨</strong>ï¼šæ‰¹é‡å¤„ç†ï¼Œæé«˜I/Oæ•ˆç‡</li></ul></div><div class="application-card app-keyboard"><h3>âŒ¨ï¸ é”®ç›˜è¾“å…¥ç¼“å†²</h3><p><strong>åœºæ™¯</strong>ï¼šç”¨æˆ·è¾“å…¥å¤„ç†</p><ul><li><strong>ç”Ÿäº§è€…</strong>ï¼šé”®ç›˜ç¡¬ä»¶</li><li><strong>æ¶ˆè´¹è€…</strong>ï¼šåº”ç”¨ç¨‹åº</li><li><strong>ç¼“å†²ä½œç”¨</strong>ï¼šæš‚å­˜æŒ‰é”®ï¼Œé˜²æ­¢è¾“å…¥ä¸¢å¤±</li></ul></div></div><div class="key-point"><h3>ğŸ¯ ç¼“å†²åŒºè®¾è®¡è€ƒè™‘å› ç´ </h3><ul><li><strong>ç¼“å†²åŒºå¤§å°</strong>ï¼šå¤ªå°å®¹æ˜“æ»¡ï¼Œå¤ªå¤§æµªè´¹å†…å­˜</li><li><strong>é˜»å¡ç­–ç•¥</strong>ï¼šæ»¡æ—¶æ˜¯é˜»å¡ç”Ÿäº§è€…è¿˜æ˜¯ä¸¢å¼ƒæ•°æ®</li><li><strong>ä¼˜å…ˆçº§</strong>ï¼šæ˜¯å¦éœ€è¦æ”¯æŒä¸åŒä¼˜å…ˆçº§çš„æ•°æ®</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„åŒæ­¥æ§åˆ¶</li><li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šç¼“å†²åŒºä½¿ç”¨ç‡å’Œé˜»å¡æƒ…å†µç»Ÿè®¡</li></ul></div></div><!-- ğŸ’» ä»£ç å®ç° --><div class="knowledge-section"><div class="section-header"><span class="section-icon">ğŸ’»</span><h2 class="section-title">ç¼“å†²åŒºä»£ç å®ç°</h2></div><div class="code-container"><div class="code-tabs"><button class="code-tab active" onclick="showCode('simple')">ç®€å•ç¼“å†²åŒº</button><button class="code-tab" onclick="showCode('threadsafe')">çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬</button><button class="code-tab" onclick="showCode('producer-consumer')">ç”Ÿäº§è€…-æ¶ˆè´¹è€…</button></div><div id="simple-code" class="code-content"><button class="copy-btn" onclick="copyCode('simple', this)">ğŸ“‹ å¤åˆ¶</button><pre><code>class SimpleBuffer:
    """ç®€å•çš„é˜Ÿåˆ—ç¼“å†²åŒºå®ç°"""

    def __init__(self, capacity):
        self.capacity = capacity
        self.buffer = []
        self.blocked_producers = 0
        self.blocked_consumers = 0

    def produce(self, item):
        """ç”Ÿäº§è€…å‘ç¼“å†²åŒºæ·»åŠ æ•°æ®"""
        if len(self.buffer) >= self.capacity:
            self.blocked_producers += 1
            print(f"ç¼“å†²åŒºå·²æ»¡! ç”Ÿäº§è€…é˜»å¡ï¼Œæ•°æ®: {item}")
            return False

        self.buffer.append(item)
        print(f"ç”Ÿäº§æ•°æ®: {item}, ç¼“å†²åŒºå¤§å°: {len(self.buffer)}")
        return True

    def consume(self):
        """æ¶ˆè´¹è€…ä»ç¼“å†²åŒºè·å–æ•°æ®"""
        if len(self.buffer) == 0:
            self.blocked_consumers += 1
            print("ç¼“å†²åŒºä¸ºç©º! æ¶ˆè´¹è€…é˜»å¡")
            return None

        item = self.buffer.pop(0)  # FIFOé˜Ÿåˆ—
        print(f"æ¶ˆè´¹æ•°æ®: {item}, ç¼“å†²åŒºå¤§å°: {len(self.buffer)}")
        return item

    def is_full(self):
        return len(self.buffer) >= self.capacity

    def is_empty(self):
        return len(self.buffer) == 0

    def size(self):
        return len(self.buffer)

    def usage_rate(self):
        """ç¼“å†²åŒºä½¿ç”¨ç‡"""
        return (len(self.buffer) / self.capacity) * 100

    def get_stats(self):
        """è·å–ç»Ÿè®¡ä¿¡æ¯"""
        return {
            'buffer_size': len(self.buffer),
            'capacity': self.capacity,
            'usage_rate': self.usage_rate(),
            'blocked_producers': self.blocked_producers,
            'blocked_consumers': self.blocked_consumers
        }

# ä½¿ç”¨ç¤ºä¾‹
buffer = SimpleBuffer(5)

# æ¨¡æ‹Ÿç”Ÿäº§å’Œæ¶ˆè´¹
for i in range(7):  # ç”Ÿäº§7ä¸ªï¼Œç¼“å†²åŒºåªèƒ½æ”¾5ä¸ª
    buffer.produce(f"æ•°æ®{i}")

print("\nå¼€å§‹æ¶ˆè´¹:")
for i in range(3):  # æ¶ˆè´¹3ä¸ª
    buffer.consume()

print(f"\nç»Ÿè®¡ä¿¡æ¯: {buffer.get_stats()}")</code></pre></div><div id="threadsafe-code" class="code-content" style="display: none;"><button class="copy-btn" onclick="copyCode('threadsafe', this)">ğŸ“‹ å¤åˆ¶</button><pre><code>import threading
import time
from collections import deque

class ThreadSafeBuffer:
    """çº¿ç¨‹å®‰å…¨çš„ç¼“å†²åŒºå®ç°"""

    def __init__(self, capacity):
        self.capacity = capacity
        self.buffer = deque()
        self.lock = threading.Lock()
        self.not_full = threading.Condition(self.lock)
        self.not_empty = threading.Condition(self.lock)

        # ç»Ÿè®¡ä¿¡æ¯
        self.produced_count = 0
        self.consumed_count = 0
        self.blocked_producers = 0
        self.blocked_consumers = 0

    def produce(self, item, timeout=None):
        """çº¿ç¨‹å®‰å…¨çš„ç”Ÿäº§æ“ä½œ"""
        with self.not_full:
            # ç­‰å¾…ç¼“å†²åŒºä¸æ»¡
            start_time = time.time()
            while len(self.buffer) >= self.capacity:
                self.blocked_producers += 1
                if not self.not_full.wait(timeout):
                    return False  # è¶…æ—¶

            # æ·»åŠ æ•°æ®
            self.buffer.append(item)
            self.produced_count += 1
            print(f"[ç”Ÿäº§è€…] ç”Ÿäº§: {item}, ç¼“å†²åŒº: {len(self.buffer)}/{self.capacity}")

            # é€šçŸ¥æ¶ˆè´¹è€…
            self.not_empty.notify()
            return True

    def consume(self, timeout=None):
        """çº¿ç¨‹å®‰å…¨çš„æ¶ˆè´¹æ“ä½œ"""
        with self.not_empty:
            # ç­‰å¾…ç¼“å†²åŒºä¸ç©º
            while len(self.buffer) == 0:
                self.blocked_consumers += 1
                if not self.not_empty.wait(timeout):
                    return None  # è¶…æ—¶

            # è·å–æ•°æ®
            item = self.buffer.popleft()
            self.consumed_count += 1
            print(f"[æ¶ˆè´¹è€…] æ¶ˆè´¹: {item}, ç¼“å†²åŒº: {len(self.buffer)}/{self.capacity}")

            # é€šçŸ¥ç”Ÿäº§è€…
            self.not_full.notify()
            return item

    def size(self):
        with self.lock:
            return len(self.buffer)

    def is_full(self):
        with self.lock:
            return len(self.buffer) >= self.capacity

    def is_empty(self):
        with self.lock:
            return len(self.buffer) == 0

    def get_stats(self):
        with self.lock:
            return {
                'buffer_size': len(self.buffer),
                'capacity': self.capacity,
                'produced_count': self.produced_count,
                'consumed_count': self.consumed_count,
                'blocked_producers': self.blocked_producers,
                'blocked_consumers': self.blocked_consumers,
                'usage_rate': (len(self.buffer) / self.capacity) * 100
            }</code></pre></div><div id="producer-consumer-code" class="code-content" style="display: none;"><button class="copy-btn" onclick="copyCode('producer-consumer', this)">ğŸ“‹ å¤åˆ¶</button><pre><code>import threading
import time
import random

class ProducerConsumerSystem:
    """å®Œæ•´çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿ"""

    def __init__(self, buffer_capacity=10):
        self.buffer = ThreadSafeBuffer(buffer_capacity)
        self.running = False
        self.producer_threads = []
        self.consumer_threads = []

    def producer_worker(self, producer_id, production_rate=1.0):
        """ç”Ÿäº§è€…å·¥ä½œçº¿ç¨‹"""
        item_count = 0
        while self.running:
            item = f"P{producer_id}-{item_count}"

            if self.buffer.produce(item, timeout=1.0):
                item_count += 1

            # æ ¹æ®ç”Ÿäº§é€Ÿç‡è°ƒæ•´ä¼‘çœ æ—¶é—´
            time.sleep(1.0 / production_rate)

    def consumer_worker(self, consumer_id, consumption_rate=1.0):
        """æ¶ˆè´¹è€…å·¥ä½œçº¿ç¨‹"""
        while self.running:
            item = self.buffer.consume(timeout=1.0)

            if item:
                # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
                processing_time = random.uniform(0.1, 0.3)
                time.sleep(processing_time)

            # æ ¹æ®æ¶ˆè´¹é€Ÿç‡è°ƒæ•´ä¼‘çœ æ—¶é—´
            time.sleep(1.0 / consumption_rate)

    def start_producer(self, producer_id, production_rate=1.0):
        """å¯åŠ¨ç”Ÿäº§è€…"""
        thread = threading.Thread(
            target=self.producer_worker,
            args=(producer_id, production_rate),
            daemon=True
        )
        self.producer_threads.append(thread)
        thread.start()
        print(f"ç”Ÿäº§è€… {producer_id} å·²å¯åŠ¨ (é€Ÿç‡: {production_rate}/ç§’)")

    def start_consumer(self, consumer_id, consumption_rate=1.0):
        """å¯åŠ¨æ¶ˆè´¹è€…"""
        thread = threading.Thread(
            target=self.consumer_worker,
            args=(consumer_id, consumption_rate),
            daemon=True
        )
        self.consumer_threads.append(thread)
        thread.start()
        print(f"æ¶ˆè´¹è€… {consumer_id} å·²å¯åŠ¨ (é€Ÿç‡: {consumption_rate}/ç§’)")

    def start_system(self):
        """å¯åŠ¨ç³»ç»Ÿ"""
        self.running = True
        print("ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿå·²å¯åŠ¨")

    def stop_system(self):
        """åœæ­¢ç³»ç»Ÿ"""
        self.running = False
        print("ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç³»ç»Ÿå·²åœæ­¢")

    def monitor_stats(self, interval=2.0):
        """ç›‘æ§ç³»ç»ŸçŠ¶æ€"""
        while self.running:
            stats = self.buffer.get_stats()
            print(f"\n[ç›‘æ§] ç¼“å†²åŒºçŠ¶æ€:")
            print(f"  å¤§å°: {stats['buffer_size']}/{stats['capacity']}")
            print(f"  ä½¿ç”¨ç‡: {stats['usage_rate']:.1f}%")
            print(f"  å·²ç”Ÿäº§: {stats['produced_count']}")
            print(f"  å·²æ¶ˆè´¹: {stats['consumed_count']}")
            print(f"  ç”Ÿäº§è€…é˜»å¡: {stats['blocked_producers']}")
            print(f"  æ¶ˆè´¹è€…é˜»å¡: {stats['blocked_consumers']}")

            time.sleep(interval)

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    system = ProducerConsumerSystem(buffer_capacity=5)

    # å¯åŠ¨ç³»ç»Ÿ
    system.start_system()

    # å¯åŠ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…
    system.start_producer(1, production_rate=2.0)  # å¿«é€Ÿç”Ÿäº§è€…
    system.start_producer(2, production_rate=1.0)  # æ™®é€šç”Ÿäº§è€…
    system.start_consumer(1, consumption_rate=1.5) # å¿«é€Ÿæ¶ˆè´¹è€…
    system.start_consumer(2, consumption_rate=0.8) # æ…¢é€Ÿæ¶ˆè´¹è€…

    # å¯åŠ¨ç›‘æ§
    monitor_thread = threading.Thread(
        target=system.monitor_stats,
        daemon=True
    )
    monitor_thread.start()

    # è¿è¡Œ10ç§’ååœæ­¢
    time.sleep(10)
    system.stop_system()

    # æœ€ç»ˆç»Ÿè®¡
    print(f"\næœ€ç»ˆç»Ÿè®¡: {system.buffer.get_stats()}")</code></pre></div></div></div><!-- âœ… å­¦ä¹ æ£€éªŒ --><div class="knowledge-section"><div class="section-header"><span class="section-icon">âœ…</span><h2 class="section-title">å­¦ä¹ æ£€éªŒ</h2></div><div class="quiz-question"><h4>ğŸ¤” é—®é¢˜1ï¼šä¸ºä»€ä¹ˆç½‘ç»œæ•°æ®åŒ…å¤„ç†éœ€è¦ç¼“å†²åŒºï¼Ÿ</h4><button class="show-answer-btn" onclick="toggleAnswer('answer1')">æ˜¾ç¤ºç­”æ¡ˆ</button><div id="answer1" class="quiz-answer"><strong>ç­”æ¡ˆï¼š</strong>å› ä¸ºç½‘ç»œæ•°æ®åŒ…åˆ°è¾¾é€Ÿåº¦ä¸ç¨³å®šï¼Œåº”ç”¨ç¨‹åºå¤„ç†é€Ÿåº¦ä¹Ÿå¯èƒ½å˜åŒ–<br><strong>å…·ä½“åŸå› ï¼š</strong><ul><li><strong>ç½‘ç»œæ³¢åŠ¨</strong>ï¼šæ•°æ®åŒ…å¯èƒ½çªå‘æ€§å¤§é‡åˆ°è¾¾</li><li><strong>å¤„ç†å»¶è¿Ÿ</strong>ï¼šåº”ç”¨ç¨‹åºå¯èƒ½æ­£åœ¨å¤„ç†å…¶ä»–ä»»åŠ¡</li><li><strong>é˜²æ­¢ä¸¢å¤±</strong>ï¼šç¼“å†²åŒºæš‚å­˜æ•°æ®åŒ…ï¼Œé¿å…å› å¤„ç†ä¸åŠæ—¶è€Œä¸¢å¤±</li><li><strong>å¹³æ»‘å¤„ç†</strong>ï¼šå°†çªå‘æµé‡å¹³æ‘Šåˆ°è¾ƒé•¿æ—¶é—´å¤„ç†</li></ul></div></div><div class="quiz-question"><h4>ğŸ¤” é—®é¢˜2ï¼šéŸ³é¢‘æ’­æ”¾ç¼“å†²åŒºå¤ªå°ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿå¤ªå¤§å‘¢ï¼Ÿ</h4><button class="show-answer-btn" onclick="toggleAnswer('answer2')">æ˜¾ç¤ºç­”æ¡ˆ</button><div id="answer2" class="quiz-answer"><strong>ç¼“å†²åŒºå¤ªå°çš„é—®é¢˜ï¼š</strong><ul><li><strong>éŸ³é¢‘å¡é¡¿</strong>ï¼šç¼“å†²åŒºå¾ˆå¿«è¢«æ¶ˆè€—å®Œï¼Œå¯¼è‡´æ’­æ”¾ä¸­æ–­</li><li><strong>é¢‘ç¹é˜»å¡</strong>ï¼šæ¶ˆè´¹è€…ç»å¸¸ç­‰å¾…æ–°æ•°æ®åˆ°è¾¾</li><li><strong>ä¸ç¨³å®šæ’­æ”¾</strong>ï¼šéš¾ä»¥åº”å¯¹ç½‘ç»œæˆ–å¤„ç†çš„çŸ­æœŸæ³¢åŠ¨</li></ul><strong>ç¼“å†²åŒºå¤ªå¤§çš„é—®é¢˜ï¼š</strong><ul><li><strong>å»¶è¿Ÿå¢åŠ </strong>ï¼šæ•°æ®ä»ç”Ÿäº§åˆ°æ¶ˆè´¹çš„å»¶è¿Ÿå˜é•¿</li><li><strong>å†…å­˜æµªè´¹</strong>ï¼šå ç”¨è¿‡å¤šå†…å­˜èµ„æº</li><li><strong>å“åº”æ€§å·®</strong>ï¼šæš‚åœã€å¿«è¿›ç­‰æ“ä½œå“åº”æ…¢</li></ul></div></div><div class="quiz-question"><h4>ğŸ¤” é—®é¢˜3ï¼šåœ¨ç”Ÿäº§è€…é€Ÿåº¦è¿œå¤§äºæ¶ˆè´¹è€…é€Ÿåº¦çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥é‡‡å–ä»€ä¹ˆç­–ç•¥ï¼Ÿ</h4><button class="show-answer-btn" onclick="toggleAnswer('answer3')">æ˜¾ç¤ºç­”æ¡ˆ</button><div id="answer3" class="quiz-answer"><strong>å¯é€‰ç­–ç•¥ï¼š</strong><ul><li><strong>é˜»å¡ç”Ÿäº§è€…</strong>ï¼šç¼“å†²åŒºæ»¡æ—¶æš‚åœç”Ÿäº§è€…ï¼Œé€‚ç”¨äºæ•°æ®ä¸èƒ½ä¸¢å¤±çš„åœºæ™¯</li><li><strong>ä¸¢å¼ƒæ–°æ•°æ®</strong>ï¼šç¼“å†²åŒºæ»¡æ—¶ä¸¢å¼ƒæ–°æ¥çš„æ•°æ®ï¼Œé€‚ç”¨äºå®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯</li><li><strong>ä¸¢å¼ƒæ—§æ•°æ®</strong>ï¼šç¼“å†²åŒºæ»¡æ—¶ä¸¢å¼ƒæœ€æ—§çš„æ•°æ®ï¼Œä¿æŒæœ€æ–°æ•°æ®</li><li><strong>æµé‡æ§åˆ¶</strong>ï¼šå‘ä¸Šæ¸¸å‘é€åå‹ä¿¡å·ï¼Œè¦æ±‚é™ä½ç”Ÿäº§é€Ÿåº¦</li><li><strong>åŠ¨æ€æ‰©å®¹</strong>ï¼šåœ¨èµ„æºå…è®¸çš„æƒ…å†µä¸‹åŠ¨æ€å¢åŠ ç¼“å†²åŒºå¤§å°</li><li><strong>å¤šçº§ç¼“å†²</strong>ï¼šä½¿ç”¨å¤šä¸ªçº§åˆ«çš„ç¼“å†²åŒºåˆ†å±‚å¤„ç†</li></ul><strong>é€‰æ‹©ä¾æ®ï¼š</strong>æ•°æ®é‡è¦æ€§ã€å®æ—¶æ€§è¦æ±‚ã€èµ„æºé™åˆ¶ç­‰
            </div></div><div class="quiz-question"><h4>ğŸ¤” é—®é¢˜4ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜æ•ˆçš„çº¿ç¨‹å®‰å…¨ç¼“å†²åŒºï¼Ÿ</h4><button class="show-answer-btn" onclick="toggleAnswer('answer4')">æ˜¾ç¤ºç­”æ¡ˆ</button><div id="answer4" class="quiz-answer"><strong>å…³é”®è®¾è®¡è¦ç‚¹ï¼š</strong><ul><li><strong>é”ç­–ç•¥</strong>ï¼šä½¿ç”¨è¯»å†™é”æˆ–æ¡ä»¶å˜é‡å‡å°‘é”ç«äº‰</li><li><strong>æ•°æ®ç»“æ„</strong>ï¼šé€‰æ‹©é«˜æ•ˆçš„åº•å±‚æ•°æ®ç»“æ„ï¼ˆå¦‚ç¯å½¢ç¼“å†²åŒºï¼‰</li><li><strong>æ¡ä»¶ç­‰å¾…</strong>ï¼šé¿å…å¿™ç­‰å¾…ï¼Œä½¿ç”¨æ¡ä»¶å˜é‡è¿›è¡Œé˜»å¡</li><li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šæ”¯æŒæ‰¹é‡è¯»å†™å‡å°‘é”å¼€é”€</li><li><strong>æ— é”è®¾è®¡</strong>ï¼šåœ¨ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨æ— é”é˜Ÿåˆ—æé«˜æ€§èƒ½</li><li><strong>å†…å­˜å¯¹é½</strong>ï¼šé¿å…false sharingï¼Œä¼˜åŒ–ç¼“å­˜æ€§èƒ½</li></ul></div></div><div class="quiz-question"><h4>ğŸ¤” é—®é¢˜5ï¼šåœ¨è®¾è®¡è§†é¢‘æµç¼“å†²åŒºæ—¶éœ€è¦è€ƒè™‘å“ªäº›ç‰¹æ®Šå› ç´ ï¼Ÿ</h4><button class="show-answer-btn" onclick="toggleAnswer('answer5')">æ˜¾ç¤ºç­”æ¡ˆ</button><div id="answer5" class="quiz-answer"><strong>è§†é¢‘æµçš„ç‰¹æ®Šè€ƒè™‘ï¼š</strong><ul><li><strong>å¸§ç‡è¦æ±‚</strong>ï¼šå¿…é¡»ä¿è¯ç¨³å®šçš„å¸§ç‡æ’­æ”¾ï¼ˆå¦‚30fpsã€60fpsï¼‰</li><li><strong>I/P/Bå¸§</strong>ï¼šä¸åŒç±»å‹å¸§çš„é‡è¦æ€§å’Œå¤§å°å·®å¼‚å¾ˆå¤§</li><li><strong>æ—¶é—´æˆ³</strong>ï¼šæ¯ä¸ªå¸§éƒ½æœ‰ä¸¥æ ¼çš„æ’­æ”¾æ—¶é—´è¦æ±‚</li><li><strong>æ•°æ®é‡å¤§</strong>ï¼šè§†é¢‘æ•°æ®é‡è¿œå¤§äºéŸ³é¢‘ï¼Œéœ€è¦æ›´å¤§ç¼“å†²åŒº</li><li><strong>é¢„åŠ è½½ç­–ç•¥</strong>ï¼šéœ€è¦æå‰ç¼“å†²è¶³å¤Ÿçš„æ•°æ®é˜²æ­¢å¡é¡¿</li><li><strong>åŠ¨æ€ç ç‡</strong>ï¼šæ ¹æ®ç½‘ç»œçŠ¶å†µè°ƒæ•´è§†é¢‘è´¨é‡å’Œç¼“å†²ç­–ç•¥</li><li><strong>è·³è·ƒæ’­æ”¾</strong>ï¼šæ”¯æŒå¿«è¿›ã€åé€€ç­‰éšæœºè®¿é—®æ“ä½œ</li></ul></div></div><h3>ğŸ“š è¿›ä¸€æ­¥å­¦ä¹ å»ºè®®</h3><ul><li>ğŸ”„ <strong>æ— é”é˜Ÿåˆ—</strong>ï¼šå­¦ä¹ é«˜æ€§èƒ½çš„lock-freeæ•°æ®ç»“æ„</li><li>ğŸ¯ <strong>èƒŒå‹æœºåˆ¶</strong>ï¼šäº†è§£æµé‡æ§åˆ¶å’Œåå‹ç­–ç•¥</li><li>ğŸŒŠ <strong>æµå¤„ç†ç³»ç»Ÿ</strong>ï¼šç ”ç©¶Apache Kafkaã€RabbitMQç­‰æ¶ˆæ¯é˜Ÿåˆ—</li><li>ğŸ® <strong>å®æ—¶ç³»ç»Ÿ</strong>ï¼šæ¢ç´¢å®æ—¶æ“ä½œç³»ç»Ÿä¸­çš„ç¼“å†²åŒºè®¾è®¡</li></ul></div><!-- å¯¼èˆªæŒ‰é’® --><div style="text-align: center; margin-top: 40px;"><a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary"><span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a><a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary"><span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a></div></div><script>class BufferSimulation { constructor(canvasId, capacity = 10) { this.canvas = document.getElementById(canvasId); this.ctx = this.canvas.getContext('2d'); this.capacity = capacity; this.buffer = []; this.isProducerRunning = false; this.isConsumerRunning = false; this.stats = { produced: 0, consumed: 0, blockedProducer: 0, blockedConsumer: 0 }; this.particles = []; this.producerPos = { x: 100, y: 200 }; this.consumerPos = { x: 700, y: 200 }; this.bufferPos = { x: 300, y: 150 }; this.cellWidth = 35; this.cellHeight = 40; this.producerSpeed = 5; this.consumerSpeed = 5; this.lastProduceTime = 0; this.lastConsumeTime = 0; this.startAnimation(); this.draw(); } startAnimation() { const animate = () => { this.update(); this.draw(); requestAnimationFrame(animate); }; animate(); } update() { const now = Date.now(); if (this.isProducerRunning) { const produceInterval = 1000 / this.producerSpeed; if (now - this.lastProduceTime > produceInterval) { this.produce(); this.lastProduceTime = now; } } if (this.isConsumerRunning) { const consumeInterval = 1000 / this.consumerSpeed; if (now - this.lastConsumeTime > consumeInterval) { this.consume(); this.lastConsumeTime = now; } } this.particles = this.particles.filter(particle => { particle.update(); return !particle.isDead(); }); this.updateStats(); } produce() { if (this.buffer.length >= this.capacity) { this.stats.blockedProducer++; this.createBlockedEffect(this.producerPos.x, this.producerPos.y, '#e74c3c'); return false; } const item = { id: this.stats.produced, value: Math.floor(Math.random() * 100), timestamp: Date.now() }; this.buffer.push(item); this.stats.produced++; this.createProduceAnimation(item); return true; } consume() { if (this.buffer.length === 0) { this.stats.blockedConsumer++; this.createBlockedEffect(this.consumerPos.x, this.consumerPos.y, '#f39c12'); return null; } const item = this.buffer.shift(); this.stats.consumed++; this.createConsumeAnimation(item); return item; } createProduceAnimation(item) { this.particles.push(new DataParticle( this.producerPos.x, this.producerPos.y, this.bufferPos.x + this.buffer.length * this.cellWidth, this.bufferPos.y, '#27ae60', item.value )); } createConsumeAnimation(item) { const startX = this.bufferPos.x; this.particles.push(new DataParticle( startX, this.bufferPos.y, this.consumerPos.x, this.consumerPos.y, '#e74c3c', item.value )); } createBlockedEffect(x, y, color) { for (let i = 0; i < 5; i++) { this.particles.push(new BlockedParticle(x, y, color)); } } draw() { this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height); gradient.addColorStop(0, '#f8f9fa'); gradient.addColorStop(1, '#e9ecef'); this.ctx.fillStyle = gradient; this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height); this.ctx.fillStyle = '#2c3e50'; this.ctx.font = 'bold 18px Arial'; this.ctx.textAlign = 'center'; this.ctx.fillText('ğŸ”„ ç”Ÿäº§è€…-æ¶ˆè´¹è€…ç¼“å†²åŒºä»¿çœŸ', this.canvas.width/2, 30); this.drawProducer(); this.drawBuffer(); this.drawConsumer(); this.drawConnections(); this.particles.forEach(particle => particle.draw(this.ctx)); this.drawStatusInfo(); } drawProducer() { const x = this.producerPos.x; const y = this.producerPos.y; this.ctx.fillStyle = this.isProducerRunning ? '#27ae60' : '#95a5a6'; this.ctx.fillRect(x - 40, y - 30, 80, 60); this.ctx.strokeStyle = '#2c3e50'; this.ctx.lineWidth = 2; this.ctx.strokeRect(x - 40, y - 30, 80, 60); this.ctx.fillStyle = '#ffffff'; this.ctx.font = 'bold 14px Arial'; this.ctx.textAlign = 'center'; this.ctx.fillText('ğŸ­', x, y - 5); this.ctx.fillText('ç”Ÿäº§è€…', x, y + 10); this.ctx.fillStyle = '#2c3e50'; this.ctx.font = '12px Arial'; this.ctx.fillText(`é€Ÿåº¦: ${this.producerSpeed}`, x, y + 50); } drawConsumer() { const x = this.consumerPos.x; const y = this.consumerPos.y; this.ctx.fillStyle = this.isConsumerRunning ? '#e74c3c' : '#95a5a6'; this.ctx.fillRect(x - 40, y - 30, 80, 60); this.ctx.strokeStyle = '#2c3e50'; this.ctx.lineWidth = 2; this.ctx.strokeRect(x - 40, y - 30, 80, 60); this.ctx.fillStyle = '#ffffff'; this.ctx.font = 'bold 14px Arial'; this.ctx.textAlign = 'center'; this.ctx.fillText('ğŸ›’', x, y - 5); this.ctx.fillText('æ¶ˆè´¹è€…', x, y + 10); this.ctx.fillStyle = '#2c3e50'; this.ctx.font = '12px Arial'; this.ctx.fillText(`é€Ÿåº¦: ${this.consumerSpeed}`, x, y + 50); } drawBuffer() { const x = this.bufferPos.x; const y = this.bufferPos.y; this.ctx.fillStyle = '#2c3e50'; this.ctx.font = 'bold 16px Arial'; this.ctx.textAlign = 'left'; this.ctx.fillText('ğŸ“¦ ç¼“å†²åŒºé˜Ÿåˆ—', x, y - 20); for (let i = 0; i < this.capacity; i++) { const cellX = x + i * this.cellWidth; const isOccupied = i < this.buffer.length; this.ctx.fillStyle = isOccupied ? '#3498db' : '#ffffff'; this.ctx.fillRect(cellX, y, this.cellWidth - 2, this.cellHeight); this.ctx.strokeStyle = '#2c3e50'; this.ctx.lineWidth = 1; this.ctx.strokeRect(cellX, y, this.cellWidth - 2, this.cellHeight); if (isOccupied) { this.ctx.fillStyle = '#ffffff'; this.ctx.font = 'bold 12px Arial'; this.ctx.textAlign = 'center'; this.ctx.fillText( this.buffer[i].value.toString(), cellX + this.cellWidth/2, y + this.cellHeight/2 + 4 ); } this.ctx.fillStyle = '#7f8c8d'; this.ctx.font = '10px Arial'; this.ctx.textAlign = 'center'; this.ctx.fillText(i.toString(), cellX + this.cellWidth/2, y + this.cellHeight + 15); } if (this.buffer.length > 0) { this.ctx.fillStyle = '#27ae60'; this.ctx.font = 'bold 12px Arial'; this.ctx.textAlign = 'center'; this.ctx.fillText('Front', x + this.cellWidth/2, y - 5); const rearX = x + (this.buffer.length - 1) * this.cellWidth; this.ctx.fillStyle = '#e74c3c'; this.ctx.fillText('Rear', rearX + this.cellWidth/2, y + this.cellHeight + 30); } const usage = (this.buffer.length / this.capacity) * 100; const usageColor = usage > 80 ? '#e74c3c' : usage > 60 ? '#f39c12' : '#27ae60'; this.ctx.fillStyle = usageColor; this.ctx.font = 'bold 14px Arial'; this.ctx.textAlign = 'left'; this.ctx.fillText(`ä½¿ç”¨ç‡: ${usage.toFixed(1)}%`, x, y + this.cellHeight + 50); } drawConnections() { this.ctx.strokeStyle = '#3498db'; this.ctx.lineWidth = 3; this.ctx.setLineDash([10, 5]); this.ctx.beginPath(); this.ctx.moveTo(this.producerPos.x + 40, this.producerPos.y); this.ctx.lineTo(this.bufferPos.x - 20, this.bufferPos.y + this.cellHeight/2); this.ctx.stroke(); this.ctx.beginPath(); this.ctx.moveTo(this.bufferPos.x + this.capacity * this.cellWidth + 20, this.bufferPos.y + this.cellHeight/2); this.ctx.lineTo(this.consumerPos.x - 40, this.consumerPos.y); this.ctx.stroke(); this.ctx.setLineDash([]); } drawStatusInfo() { const startY = 320; this.ctx.fillStyle = '#2c3e50'; this.ctx.font = '14px Arial'; this.ctx.textAlign = 'left'; this.ctx.fillText(`é˜Ÿåˆ—çŠ¶æ€: ${this.buffer.length}/${this.capacity}`, 50, startY); this.ctx.fillText(`ç”Ÿäº§è€…çŠ¶æ€: ${this.isProducerRunning ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢'}`, 250, startY); this.ctx.fillText(`æ¶ˆè´¹è€…çŠ¶æ€: ${this.isConsumerRunning ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢'}`, 450, startY); } updateStats() { document.getElementById('producedCount').textContent = this.stats.produced; document.getElementById('consumedCount').textContent = this.stats.consumed; document.getElementById('bufferCount').textContent = this.buffer.length; document.getElementById('bufferUsage').textContent = ((this.buffer.length / this.capacity) * 100).toFixed(1) + '%'; document.getElementById('blockedProducer').textContent = this.stats.blockedProducer; document.getElementById('blockedConsumer').textContent = this.stats.blockedConsumer; } toggleProducer() { this.isProducerRunning = !this.isProducerRunning; } toggleConsumer() { this.isConsumerRunning = !this.isConsumerRunning; } setProducerSpeed(speed) { this.producerSpeed = speed; } setConsumerSpeed(speed) { this.consumerSpeed = speed; } reset() { this.buffer = []; this.particles = []; this.stats = { produced: 0, consumed: 0, blockedProducer: 0, blockedConsumer: 0 }; this.isProducerRunning = false; this.isConsumerRunning = false; } resize(newCapacity) { this.capacity = newCapacity; if (this.buffer.length > newCapacity) { this.buffer = this.buffer.slice(0, newCapacity); } } } class DataParticle { constructor(startX, startY, targetX, targetY, color, value) { this.x = startX; this.y = startY; this.targetX = targetX; this.targetY = targetY; this.color = color; this.value = value; this.progress = 0; this.speed = 0.02; this.size = 20; } update() { this.progress += this.speed; this.x = this.x + (this.targetX - this.x) * 0.1; this.y = this.y + (this.targetY - this.y) * 0.1; } draw(ctx) { ctx.save(); ctx.fillStyle = this.color; ctx.strokeStyle = '#2c3e50'; ctx.lineWidth = 2; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); ctx.stroke(); ctx.fillStyle = '#ffffff'; ctx.font = 'bold 12px Arial'; ctx.textAlign = 'center'; ctx.fillText(this.value.toString(), this.x, this.y + 4); ctx.restore(); } isDead() { return this.progress >= 1; } } class BlockedParticle { constructor(x, y, color) { this.x = x + (Math.random() - 0.5) * 40; this.y = y + (Math.random() - 0.5) * 40; this.vx = (Math.random() - 0.5) * 4; this.vy = (Math.random() - 0.5) * 4; this.color = color; this.life = 1.0; this.decay = 0.03; this.size = Math.random() * 8 + 4; } update() { this.x += this.vx; this.y += this.vy; this.life -= this.decay; this.size *= 0.98; } draw(ctx) { ctx.save(); ctx.globalAlpha = this.life; ctx.fillStyle = this.color; ctx.fillText('âŒ', this.x, this.y); ctx.restore(); } isDead() { return this.life <= 0; } } let bufferSim = new BufferSimulation('bufferCanvas', 10); function toggleProducer() { bufferSim.toggleProducer(); const btn = event.target; btn.textContent = bufferSim.isProducerRunning ? 'åœæ­¢ç”Ÿäº§' : 'å¯åŠ¨ç”Ÿäº§'; } function toggleConsumer() { bufferSim.toggleConsumer(); const btn = event.target; btn.textContent = bufferSim.isConsumerRunning ? 'åœæ­¢æ¶ˆè´¹' : 'å¯åŠ¨æ¶ˆè´¹'; } function resetBuffer() { bufferSim.reset(); document.querySelector('.btn-producer').textContent = 'å¯åŠ¨ç”Ÿäº§'; document.querySelector('.btn-consumer').textContent = 'å¯åŠ¨æ¶ˆè´¹'; } function resizeBuffer() { const newSize = document.getElementById('bufferSize').value; bufferSim.resize(parseInt(newSize)); } async function startDemo() { resetBuffer(); await new Promise(resolve => setTimeout(resolve, 500)); bufferSim.toggleProducer(); document.querySelector('.btn-producer').textContent = 'åœæ­¢ç”Ÿäº§'; await new Promise(resolve => setTimeout(resolve, 3000)); bufferSim.toggleConsumer(); document.querySelector('.btn-consumer').textContent = 'åœæ­¢æ¶ˆè´¹'; setTimeout(() => { bufferSim.setProducerSpeed(8); document.getElementById('producerSpeed').value = 8; }, 5000); setTimeout(() => { bufferSim.setConsumerSpeed(3); document.getElementById('consumerSpeed').value = 3; }, 8000); } document.getElementById('producerSpeed').addEventListener('input', function() { bufferSim.setProducerSpeed(parseInt(this.value)); }); document.getElementById('consumerSpeed').addEventListener('input', function() { bufferSim.setConsumerSpeed(parseInt(this.value)); }); function showCode(language) { document.querySelectorAll('.code-content').forEach(el => el.style.display = 'none'); document.querySelectorAll('.code-tab').forEach(el => el.classList.remove('active')); document.getElementById(language + '-code').style.display = 'block'; event.target.classList.add('active'); } function copyCode(language, button) { const codeElement = document.querySelector(`#${language}-code pre code`); const text = codeElement.textContent; if (navigator.clipboard && window.isSecureContext) { navigator.clipboard.writeText(text).then(() => { showCopySuccess(button); }).catch(() => { fallbackCopyText(text, button); }); } else { fallbackCopyText(text, button); } } function fallbackCopyText(text, button) { const textArea = document.createElement('textarea'); textArea.value = text; textArea.style.position = 'fixed'; textArea.style.left = '-999999px'; textArea.style.top = '-999999px'; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); showCopySuccess(button); } catch (err) { console.error('å¤åˆ¶å¤±è´¥:', err); alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»£ç '); } document.body.removeChild(textArea); } function showCopySuccess(button) { const originalText = button.textContent; const originalBg = button.style.background; button.textContent = 'âœ… å·²å¤åˆ¶'; button.style.background = '#27ae60'; button.style.transform = 'scale(1.1)'; setTimeout(() => { button.textContent = originalText; button.style.background = originalBg; button.style.transform = 'scale(1)'; }, 2000); } function toggleAnswer(answerId) { const answer = document.getElementById(answerId); const btn = event.target; if (answer.style.display === 'none' || answer.style.display === '') { answer.style.display = 'block'; btn.textContent = 'éšè—ç­”æ¡ˆ'; btn.style.background = '#e74c3c'; } else { answer.style.display = 'none'; btn.textContent = 'æ˜¾ç¤ºç­”æ¡ˆ'; btn.style.background = '#17a2b8'; } }</script>
{% endblock %}