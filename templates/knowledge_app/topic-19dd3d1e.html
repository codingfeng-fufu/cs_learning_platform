{% extends 'knowledge_app/base.html' %}

{% block title %}B+æ ‘ - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<div class="page-container fade-in">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a>
        <span>></span>
        <span>æ•°æ®ç»“æ„</span>
        <span>></span>
        <span>B+æ ‘</span>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header slide-in-left">
        <h1>
            <span class="page-icon">ğŸŒ²</span>
            B+æ ‘ (B+Tree)
        </h1>
        <p>æ•°æ®åº“ç´¢å¼•çš„é»„é‡‘æ ‡å‡†ï¼Œå¶å­èŠ‚ç‚¹é“¾å¼å­˜å‚¨ï¼Œå®Œç¾æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œé¡ºåºè®¿é—®</p>
    </div>

    <!-- ğŸ“‹ çŸ¥è¯†ç‚¹æ¦‚è¿° -->
    <div class="content-card slide-in-right">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“‹</span>
                çŸ¥è¯†ç‚¹æ¦‚è¿°
            </h2>

            <div class="overview-content">
                <div class="concept-intro">
                    <h3>æ ¸å¿ƒæ¦‚å¿µ</h3>
                    <p>B+æ ‘æ˜¯Bæ ‘çš„è¿›åŒ–ç‰ˆæœ¬ï¼Œå°±åƒå›¾ä¹¦é¦†çš„åŒå±‚ç´¢å¼•ç³»ç»Ÿï¼šä¸Šå±‚æ˜¯ç›®å½•ç´¢å¼•ï¼ˆå†…éƒ¨èŠ‚ç‚¹ï¼‰ï¼Œåªå‘Šè¯‰ä½ åœ¨å“ªä¸ªä¹¦æ¶ï¼›ä¸‹å±‚æ˜¯å…·ä½“çš„ä¹¦ç±ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰ï¼ŒæŒ‰é¡ºåºæ’åˆ—å¹¶ä¸”ç›¸äº’è¿æ¥ã€‚è¿™ç§è®¾è®¡ä½¿å¾—B+æ ‘åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­è¡¨ç°å“è¶Šï¼Œç‰¹åˆ«é€‚åˆèŒƒå›´æŸ¥è¯¢å’Œé¡ºåºæ‰«æã€‚</p>
                </div>

                <div class="unified-grid unified-grid-2">
                    <div class="info-box info-box-info">
                        <span class="info-icon">ğŸ“š</span>
                        <div>
                            <strong>å­¦ä¹ éš¾åº¦ï¼š</strong>ä¸­ç­‰åéš¾
                            <br><strong>å‰ç½®çŸ¥è¯†ï¼š</strong>Bæ ‘ã€æ•°æ®åº“åŸºç¡€æ¦‚å¿µ
                        </div>
                    </div>
                    <div class="info-box info-box-success">
                        <span class="info-icon">â±ï¸</span>
                        <div>
                            <strong>å­¦ä¹ æ—¶é—´ï¼š</strong>50-80åˆ†é’Ÿ
                            <br><strong>é‡è¦ç¨‹åº¦ï¼š</strong>â­â­â­â­â­
                        </div>
                    </div>
                </div>

                <div class="terms-list">
                    <h4>ğŸ”‘ å…³é”®æœ¯è¯­</h4>
                    <div class="unified-grid unified-grid-2">
                        <div class="term-item">
                            <strong>å¶å­èŠ‚ç‚¹ï¼š</strong>å­˜å‚¨å®é™…æ•°æ®çš„åº•å±‚èŠ‚ç‚¹ï¼Œå½¢æˆæœ‰åºé“¾è¡¨
                        </div>
                        <div class="term-item">
                            <strong>å†…éƒ¨èŠ‚ç‚¹ï¼š</strong>åªå­˜å‚¨ç´¢å¼•ä¿¡æ¯ï¼Œä¸å­˜å‚¨å®é™…æ•°æ®
                        </div>
                        <div class="term-item">
                            <strong>é¡ºåºé“¾è¡¨ï¼š</strong>å¶å­èŠ‚ç‚¹é—´çš„æŒ‡é’ˆè¿æ¥ï¼Œæ”¯æŒé¡ºåºè®¿é—®
                        </div>
                        <div class="term-item">
                            <strong>èŒƒå›´æŸ¥è¯¢ï¼š</strong>åˆ©ç”¨å¶å­é“¾è¡¨é«˜æ•ˆæŸ¥è¯¢ä¸€ä¸ªåŒºé—´å†…çš„æ•°æ®
                        </div>
                    </div>
                </div>

                <div class="problem-solution">
                    <h4>ğŸ’¡ ç›¸æ¯”Bæ ‘çš„æ”¹è¿›</h4>
                    <div class="unified-grid unified-grid-2">
                        <div class="problem-box">
                            <h5>ğŸ”´ Bæ ‘çš„å±€é™</h5>
                            <ul>
                                <li>å†…éƒ¨èŠ‚ç‚¹ä¹Ÿå­˜å‚¨æ•°æ®ï¼Œé™ä½åˆ†æ”¯å› å­</li>
                                <li>èŒƒå›´æŸ¥è¯¢éœ€è¦ä¸­åºéå†ï¼Œæ•ˆç‡ä¸é«˜</li>
                                <li>é¡ºåºè®¿é—®éœ€è¦é‡å¤æŸ¥æ‰¾è·¯å¾„</li>
                                <li>å¶å­èŠ‚ç‚¹æ— è¿æ¥ï¼Œä¸åˆ©äºæ‰«ææ“ä½œ</li>
                            </ul>
                        </div>
                        <div class="solution-box">
                            <h5>ğŸŸ¢ B+æ ‘ä¼˜åŠ¿</h5>
                            <ul>
                                <li>å†…éƒ¨èŠ‚ç‚¹ä»…ç´¢å¼•ï¼Œæé«˜åˆ†æ”¯å› å­</li>
                                <li>å¶å­é“¾è¡¨æ”¯æŒé«˜æ•ˆèŒƒå›´æŸ¥è¯¢</li>
                                <li>æ‰€æœ‰æ•°æ®åœ¨å¶å­å±‚ï¼ŒæŸ¥æ‰¾è·¯å¾„ç¨³å®š</li>
                                <li>å®Œç¾é€‚é…æ•°æ®åº“è®¿é—®æ¨¡å¼</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“– æ¦‚å¿µè¯¦è§£ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“–</span>
                æ¦‚å¿µè¯¦è§£
            </h2>

            <div class="concept-details">
                <div class="concept-item">
                    <h3>ğŸ¯ B+æ ‘çš„æ ¸å¿ƒç‰¹å¾</h3>
                    <p>B+æ ‘åœ¨Bæ ‘åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸‰ä¸ªå…³é”®æ”¹è¿›ï¼šæ•°æ®åˆ†ç¦»ã€å¶å­é“¾è¡¨ã€ç¨³å®šæ·±åº¦ã€‚è¿™äº›ç‰¹æ€§ä½¿å…¶æˆä¸ºæ•°æ®åº“ç´¢å¼•çš„ç†æƒ³é€‰æ‹©ã€‚</p>
                    <div class="example-box">
                        <strong>å…³é”®ç‰¹æ€§ï¼š</strong>æ‰€æœ‰æ•°æ®è®°å½•éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œå†…éƒ¨èŠ‚ç‚¹åªå­˜å‚¨ç”¨äºå¯¼èˆªçš„ç´¢å¼•å€¼ï¼Œå¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆé“¾æ¥å½¢æˆæœ‰åºé“¾è¡¨ã€‚
                    </div>
                    <div class="stats-box">
                        <h5>ğŸ“Š B+æ ‘ç»“æ„ç‰¹ç‚¹</h5>
                        <p><strong>å†…éƒ¨èŠ‚ç‚¹ï¼š</strong>åªå­˜å‚¨ç´¢å¼•å…³é”®å­—ï¼Œä¸å­˜å‚¨æ•°æ®è®°å½•</p>
                        <p><strong>å¶å­èŠ‚ç‚¹ï¼š</strong>å­˜å‚¨æ‰€æœ‰æ•°æ®è®°å½•ï¼ŒæŒ‰å…³é”®å­—æœ‰åºæ’åˆ—</p>
                        <p><strong>é“¾è¡¨ç»“æ„ï¼š</strong>å¶å­èŠ‚ç‚¹é—´é€šè¿‡æŒ‡é’ˆç›¸äº’è¿æ¥</p>
                        <p><strong>æŸ¥æ‰¾è·¯å¾„ï¼š</strong>æ‰€æœ‰æŸ¥æ‰¾éƒ½å¿…é¡»åˆ°è¾¾å¶å­èŠ‚ç‚¹</p>
                    </div>
                </div>

                <div class="concept-item">
                    <h3>ğŸ¯ B+æ ‘ vs Bæ ‘ è¯¦ç»†å¯¹æ¯”</h3>
                    <div class="comparison-grid">
                        <div class="compare-box">
                            <h4>ğŸŒ³ Bæ ‘ç»“æ„</h4>
                            <div class="tree-structure-demo">
                                <div class="tree-level">
                                    <div class="tree-node btree-node">
                                        <span class="node-content">50[data]</span>
                                    </div>
                                </div>
                                <div class="tree-level">
                                    <div class="tree-node btree-node">
                                        <span class="node-content">25[data]</span>
                                    </div>
                                    <div class="tree-node btree-node">
                                        <span class="node-content">75[data]</span>
                                    </div>
                                </div>
                            </div>
                            <ul class="compare-features">
                                <li>å†…éƒ¨èŠ‚ç‚¹å­˜å‚¨æ•°æ®</li>
                                <li>æŸ¥æ‰¾å¯èƒ½åœ¨å†…éƒ¨èŠ‚ç‚¹ç»“æŸ</li>
                                <li>èŠ‚ç‚¹åˆ©ç”¨ç‡ç›¸å¯¹è¾ƒä½</li>
                                <li>èŒƒå›´æŸ¥è¯¢éœ€è¦éå†æ ‘</li>
                            </ul>
                        </div>
                        <div class="compare-box">
                            <h4>ğŸŒ² B+æ ‘ç»“æ„</h4>
                            <div class="tree-structure-demo">
                                <div class="tree-level">
                                    <div class="tree-node bplus-internal-node">
                                        <span class="node-content">50</span>
                                    </div>
                                </div>
                                <div class="tree-level">
                                    <div class="tree-node bplus-leaf-node">
                                        <span class="node-content">25[data]</span>
                                    </div>
                                    <div class="leaf-pointer">â†’</div>
                                    <div class="tree-node bplus-leaf-node">
                                        <span class="node-content">50[data]|75[data]</span>
                                    </div>
                                </div>
                            </div>
                            <ul class="compare-features">
                                <li>å†…éƒ¨èŠ‚ç‚¹ä»…å­˜å‚¨ç´¢å¼•</li>
                                <li>æ‰€æœ‰æŸ¥æ‰¾éƒ½åˆ°å¶å­èŠ‚ç‚¹</li>
                                <li>æ›´é«˜çš„èŠ‚ç‚¹åˆ©ç”¨ç‡</li>
                                <li>å¶å­é“¾è¡¨æ”¯æŒèŒƒå›´æŸ¥è¯¢</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="concept-item">
                    <h3>ğŸ¯ B+æ ‘åŸºæœ¬æ“ä½œ</h3>
                    <p>B+æ ‘çš„æ“ä½œè™½ç„¶ä¸Bæ ‘ç±»ä¼¼ï¼Œä½†ç”±äºç»“æ„å·®å¼‚ï¼Œæœ‰å…¶ç‹¬ç‰¹çš„ç‰¹ç‚¹å’Œä¼˜åŒ–ç­–ç•¥ã€‚</p>
                    <div class="process-steps">
                        <div class="step-box">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h5>æŸ¥æ‰¾æ“ä½œ</h5>
                                <p>ä»æ ¹èŠ‚ç‚¹å‘ä¸‹å¯¼èˆªï¼Œæœ€ç»ˆå¿…å®šåˆ°è¾¾å¶å­èŠ‚ç‚¹</p>
                            </div>
                        </div>
                        <div class="step-box">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h5>æ’å…¥æ“ä½œ</h5>
                                <p>åœ¨å¶å­èŠ‚ç‚¹æ’å…¥ï¼Œå¯èƒ½å¼•å‘å¶å­èŠ‚ç‚¹åˆ†è£‚</p>
                            </div>
                        </div>
                        <div class="step-box">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h5>åˆ é™¤æ“ä½œ</h5>
                                <p>ä»å¶å­èŠ‚ç‚¹åˆ é™¤ï¼Œç»´æŠ¤èŠ‚ç‚¹å’Œé“¾è¡¨ç»“æ„</p>
                            </div>
                        </div>
                        <div class="step-box">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h5>èŒƒå›´æŸ¥è¯¢</h5>
                                <p>å®šä½èµ·å§‹å¶å­èŠ‚ç‚¹ï¼Œæ²¿é“¾è¡¨é¡ºåºè®¿é—®</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="concept-item">
                    <h3>ğŸ¯ å¶å­èŠ‚ç‚¹é“¾è¡¨æœºåˆ¶</h3>
                    <p>B+æ ‘çš„å¶å­èŠ‚ç‚¹é“¾è¡¨æ˜¯å…¶æœ€é‡è¦çš„ç‰¹æ€§ï¼Œä¸ºæ•°æ®åº“çš„èŒƒå›´æŸ¥è¯¢å’Œé¡ºåºæ‰«ææä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚</p>
                    <div class="traversal-algorithm">
                        <h5>èŒƒå›´æŸ¥è¯¢ç®—æ³•ï¼š</h5>
                        <div class="algorithm-steps">
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤1ï¼š</span>
                                <span>å®šä½èŒƒå›´æŸ¥è¯¢çš„èµ·å§‹å…³é”®å­—æ‰€åœ¨çš„å¶å­èŠ‚ç‚¹</span>
                            </div>
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤2ï¼š</span>
                                <span>åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•</span>
                            </div>
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤3ï¼š</span>
                                <span>æ²¿ç€å¶å­èŠ‚ç‚¹é“¾è¡¨å‘å³é¡ºåºéå†</span>
                            </div>
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤4ï¼š</span>
                                <span>æ”¶é›†æ‰€æœ‰åœ¨æŸ¥è¯¢èŒƒå›´å†…çš„æ•°æ®è®°å½•</span>
                            </div>
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤5ï¼š</span>
                                <span>é‡åˆ°è¶…å‡ºèŒƒå›´çš„å…³é”®å­—æ—¶åœæ­¢æŸ¥è¯¢</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box info-box-warning">
                    <span class="info-icon">âš ï¸</span>
                    <strong>è®¾è®¡è¦ç‚¹ï¼š</strong>
                    <ul>
                        <li>å¶å­èŠ‚ç‚¹çš„åˆ†è£‚ä¸éœ€è¦å°†ä¸­é—´å…³é”®å­—ä¸Šæï¼Œè€Œæ˜¯å¤åˆ¶åˆ°çˆ¶èŠ‚ç‚¹</li>
                        <li>å†…éƒ¨èŠ‚ç‚¹çš„å…³é”®å­—æ˜¯å¶å­èŠ‚ç‚¹å…³é”®å­—çš„"è·¯æ ‡"ï¼Œä¸æ˜¯å®é™…æ•°æ®</li>
                        <li>å¶å­èŠ‚ç‚¹é“¾è¡¨å¿…é¡»ç»´æŠ¤æœ‰åºæ€§ï¼Œæ’å…¥å’Œåˆ é™¤æ—¶è¦æ›´æ–°æŒ‡é’ˆ</li>
                        <li>èŒƒå›´æŸ¥è¯¢çš„æ€§èƒ½ä¸æŸ¥è¯¢èŒƒå›´å¤§å°å‘ˆçº¿æ€§å…³ç³»ï¼Œè€Œéå¯¹æ•°å…³ç³»</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“Š å¯è§†åŒ–å±•ç¤º -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“Š</span>
                äº¤äº’å¼B+æ ‘æ¼”ç¤º
            </h2>

            <div class="visualization-container">
                <div class="demo-description">
                    <p>ä½“éªŒB+æ ‘çš„ç‹¬ç‰¹é­…åŠ›ï¼<span style="color: #0ea5e9; font-weight: bold;">è“è‰²èŠ‚ç‚¹</span>è¡¨ç¤ºå†…éƒ¨ç´¢å¼•èŠ‚ç‚¹ï¼Œ<span style="color: #16a34a; font-weight: bold;">ç»¿è‰²èŠ‚ç‚¹</span>è¡¨ç¤ºå¶å­æ•°æ®èŠ‚ç‚¹ï¼Œ<span style="color: #dc2626; font-weight: bold; opacity: 0.7;">çº¢è‰²ç®­å¤´</span>è¡¨ç¤ºå¶å­èŠ‚ç‚¹é—´çš„é“¾è¡¨è¿æ¥ã€‚</p>
                    <div style="margin-top: 10px; font-size: 14px; color: #666;">
                        âœ¨ <strong>ç‰¹è‰²åŠŸèƒ½ï¼š</strong>æ”¯æŒèŒƒå›´æŸ¥è¯¢æ¼”ç¤ºï¼Œè§‚å¯Ÿå¶å­é“¾è¡¨å¦‚ä½•å®ç°é«˜æ•ˆçš„åŒºé—´æŸ¥æ‰¾ï¼Œä½“éªŒB+æ ‘åœ¨æ•°æ®åº“ç´¢å¼•ä¸­çš„æ ¸å¿ƒä¼˜åŠ¿ï¼
                    </div>
                </div>

                <div class="canvas-demo">
                    <div class="controls">
                        <div class="control-group">
                            <label>B+æ ‘é˜¶æ•°ï¼š</label>
                            <select id="bplusTreeOrder" onchange="changeOrder()">
                                <option value="3">3é˜¶</option>
                                <option value="4" selected>4é˜¶</option>
                                <option value="5">5é˜¶</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>æ’å…¥å€¼ï¼š</label>
                            <input type="number" id="insertValue" placeholder="è¾“å…¥æ•°å­—" min="1" max="99">
                            <button class="insert-btn" onclick="insertKey()">ğŸ” æ’å…¥</button>
                        </div>
                        <div class="control-group">
                            <label>åˆ é™¤å€¼ï¼š</label>
                            <input type="number" id="deleteValue" placeholder="è¾“å…¥æ•°å­—" min="1" max="99">
                            <button class="delete-btn" onclick="deleteKey()">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </div>

                    <div class="range-query-controls">
                        <div class="control-group">
                            <label>èŒƒå›´æŸ¥è¯¢ï¼š</label>
                            <input type="number" id="rangeStart" placeholder="èµ·å§‹å€¼" min="1" max="99">
                            <span>åˆ°</span>
                            <input type="number" id="rangeEnd" placeholder="ç»“æŸå€¼" min="1" max="99">
                            <button class="range-btn" onclick="rangeQuery()">ğŸ” èŒƒå›´æŸ¥è¯¢</button>
                        </div>
                    </div>

                    <div class="preset-controls">
                        <button class="demo-btn" onclick="insertDemo()">ğŸ“ æ¼”ç¤ºæ’å…¥</button>
                        <button class="traverse-btn" onclick="leafTraversal()">ğŸ”— å¶å­éå†</button>
                        <button class="search-btn" onclick="searchDemo()">ğŸ” æŸ¥æ‰¾æ¼”ç¤º</button>
                        <button class="reset-btn" onclick="resetBPlusTree()">ğŸ”„ é‡ç½®</button>
                    </div>

                    <div class="canvas-container">
                        <canvas id="bplusCanvas" width="950" height="550"></canvas>
                    </div>

                    <div class="legend">
                        <h4>å›¾ä¾‹è¯´æ˜</h4>
                        <div class="legend-items">
                            <div class="legend-item">
                                <div class="legend-node internal-node">
                                    <span>50|75</span>
                                </div>
                                <span>å†…éƒ¨ç´¢å¼•èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-node leaf-node">
                                    <span>25[D]|30[D]</span>
                                </div>
                                <span>å¶å­æ•°æ®èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-node current-node">
                                    <span>40[D]</span>
                                </div>
                                <span>å½“å‰æ“ä½œèŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-node range-node">
                                    <span>60[D]</span>
                                </div>
                                <span>èŒƒå›´æŸ¥è¯¢ç»“æœ</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-pointer leaf-pointer-demo">â†’</div>
                                <span>å¶å­é“¾è¡¨æŒ‡é’ˆ</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-connection tree-connection-demo"></div>
                                <span>æ ‘å½¢è¿æ¥</span>
                            </div>
                        </div>
                        <div class="legend-explanation">
                            <p><strong>èŠ‚ç‚¹ç±»å‹è¯´æ˜ï¼š</strong></p>
                            <ul>
                                <li><strong>å†…éƒ¨èŠ‚ç‚¹ï¼š</strong>åªå­˜å‚¨ç´¢å¼•å…³é”®å­—ï¼Œç”¨äºå¯¼èˆªæŸ¥æ‰¾</li>
                                <li><strong>å¶å­èŠ‚ç‚¹ï¼š</strong>å­˜å‚¨å…³é”®å­—å’Œå¯¹åº”çš„æ•°æ®è®°å½•[D]</li>
                                <li><strong>é“¾è¡¨æŒ‡é’ˆï¼š</strong>è¿æ¥ç›¸é‚»å¶å­èŠ‚ç‚¹ï¼Œæ”¯æŒé¡ºåºè®¿é—®</li>
                                <li><strong>æ ‘å½¢è¿æ¥ï¼š</strong>çˆ¶å­èŠ‚ç‚¹é—´çš„å¯¼èˆªå…³ç³»</li>
                            </ul>
                            <div style="margin-top: 12px; padding: 10px; background: #f0f9ff; border-left: 3px solid #3b82f6; border-radius: 4px;">
                                <strong>ğŸ’¡ æ“ä½œæŠ€å·§ï¼š</strong>
                                <ul style="margin: 8px 0 0 15px; font-size: 12px;">
                                    <li>ğŸ”¢ <strong>åŸºç¡€æ“ä½œ</strong>ï¼šæ’å…¥ã€åˆ é™¤æ•°å­—è§‚å¯Ÿæ ‘ç»“æ„å˜åŒ–</li>
                                    <li>ğŸ” <strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šè¾“å…¥èµ·å§‹å’Œç»“æŸå€¼ï¼Œè§‚å¯Ÿå¶å­é“¾è¡¨éå†</li>
                                    <li>ğŸ”— <strong>å¶å­éå†</strong>ï¼šå±•ç¤ºB+æ ‘é¡ºåºè®¿é—®çš„å¼ºå¤§èƒ½åŠ›</li>
                                    <li>ğŸ¯ <strong>é˜¶æ•°è°ƒèŠ‚</strong>ï¼šä½“éªŒä¸åŒé˜¶æ•°å¯¹æ ‘ç»“æ„çš„å½±å“</li>
                                    <li>ğŸ“Š <strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼šå¯¹æ¯”ç‚¹æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢çš„æ•ˆç‡å·®å¼‚</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="info">
                        <div class="info-box">
                            <h4>æ“ä½œæ—¥å¿—</h4>
                            <div class="sequence" id="bplusHistory"></div>
                            <div class="status" id="bplusStatus">B+æ ‘å·²åˆå§‹åŒ–ï¼Œå¼€å§‹æ‚¨çš„æ¢ç´¢ä¹‹æ—…</div>
                        </div>
                        <div class="info-box">
                            <h4>æ ‘ç»Ÿè®¡ä¿¡æ¯</h4>
                            <div class="sequence" id="bplusStats"></div>
                            <div class="status" id="bplusStructure">é«˜åº¦: 0, å¶å­èŠ‚ç‚¹: 0, å†…éƒ¨èŠ‚ç‚¹: 0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ’» ä»£ç å®ç° -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ’»</span>
                ä»£ç å®ç°
            </h2>

            <div class="code-implementation">
                <div class="code-tabs">
                    <button class="tab-btn active" onclick="showCode('cpp')">C++</button>
                    <button class="tab-btn" onclick="showCode('java')">Java</button>
                    <button class="tab-btn" onclick="showCode('python')">Python</button>
                </div>

                <div id="cpp-code" class="code-content active">
                    <div class="code-header">
                        <span>C++ å®ç°</span>
                        <button onclick="copyCode('cpp', this)" class="copy-btn">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code id="cpp-source">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt;
using namespace std;

template&lt;typename KeyType, typename ValueType&gt;
class BPlusTree {
private:
    struct BPlusNode {
        vector&lt;KeyType&gt; keys;
        bool isLeaf;
        BPlusNode* parent;

        BPlusNode(bool leaf) : isLeaf(leaf), parent(nullptr) {}
        virtual ~BPlusNode() {}
    };

    struct InternalNode : public BPlusNode {
        vector&lt;BPlusNode*&gt; children;

        InternalNode() : BPlusNode(false) {}

        ~InternalNode() {
            for (auto child : children) {
                delete child;
            }
        }
    };

    struct LeafNode : public BPlusNode {
        vector&lt;ValueType&gt; values;
        LeafNode* next;
        LeafNode* prev;

        LeafNode() : BPlusNode(true), next(nullptr), prev(nullptr) {}
    };

    BPlusNode* root;
    LeafNode* leftmostLeaf;  // æŒ‡å‘æœ€å·¦è¾¹çš„å¶å­èŠ‚ç‚¹
    int order;               // B+æ ‘çš„é˜¶æ•°
    int minKeys;            // æœ€å°‘å…³é”®å­—æ•°
    int maxKeys;            // æœ€å¤šå…³é”®å­—æ•°

public:
    BPlusTree(int degree) : root(nullptr), leftmostLeaf(nullptr), order(degree) {
        minKeys = (degree - 1) / 2;
        maxKeys = degree - 1;
    }

    ~BPlusTree() {
        delete root;
    }

    // æœç´¢æ“ä½œ
    ValueType* search(const KeyType& key) {
        LeafNode* leaf = findLeaf(key);
        if (!leaf) return nullptr;

        for (int i = 0; i &lt; leaf-&gt;keys.size(); i++) {
            if (leaf-&gt;keys[i] == key) {
                return &amp;leaf-&gt;values[i];
            }
        }
        return nullptr;
    }

    // èŒƒå›´æŸ¥è¯¢
    vector&lt;pair&lt;KeyType, ValueType&gt;&gt; rangeQuery(const KeyType& startKey, const KeyType& endKey) {
        vector&lt;pair&lt;KeyType, ValueType&gt;&gt; result;

        LeafNode* leaf = findLeaf(startKey);
        if (!leaf) return result;

        // åœ¨èµ·å§‹å¶å­èŠ‚ç‚¹ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºstartKeyçš„ä½ç½®
        int startIdx = 0;
        while (startIdx &lt; leaf-&gt;keys.size() && leaf-&gt;keys[startIdx] &lt; startKey) {
            startIdx++;
        }

        // æ²¿ç€å¶å­é“¾è¡¨æ”¶é›†èŒƒå›´å†…çš„æ‰€æœ‰æ•°æ®
        while (leaf && startIdx &lt; leaf-&gt;keys.size()) {
            if (leaf-&gt;keys[startIdx] &gt; endKey) break;

            result.push_back({leaf-&gt;keys[startIdx], leaf-&gt;values[startIdx]});
            startIdx++;

            // å¦‚æœå½“å‰å¶å­èŠ‚ç‚¹éå†å®Œï¼Œç§»åˆ°ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹
            if (startIdx == leaf-&gt;keys.size()) {
                leaf = leaf-&gt;next;
                startIdx = 0;
            }
        }

        return result;
    }

    // æ’å…¥æ“ä½œ
    bool insert(const KeyType& key, const ValueType& value) {
        if (!root) {
            // åˆ›å»ºç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹ä½œä¸ºæ ¹
            LeafNode* newLeaf = new LeafNode();
            newLeaf-&gt;keys.push_back(key);
            newLeaf-&gt;values.push_back(value);
            root = newLeaf;
            leftmostLeaf = newLeaf;
            return true;
        }

        LeafNode* leaf = findLeaf(key);

        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        for (int i = 0; i &lt; leaf-&gt;keys.size(); i++) {
            if (leaf-&gt;keys[i] == key) {
                leaf-&gt;values[i] = value; // æ›´æ–°å€¼
                return true;
            }
        }

        // åœ¨å¶å­èŠ‚ç‚¹ä¸­æ’å…¥
        insertIntoLeaf(leaf, key, value);

        // å¦‚æœå¶å­èŠ‚ç‚¹æº¢å‡ºï¼Œè¿›è¡Œåˆ†è£‚
        if (leaf-&gt;keys.size() &gt; maxKeys) {
            splitLeaf(leaf);
        }

        return true;
    }

    // åˆ é™¤æ“ä½œ
    bool remove(const KeyType& key) {
        if (!root) return false;

        LeafNode* leaf = findLeaf(key);
        if (!leaf) return false;

        // åœ¨å¶å­èŠ‚ç‚¹ä¸­æŸ¥æ‰¾å¹¶åˆ é™¤
        for (int i = 0; i &lt; leaf-&gt;keys.size(); i++) {
            if (leaf-&gt;keys[i] == key) {
                leaf-&gt;keys.erase(leaf-&gt;keys.begin() + i);
                leaf-&gt;values.erase(leaf-&gt;values.begin() + i);

                // å¤„ç†èŠ‚ç‚¹ä¸‹æº¢
                if (leaf-&gt;keys.size() &lt; minKeys && leaf != root) {
                    handleLeafUnderflow(leaf);
                }

                return true;
            }
        }

        return false;
    }

    // é¡ºåºéå†æ‰€æœ‰å¶å­èŠ‚ç‚¹
    vector&lt;pair&lt;KeyType, ValueType&gt;&gt; getAllData() {
        vector&lt;pair&lt;KeyType, ValueType&gt;&gt; result;

        LeafNode* current = leftmostLeaf;
        while (current) {
            for (int i = 0; i &lt; current-&gt;keys.size(); i++) {
                result.push_back({current-&gt;keys[i], current-&gt;values[i]});
            }
            current = current-&gt;next;
        }

        return result;
    }

    // æ‰“å°B+æ ‘ç»“æ„
    void print() {
        if (!root) {
            cout &lt;&lt; "Empty B+ Tree" &lt;&lt; endl;
            return;
        }
        printLevel(root, 0);
    }

private:
    LeafNode* findLeaf(const KeyType& key) {
        if (!root) return nullptr;

        BPlusNode* current = root;

        // å‘ä¸‹æœç´¢ç›´åˆ°å¶å­èŠ‚ç‚¹
        while (!current-&gt;isLeaf) {
            InternalNode* internal = static_cast&lt;InternalNode*&gt;(current);

            int i = 0;
            while (i &lt; current-&gt;keys.size() && key &gt;= current-&gt;keys[i]) {
                i++;
            }
            current = internal-&gt;children[i];
        }

        return static_cast&lt;LeafNode*&gt;(current);
    }

    void insertIntoLeaf(LeafNode* leaf, const KeyType& key, const ValueType& value) {
        int i = 0;
        while (i &lt; leaf-&gt;keys.size() && leaf-&gt;keys[i] &lt; key) {
            i++;
        }

        leaf-&gt;keys.insert(leaf-&gt;keys.begin() + i, key);
        leaf-&gt;values.insert(leaf-&gt;values.begin() + i, value);
    }

    void splitLeaf(LeafNode* leaf) {
        LeafNode* newLeaf = new LeafNode();

        int mid = (maxKeys + 1) / 2;

        // ç§»åŠ¨ååŠéƒ¨åˆ†æ•°æ®åˆ°æ–°å¶å­èŠ‚ç‚¹
        newLeaf-&gt;keys.assign(leaf-&gt;keys.begin() + mid, leaf-&gt;keys.end());
        newLeaf-&gt;values.assign(leaf-&gt;values.begin() + mid, leaf-&gt;values.end());

        // è°ƒæ•´åŸå¶å­èŠ‚ç‚¹å¤§å°
        leaf-&gt;keys.resize(mid);
        leaf-&gt;values.resize(mid);

        // æ›´æ–°å¶å­é“¾è¡¨æŒ‡é’ˆ
        newLeaf-&gt;next = leaf-&gt;next;
        newLeaf-&gt;prev = leaf;
        if (leaf-&gt;next) {
            leaf-&gt;next-&gt;prev = newLeaf;
        }
        leaf-&gt;next = newLeaf;

        // å°†æ–°å¶å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå…³é”®å­—æå‡åˆ°çˆ¶èŠ‚ç‚¹
        KeyType promoteKey = newLeaf-&gt;keys[0];

        if (leaf == root) {
            // åˆ›å»ºæ–°çš„æ ¹èŠ‚ç‚¹
            InternalNode* newRoot = new InternalNode();
            newRoot-&gt;keys.push_back(promoteKey);
            newRoot-&gt;children.push_back(leaf);
            newRoot-&gt;children.push_back(newLeaf);

            leaf-&gt;parent = newRoot;
            newLeaf-&gt;parent = newRoot;
            root = newRoot;
        } else {
            // æ’å…¥åˆ°ç°æœ‰çˆ¶èŠ‚ç‚¹
            InternalNode* parent = static_cast&lt;InternalNode*&gt;(leaf-&gt;parent);
            insertIntoInternal(parent, promoteKey, newLeaf);
            newLeaf-&gt;parent = parent;
        }
    }

    void insertIntoInternal(InternalNode* internal, const KeyType& key, BPlusNode* rightChild) {
        int i = 0;
        while (i &lt; internal-&gt;keys.size() && internal-&gt;keys[i] &lt; key) {
            i++;
        }

        internal-&gt;keys.insert(internal-&gt;keys.begin() + i, key);
        internal-&gt;children.insert(internal-&gt;children.begin() + i + 1, rightChild);

        // å¦‚æœå†…éƒ¨èŠ‚ç‚¹æº¢å‡ºï¼Œè¿›è¡Œåˆ†è£‚
        if (internal-&gt;keys.size() &gt; maxKeys) {
            splitInternal(internal);
        }
    }

    void splitInternal(InternalNode* internal) {
        InternalNode* newInternal = new InternalNode();

        int mid = maxKeys / 2;
        KeyType promoteKey = internal-&gt;keys[mid];

        // ç§»åŠ¨ååŠéƒ¨åˆ†å…³é”®å­—å’Œå­èŠ‚ç‚¹
        newInternal-&gt;keys.assign(internal-&gt;keys.begin() + mid + 1, internal-&gt;keys.end());
        newInternal-&gt;children.assign(internal-&gt;children.begin() + mid + 1, internal-&gt;children.end());

        // è°ƒæ•´åŸå†…éƒ¨èŠ‚ç‚¹å¤§å°
        internal-&gt;keys.resize(mid);
        internal-&gt;children.resize(mid + 1);

        // æ›´æ–°å­èŠ‚ç‚¹çš„çˆ¶æŒ‡é’ˆ
        for (auto child : newInternal-&gt;children) {
            child-&gt;parent = newInternal;
        }

        if (internal == root) {
            // åˆ›å»ºæ–°æ ¹èŠ‚ç‚¹
            InternalNode* newRoot = new InternalNode();
            newRoot-&gt;keys.push_back(promoteKey);
            newRoot-&gt;children.push_back(internal);
            newRoot-&gt;children.push_back(newInternal);

            internal-&gt;parent = newRoot;
            newInternal-&gt;parent = newRoot;
            root = newRoot;
        } else {
            // æ’å…¥åˆ°ç°æœ‰çˆ¶èŠ‚ç‚¹
            InternalNode* parent = static_cast&lt;InternalNode*&gt;(internal-&gt;parent);
            insertIntoInternal(parent, promoteKey, newInternal);
            newInternal-&gt;parent = parent;
        }
    }

    void handleLeafUnderflow(LeafNode* leaf) {
        // ç®€åŒ–çš„ä¸‹æº¢å¤„ç†ï¼šè¿™é‡Œåªå®ç°åŸºæœ¬é€»è¾‘
        // å®Œæ•´å®ç°éœ€è¦è€ƒè™‘ä»å…„å¼ŸèŠ‚ç‚¹å€Ÿç”¨æˆ–åˆå¹¶èŠ‚ç‚¹
        if (leaf-&gt;keys.empty()) {
            // åˆ é™¤ç©ºå¶å­èŠ‚ç‚¹
            if (leaf-&gt;prev) leaf-&gt;prev-&gt;next = leaf-&gt;next;
            if (leaf-&gt;next) leaf-&gt;next-&gt;prev = leaf-&gt;prev;
            if (leaf == leftmostLeaf) leftmostLeaf = leaf-&gt;next;
        }
    }

    void printLevel(BPlusNode* node, int level) {
        if (!node) return;

        for (int i = 0; i &lt; level; i++) cout &lt;&lt; "  ";

        if (node-&gt;isLeaf) {
            cout &lt;&lt; "Leaf: ";
            LeafNode* leaf = static_cast&lt;LeafNode*&gt;(node);
            for (int i = 0; i &lt; leaf-&gt;keys.size(); i++) {
                cout &lt;&lt; "[" &lt;&lt; leaf-&gt;keys[i] &lt;&lt; ":" &lt;&lt; leaf-&gt;values[i] &lt;&lt; "]";
            }
            cout &lt;&lt; endl;
        } else {
            cout &lt;&lt; "Internal: ";
            for (auto key : node-&gt;keys) {
                cout &lt;&lt; key &lt;&lt; " ";
            }
            cout &lt;&lt; endl;

            InternalNode* internal = static_cast&lt;InternalNode*&gt;(node);
            for (auto child : internal-&gt;children) {
                printLevel(child, level + 1);
            }
        }
    }
};</code></pre>
                </div>

                <div id="java-code" class="code-content">
                    <div class="code-header">
                        <span>Java å®ç°</span>
                        <button onclick="copyCode('java', this)" class="copy-btn">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code id="java-source">import java.util.*;

public class BPlusTree&lt;K extends Comparable&lt;K&gt;, V&gt; {

    abstract class BPlusNode {
        List&lt;K&gt; keys;
        boolean isLeaf;
        BPlusNode parent;

        BPlusNode(boolean isLeaf) {
            this.keys = new ArrayList&lt;&gt;();
            this.isLeaf = isLeaf;
            this.parent = null;
        }
    }

    class InternalNode extends BPlusNode {
        List&lt;BPlusNode&gt; children;

        InternalNode() {
            super(false);
            this.children = new ArrayList&lt;&gt;();
        }
    }

    class LeafNode extends BPlusNode {
        List&lt;V&gt; values;
        LeafNode next;
        LeafNode prev;

        LeafNode() {
            super(true);
            this.values = new ArrayList&lt;&gt;();
            this.next = null;
            this.prev = null;
        }
    }

    private BPlusNode root;
    private LeafNode leftmostLeaf;
    private int order;
    private int minKeys;
    private int maxKeys;

    public BPlusTree(int order) {
        this.order = order;
        this.minKeys = (order - 1) / 2;
        this.maxKeys = order - 1;
        this.root = null;
        this.leftmostLeaf = null;
    }

    // æœç´¢æ“ä½œ
    public V search(K key) {
        LeafNode leaf = findLeaf(key);
        if (leaf == null) return null;

        for (int i = 0; i &lt; leaf.keys.size(); i++) {
            if (leaf.keys.get(i).equals(key)) {
                return leaf.values.get(i);
            }
        }
        return null;
    }

    // èŒƒå›´æŸ¥è¯¢
    public List&lt;Map.Entry&lt;K, V&gt;&gt; rangeQuery(K startKey, K endKey) {
        List&lt;Map.Entry&lt;K, V&gt;&gt; result = new ArrayList&lt;&gt;();

        LeafNode leaf = findLeaf(startKey);
        if (leaf == null) return result;

        int startIdx = 0;
        while (startIdx &lt; leaf.keys.size() &&
               leaf.keys.get(startIdx).compareTo(startKey) &lt; 0) {
            startIdx++;
        }

        while (leaf != null && startIdx &lt; leaf.keys.size()) {
            if (leaf.keys.get(startIdx).compareTo(endKey) &gt; 0) break;

            result.add(new AbstractMap.SimpleEntry&lt;&gt;(
                leaf.keys.get(startIdx), leaf.values.get(startIdx)));
            startIdx++;

            if (startIdx == leaf.keys.size()) {
                leaf = leaf.next;
                startIdx = 0;
            }
        }

        return result;
    }

    // æ’å…¥æ“ä½œ
    public boolean insert(K key, V value) {
        if (root == null) {
            LeafNode newLeaf = new LeafNode();
            newLeaf.keys.add(key);
            newLeaf.values.add(value);
            root = newLeaf;
            leftmostLeaf = newLeaf;
            return true;
        }

        LeafNode leaf = findLeaf(key);

        // æ£€æŸ¥é”®æ˜¯å¦å·²å­˜åœ¨
        for (int i = 0; i &lt; leaf.keys.size(); i++) {
            if (leaf.keys.get(i).equals(key)) {
                leaf.values.set(i, value);
                return true;
            }
        }

        insertIntoLeaf(leaf, key, value);

        if (leaf.keys.size() &gt; maxKeys) {
            splitLeaf(leaf);
        }

        return true;
    }

    // åˆ é™¤æ“ä½œ
    public boolean remove(K key) {
        if (root == null) return false;

        LeafNode leaf = findLeaf(key);
        if (leaf == null) return false;

        for (int i = 0; i &lt; leaf.keys.size(); i++) {
            if (leaf.keys.get(i).equals(key)) {
                leaf.keys.remove(i);
                leaf.values.remove(i);

                if (leaf.keys.size() &lt; minKeys && leaf != root) {
                    handleLeafUnderflow(leaf);
                }

                return true;
            }
        }

        return false;
    }

    // è·å–æ‰€æœ‰æ•°æ®ï¼ˆé¡ºåºéå†å¶å­èŠ‚ç‚¹ï¼‰
    public List&lt;Map.Entry&lt;K, V&gt;&gt; getAllData() {
        List&lt;Map.Entry&lt;K, V&gt;&gt; result = new ArrayList&lt;&gt;();

        LeafNode current = leftmostLeaf;
        while (current != null) {
            for (int i = 0; i &lt; current.keys.size(); i++) {
                result.add(new AbstractMap.SimpleEntry&lt;&gt;(
                    current.keys.get(i), current.values.get(i)));
            }
            current = current.next;
        }

        return result;
    }

    // æ‰“å°æ ‘ç»“æ„
    public void printTree() {
        if (root == null) {
            System.out.println("Empty B+ Tree");
            return;
        }
        printLevel(root, 0);
    }

    // ç§æœ‰è¾…åŠ©æ–¹æ³•
    private LeafNode findLeaf(K key) {
        if (root == null) return null;

        BPlusNode current = root;

        while (!current.isLeaf) {
            InternalNode internal = (InternalNode) current;

            int i = 0;
            while (i &lt; current.keys.size() &&
                   key.compareTo(current.keys.get(i)) &gt;= 0) {
                i++;
            }
            current = internal.children.get(i);
        }

        return (LeafNode) current;
    }

    private void insertIntoLeaf(LeafNode leaf, K key, V value) {
        int i = 0;
        while (i &lt; leaf.keys.size() &&
               leaf.keys.get(i).compareTo(key) &lt; 0) {
            i++;
        }

        leaf.keys.add(i, key);
        leaf.values.add(i, value);
    }

    private void splitLeaf(LeafNode leaf) {
        LeafNode newLeaf = new LeafNode();

        int mid = (maxKeys + 1) / 2;

        // å¤åˆ¶ååŠéƒ¨åˆ†åˆ°æ–°å¶å­èŠ‚ç‚¹
        for (int i = mid; i &lt; leaf.keys.size(); i++) {
            newLeaf.keys.add(leaf.keys.get(i));
            newLeaf.values.add(leaf.values.get(i));
        }

        // è°ƒæ•´åŸå¶å­èŠ‚ç‚¹å¤§å°
        leaf.keys.subList(mid, leaf.keys.size()).clear();
        leaf.values.subList(mid, leaf.values.size()).clear();

        // æ›´æ–°å¶å­é“¾è¡¨
        newLeaf.next = leaf.next;
        newLeaf.prev = leaf;
        if (leaf.next != null) {
            leaf.next.prev = newLeaf;
        }
        leaf.next = newLeaf;

        K promoteKey = newLeaf.keys.get(0);

        if (leaf == root) {
            InternalNode newRoot = new InternalNode();
            newRoot.keys.add(promoteKey);
            newRoot.children.add(leaf);
            newRoot.children.add(newLeaf);

            leaf.parent = newRoot;
            newLeaf.parent = newRoot;
            root = newRoot;
        } else {
            InternalNode parent = (InternalNode) leaf.parent;
            insertIntoInternal(parent, promoteKey, newLeaf);
            newLeaf.parent = parent;
        }
    }

    private void insertIntoInternal(InternalNode internal, K key, BPlusNode rightChild) {
        int i = 0;
        while (i &lt; internal.keys.size() &&
               internal.keys.get(i).compareTo(key) &lt; 0) {
            i++;
        }

        internal.keys.add(i, key);
        internal.children.add(i + 1, rightChild);

        if (internal.keys.size() &gt; maxKeys) {
            splitInternal(internal);
        }
    }

    private void splitInternal(InternalNode internal) {
        InternalNode newInternal = new InternalNode();

        int mid = maxKeys / 2;
        K promoteKey = internal.keys.get(mid);

        // ç§»åŠ¨ååŠéƒ¨åˆ†
        for (int i = mid + 1; i &lt; internal.keys.size(); i++) {
            newInternal.keys.add(internal.keys.get(i));
        }

        for (int i = mid + 1; i &lt; internal.children.size(); i++) {
            newInternal.children.add(internal.children.get(i));
            internal.children.get(i).parent = newInternal;
        }

        // è°ƒæ•´åŸèŠ‚ç‚¹å¤§å°
        internal.keys.subList(mid, internal.keys.size()).clear();
        internal.children.subList(mid + 1, internal.children.size()).clear();

        if (internal == root) {
            InternalNode newRoot = new InternalNode();
            newRoot.keys.add(promoteKey);
            newRoot.children.add(internal);
            newRoot.children.add(newInternal);

            internal.parent = newRoot;
            newInternal.parent = newRoot;
            root = newRoot;
        } else {
            InternalNode parent = (InternalNode) internal.parent;
            insertIntoInternal(parent, promoteKey, newInternal);
            newInternal.parent = parent;
        }
    }

    private void handleLeafUnderflow(LeafNode leaf) {
        // ç®€åŒ–çš„ä¸‹æº¢å¤„ç†
        if (leaf.keys.isEmpty()) {
            if (leaf.prev != null) leaf.prev.next = leaf.next;
            if (leaf.next != null) leaf.next.prev = leaf.prev;
            if (leaf == leftmostLeaf) leftmostLeaf = leaf.next;
        }
    }

    private void printLevel(BPlusNode node, int level) {
        if (node == null) return;

        for (int i = 0; i &lt; level; i++) System.out.print("  ");

        if (node.isLeaf) {
            System.out.print("Leaf: ");
            LeafNode leaf = (LeafNode) node;
            for (int i = 0; i &lt; leaf.keys.size(); i++) {
                System.out.print("[" + leaf.keys.get(i) + ":" +
                                leaf.values.get(i) + "]");
            }
            System.out.println();
        } else {
            System.out.print("Internal: ");
            for (K key : node.keys) {
                System.out.print(key + " ");
            }
            System.out.println();

            InternalNode internal = (InternalNode) node;
            for (BPlusNode child : internal.children) {
                printLevel(child, level + 1);
            }
        }
    }
}</code></pre>
                </div>

                <div id="python-code" class="code-content">
                    <div class="code-header">
                        <span>Python å®ç°</span>
                        <button onclick="copyCode('python', this)" class="copy-btn">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code id="python-source">class BPlusNode:
    """B+æ ‘èŠ‚ç‚¹åŸºç±»"""
    def __init__(self, is_leaf=False):
        self.keys = []
        self.is_leaf = is_leaf
        self.parent = None

class InternalNode(BPlusNode):
    """å†…éƒ¨èŠ‚ç‚¹ç±»"""
    def __init__(self):
        super().__init__(is_leaf=False)
        self.children = []

class LeafNode(BPlusNode):
    """å¶å­èŠ‚ç‚¹ç±»"""
    def __init__(self):
        super().__init__(is_leaf=True)
        self.values = []
        self.next = None  # æŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹
        self.prev = None  # æŒ‡å‘å‰ä¸€ä¸ªå¶å­èŠ‚ç‚¹

class BPlusTree:
    """B+æ ‘å®ç°ç±»"""
    def __init__(self, order):
        self.order = order
        self.min_keys = (order - 1) // 2
        self.max_keys = order - 1
        self.root = None
        self.leftmost_leaf = None  # æœ€å·¦è¾¹çš„å¶å­èŠ‚ç‚¹

    def search(self, key):
        """æœç´¢æŒ‡å®šå…³é”®å­—"""
        leaf = self._find_leaf(key)
        if not leaf:
            return None

        for i, k in enumerate(leaf.keys):
            if k == key:
                return leaf.values[i]
        return None

    def range_query(self, start_key, end_key):
        """èŒƒå›´æŸ¥è¯¢"""
        result = []

        # æ‰¾åˆ°èµ·å§‹å¶å­èŠ‚ç‚¹
        leaf = self._find_leaf(start_key)
        if not leaf:
            return result

        # åœ¨èµ·å§‹å¶å­èŠ‚ç‚¹ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºstart_keyçš„ä½ç½®
        start_idx = 0
        while start_idx < len(leaf.keys) and leaf.keys[start_idx] < start_key:
            start_idx += 1

        # æ²¿ç€å¶å­é“¾è¡¨æ”¶é›†èŒƒå›´å†…çš„æ•°æ®
        while leaf and start_idx < len(leaf.keys):
            if leaf.keys[start_idx] > end_key:
                break

            result.append((leaf.keys[start_idx], leaf.values[start_idx]))
            start_idx += 1

            # å¦‚æœå½“å‰å¶å­èŠ‚ç‚¹éå†å®Œï¼Œç§»åˆ°ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹
            if start_idx == len(leaf.keys):
                leaf = leaf.next
                start_idx = 0

        return result

    def insert(self, key, value):
        """æ’å…¥é”®å€¼å¯¹"""
        if not self.root:
            # åˆ›å»ºç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹ä½œä¸ºæ ¹
            new_leaf = LeafNode()
            new_leaf.keys.append(key)
            new_leaf.values.append(value)
            self.root = new_leaf
            self.leftmost_leaf = new_leaf
            return True

        leaf = self._find_leaf(key)

        # æ£€æŸ¥é”®æ˜¯å¦å·²å­˜åœ¨
        for i, k in enumerate(leaf.keys):
            if k == key:
                leaf.values[i] = value  # æ›´æ–°å€¼
                return True

        # åœ¨å¶å­èŠ‚ç‚¹ä¸­æ’å…¥
        self._insert_into_leaf(leaf, key, value)

        # å¦‚æœå¶å­èŠ‚ç‚¹æº¢å‡ºï¼Œè¿›è¡Œåˆ†è£‚
        if len(leaf.keys) > self.max_keys:
            self._split_leaf(leaf)

        return True

    def remove(self, key):
        """åˆ é™¤æŒ‡å®šå…³é”®å­—"""
        if not self.root:
            return False

        leaf = self._find_leaf(key)
        if not leaf:
            return False

        # åœ¨å¶å­èŠ‚ç‚¹ä¸­æŸ¥æ‰¾å¹¶åˆ é™¤
        for i, k in enumerate(leaf.keys):
            if k == key:
                del leaf.keys[i]
                del leaf.values[i]

                # å¤„ç†èŠ‚ç‚¹ä¸‹æº¢ï¼ˆç®€åŒ–å¤„ç†ï¼‰
                if len(leaf.keys) < self.min_keys and leaf != self.root:
                    self._handle_leaf_underflow(leaf)

                return True

        return False

    def get_all_data(self):
        """è·å–æ‰€æœ‰æ•°æ®ï¼ˆæŒ‰é¡ºåºï¼‰"""
        result = []
        current = self.leftmost_leaf

        while current:
            for i in range(len(current.keys)):
                result.append((current.keys[i], current.values[i]))
            current = current.next

        return result

    def print_tree(self):
        """æ‰“å°æ ‘ç»“æ„"""
        if not self.root:
            print("Empty B+ Tree")
            return
        self._print_level(self.root, 0)

    def print_leaf_chain(self):
        """æ‰“å°å¶å­èŠ‚ç‚¹é“¾è¡¨"""
        print("Leaf chain: ", end="")
        current = self.leftmost_leaf
        while current:
            print(f"[{','.join(map(str, current.keys))}]", end="")
            if current.next:
                print(" -> ", end="")
            current = current.next
        print()

    def _find_leaf(self, key):
        """æ‰¾åˆ°åº”è¯¥åŒ…å«æŒ‡å®šå…³é”®å­—çš„å¶å­èŠ‚ç‚¹"""
        if not self.root:
            return None

        current = self.root

        # å‘ä¸‹æœç´¢ç›´åˆ°å¶å­èŠ‚ç‚¹
        while not current.is_leaf:
            i = 0
            while i < len(current.keys) and key >= current.keys[i]:
                i += 1
            current = current.children[i]

        return current

    def _insert_into_leaf(self, leaf, key, value):
        """åœ¨å¶å­èŠ‚ç‚¹ä¸­æ’å…¥é”®å€¼å¯¹"""
        i = 0
        while i < len(leaf.keys) and leaf.keys[i] < key:
            i += 1

        leaf.keys.insert(i, key)
        leaf.values.insert(i, value)

    def _split_leaf(self, leaf):
        """åˆ†è£‚å¶å­èŠ‚ç‚¹"""
        new_leaf = LeafNode()

        mid = (self.max_keys + 1) // 2

        # å°†ååŠéƒ¨åˆ†æ•°æ®ç§»åˆ°æ–°å¶å­èŠ‚ç‚¹
        new_leaf.keys = leaf.keys[mid:]
        new_leaf.values = leaf.values[mid:]

        # è°ƒæ•´åŸå¶å­èŠ‚ç‚¹
        leaf.keys = leaf.keys[:mid]
        leaf.values = leaf.values[:mid]

        # æ›´æ–°å¶å­é“¾è¡¨æŒ‡é’ˆ
        new_leaf.next = leaf.next
        new_leaf.prev = leaf
        if leaf.next:
            leaf.next.prev = new_leaf
        leaf.next = new_leaf

        # æå‡æ–°å¶å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªå…³é”®å­—åˆ°çˆ¶èŠ‚ç‚¹
        promote_key = new_leaf.keys[0]

        if leaf == self.root:
            # åˆ›å»ºæ–°çš„æ ¹èŠ‚ç‚¹
            new_root = InternalNode()
            new_root.keys.append(promote_key)
            new_root.children.append(leaf)
            new_root.children.append(new_leaf)

            leaf.parent = new_root
            new_leaf.parent = new_root
            self.root = new_root
        else:
            # æ’å…¥åˆ°ç°æœ‰çˆ¶èŠ‚ç‚¹
            parent = leaf.parent
            self._insert_into_internal(parent, promote_key, new_leaf)
            new_leaf.parent = parent

    def _insert_into_internal(self, internal, key, right_child):
        """åœ¨å†…éƒ¨èŠ‚ç‚¹ä¸­æ’å…¥å…³é”®å­—å’Œå³å­èŠ‚ç‚¹"""
        i = 0
        while i < len(internal.keys) and internal.keys[i] < key:
            i += 1

        internal.keys.insert(i, key)
        internal.children.insert(i + 1, right_child)

        # å¦‚æœå†…éƒ¨èŠ‚ç‚¹æº¢å‡ºï¼Œè¿›è¡Œåˆ†è£‚
        if len(internal.keys) > self.max_keys:
            self._split_internal(internal)

    def _split_internal(self, internal):
        """åˆ†è£‚å†…éƒ¨èŠ‚ç‚¹"""
        new_internal = InternalNode()

        mid = self.max_keys // 2
        promote_key = internal.keys[mid]

        # ç§»åŠ¨ååŠéƒ¨åˆ†å…³é”®å­—å’Œå­èŠ‚ç‚¹
        new_internal.keys = internal.keys[mid + 1:]
        new_internal.children = internal.children[mid + 1:]

        # è°ƒæ•´åŸå†…éƒ¨èŠ‚ç‚¹
        internal.keys = internal.keys[:mid]
        internal.children = internal.children[:mid + 1]

        # æ›´æ–°å­èŠ‚ç‚¹çš„çˆ¶æŒ‡é’ˆ
        for child in new_internal.children:
            child.parent = new_internal

        if internal == self.root:
            # åˆ›å»ºæ–°æ ¹èŠ‚ç‚¹
            new_root = InternalNode()
            new_root.keys.append(promote_key)
            new_root.children.append(internal)
            new_root.children.append(new_internal)

            internal.parent = new_root
            new_internal.parent = new_root
            self.root = new_root
        else:
            # æ’å…¥åˆ°ç°æœ‰çˆ¶èŠ‚ç‚¹
            parent = internal.parent
            self._insert_into_internal(parent, promote_key, new_internal)
            new_internal.parent = parent

    def _handle_leaf_underflow(self, leaf):
        """å¤„ç†å¶å­èŠ‚ç‚¹ä¸‹æº¢ï¼ˆç®€åŒ–å¤„ç†ï¼‰"""
        if not leaf.keys:
            # åˆ é™¤ç©ºå¶å­èŠ‚ç‚¹
            if leaf.prev:
                leaf.prev.next = leaf.next
            if leaf.next:
                leaf.next.prev = leaf.prev
            if leaf == self.leftmost_leaf:
                self.leftmost_leaf = leaf.next

    def _print_level(self, node, level):
        """é€’å½’æ‰“å°æ ‘çš„å±‚æ¬¡ç»“æ„"""
        if not node:
            return

        indent = "  " * level

        if node.is_leaf:
            print(f"{indent}Leaf: ", end="")
            for i in range(len(node.keys)):
                print(f"[{node.keys[i]}:{node.values[i]}]", end="")
            print()
        else:
            print(f"{indent}Internal: {' '.join(map(str, node.keys))}")
            for child in node.children:
                self._print_level(child, level + 1)

# ä½¿ç”¨ç¤ºä¾‹
def example_usage():
    # åˆ›å»ºä¸€ä¸ª4é˜¶B+æ ‘
    bplus_tree = BPlusTree(order=4)

    # æ’å…¥ä¸€äº›æ•°æ®
    data = [(10, 'A'), (20, 'B'), (30, 'C'), (40, 'D'),
            (50, 'E'), (25, 'F'), (35, 'G'), (15, 'H')]

    print("æ’å…¥æ•°æ®:")
    for key, value in data:
        bplus_tree.insert(key, value)
        print(f"æ’å…¥ ({key}, {value})")

    print("\nB+æ ‘ç»“æ„:")
    bplus_tree.print_tree()

    print("\nå¶å­èŠ‚ç‚¹é“¾è¡¨:")
    bplus_tree.print_leaf_chain()

    print("\næ‰€æœ‰æ•°æ®ï¼ˆæœ‰åºï¼‰:")
    all_data = bplus_tree.get_all_data()
    for key, value in all_data:
        print(f"({key}, {value})", end=" ")
    print()

    print("\nèŒƒå›´æŸ¥è¯¢ [20, 40]:")
    range_result = bplus_tree.range_query(20, 40)
    for key, value in range_result:
        print(f"({key}, {value})", end=" ")
    print()

    print("\næœç´¢å…³é”®å­— 25:")
    result = bplus_tree.search(25)
    print(f"ç»“æœ: {result}")

if __name__ == "__main__":
    example_usage()</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸŒŸ å®é™…åº”ç”¨ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸŒŸ</span>
                å®é™…åº”ç”¨
            </h2>

            <div class="applications">
                <div class="unified-grid unified-grid-2">
                    <div class="app-item">
                        <h4>ğŸ—„ï¸ MySQL InnoDB</h4>
                        <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>ä¸»é”®ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ï¼‰çš„åº•å±‚å®ç°</p>
                        <p><strong>ä¼˜åŠ¿ï¼š</strong>å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´è¡Œæ•°æ®ï¼Œæ”¯æŒé«˜æ•ˆèŒƒå›´æ‰«æ</p>
                        <p><strong>å®ç°ï¼š</strong>16KBé¡µé¢å¤§å°ï¼Œå¶å­èŠ‚ç‚¹é“¾è¡¨æ”¯æŒé¡ºåºIO</p>
                    </div>

                    <div class="app-item">
                        <h4>ğŸ“Š PostgreSQL BTREE</h4>
                        <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>é»˜è®¤ç´¢å¼•ç±»å‹ï¼Œæ”¯æŒå„ç§æ•°æ®ç±»å‹</p>
                        <p><strong>ä¼˜åŠ¿ï¼š</strong>ä¼˜ç§€çš„å¹¶å‘æ§åˆ¶ï¼Œæ”¯æŒéƒ¨åˆ†åŒ¹é…æŸ¥è¯¢</p>
                        <p><strong>å®ç°ï¼š</strong>8KBé¡µé¢ï¼ŒWALæ—¥å¿—ä¿è¯æŒä¹…æ€§</p>
                    </div>

                    <div class="app-item">
                        <h4>ğŸ” Elasticsearch</h4>
                        <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>å€’æ’ç´¢å¼•çš„term dictionaryå®ç°</p>
                        <p><strong>ä¼˜åŠ¿ï¼š</strong>æ”¯æŒå‰ç¼€åŒ¹é…å’ŒèŒƒå›´æŸ¥è¯¢</p>
                        <p><strong>å®ç°ï¼š</strong>ç»“åˆFSTä¼˜åŒ–å†…å­˜ä½¿ç”¨</p>
                    </div>

                    <div class="app-item">
                        <h4>ğŸ“ˆ æ—¶åºæ•°æ®åº“</h4>
                        <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>InfluxDBã€TimescaleDBçš„æ—¶é—´ç´¢å¼•</p>
                        <p><strong>ä¼˜åŠ¿ï¼š</strong>æ—¶é—´èŒƒå›´æŸ¥è¯¢æ€§èƒ½ä¼˜å¼‚</p>
                        <p><strong>å®ç°ï¼š</strong>æ—¶é—´æˆ³ä½œä¸ºå…³é”®å­—ï¼Œå¶å­é“¾è¡¨æ”¯æŒæ—¶é—´åºåˆ—æ‰«æ</p>
                    </div>
                </div>

                <div class="performance-analysis">
                    <h4>ğŸ“Š æ€§èƒ½åˆ†æå¯¹æ¯”</h4>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>æ“ä½œç±»å‹</th>
                                <th>Bæ ‘</th>
                                <th>B+æ ‘</th>
                                <th>B+æ ‘ä¼˜åŠ¿</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ç‚¹æŸ¥è¯¢</td>
                                <td>O(logâ‚˜n)</td>
                                <td>O(logâ‚˜n)</td>
                                <td>è·¯å¾„ç¨³å®šï¼Œç¼“å­˜å‹å¥½</td>
                            </tr>
                            <tr>
                                <td>èŒƒå›´æŸ¥è¯¢</td>
                                <td>O(logâ‚˜n + k)</td>
                                <td>O(logâ‚˜n + k/f)</td>
                                <td>å¶å­é“¾è¡¨ï¼Œæ— éœ€é‡å¤æŸ¥æ‰¾</td>
                            </tr>
                            <tr>
                                <td>é¡ºåºæ‰«æ</td>
                                <td>O(nÂ·logâ‚˜n)</td>
                                <td>O(n/f)</td>
                                <td>çº¿æ€§æ—¶é—´ï¼ŒIOä¼˜åŒ–</td>
                            </tr>
                            <tr>
                                <td>æ’å…¥/åˆ é™¤</td>
                                <td>O(logâ‚˜n)</td>
                                <td>O(logâ‚˜n)</td>
                                <td>åˆ†è£‚ç­–ç•¥æ›´ç®€å•</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="performance-note">
                        <strong>æ³¨é‡Šï¼š</strong>kä¸ºæŸ¥è¯¢ç»“æœæ•°é‡ï¼Œfä¸ºå¶å­èŠ‚ç‚¹å¹³å‡å¡«å……å› å­ï¼Œmä¸ºæ ‘çš„é˜¶æ•°
                    </p>
                </div>

                <div class="concept-item">
                    <h3>ğŸ¯ B+æ ‘åœ¨æ•°æ®åº“ä¸­çš„å…³é”®ä¼˜åŠ¿</h3>
                    <div class="unified-grid unified-grid-2">
                        <div class="advantage-box">
                            <h4>ğŸš€ æŸ¥è¯¢æ€§èƒ½</h4>
                            <ul>
                                <li><strong>ç¨³å®šçš„æŸ¥æ‰¾æ·±åº¦ï¼š</strong>æ‰€æœ‰æŸ¥è¯¢éƒ½åˆ°å¶å­èŠ‚ç‚¹</li>
                                <li><strong>æ›´é«˜çš„åˆ†æ”¯å› å­ï¼š</strong>å†…éƒ¨èŠ‚ç‚¹ä¸å­˜æ•°æ®</li>
                                <li><strong>ç¼“å­˜å‹å¥½ï¼š</strong>å†…éƒ¨èŠ‚ç‚¹å¯å®Œå…¨é©»ç•™å†…å­˜</li>
                                <li><strong>é¢„è¯»ä¼˜åŒ–ï¼š</strong>å¶å­èŠ‚ç‚¹é¡ºåºå­˜å‚¨</li>
                            </ul>
                        </div>
                        <div class="advantage-box">
                            <h4>ğŸ“ˆ å­˜å‚¨æ•ˆç‡</h4>
                            <ul>
                                <li><strong>ç©ºé—´åˆ©ç”¨ç‡é«˜ï¼š</strong>æ•°æ®é›†ä¸­å­˜å‚¨åœ¨å¶å­å±‚</li>
                                <li><strong>å‹ç¼©å‹å¥½ï¼š</strong>ç›¸ä¼¼æ•°æ®èšé›†å­˜å‚¨</li>
                                <li><strong>é¡µé¢å¡«å……åº¦ï¼š</strong>å¶å­èŠ‚ç‚¹é€šå¸¸æœ‰æ›´é«˜å¡«å……ç‡</li>
                                <li><strong>ç»´æŠ¤æˆæœ¬ä½ï¼š</strong>åˆ†è£‚åˆå¹¶æ“ä½œç›¸å¯¹ç®€å•</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="real-world-example">
                    <h4>ğŸ’¼ MySQL InnoDB å®æˆ˜æ¡ˆä¾‹</h4>
                    <div class="example-content">
                        <div class="sql-example">
                            <h5>å…¸å‹çš„èŒƒå›´æŸ¥è¯¢åœºæ™¯ï¼š</h5>
                            <pre class="sql-code">
-- æŸ¥è¯¢æŸä¸ªæ—¶é—´èŒƒå›´å†…çš„è®¢å•
SELECT * FROM orders
WHERE order_date BETWEEN '2024-01-01' AND '2024-01-31'
ORDER BY order_date;

-- B+æ ‘çš„æ‰§è¡Œè¿‡ç¨‹ï¼š
-- 1. é€šè¿‡B+æ ‘ç´¢å¼•å®šä½åˆ° '2024-01-01' å¯¹åº”çš„å¶å­èŠ‚ç‚¹
-- 2. æ²¿ç€å¶å­é“¾è¡¨é¡ºåºè¯»å–åˆ° '2024-01-31'
-- 3. æ•°æ®å¤©ç„¶æœ‰åºï¼Œæ— éœ€é¢å¤–æ’åº
                            </pre>
                        </div>
                        <div class="performance-metrics">
                            <h5>æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”ï¼š</h5>
                            <ul>
                                <li><strong>IOæ¬¡æ•°ï¼š</strong>B+æ ‘çº¦3-4æ¬¡ï¼ŒBæ ‘çº¦20-30æ¬¡</li>
                                <li><strong>ç¼“å­˜å‘½ä¸­ç‡ï¼š</strong>B+æ ‘90%+ï¼ŒBæ ‘60-70%</li>
                                <li><strong>å¹¶å‘æ€§èƒ½ï¼š</strong>B+æ ‘å¶å­é”ç²’åº¦æ›´ç»†</li>
                                <li><strong>èŒƒå›´æŸ¥è¯¢é€Ÿåº¦ï¼š</strong>B+æ ‘å¿«10-100å€</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… å­¦ä¹ æ£€éªŒ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">âœ…</span>
                å­¦ä¹ æ£€éªŒ
            </h2>

            <div class="quiz-section">
                <div class="quiz-item">
                    <h4>ğŸ¤” é—®é¢˜1ï¼šç»“æ„ç†è§£</h4>
                    <p>B+æ ‘ä¸Bæ ‘çš„æœ€ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿè¿™ç§è®¾è®¡å¸¦æ¥äº†å“ªäº›ä¼˜åŠ¿ï¼Ÿ</p>
                    <button class="quiz-btn" onclick="toggleAnswer(1)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div id="answer1" class="quiz-answer">
                        <strong>ç­”æ¡ˆï¼š</strong><br>
                        <strong>ä¸»è¦åŒºåˆ«ï¼š</strong><br>
                        â€¢ B+æ ‘çš„æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ä¸­ï¼Œå†…éƒ¨èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•<br>
                        â€¢ å¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆè¿æ¥å½¢æˆæœ‰åºé“¾è¡¨<br>
                        â€¢ æ‰€æœ‰æŸ¥æ‰¾æ“ä½œéƒ½å¿…é¡»åˆ°è¾¾å¶å­èŠ‚ç‚¹<br>
                        <strong>å¸¦æ¥çš„ä¼˜åŠ¿ï¼š</strong><br>
                        â€¢ å†…éƒ¨èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œå¯å®¹çº³æ›´å¤šç´¢å¼•ï¼Œæé«˜åˆ†æ”¯å› å­<br>
                        â€¢ å¶å­é“¾è¡¨æ”¯æŒé«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢å’Œé¡ºåºè®¿é—®<br>
                        â€¢ æŸ¥æ‰¾è·¯å¾„ç¨³å®šï¼Œç¼“å­˜å‹å¥½
                    </div>
                </div>

                <div class="quiz-item">
                    <h4>ğŸ¤” é—®é¢˜2ï¼šèŒƒå›´æŸ¥è¯¢æœºåˆ¶</h4>
                    <p>B+æ ‘æ˜¯å¦‚ä½•å®ç°é«˜æ•ˆèŒƒå›´æŸ¥è¯¢çš„ï¼Ÿè¯·æè¿°æŸ¥è¯¢[20, 60]èŒƒå›´æ•°æ®çš„è¿‡ç¨‹ã€‚</p>
                    <button class="quiz-btn" onclick="toggleAnswer(2)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div id="answer2" class="quiz-answer">
                        <strong>ç­”æ¡ˆï¼š</strong><br>
                        <strong>èŒƒå›´æŸ¥è¯¢è¿‡ç¨‹ï¼š</strong><br>
                        1. <strong>å®šä½èµ·å§‹ï¼š</strong>é€šè¿‡B+æ ‘ç´¢å¼•æ‰¾åˆ°åŒ…å«å…³é”®å­—20çš„å¶å­èŠ‚ç‚¹<br>
                        2. <strong>æ‰¾åˆ°èµ·ç‚¹ï¼š</strong>åœ¨è¯¥å¶å­èŠ‚ç‚¹ä¸­å®šä½åˆ°ç¬¬ä¸€ä¸ªâ‰¥20çš„æ•°æ®è®°å½•<br>
                        3. <strong>é“¾è¡¨éå†ï¼š</strong>æ²¿ç€å¶å­èŠ‚ç‚¹çš„nextæŒ‡é’ˆé¡ºåºè®¿é—®<br>
                        4. <strong>æ”¶é›†æ•°æ®ï¼š</strong>æ”¶é›†æ‰€æœ‰â‰¤60çš„æ•°æ®è®°å½•<br>
                        5. <strong>ç»“æŸæ¡ä»¶ï¼š</strong>é‡åˆ°>60çš„æ•°æ®æ—¶åœæ­¢<br>
                        <strong>æ—¶é—´å¤æ‚åº¦ï¼š</strong>O(logâ‚˜n + k/f)ï¼Œå…¶ä¸­kæ˜¯ç»“æœæ•°é‡ï¼Œfæ˜¯å¡«å……å› å­
                    </div>
                </div>

                <div class="quiz-item">
                    <h4>ğŸ¤” é—®é¢˜3ï¼šæ•°æ®åº“åº”ç”¨</h4>
                    <p>ä¸ºä»€ä¹ˆå‡ ä¹æ‰€æœ‰å…³ç³»æ•°æ®åº“éƒ½é€‰æ‹©B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Ÿç›¸æ¯”å“ˆå¸Œç´¢å¼•æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</p>
                    <button class="quiz-btn" onclick="toggleAnswer(3)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div id="answer3" class="quiz-answer">
                        <strong>ç­”æ¡ˆï¼š</strong><br>
                        <strong>é€‰æ‹©B+æ ‘çš„åŸå› ï¼š</strong><br>
                        â€¢ <strong>ç£ç›˜å‹å¥½ï¼š</strong>æ ‘ç»“æ„åŒ¹é…ç£ç›˜å—å¤§å°ï¼Œå‡å°‘I/Oæ¬¡æ•°<br>
                        â€¢ <strong>èŒƒå›´æŸ¥è¯¢ï¼š</strong>æ”¯æŒBETWEENã€ORDER BYç­‰SQLæ“ä½œ<br>
                        â€¢ <strong>é¡ºåºè®¿é—®ï¼š</strong>å¶å­é“¾è¡¨å¤©ç„¶æ”¯æŒå…¨è¡¨æ‰«æ<br>
                        â€¢ <strong>å¹¶å‘æ§åˆ¶ï¼š</strong>æ›´ç»†ç²’åº¦çš„é”æœºåˆ¶<br>
                        <strong>ç›¸æ¯”å“ˆå¸Œç´¢å¼•ä¼˜åŠ¿ï¼š</strong><br>
                        â€¢ æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆå“ˆå¸Œä¸æ”¯æŒï¼‰<br>
                        â€¢ æ”¯æŒæ’åºæ“ä½œï¼ˆå“ˆå¸Œæ— åºï¼‰<br>
                        â€¢ æ”¯æŒå‰ç¼€åŒ¹é…ï¼ˆLIKE 'abc%'ï¼‰<br>
                        â€¢ æ›´ç¨³å®šçš„æ€§èƒ½è¡¨ç°
                    </div>
                </div>

                <div class="quiz-item">
                    <h4>ğŸ¤” é—®é¢˜4ï¼šå¶å­èŠ‚ç‚¹åˆ†è£‚</h4>
                    <p>B+æ ‘å¶å­èŠ‚ç‚¹åˆ†è£‚ä¸Bæ ‘èŠ‚ç‚¹åˆ†è£‚æœ‰ä»€ä¹ˆä¸åŒï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ</p>
                    <button class="quiz-btn" onclick="toggleAnswer(4)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div id="answer4" class="quiz-answer">
                        <strong>ç­”æ¡ˆï¼š</strong><br>
                        <strong>B+æ ‘å¶å­åˆ†è£‚ç‰¹ç‚¹ï¼š</strong><br>
                        â€¢ ä¸­é—´å…³é”®å­—<strong>å¤åˆ¶</strong>åˆ°çˆ¶èŠ‚ç‚¹ï¼ˆè€Œéç§»åŠ¨ï¼‰<br>
                        â€¢ åˆ†è£‚åéœ€è¦æ›´æ–°å¶å­èŠ‚ç‚¹é—´çš„é“¾è¡¨æŒ‡é’ˆ<br>
                        â€¢ åŸå¶å­èŠ‚ç‚¹ä¿ç•™ä¸­é—´å…³é”®å­—<br>
                        <strong>Bæ ‘èŠ‚ç‚¹åˆ†è£‚ï¼š</strong><br>
                        â€¢ ä¸­é—´å…³é”®å­—<strong>ç§»åŠ¨</strong>åˆ°çˆ¶èŠ‚ç‚¹<br>
                        â€¢ æ— éœ€ç»´æŠ¤é“¾è¡¨å…³ç³»<br>
                        <strong>è®¾è®¡åŸå› ï¼š</strong><br>
                        â€¢ ä¿æŒå¶å­é“¾è¡¨çš„å®Œæ•´æ€§å’Œæœ‰åºæ€§<br>
                        â€¢ ç¡®ä¿èŒƒå›´æŸ¥è¯¢ä¸ä¼šé—æ¼æ•°æ®<br>
                        â€¢ å†…éƒ¨èŠ‚ç‚¹ä½œä¸º"è·¯æ ‡"ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®
                    </div>
                </div>
            </div>

            <div class="next-steps">
                <h4>ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®</h4>
                <div class="unified-grid unified-grid-2">
                    <div class="info-box info-box-info">
                        <span class="info-icon">ğŸ“–</span>
                        <strong>æ·±å…¥å­¦ä¹ ï¼š</strong>LSM-Treeã€è·³è¡¨ç­‰ç°ä»£æ•°æ®åº“ç´¢å¼•ç»“æ„
                    </div>
                    <div class="info-box info-box-success">
                        <span class="info-icon">ğŸ’ª</span>
                        <strong>å®è·µé¡¹ç›®ï¼š</strong>å®ç°ä¸€ä¸ªæ”¯æŒäº‹åŠ¡çš„B+æ ‘å­˜å‚¨å¼•æ“
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary">
            <span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a>
        <a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary">
            <span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a>
    </div>
</div>

<style>
/* é¡µé¢åŸºç¡€æ ·å¼ - ç»§æ‰¿å‰é¢é¡µé¢çš„æ ·å¼æ¡†æ¶ */
.page-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.breadcrumb {
    margin-bottom: 20px;
    font-size: 14px;
    color: #666;
}

.page-header {
    text-align: center;
    margin-bottom: 30px;
}

.page-header h1 {
    font-size: 2.5rem;
    color: #333;
    margin-bottom: 10px;
}

.page-icon {
    font-size: 3rem;
    margin-right: 15px;
}

.content-card {
    background: white;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 20px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}

.section-title {
    font-size: 1.5rem;
    color: #333;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-icon {
    font-size: 1.8rem;
}

/* ç½‘æ ¼å¸ƒå±€ */
.unified-grid {
    display: grid;
    gap: 20px;
}

.unified-grid-2 {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

/* ä¿¡æ¯æ¡†æ ·å¼ */
.info-box {
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #4299e1;
}

.info-box-info {
    background: #ebf8ff;
    border-left-color: #4299e1;
}

.info-box-success {
    background: #f0fff4;
    border-left-color: #48bb78;
}

.info-box-warning {
    background: #fffaf0;
    border-left-color: #ed8936;
}

.info-icon {
    margin-right: 8px;
}

/* æ¦‚å¿µè¯¦è§£æ ·å¼ */
.concept-item {
    margin-bottom: 25px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.concept-item h3 {
    color: #2d3748;
    margin-bottom: 10px;
}

.example-box {
    margin-top: 15px;
    padding: 15px;
    background: #e6fffa;
    border-left: 4px solid #38b2ac;
    border-radius: 4px;
}

/* é—®é¢˜è§£å†³æ–¹æ¡ˆæ ·å¼ */
.problem-solution {
    margin-top: 25px;
}

.problem-box {
    padding: 20px;
    background: #fef2f2;
    border-left: 4px solid #f56565;
    border-radius: 8px;
}

.solution-box {
    padding: 20px;
    background: #f0fff4;
    border-left: 4px solid #48bb78;
    border-radius: 8px;
}

/* ç»Ÿè®¡æ¡†æ ·å¼ */
.stats-box {
    margin-top: 15px;
    padding: 15px;
    background: #f7fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.stats-box h5 {
    color: #2d3748;
    margin-bottom: 10px;
}

/* B+æ ‘å¯¹æ¯”å±•ç¤ºæ ·å¼ */
.comparison-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.compare-box {
    padding: 20px;
    border-radius: 8px;
    border: 2px solid #e2e8f0;
}

.compare-box h4 {
    text-align: center;
    margin-bottom: 15px;
    color: #2d3748;
}

.tree-structure-demo {
    margin: 15px 0;
    text-align: center;
}

.tree-level {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 10px 0;
    gap: 10px;
}

.tree-node {
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: bold;
    min-width: 80px;
    text-align: center;
}

.btree-node {
    background: #dbeafe;
    border: 2px solid #3b82f6;
    color: #1d4ed8;
}

.bplus-internal-node {
    background: #dbeafe;
    border: 2px solid #0ea5e9;
    color: #0369a1;
}

.bplus-leaf-node {
    background: #dcfce7;
    border: 2px solid #16a34a;
    color: #15803d;
}

.leaf-pointer {
    font-size: 16px;
    font-weight: bold;
    color: #dc2626;
}

.compare-features {
    margin-top: 15px;
    padding-left: 20px;
}

.compare-features li {
    margin-bottom: 8px;
    color: #4a5568;
    font-size: 14px;
}

/* è¿‡ç¨‹æ­¥éª¤æ ·å¼ */
.process-steps {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.step-box {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.step-number {
    background: #4299e1;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    flex-shrink: 0;
}

.step-content h5 {
    color: #2d3748;
    margin-bottom: 5px;
}

/* éå†ç®—æ³•æ ·å¼ */
.traversal-algorithm {
    margin-top: 15px;
}

.algorithm-steps {
    background: #f7fafc;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.algo-step {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 10px;
    padding: 8px 0;
}

.step-label {
    background: #ed8936;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: bold;
    flex-shrink: 0;
}

/* B+æ ‘å¯è§†åŒ–æ¼”ç¤ºæ ·å¼ */
.canvas-demo {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.control-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.control-group label {
    font-size: 14px;
    color: #4a5568;
    font-weight: 500;
}

.control-group select,
.control-group input {
    padding: 6px 10px;
    border: 2px solid #e2e8f0;
    border-radius: 6px;
    font-size: 14px;
    min-width: 80px;
}

.control-group select:focus,
.control-group input:focus {
    outline: none;
    border-color: #4299e1;
}

/* èŒƒå›´æŸ¥è¯¢æ§åˆ¶æ ·å¼ */
.range-query-controls {
    display: flex;
    justify-content: center;
    margin-bottom: 15px;
}

.range-query-controls .control-group {
    background: #f0f9ff;
    padding: 10px 15px;
    border-radius: 8px;
    border: 1px solid #bae6fd;
}

.range-query-controls span {
    color: #0369a1;
    font-weight: 500;
    margin: 0 5px;
}

.preset-controls {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.preset-controls button {
    padding: 10px 20px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
    color: white;
}

.insert-btn { background: linear-gradient(45deg, #16a34a, #22c55e); }
.delete-btn { background: linear-gradient(45deg, #dc2626, #ef4444); }
.range-btn { background: linear-gradient(45deg, #0ea5e9, #38bdf8); }
.demo-btn { background: linear-gradient(45deg, #7c3aed, #a855f7); }
.traverse-btn { background: linear-gradient(45deg, #f59e0b, #fbbf24); }
.search-btn { background: linear-gradient(45deg, #0ea5e9, #38bdf8); }
.reset-btn { background: linear-gradient(45deg, #4a5568, #6b7280); }

.preset-controls button:hover,
.control-group button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.canvas-container {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

#bplusCanvas {
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    background: white;
}

/* B+æ ‘å›¾ä¾‹æ ·å¼ */
.legend {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin: 20px 0;
    border: 1px solid #e2e8f0;
}

.legend h4 {
    margin: 0 0 15px 0;
    color: #2d3748;
    font-size: 16px;
}

.legend-items {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    margin-bottom: 15px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: white;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* B+æ ‘èŠ‚ç‚¹æ ·å¼ */
.legend-node {
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: bold;
    min-width: 50px;
    text-align: center;
    border: 2px solid;
}

.internal-node {
    background: #dbeafe;
    border-color: #0ea5e9;
    color: #0369a1;
}

.leaf-node {
    background: #dcfce7;
    border-color: #16a34a;
    color: #15803d;
}

.current-node {
    background: #ef4444;
    border-color: #dc2626;
    color: white;
}

.range-node {
    background: #fbbf24;
    border-color: #f59e0b;
    color: #92400e;
}

.leaf-pointer-demo {
    color: #dc2626;
    font-size: 16px;
    font-weight: bold;
}

.tree-connection-demo {
    width: 30px;
    height: 3px;
    background: #6b7280;
}

.legend-explanation {
    background: white;
    padding: 12px;
    border-radius: 6px;
    border-left: 4px solid #3b82f6;
}

.legend-explanation p {
    margin: 0 0 8px 0;
    font-weight: bold;
    color: #2d3748;
}

.legend-explanation ul {
    margin: 0;
    padding-left: 20px;
}

.legend-explanation li {
    margin-bottom: 4px;
    font-size: 14px;
    color: #4a5568;
}

.info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
}

.info .info-box {
    background: #f7fafc;
    border: 1px solid #e2e8f0;
}

.info h4 {
    margin-top: 0;
    color: #2d3748;
}

.sequence {
    font-size: 16px;
    font-weight: bold;
    color: #4299e1;
    min-height: 20px;
}

.status {
    font-size: 14px;
    color: #718096;
    margin-top: 8px;
}

/* ä»£ç æ ·å¼ */
.code-tabs {
    display: flex;
    border-bottom: 1px solid #e2e8f0;
    margin-bottom: 20px;
}

.tab-btn {
    padding: 12px 24px;
    border: none;
    background: none;
    cursor: pointer;
    font-size: 16px;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
}

.tab-btn.active {
    color: #4299e1;
    border-bottom-color: #4299e1;
}

.code-content {
    display: none;
}

.code-content.active {
    display: block;
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.copy-btn {
    background: #4299e1;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

.copy-btn:hover {
    background: #3182ce;
}

pre {
    background: #2d3748;
    color: #e2e8f0;
    padding: 20px;
    border-radius: 8px;
    overflow-x: auto;
    line-height: 1.6;
    font-size: 14px;
}

/* åº”ç”¨åœºæ™¯æ ·å¼ */
.app-item {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #4299e1;
}

.app-item h4 {
    color: #2d3748;
    margin-bottom: 15px;
}

/* æ€§èƒ½åˆ†æè¡¨æ ¼æ ·å¼ */
.performance-analysis {
    margin-top: 30px;
}

.comparison-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.comparison-table th,
.comparison-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #e2e8f0;
}

.comparison-table th {
    background: #f7fafc;
    font-weight: bold;
    color: #2d3748;
}

.performance-note {
    margin-top: 10px;
    font-size: 14px;
    color: #666;
    font-style: italic;
}

/* ä¼˜åŠ¿æ¡†æ ·å¼ */
.advantage-box {
    padding: 20px;
    background: #f0f9ff;
    border-radius: 8px;
    border-left: 4px solid #0ea5e9;
}

.advantage-box h4 {
    color: #0c4a6e;
    margin-bottom: 15px;
}

.advantage-box ul {
    margin: 0;
    padding-left: 20px;
}

.advantage-box li {
    margin-bottom: 8px;
    color: #1e40af;
}

/* å®æˆ˜æ¡ˆä¾‹æ ·å¼ */
.real-world-example {
    margin-top: 30px;
    padding: 25px;
    background: #f8fafc;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
}

.example-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin-top: 20px;
}

.sql-example {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #16a34a;
}

.sql-code {
    background: #1e293b;
    color: #e2e8f0;
    padding: 15px;
    border-radius: 6px;
    font-size: 13px;
    margin-top: 10px;
}

.performance-metrics {
    background: white;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #3b82f6;
}

.performance-metrics ul {
    margin-top: 15px;
    padding-left: 20px;
}

.performance-metrics li {
    margin-bottom: 8px;
    color: #374151;
}

/* æœ¯è¯­åˆ—è¡¨æ ·å¼ */
.terms-list .unified-grid-2 {
    margin-top: 15px;
}

.term-item {
    padding: 12px;
    background: white;
    border-radius: 6px;
    border-left: 3px solid #4299e1;
}

/* æµ‹éªŒæ ·å¼ */
.quiz-item {
    margin-bottom: 25px;
    padding: 20px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
}

.quiz-btn {
    background: #4299e1;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 15px;
    transition: background 0.3s ease;
}

.quiz-btn:hover {
    background: #3182ce;
}

.quiz-answer {
    display: none;
    margin-top: 15px;
    padding: 15px;
    background: #f0fff4;
    border-left: 4px solid #48bb78;
    border-radius: 4px;
}

.quiz-answer.show {
    display: block;
}

.unified-btn {
    display: inline-block;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    margin: 0 10px;
    transition: all 0.3s ease;
}

.unified-btn-primary {
    background: #4299e1;
    color: white;
}

.unified-btn-secondary {
    background: #718096;
    color: white;
}

.unified-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

@media (max-width: 768px) {
    .info {
        grid-template-columns: 1fr;
    }

    .controls {
        flex-direction: column;
    }

    .preset-controls {
        flex-direction: column;
        align-items: center;
    }

    .preset-controls button {
        width: 200px;
    }

    .unified-grid-2 {
        grid-template-columns: 1fr;
    }

    .comparison-grid {
        grid-template-columns: 1fr;
    }

    .process-steps {
        grid-template-columns: 1fr;
    }

    .comparison-table {
        font-size: 12px;
    }

    .example-content {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// B+æ ‘å¯è§†åŒ–æ¼”ç¤ºç›¸å…³ä»£ç 
const bplusCanvas = document.getElementById('bplusCanvas');
const bplusCtx = bplusCanvas.getContext('2d');

// B+æ ‘èŠ‚ç‚¹ç±»
class BPlusNode {
    constructor(isLeaf = false) {
        this.keys = [];
        this.isLeaf = isLeaf;
        this.parent = null;
        this.x = 0;
        this.y = 0;
        this.width = 0;
        this.height = 40;
        this.state = 'normal'; // normal, current, new, range
    }
}

class InternalNode extends BPlusNode {
    constructor() {
        super(false);
        this.children = [];
    }
}

class LeafNode extends BPlusNode {
    constructor() {
        super(true);
        this.values = [];
        this.next = null;
        this.prev = null;
    }
}

// B+æ ‘ç±»
class BPlusTree {
    constructor(order = 4) {
        this.root = null;
        this.order = order;
        this.minKeys = Math.floor((order - 1) / 2);
        this.maxKeys = order - 1;
        this.leftmostLeaf = null;
    }

    search(key) {
        const leaf = this.findLeaf(key);
        if (!leaf) return null;

        for (let i = 0; i < leaf.keys.length; i++) {
            if (leaf.keys[i] === key) {
                return { leaf: leaf, index: i, value: leaf.values[i] };
            }
        }
        return null;
    }

    rangeQuery(startKey, endKey) {
        const result = [];
        const leaf = this.findLeaf(startKey);
        if (!leaf) return result;

        let currentLeaf = leaf;
        let startIdx = 0;

        // åœ¨èµ·å§‹å¶å­èŠ‚ç‚¹ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ª >= startKey çš„ä½ç½®
        while (startIdx < currentLeaf.keys.length && currentLeaf.keys[startIdx] < startKey) {
            startIdx++;
        }

        // æ²¿ç€å¶å­é“¾è¡¨æ”¶é›†æ•°æ®
        while (currentLeaf && startIdx < currentLeaf.keys.length) {
            if (currentLeaf.keys[startIdx] > endKey) break;

            result.push({
                key: currentLeaf.keys[startIdx],
                value: currentLeaf.values[startIdx],
                leaf: currentLeaf,
                index: startIdx
            });
            startIdx++;

            if (startIdx === currentLeaf.keys.length) {
                currentLeaf = currentLeaf.next;
                startIdx = 0;
            }
        }

        return result;
    }

    insert(key, value = `D${key}`) {
        if (!this.root) {
            const newLeaf = new LeafNode();
            newLeaf.keys.push(key);
            newLeaf.values.push(value);
            this.root = newLeaf;
            this.leftmostLeaf = newLeaf;
            return { type: 'create', node: newLeaf };
        }

        const leaf = this.findLeaf(key);

        // æ£€æŸ¥é”®æ˜¯å¦å·²å­˜åœ¨
        for (let i = 0; i < leaf.keys.length; i++) {
            if (leaf.keys[i] === key) {
                leaf.values[i] = value;
                return { type: 'update', node: leaf };
            }
        }

        this.insertIntoLeaf(leaf, key, value);

        if (leaf.keys.length > this.maxKeys) {
            this.splitLeaf(leaf);
        }

        return { type: 'insert', node: leaf };
    }

    findLeaf(key) {
        if (!this.root) return null;

        let current = this.root;

        while (!current.isLeaf) {
            let i = 0;
            while (i < current.keys.length && key >= current.keys[i]) {
                i++;
            }
            current = current.children[i];
        }

        return current;
    }

    insertIntoLeaf(leaf, key, value) {
        let i = 0;
        while (i < leaf.keys.length && leaf.keys[i] < key) {
            i++;
        }

        leaf.keys.splice(i, 0, key);
        leaf.values.splice(i, 0, value);
    }

    splitLeaf(leaf) {
        const newLeaf = new LeafNode();
        const mid = Math.ceil(this.maxKeys / 2);

        // ç§»åŠ¨ååŠéƒ¨åˆ†æ•°æ®
        newLeaf.keys = leaf.keys.splice(mid);
        newLeaf.values = leaf.values.splice(mid);

        // æ›´æ–°å¶å­é“¾è¡¨
        newLeaf.next = leaf.next;
        newLeaf.prev = leaf;
        if (leaf.next) {
            leaf.next.prev = newLeaf;
        }
        leaf.next = newLeaf;

        const promoteKey = newLeaf.keys[0];

        if (leaf === this.root) {
            const newRoot = new InternalNode();
            newRoot.keys.push(promoteKey);
            newRoot.children.push(leaf);
            newRoot.children.push(newLeaf);

            leaf.parent = newRoot;
            newLeaf.parent = newRoot;
            this.root = newRoot;
        } else {
            const parent = leaf.parent;
            this.insertIntoInternal(parent, promoteKey, newLeaf);
            newLeaf.parent = parent;
        }
    }

    insertIntoInternal(internal, key, rightChild) {
        let i = 0;
        while (i < internal.keys.length && internal.keys[i] < key) {
            i++;
        }

        internal.keys.splice(i, 0, key);
        internal.children.splice(i + 1, 0, rightChild);

        if (internal.keys.length > this.maxKeys) {
            this.splitInternal(internal);
        }
    }

    splitInternal(internal) {
        const newInternal = new InternalNode();
        const mid = Math.floor(this.maxKeys / 2);
        const promoteKey = internal.keys[mid];

        newInternal.keys = internal.keys.splice(mid + 1);
        newInternal.children = internal.children.splice(mid + 1);
        internal.keys.splice(mid, 1); // ç§»é™¤æå‡çš„å…³é”®å­—

        // æ›´æ–°å­èŠ‚ç‚¹çš„çˆ¶æŒ‡é’ˆ
        for (const child of newInternal.children) {
            child.parent = newInternal;
        }

        if (internal === this.root) {
            const newRoot = new InternalNode();
            newRoot.keys.push(promoteKey);
            newRoot.children.push(internal);
            newRoot.children.push(newInternal);

            internal.parent = newRoot;
            newInternal.parent = newRoot;
            this.root = newRoot;
        } else {
            const parent = internal.parent;
            this.insertIntoInternal(parent, promoteKey, newInternal);
            newInternal.parent = parent;
        }
    }

    getAllData() {
        const result = [];
        let current = this.leftmostLeaf;

        while (current) {
            for (let i = 0; i < current.keys.length; i++) {
                result.push({ key: current.keys[i], value: current.values[i] });
            }
            current = current.next;
        }

        return result;
    }

    getHeight(node = this.root) {
        if (!node) return 0;
        if (node.isLeaf) return 1;
        return this.getHeight(node.children[0]) + 1;
    }

    getNodeCount(node = this.root) {
        if (!node) return { total: 0, internal: 0, leaf: 0 };

        if (node.isLeaf) {
            return { total: 1, internal: 0, leaf: 1 };
        }

        let counts = { total: 1, internal: 1, leaf: 0 };
        for (const child of node.children) {
            const childCounts = this.getNodeCount(child);
            counts.total += childCounts.total;
            counts.internal += childCounts.internal;
            counts.leaf += childCounts.leaf;
        }

        return counts;
    }
}

// å…¨å±€å˜é‡
let bplusTree = new BPlusTree(4);
let animationState = {
    isAnimating: false,
    history: [],
    rangeResults: []
};

// è®¡ç®—B+æ ‘å¸ƒå±€
function calculateBPlusLayout(node, level = 0, x = 475, levelWidth = 900) {
    if (!node) return;

    const keyWidth = node.isLeaf ? 45 : 35;
    const nodeMargin = 20;
    node.width = node.keys.length * keyWidth + nodeMargin;
    node.x = x;
    node.y = 80 + level * 80;

    if (!node.isLeaf && node.children.length > 0) {
        const childrenCount = node.children.length;
        const childWidth = levelWidth / childrenCount;
        const startX = x - levelWidth / 2 + childWidth / 2;

        for (let i = 0; i < node.children.length; i++) {
            const childX = startX + i * childWidth;
            calculateBPlusLayout(node.children[i], level + 1, childX, childWidth * 0.8);
        }
    }
}

// ç»˜åˆ¶B+æ ‘èŠ‚ç‚¹
function drawBPlusNode(node) {
    if (!node) return;

    const keyWidth = node.isLeaf ? 45 : 35;
    const nodeHeight = 40;
    const x = node.x - node.width / 2;
    const y = node.y - nodeHeight / 2;

    // æ ¹æ®èŠ‚ç‚¹ç±»å‹å’ŒçŠ¶æ€è®¾ç½®é¢œè‰²
    let fillColor, strokeColor, textColor;

    if (node.state === 'current') {
        fillColor = '#ef4444';
        strokeColor = '#dc2626';
        textColor = 'white';
    } else if (node.state === 'range') {
        fillColor = '#fbbf24';
        strokeColor = '#f59e0b';
        textColor = '#92400e';
    } else if (node.isLeaf) {
        fillColor = '#dcfce7';
        strokeColor = '#16a34a';
        textColor = '#15803d';
    } else {
        fillColor = '#dbeafe';
        strokeColor = '#0ea5e9';
        textColor = '#0369a1';
    }

    // ç»˜åˆ¶èŠ‚ç‚¹èƒŒæ™¯
    bplusCtx.fillStyle = fillColor;
    bplusCtx.fillRect(x, y, node.width, nodeHeight);

    // ç»˜åˆ¶èŠ‚ç‚¹è¾¹æ¡†
    bplusCtx.strokeStyle = strokeColor;
    bplusCtx.lineWidth = 2;
    bplusCtx.strokeRect(x, y, node.width, nodeHeight);

    // ç»˜åˆ¶åˆ†éš”çº¿å’Œå†…å®¹
    bplusCtx.strokeStyle = strokeColor;
    bplusCtx.lineWidth = 1;
    bplusCtx.fillStyle = textColor;
    bplusCtx.font = 'bold 12px Arial';
    bplusCtx.textAlign = 'center';
    bplusCtx.textBaseline = 'middle';

    for (let i = 0; i < node.keys.length; i++) {
        const keyX = x + (i + 0.5) * keyWidth + 10;
        const keyY = node.y;

        // ç»˜åˆ¶åˆ†éš”çº¿
        if (i > 0) {
            bplusCtx.beginPath();
            bplusCtx.moveTo(x + i * keyWidth + 10, y);
            bplusCtx.lineTo(x + i * keyWidth + 10, y + nodeHeight);
            bplusCtx.stroke();
        }

        // ç»˜åˆ¶å†…å®¹
        if (node.isLeaf) {
            // å¶å­èŠ‚ç‚¹æ˜¾ç¤º key[data]
            bplusCtx.fillText(`${node.keys[i]}[D]`, keyX, keyY);
        } else {
            // å†…éƒ¨èŠ‚ç‚¹åªæ˜¾ç¤º key
            bplusCtx.fillText(node.keys[i].toString(), keyX, keyY);
        }
    }
}

// ç»˜åˆ¶æ ‘å½¢è¿æ¥çº¿
function drawTreeConnections(node) {
    if (!node || node.isLeaf) return;

    const nodeY = node.y + 20;

    for (let i = 0; i < node.children.length; i++) {
        const child = node.children[i];
        const childY = child.y - 20;

        const parentX = node.x + (i - node.children.length / 2 + 0.5) * 25;

        bplusCtx.strokeStyle = '#6b7280';
        bplusCtx.lineWidth = 2;
        bplusCtx.beginPath();
        bplusCtx.moveTo(parentX, nodeY);
        bplusCtx.lineTo(child.x, childY);
        bplusCtx.stroke();

        drawTreeConnections(child);
    }
}

// ç»˜åˆ¶å¶å­èŠ‚ç‚¹é“¾è¡¨è¿æ¥
function drawLeafConnections() {
    let current = bplusTree.leftmostLeaf;

    while (current && current.next) {
        const startX = current.x + current.width / 2 - 10;
        const startY = current.y + 25;
        const endX = current.next.x - current.next.width / 2 + 10;
        const endY = current.next.y + 25;

        // ç»˜åˆ¶ç®­å¤´è¿æ¥çº¿
        bplusCtx.strokeStyle = '#dc2626';
        bplusCtx.lineWidth = 2;
        bplusCtx.setLineDash([5, 3]);

        bplusCtx.beginPath();
        bplusCtx.moveTo(startX, startY);
        bplusCtx.lineTo(endX, endY);
        bplusCtx.stroke();

        // ç»˜åˆ¶ç®­å¤´
        const angle = Math.atan2(endY - startY, endX - startX);
        const arrowLength = 8;
        const arrowAngle = Math.PI / 6;

        bplusCtx.fillStyle = '#dc2626';
        bplusCtx.beginPath();
        bplusCtx.moveTo(endX, endY);
        bplusCtx.lineTo(
            endX - arrowLength * Math.cos(angle - arrowAngle),
            endY - arrowLength * Math.sin(angle - arrowAngle)
        );
        bplusCtx.lineTo(
            endX - arrowLength * Math.cos(angle + arrowAngle),
            endY - arrowLength * Math.sin(angle + arrowAngle)
        );
        bplusCtx.closePath();
        bplusCtx.fill();

        bplusCtx.setLineDash([]); // é‡ç½®è™šçº¿
        current = current.next;
    }
}

// ç»˜åˆ¶æ•´ä¸ªB+æ ‘
function drawBPlusTree() {
    bplusCtx.clearRect(0, 0, bplusCanvas.width, bplusCanvas.height);

    if (!bplusTree.root) {
        bplusCtx.fillStyle = '#6b7280';
        bplusCtx.font = '18px Arial';
        bplusCtx.textAlign = 'center';
        bplusCtx.fillText('B+æ ‘ä¸ºç©ºï¼Œè¯·æ’å…¥æ•°æ®', bplusCanvas.width / 2, bplusCanvas.height / 2);
        return;
    }

    // è®¡ç®—å¸ƒå±€
    calculateBPlusLayout(bplusTree.root);

    // ç»˜åˆ¶æ ‘å½¢è¿æ¥çº¿ï¼ˆåº•å±‚ï¼‰
    drawTreeConnections(bplusTree.root);

    // ç»˜åˆ¶å¶å­é“¾è¡¨è¿æ¥
    drawLeafConnections();

    // ç»˜åˆ¶èŠ‚ç‚¹ï¼ˆé¡¶å±‚ï¼‰
    function drawAllNodes(node) {
        if (node) {
            drawBPlusNode(node);
            if (!node.isLeaf) {
                for (const child of node.children) {
                    drawAllNodes(child);
                }
            }
        }
    }
    drawAllNodes(bplusTree.root);
}

// é‡ç½®èŠ‚ç‚¹çŠ¶æ€
function resetNodeStates(node = bplusTree.root) {
    if (node) {
        node.state = 'normal';
        if (!node.isLeaf) {
            for (const child of node.children) {
                resetNodeStates(child);
            }
        }
    }
}

// æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
function updateBPlusStats() {
    const height = bplusTree.getHeight();
    const counts = bplusTree.getNodeCount();
    const keyCount = bplusTree.getAllData().length;

    document.getElementById('bplusStats').textContent =
        `å…³é”®å­—: ${keyCount}, å†…éƒ¨èŠ‚ç‚¹: ${counts.internal}, å¶å­èŠ‚ç‚¹: ${counts.leaf}`;
    document.getElementById('bplusStructure').textContent =
        `é«˜åº¦: ${height}, é˜¶æ•°: ${bplusTree.order}, æ€»èŠ‚ç‚¹: ${counts.total}`;
}

// æ’å…¥å…³é”®å­—
async function insertKey() {
    if (animationState.isAnimating) return;

    const input = document.getElementById('insertValue');
    const value = parseInt(input.value);

    if (isNaN(value) || value < 1 || value > 99) {
        alert('è¯·è¾“å…¥1-99ä¹‹é—´çš„æ•°å­—');
        return;
    }

    animationState.isAnimating = true;

    try {
        resetNodeStates();
        const result = bplusTree.insert(value);

        if (result.node) {
            result.node.state = 'current';
        }

        drawBPlusTree();
        updateBPlusStats();

        animationState.history.push(`æ’å…¥ ${value}`);
        updateHistory();

        document.getElementById('bplusStatus').textContent = `æˆåŠŸæ’å…¥å…³é”®å­— ${value}`;

        // é‡ç½®çŠ¶æ€
        setTimeout(() => {
            resetNodeStates();
            drawBPlusTree();
        }, 2000);

    } catch (error) {
        console.error('æ’å…¥æ“ä½œå‡ºé”™:', error);
        document.getElementById('bplusStatus').textContent = 'æ’å…¥æ“ä½œå¤±è´¥';
    }

    input.value = '';
    animationState.isAnimating = false;
}

// åˆ é™¤å…³é”®å­—ï¼ˆç®€åŒ–å®ç°ï¼‰
async function deleteKey() {
    const input = document.getElementById('deleteValue');
    const value = parseInt(input.value);

    if (isNaN(value)) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—');
        return;
    }

    // ç®€åŒ–åˆ é™¤ - é‡å»ºæ ‘
    const allData = bplusTree.getAllData();
    const filteredData = allData.filter(item => item.key !== value);

    if (filteredData.length === allData.length) {
        alert(`å…³é”®å­— ${value} ä¸å­˜åœ¨`);
        return;
    }

    bplusTree = new BPlusTree(bplusTree.order);
    for (const item of filteredData) {
        bplusTree.insert(item.key, item.value);
    }

    drawBPlusTree();
    updateBPlusStats();

    animationState.history.push(`åˆ é™¤ ${value}`);
    updateHistory();

    document.getElementById('bplusStatus').textContent = `æˆåŠŸåˆ é™¤å…³é”®å­— ${value}`;
    input.value = '';
}

// èŒƒå›´æŸ¥è¯¢
async function rangeQuery() {
    const startInput = document.getElementById('rangeStart');
    const endInput = document.getElementById('rangeEnd');
    const startKey = parseInt(startInput.value);
    const endKey = parseInt(endInput.value);

    if (isNaN(startKey) || isNaN(endKey) || startKey > endKey) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„èŒƒå›´ï¼ˆèµ·å§‹å€¼ â‰¤ ç»“æŸå€¼ï¼‰');
        return;
    }

    resetNodeStates();

    const results = bplusTree.rangeQuery(startKey, endKey);
    animationState.rangeResults = results;

    // é«˜äº®èŒƒå›´æŸ¥è¯¢ç»“æœ
    for (const result of results) {
        result.leaf.state = 'range';
    }

    drawBPlusTree();

    const resultKeys = results.map(r => r.key).join(', ');
    document.getElementById('bplusStatus').textContent =
        `èŒƒå›´æŸ¥è¯¢ [${startKey}, ${endKey}]: ${resultKeys || 'æ— ç»“æœ'}`;

    animationState.history.push(`èŒƒå›´æŸ¥è¯¢ [${startKey}, ${endKey}]`);
    updateHistory();

    // 3ç§’åé‡ç½®é«˜äº®
    setTimeout(() => {
        resetNodeStates();
        drawBPlusTree();
    }, 3000);

    startInput.value = '';
    endInput.value = '';
}

// å¶å­éå†æ¼”ç¤º
async function leafTraversal() {
    if (!bplusTree.root) {
        alert('è¯·å…ˆæ’å…¥ä¸€äº›æ•°æ®');
        return;
    }

    resetNodeStates();

    const allData = bplusTree.getAllData();
    const keys = allData.map(item => item.key).join(' â†’ ');

    // é«˜äº®æ‰€æœ‰å¶å­èŠ‚ç‚¹
    let current = bplusTree.leftmostLeaf;
    while (current) {
        current.state = 'range';
        current = current.next;
    }

    drawBPlusTree();

    document.getElementById('bplusStatus').textContent =
        `å¶å­é“¾è¡¨éå†: ${keys}`;

    animationState.history.push('å¶å­é“¾è¡¨éå†');
    updateHistory();

    setTimeout(() => {
        resetNodeStates();
        drawBPlusTree();
    }, 3000);
}

// æŸ¥æ‰¾æ¼”ç¤º
async function searchDemo() {
    if (!bplusTree.root) {
        alert('è¯·å…ˆæ’å…¥ä¸€äº›æ•°æ®');
        return;
    }

    const allData = bplusTree.getAllData();
    if (allData.length === 0) return;

    const randomIndex = Math.floor(Math.random() * allData.length);
    const randomKey = allData[randomIndex].key;

    resetNodeStates();
    const result = bplusTree.search(randomKey);

    if (result) {
        result.leaf.state = 'current';
        drawBPlusTree();

        document.getElementById('bplusStatus').textContent =
            `æ‰¾åˆ°å…³é”®å­— ${randomKey}ï¼Œå€¼: ${result.value}`;
    }

    animationState.history.push(`æŸ¥æ‰¾ ${randomKey}`);
    updateHistory();

    setTimeout(() => {
        resetNodeStates();
        drawBPlusTree();
    }, 2000);
}

// æ¼”ç¤ºæ’å…¥
async function insertDemo() {
    if (animationState.isAnimating) return;

    const demoKeys = [50, 25, 75, 10, 30, 60, 80, 15, 35, 65];
    animationState.isAnimating = true;

    for (const key of demoKeys) {
        const existing = bplusTree.search(key);
        if (!existing) {
            await new Promise(resolve => {
                setTimeout(() => {
                    resetNodeStates();
                    const result = bplusTree.insert(key);
                    if (result.node) {
                        result.node.state = 'current';
                    }
                    drawBPlusTree();
                    updateBPlusStats();

                    animationState.history.push(`æ¼”ç¤ºæ’å…¥ ${key}`);
                    updateHistory();

                    document.getElementById('bplusStatus').textContent =
                        `æ¼”ç¤ºæ’å…¥å…³é”®å­— ${key}`;

                    setTimeout(() => {
                        resetNodeStates();
                        drawBPlusTree();
                        resolve();
                    }, 1500);
                }, 800);
            });
        }
    }

    animationState.isAnimating = false;
    document.getElementById('bplusStatus').textContent = 'æ¼”ç¤ºæ’å…¥å®Œæˆ';
}

// é‡ç½®B+æ ‘
function resetBPlusTree() {
    bplusTree = new BPlusTree(bplusTree.order);
    animationState.history = [];
    animationState.rangeResults = [];
    resetNodeStates();
    drawBPlusTree();
    updateBPlusStats();
    updateHistory();
    document.getElementById('bplusStatus').textContent = 'B+æ ‘å·²é‡ç½®';
}

// æ”¹å˜é˜¶æ•°
function changeOrder() {
    const select = document.getElementById('bplusTreeOrder');
    const newOrder = parseInt(select.value);
    bplusTree = new BPlusTree(newOrder);
    resetBPlusTree();
    document.getElementById('bplusStatus').textContent = `å·²åˆ‡æ¢åˆ°${newOrder}é˜¶B+æ ‘`;
}

// æ›´æ–°å†å²è®°å½•
function updateHistory() {
    const history = animationState.history.slice(-8); // åªæ˜¾ç¤ºæœ€è¿‘8æ¡
    document.getElementById('bplusHistory').textContent =
        history.length > 0 ? history.join(' â†’ ') : 'æš‚æ— æ“ä½œ';
}

// ä»£ç ç›¸å…³åŠŸèƒ½
function showCode(language) {
    const codeContents = document.querySelectorAll('.code-content');
    codeContents.forEach(content => content.classList.remove('active'));

    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(tab => tab.classList.remove('active'));

    document.getElementById(`${language}-code`).classList.add('active');
    event.target.classList.add('active');
}

function copyCode(language, buttonElement) {
    let button = buttonElement;
    if (!button) {
        button = event ? event.target : null;
    }

    if (!button) {
        console.error('æ— æ³•è·å–æŒ‰é’®å…ƒç´ ');
        return;
    }

    const codeElement = document.getElementById(`${language}-source`);

    if (!codeElement) {
        console.error(`æ‰¾ä¸åˆ°ä»£ç å…ƒç´ : ${language}-source`);
        showCopyError(button);
        return;
    }

    const text = codeElement.textContent || codeElement.innerText;
    const cleanText = text.trim();

    if (!cleanText) {
        console.error('ä»£ç å†…å®¹ä¸ºç©º');
        showCopyError(button);
        return;
    }

    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(cleanText).then(() => {
            showCopySuccess(button);
        }).catch(err => {
            console.error('ç°ä»£APIå¤åˆ¶å¤±è´¥:', err);
            fallbackCopyTextToClipboard(cleanText, button);
        });
    } else {
        fallbackCopyTextToClipboard(cleanText, button);
    }
}

function fallbackCopyTextToClipboard(text, button) {
    const textArea = document.createElement("textarea");
    textArea.value = text;

    textArea.style.position = "fixed";
    textArea.style.top = "-1000px";
    textArea.style.left = "-1000px";
    textArea.style.width = "1px";
    textArea.style.height = "1px";
    textArea.style.padding = "0";
    textArea.style.border = "none";
    textArea.style.outline = "none";
    textArea.style.boxShadow = "none";
    textArea.style.background = "transparent";

    document.body.appendChild(textArea);

    try {
        textArea.focus();
        textArea.select();
        textArea.setSelectionRange(0, text.length);

        const successful = document.execCommand('copy');

        if (successful) {
            showCopySuccess(button);
        } else {
            console.error('execCommandå¤åˆ¶å¤±è´¥');
            showCopyError(button);
        }
    } catch (err) {
        console.error('é™çº§å¤åˆ¶æ–¹æ³•å‡ºé”™:', err);
        showCopyError(button);
    } finally {
        document.body.removeChild(textArea);
    }
}

function showCopySuccess(button) {
    if (!button) return;

    const originalText = button.innerHTML;
    const originalClass = button.className;

    button.innerHTML = 'âœ… å·²å¤åˆ¶';
    button.className = originalClass + ' copy-success';
    button.disabled = true;

    const originalStyle = button.style.cssText;
    button.style.cssText = originalStyle + '; background: #22c55e !important; color: white !important;';

    setTimeout(() => {
        button.innerHTML = originalText;
        button.className = originalClass;
        button.disabled = false;
        button.style.cssText = originalStyle;
    }, 2000);
}

function showCopyError(button) {
    if (!button) return;

    const originalText = button.innerHTML;
    const originalClass = button.className;

    button.innerHTML = 'âŒ å¤åˆ¶å¤±è´¥';
    button.className = originalClass + ' copy-error';
    button.disabled = true;

    const originalStyle = button.style.cssText;
    button.style.cssText = originalStyle + '; background: #ef4444 !important; color: white !important;';

    setTimeout(() => {
        button.innerHTML = originalText;
        button.className = originalClass;
        button.disabled = false;
        button.style.cssText = originalStyle;
    }, 2000);
}

// æµ‹éªŒåŠŸèƒ½
function toggleAnswer(questionNumber) {
    const answer = document.getElementById(`answer${questionNumber}`);
    const button = event.target;

    if (answer.classList.contains('show')) {
        answer.classList.remove('show');
        button.textContent = 'ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ';
    } else {
        answer.classList.add('show');
        button.textContent = 'éšè—ç­”æ¡ˆ';
    }
}

// é”®ç›˜äº‹ä»¶æ”¯æŒ
document.getElementById('insertValue').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        insertKey();
    }
});

document.getElementById('deleteValue').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        deleteKey();
    }
});

document.getElementById('rangeStart').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        rangeQuery();
    }
});

document.getElementById('rangeEnd').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        rangeQuery();
    }
});

// åˆå§‹åŒ–
drawBPlusTree();
updateBPlusStats();
updateHistory();
</script>

{% endblock %}