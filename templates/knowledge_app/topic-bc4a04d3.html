{% extends 'knowledge_app/base.html' %}

{% block title %}Bæ ‘ - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block content %}
<div class="page-container fade-in">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="{% url 'knowledge_app:index' %}">é¦–é¡µ</a>
        <span>></span>
        <span>æ•°æ®ç»“æ„</span>
        <span>></span>
        <span>Bæ ‘</span>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header slide-in-left">
        <h1>
            <span class="page-icon">ğŸŒ³</span>
            Bæ ‘ (B-Tree)
        </h1>
        <p>å¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼Œæ•°æ®åº“ç´¢å¼•çš„åŸºçŸ³ï¼Œæ”¯æŒé«˜æ•ˆçš„ç£ç›˜å­˜å‚¨å’Œæ£€ç´¢</p>
    </div>

    <!-- ğŸ“‹ çŸ¥è¯†ç‚¹æ¦‚è¿° -->
    <div class="content-card slide-in-right">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“‹</span>
                çŸ¥è¯†ç‚¹æ¦‚è¿°
            </h2>

            <div class="overview-content">
                <div class="concept-intro">
                    <h3>æ ¸å¿ƒæ¦‚å¿µ</h3>
                    <p>Bæ ‘å°±åƒä¸€æœ¬å¤šçº§ç´¢å¼•çš„ç™¾ç§‘å…¨ä¹¦ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥å®¹çº³å¤šä¸ªå…³é”®å­—ï¼Œé€šè¿‡å·§å¦™çš„å¹³è¡¡æœºåˆ¶ç¡®ä¿æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ã€‚å®ƒä¸“ä¸ºç£ç›˜å­˜å‚¨ä¼˜åŒ–ï¼Œå‡å°‘ç£ç›˜I/Oæ¬¡æ•°ï¼Œæ˜¯ç°ä»£æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚</p>
                </div>

                <div class="unified-grid unified-grid-2">
                    <div class="info-box info-box-info">
                        <span class="info-icon">ğŸ“š</span>
                        <div>
                            <strong>å­¦ä¹ éš¾åº¦ï¼š</strong>ä¸­ç­‰åéš¾
                            <br><strong>å‰ç½®çŸ¥è¯†ï¼š</strong>äºŒå‰æœç´¢æ ‘ã€å¹³è¡¡æ ‘æ¦‚å¿µ
                        </div>
                    </div>
                    <div class="info-box info-box-success">
                        <span class="info-icon">â±ï¸</span>
                        <div>
                            <strong>å­¦ä¹ æ—¶é—´ï¼š</strong>60-90åˆ†é’Ÿ
                            <br><strong>é‡è¦ç¨‹åº¦ï¼š</strong>â­â­â­â­â­
                        </div>
                    </div>
                </div>

                <div class="terms-list">
                    <h4>ğŸ”‘ å…³é”®æœ¯è¯­</h4>
                    <div class="unified-grid unified-grid-2">
                        <div class="term-item">
                            <strong>é˜¶æ•°(Order)ï¼š</strong>Bæ ‘çš„é‡è¦å‚æ•°ï¼Œå†³å®šèŠ‚ç‚¹æœ€å¤§å­æ ‘æ•°é‡
                        </div>
                        <div class="term-item">
                            <strong>å…³é”®å­—ï¼š</strong>å­˜å‚¨åœ¨èŠ‚ç‚¹ä¸­çš„æ•°æ®é¡¹ï¼Œç”¨äºç´¢å¼•å’ŒæŸ¥æ‰¾
                        </div>
                        <div class="term-item">
                            <strong>åˆ†è£‚(Split)ï¼š</strong>å½“èŠ‚ç‚¹è¿‡æ»¡æ—¶ä¸€åˆ†ä¸ºäºŒçš„æ“ä½œ
                        </div>
                        <div class="term-item">
                            <strong>åˆå¹¶(Merge)ï¼š</strong>å½“èŠ‚ç‚¹è¿‡å°‘æ—¶åˆå¹¶ç›¸é‚»èŠ‚ç‚¹çš„æ“ä½œ
                        </div>
                    </div>
                </div>

                <div class="problem-solution">
                    <h4>ğŸ’¡ è§£å†³çš„é—®é¢˜</h4>
                    <div class="unified-grid unified-grid-2">
                        <div class="problem-box">
                            <h5>ğŸ”´ ä¼ ç»Ÿé—®é¢˜</h5>
                            <ul>
                                <li>äºŒå‰æ ‘åœ¨ç£ç›˜å­˜å‚¨ä¸­I/Oæ¬¡æ•°è¿‡å¤š</li>
                                <li>æ•°æ®é‡å¤§æ—¶æ ‘çš„é«˜åº¦è¿‡é«˜</li>
                                <li>ç£ç›˜å—åˆ©ç”¨ç‡ä½ï¼Œå­˜å‚¨æµªè´¹</li>
                                <li>é¡ºåºè®¿é—®æ•ˆç‡ä¸é«˜</li>
                            </ul>
                        </div>
                        <div class="solution-box">
                            <h5>ğŸŸ¢ Bæ ‘ä¼˜åŠ¿</h5>
                            <ul>
                                <li>å¤šè·¯ç»“æ„å‡å°‘æ ‘çš„é«˜åº¦</li>
                                <li>æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å¤šä¸ªå…³é”®å­—</li>
                                <li>å®Œç¾é€‚é…ç£ç›˜å—å¤§å°</li>
                                <li>ä¿è¯æ‰€æœ‰å¶å­åœ¨åŒä¸€å±‚</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“– æ¦‚å¿µè¯¦è§£ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“–</span>
                æ¦‚å¿µè¯¦è§£
            </h2>

            <div class="concept-details">
                <div class="concept-item">
                    <h3>ğŸ¯ ä»€ä¹ˆæ˜¯Bæ ‘</h3>
                    <p>Bæ ‘æ˜¯ä¸€ç§å¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«å¤šä¸ªå…³é”®å­—å’Œå­æ ‘æŒ‡é’ˆã€‚å®ƒé€šè¿‡ä¸¥æ ¼çš„å¹³è¡¡æ¡ä»¶ç¡®ä¿ä¼˜ç§€çš„æŸ¥æ‰¾æ€§èƒ½ã€‚</p>
                    <div class="example-box">
                        <strong>Bæ ‘æ€§è´¨ï¼š</strong>å¯¹äºmé˜¶Bæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰mä¸ªå­æ ‘ï¼Œæœ€å¤šåŒ…å«m-1ä¸ªå…³é”®å­—ï¼Œæ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ã€‚
                    </div>
                    <div class="stats-box">
                        <h5>ğŸ“Š mé˜¶Bæ ‘ç‰¹æ€§</h5>
                        <p><strong>æ ¹èŠ‚ç‚¹ï¼š</strong>è‡³å°‘1ä¸ªå…³é”®å­—ï¼ˆé™¤ç©ºæ ‘å¤–ï¼‰</p>
                        <p><strong>å†…éƒ¨èŠ‚ç‚¹ï¼š</strong>è‡³å°‘âŒˆm/2âŒ‰-1ä¸ªå…³é”®å­—</p>
                        <p><strong>æœ€å¤§å…³é”®å­—æ•°ï¼š</strong>m-1ä¸ª</p>
                        <p><strong>æœ€å¤§å­æ ‘æ•°ï¼š</strong>mä¸ª</p>
                    </div>
                </div>

                <div class="concept-item">
                    <h3>ğŸ¯ Bæ ‘ç±»å‹ä¸å˜ç§</h3>
                    <div class="thread-types">
                        <div class="type-box">
                            <h4>Bæ ‘ (B-Tree)</h4>
                            <p>ç»å…¸çš„å¤šè·¯å¹³è¡¡æœç´¢æ ‘</p>
                            <div class="type-feature">ç‰¹ç‚¹ï¼šå†…éƒ¨èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ®</div>
                        </div>
                        <div class="type-box">
                            <h4>B+æ ‘ (B+Tree)</h4>
                            <p>Bæ ‘çš„æ”¹è¿›ç‰ˆæœ¬</p>
                            <div class="type-feature">ç‰¹ç‚¹ï¼šåªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œå†…éƒ¨èŠ‚ç‚¹åªåšç´¢å¼•</div>
                        </div>
                        <div class="type-box">
                            <h4>B*æ ‘ (B*Tree)</h4>
                            <p>B+æ ‘çš„è¿›ä¸€æ­¥ä¼˜åŒ–</p>
                            <div class="type-feature">ç‰¹ç‚¹ï¼šæé«˜èŠ‚ç‚¹åˆ©ç”¨ç‡ï¼Œå»¶è¿Ÿåˆ†è£‚æ“ä½œ</div>
                        </div>
                    </div>
                </div>

                <div class="concept-item">
                    <h3>ğŸ¯ Bæ ‘åŸºæœ¬æ“ä½œ</h3>
                    <p>Bæ ‘çš„ä¸‰å¤§æ ¸å¿ƒæ“ä½œï¼šæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ï¼Œæ¯ä¸ªæ“ä½œéƒ½éœ€è¦ç»´æŠ¤Bæ ‘çš„å¹³è¡¡æ€§è´¨ã€‚</p>
                    <div class="process-steps">
                        <div class="step-box">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h5>æŸ¥æ‰¾æ“ä½œ</h5>
                                <p>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œåœ¨èŠ‚ç‚¹å†…éƒ¨è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾</p>
                            </div>
                        </div>
                        <div class="step-box">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h5>æ’å…¥æ“ä½œ</h5>
                                <p>å…ˆæŸ¥æ‰¾æ’å…¥ä½ç½®ï¼Œå¦‚æœèŠ‚ç‚¹æ»¡äº†åˆ™è¿›è¡Œåˆ†è£‚</p>
                            </div>
                        </div>
                        <div class="step-box">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h5>åˆ é™¤æ“ä½œ</h5>
                                <p>æ ¹æ®ä¸åŒæƒ…å†µè¿›è¡Œåˆ é™¤ã€å€Ÿä½æˆ–åˆå¹¶</p>
                            </div>
                        </div>
                        <div class="step-box">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h5>å¹³è¡¡ç»´æŠ¤</h5>
                                <p>é€šè¿‡åˆ†è£‚å’Œåˆå¹¶ä¿æŒBæ ‘çš„å¹³è¡¡æ€§è´¨</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="concept-item">
                    <h3>ğŸ¯ åˆ†è£‚ä¸åˆå¹¶æœºåˆ¶</h3>
                    <p>Bæ ‘çš„è‡ªå¹³è¡¡ç‰¹æ€§é€šè¿‡èŠ‚ç‚¹çš„åˆ†è£‚å’Œåˆå¹¶æ¥å®ç°ï¼Œç¡®ä¿æ ‘çš„é«˜åº¦å§‹ç»ˆä¿æŒåœ¨å¯¹æ•°çº§åˆ«ã€‚</p>
                    <div class="traversal-algorithm">
                        <h5>èŠ‚ç‚¹åˆ†è£‚è¿‡ç¨‹ï¼š</h5>
                        <div class="algorithm-steps">
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤1ï¼š</span>
                                <span>å½“èŠ‚ç‚¹å…³é”®å­—æ•°é‡è¾¾åˆ°m-1æ—¶è§¦å‘åˆ†è£‚</span>
                            </div>
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤2ï¼š</span>
                                <span>é€‰æ‹©ä¸­é—´å…³é”®å­—ä½œä¸ºåˆ†è£‚ç‚¹</span>
                            </div>
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤3ï¼š</span>
                                <span>ä¸­é—´å…³é”®å­—ä¸Šå‡åˆ°çˆ¶èŠ‚ç‚¹</span>
                            </div>
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤4ï¼š</span>
                                <span>å·¦å³éƒ¨åˆ†å½¢æˆä¸¤ä¸ªæ–°çš„å­èŠ‚ç‚¹</span>
                            </div>
                            <div class="algo-step">
                                <span class="step-label">æ­¥éª¤5ï¼š</span>
                                <span>å¦‚æœçˆ¶èŠ‚ç‚¹ä¹Ÿæ»¡äº†ï¼Œåˆ™é€’å½’åˆ†è£‚</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box info-box-warning">
                    <span class="info-icon">âš ï¸</span>
                    <strong>é‡è¦æç¤ºï¼š</strong>
                    <ul>
                        <li>Bæ ‘çš„é˜¶æ•°é€‰æ‹©è¦è€ƒè™‘ç£ç›˜å—å¤§å°å’Œå…³é”®å­—å¤§å°</li>
                        <li>æ‰€æœ‰å¶å­èŠ‚ç‚¹å¿…é¡»åœ¨åŒä¸€å±‚ï¼Œè¿™æ˜¯Bæ ‘çš„é‡è¦ç‰¹å¾</li>
                        <li>èŠ‚ç‚¹ä¸­å…³é”®å­—å¿…é¡»ä¿æŒæœ‰åºçŠ¶æ€</li>
                        <li>é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå¦‚æ•°æ®åº“ç´¢å¼•å’Œæ–‡ä»¶ç³»ç»Ÿ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ“Š å¯è§†åŒ–å±•ç¤º -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ“Š</span>
                äº¤äº’å¼Bæ ‘æ¼”ç¤º
            </h2>

            <div class="visualization-container">
                <div class="demo-description">
                    <p>è§‚çœ‹Bæ ‘æ’å…¥å’Œåˆ é™¤æ“ä½œçš„åŠ¨ç”»æ¼”ç¤ºã€‚<span style="color: #16a34a; font-weight: bold;">ç»¿è‰²èŠ‚ç‚¹</span>è¡¨ç¤ºæ–°æ’å…¥çš„å…³é”®å­—ï¼Œ<span style="color: #dc2626; font-weight: bold;">çº¢è‰²èŠ‚ç‚¹</span>è¡¨ç¤ºæ­£åœ¨å¤„ç†çš„èŠ‚ç‚¹ï¼Œ<span style="color: #f59e0b; font-weight: bold;">æ©™è‰²èŠ‚ç‚¹</span>è¡¨ç¤ºåˆ†è£‚æˆ–åˆå¹¶çš„èŠ‚ç‚¹ã€‚</p>
                    <div style="margin-top: 10px; font-size: 14px; color: #666;">
                        âœ¨ <strong>äº¤äº’å¼å­¦ä¹ ï¼š</strong>é€šè¿‡åŠ¨ç”»æ¼”ç¤ºç†è§£Bæ ‘çš„åˆ†è£‚ã€åˆå¹¶æœºåˆ¶ï¼Œä»¥åŠå¹³è¡¡æ€§è´¨çš„ç»´æŠ¤è¿‡ç¨‹ã€‚æ”¯æŒè‡ªå®šä¹‰é˜¶æ•°å’Œå…³é”®å­—æ’å…¥ï¼
                    </div>
                </div>

                <div class="canvas-demo">
                    <div class="controls">
                        <div class="control-group">
                            <label>Bæ ‘é˜¶æ•°ï¼š</label>
                            <select id="btreeOrder" onchange="changeOrder()">
                                <option value="3">3é˜¶</option>
                                <option value="4" selected>4é˜¶</option>
                                <option value="5">5é˜¶</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>æ’å…¥å€¼ï¼š</label>
                            <input type="number" id="insertValue" placeholder="è¾“å…¥æ•°å­—" min="1" max="99">
                            <button class="insert-btn" onclick="insertKey()">ğŸ” æ’å…¥</button>
                        </div>
                        <div class="control-group">
                            <label>åˆ é™¤å€¼ï¼š</label>
                            <input type="number" id="deleteValue" placeholder="è¾“å…¥æ•°å­—" min="1" max="99">
                            <button class="delete-btn" onclick="deleteKey()">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </div>

                    <div class="preset-controls">
                        <button class="demo-btn" onclick="insertDemo()">ğŸ“ æ¼”ç¤ºæ’å…¥</button>
                        <button class="search-btn" onclick="searchDemo()">ğŸ” æŸ¥æ‰¾æ¼”ç¤º</button>
                        <button class="reset-btn" onclick="resetBTree()">ğŸ”„ é‡ç½®</button>
                    </div>

                    <div class="canvas-container">
                        <canvas id="btreeCanvas" width="900" height="500"></canvas>
                    </div>

                    <div class="legend">
                        <h4>å›¾ä¾‹è¯´æ˜</h4>
                        <div class="legend-items">
                            <div class="legend-item">
                                <div class="legend-node normal-node">
                                    <span>25|50</span>
                                </div>
                                <span>æ­£å¸¸èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-node current-node">
                                    <span>25|50</span>
                                </div>
                                <span>å½“å‰å¤„ç†èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-node new-node">
                                    <span>25|50</span>
                                </div>
                                <span>æ–°æ’å…¥èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-node split-node">
                                    <span>25|50</span>
                                </div>
                                <span>åˆ†è£‚èŠ‚ç‚¹</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-connection"></div>
                                <span>çˆ¶å­è¿æ¥</span>
                            </div>
                        </div>
                        <div class="legend-explanation">
                            <p><strong>èŠ‚ç‚¹ç»“æ„è¯´æ˜ï¼š</strong></p>
                            <ul>
                                <li><strong>å…³é”®å­—ï¼š</strong>èŠ‚ç‚¹å†…çš„æ•°æ®é¡¹ï¼Œç”¨"|"åˆ†éš”</li>
                                <li><strong>å­æŒ‡é’ˆï¼š</strong>æŒ‡å‘å­æ ‘çš„è¿æ¥çº¿</li>
                                <li><strong>æœ‰åºæ€§ï¼š</strong>èŠ‚ç‚¹å†…å…³é”®å­—ä»å·¦åˆ°å³é€’å¢</li>
                                <li><strong>å¹³è¡¡æ€§ï¼š</strong>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚</li>
                            </ul>
                            <div style="margin-top: 12px; padding: 10px; background: #f0f9ff; border-left: 3px solid #3b82f6; border-radius: 4px;">
                                <strong>ğŸ’¡ æ“ä½œæç¤ºï¼š</strong>
                                <ul style="margin: 8px 0 0 15px; font-size: 12px;">
                                    <li>ğŸ”¢ <strong>æ’å…¥æ“ä½œ</strong>ï¼šè¾“å…¥1-99çš„æ•°å­—ï¼Œè§‚å¯ŸèŠ‚ç‚¹åˆ†è£‚è¿‡ç¨‹</li>
                                    <li>ğŸ—‘ï¸ <strong>åˆ é™¤æ“ä½œ</strong>ï¼šåˆ é™¤ç°æœ‰å…³é”®å­—ï¼Œè§‚å¯Ÿåˆå¹¶è¿‡ç¨‹</li>
                                    <li>ğŸ“ <strong>æ¼”ç¤ºæ¨¡å¼</strong>ï¼šè‡ªåŠ¨æ’å…¥åºåˆ—å±•ç¤ºBæ ‘æ„å»ºè¿‡ç¨‹</li>
                                    <li>ğŸ¯ <strong>é˜¶æ•°è°ƒæ•´</strong>ï¼šåˆ‡æ¢ä¸åŒé˜¶æ•°ä½“éªŒä¸åŒçš„Bæ ‘ç»“æ„</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="info">
                        <div class="info-box">
                            <h4>æ“ä½œå†å²</h4>
                            <div class="sequence" id="btreeHistory"></div>
                            <div class="status" id="btreeStatus">Bæ ‘å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æ“ä½œ</div>
                        </div>
                        <div class="info-box">
                            <h4>æ ‘çš„ç»Ÿè®¡</h4>
                            <div class="sequence" id="btreeStats"></div>
                            <div class="status" id="btreeStructure">æ ‘é«˜åº¦: 0, èŠ‚ç‚¹æ•°: 0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ’» ä»£ç å®ç° -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸ’»</span>
                ä»£ç å®ç°
            </h2>

            <div class="code-implementation">
                <div class="code-tabs">
                    <button class="tab-btn active" onclick="showCode('cpp')">C++</button>
                    <button class="tab-btn" onclick="showCode('java')">Java</button>
                    <button class="tab-btn" onclick="showCode('python')">Python</button>
                </div>

                <div id="cpp-code" class="code-content active">
                    <div class="code-header">
                        <span>C++ å®ç°</span>
                        <button onclick="copyCode('cpp', this)" class="copy-btn">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code id="cpp-source">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt;
using namespace std;

template&lt;typename T&gt;
class BTree {
private:
    struct BTreeNode {
        vector&lt;T&gt; keys;        // å…³é”®å­—æ•°ç»„
        vector&lt;BTreeNode*&gt; children; // å­èŠ‚ç‚¹æŒ‡é’ˆæ•°ç»„
        bool isLeaf;           // æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹

        BTreeNode(bool leaf) : isLeaf(leaf) {}

        ~BTreeNode() {
            for (auto child : children) {
                delete child;
            }
        }
    };

    BTreeNode* root;
    int minDegree; // Bæ ‘çš„æœ€å°åº¦æ•° tï¼Œé˜¶æ•°ä¸º 2t

public:
    BTree(int degree) : minDegree(degree), root(nullptr) {}

    ~BTree() {
        delete root;
    }

    // æœç´¢å…³é”®å­—
    bool search(T key) {
        return searchHelper(root, key);
    }

    // æ’å…¥å…³é”®å­—
    void insert(T key) {
        if (root == nullptr) {
            root = new BTreeNode(true);
            root-&gt;keys.push_back(key);
        } else {
            // å¦‚æœæ ¹èŠ‚ç‚¹æ»¡äº†ï¼Œéœ€è¦åˆ†è£‚
            if (root-&gt;keys.size() == 2 * minDegree - 1) {
                BTreeNode* newRoot = new BTreeNode(false);
                newRoot-&gt;children.push_back(root);
                splitChild(newRoot, 0);
                root = newRoot;
            }
            insertNonFull(root, key);
        }
    }

    // åˆ é™¤å…³é”®å­—
    void remove(T key) {
        if (root == nullptr) return;

        removeHelper(root, key);

        // å¦‚æœæ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œè°ƒæ•´æ ‘ç»“æ„
        if (root-&gt;keys.empty()) {
            BTreeNode* oldRoot = root;
            if (root-&gt;isLeaf) {
                root = nullptr;
            } else {
                root = root-&gt;children[0];
            }
            oldRoot-&gt;children.clear(); // é¿å…é€’å½’åˆ é™¤
            delete oldRoot;
        }
    }

    // éå†Bæ ‘
    void traverse() {
        if (root != nullptr) {
            traverseHelper(root);
        }
        cout &lt;&lt; endl;
    }

private:
    bool searchHelper(BTreeNode* node, T key) {
        if (node == nullptr) return false;

        int i = 0;
        while (i &lt; node-&gt;keys.size() && key &gt; node-&gt;keys[i]) {
            i++;
        }

        if (i &lt; node-&gt;keys.size() && key == node-&gt;keys[i]) {
            return true;
        }

        if (node-&gt;isLeaf) {
            return false;
        }

        return searchHelper(node-&gt;children[i], key);
    }

    void insertNonFull(BTreeNode* node, T key) {
        int i = node-&gt;keys.size() - 1;

        if (node-&gt;isLeaf) {
            node-&gt;keys.push_back(T());
            while (i &gt;= 0 && key &lt; node-&gt;keys[i]) {
                node-&gt;keys[i + 1] = node-&gt;keys[i];
                i--;
            }
            node-&gt;keys[i + 1] = key;
        } else {
            while (i &gt;= 0 && key &lt; node-&gt;keys[i]) {
                i--;
            }
            i++;

            if (node-&gt;children[i]-&gt;keys.size() == 2 * minDegree - 1) {
                splitChild(node, i);
                if (key &gt; node-&gt;keys[i]) {
                    i++;
                }
            }
            insertNonFull(node-&gt;children[i], key);
        }
    }

    void splitChild(BTreeNode* parent, int childIndex) {
        BTreeNode* fullChild = parent-&gt;children[childIndex];
        BTreeNode* newChild = new BTreeNode(fullChild-&gt;isLeaf);

        // å°†ååŠéƒ¨åˆ†å…³é”®å­—ç§»åˆ°æ–°èŠ‚ç‚¹
        int midIndex = minDegree - 1;
        for (int i = 0; i &lt; minDegree - 1; i++) {
            newChild-&gt;keys.push_back(fullChild-&gt;keys[midIndex + 1 + i]);
        }

        // å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç§»åŠ¨å­æŒ‡é’ˆ
        if (!fullChild-&gt;isLeaf) {
            for (int i = 0; i &lt; minDegree; i++) {
                newChild-&gt;children.push_back(fullChild-&gt;children[midIndex + 1 + i]);
            }
            fullChild-&gt;children.resize(minDegree);
        }

        // è°ƒæ•´åŸèŠ‚ç‚¹å¤§å°
        T midKey = fullChild-&gt;keys[midIndex];
        fullChild-&gt;keys.resize(midIndex);

        // åœ¨çˆ¶èŠ‚ç‚¹ä¸­æ’å…¥ä¸­é—´å…³é”®å­—å’Œæ–°å­èŠ‚ç‚¹
        parent-&gt;children.insert(parent-&gt;children.begin() + childIndex + 1, newChild);
        parent-&gt;keys.insert(parent-&gt;keys.begin() + childIndex, midKey);
    }

    void removeHelper(BTreeNode* node, T key) {
        int keyIndex = findKey(node, key);

        if (keyIndex &lt; node-&gt;keys.size() && node-&gt;keys[keyIndex] == key) {
            if (node-&gt;isLeaf) {
                // æƒ…å†µ1: å…³é”®å­—åœ¨å¶å­èŠ‚ç‚¹ä¸­
                node-&gt;keys.erase(node-&gt;keys.begin() + keyIndex);
            } else {
                // æƒ…å†µ2: å…³é”®å­—åœ¨å†…éƒ¨èŠ‚ç‚¹ä¸­
                removeFromNonLeaf(node, keyIndex);
            }
        } else if (!node-&gt;isLeaf) {
            // å…³é”®å­—ä¸åœ¨å½“å‰èŠ‚ç‚¹ä¸­ï¼Œé€’å½’åˆ°å­èŠ‚ç‚¹
            bool shouldGoToLastChild = (keyIndex == node-&gt;keys.size());

            if (node-&gt;children[keyIndex]-&gt;keys.size() &lt; minDegree) {
                fillChild(node, keyIndex);
            }

            if (shouldGoToLastChild && keyIndex &gt; node-&gt;keys.size()) {
                removeHelper(node-&gt;children[keyIndex - 1], key);
            } else {
                removeHelper(node-&gt;children[keyIndex], key);
            }
        }
    }

    int findKey(BTreeNode* node, T key) {
        int index = 0;
        while (index &lt; node-&gt;keys.size() && node-&gt;keys[index] &lt; key) {
            index++;
        }
        return index;
    }

    void removeFromNonLeaf(BTreeNode* node, int keyIndex) {
        T key = node-&gt;keys[keyIndex];

        if (node-&gt;children[keyIndex]-&gt;keys.size() &gt;= minDegree) {
            // å·¦å­èŠ‚ç‚¹æœ‰è¶³å¤Ÿçš„å…³é”®å­—ï¼Œæ‰¾å‰é©±
            T predecessor = getPredecessor(node, keyIndex);
            node-&gt;keys[keyIndex] = predecessor;
            removeHelper(node-&gt;children[keyIndex], predecessor);
        } else if (node-&gt;children[keyIndex + 1]-&gt;keys.size() &gt;= minDegree) {
            // å³å­èŠ‚ç‚¹æœ‰è¶³å¤Ÿçš„å…³é”®å­—ï¼Œæ‰¾åç»§
            T successor = getSuccessor(node, keyIndex);
            node-&gt;keys[keyIndex] = successor;
            removeHelper(node-&gt;children[keyIndex + 1], successor);
        } else {
            // ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½åªæœ‰æœ€å°‘å…³é”®å­—æ•°ï¼Œåˆå¹¶
            mergeChildren(node, keyIndex);
            removeHelper(node-&gt;children[keyIndex], key);
        }
    }

    T getPredecessor(BTreeNode* node, int keyIndex) {
        BTreeNode* current = node-&gt;children[keyIndex];
        while (!current-&gt;isLeaf) {
            current = current-&gt;children.back();
        }
        return current-&gt;keys.back();
    }

    T getSuccessor(BTreeNode* node, int keyIndex) {
        BTreeNode* current = node-&gt;children[keyIndex + 1];
        while (!current-&gt;isLeaf) {
            current = current-&gt;children[0];
        }
        return current-&gt;keys[0];
    }

    void fillChild(BTreeNode* node, int childIndex) {
        // å°è¯•ä»å…„å¼ŸèŠ‚ç‚¹å€Ÿå…³é”®å­—ï¼Œæˆ–è€…åˆå¹¶èŠ‚ç‚¹
        if (childIndex != 0 && node-&gt;children[childIndex - 1]-&gt;keys.size() &gt;= minDegree) {
            borrowFromPrev(node, childIndex);
        } else if (childIndex != node-&gt;children.size() - 1 &&
                   node-&gt;children[childIndex + 1]-&gt;keys.size() &gt;= minDegree) {
            borrowFromNext(node, childIndex);
        } else {
            if (childIndex != node-&gt;children.size() - 1) {
                mergeChildren(node, childIndex);
            } else {
                mergeChildren(node, childIndex - 1);
            }
        }
    }

    void borrowFromPrev(BTreeNode* node, int childIndex) {
        BTreeNode* child = node-&gt;children[childIndex];
        BTreeNode* sibling = node-&gt;children[childIndex - 1];

        child-&gt;keys.insert(child-&gt;keys.begin(), node-&gt;keys[childIndex - 1]);
        node-&gt;keys[childIndex - 1] = sibling-&gt;keys.back();
        sibling-&gt;keys.pop_back();

        if (!child-&gt;isLeaf) {
            child-&gt;children.insert(child-&gt;children.begin(), sibling-&gt;children.back());
            sibling-&gt;children.pop_back();
        }
    }

    void borrowFromNext(BTreeNode* node, int childIndex) {
        BTreeNode* child = node-&gt;children[childIndex];
        BTreeNode* sibling = node-&gt;children[childIndex + 1];

        child-&gt;keys.push_back(node-&gt;keys[childIndex]);
        node-&gt;keys[childIndex] = sibling-&gt;keys[0];
        sibling-&gt;keys.erase(sibling-&gt;keys.begin());

        if (!child-&gt;isLeaf) {
            child-&gt;children.push_back(sibling-&gt;children[0]);
            sibling-&gt;children.erase(sibling-&gt;children.begin());
        }
    }

    void mergeChildren(BTreeNode* node, int childIndex) {
        BTreeNode* child = node-&gt;children[childIndex];
        BTreeNode* sibling = node-&gt;children[childIndex + 1];

        child-&gt;keys.push_back(node-&gt;keys[childIndex]);

        for (int i = 0; i &lt; sibling-&gt;keys.size(); i++) {
            child-&gt;keys.push_back(sibling-&gt;keys[i]);
        }

        if (!child-&gt;isLeaf) {
            for (int i = 0; i &lt; sibling-&gt;children.size(); i++) {
                child-&gt;children.push_back(sibling-&gt;children[i]);
            }
        }

        node-&gt;keys.erase(node-&gt;keys.begin() + childIndex);
        node-&gt;children.erase(node-&gt;children.begin() + childIndex + 1);

        sibling-&gt;children.clear(); // é¿å…é€’å½’åˆ é™¤
        delete sibling;
    }

    void traverseHelper(BTreeNode* node) {
        int i;
        for (i = 0; i &lt; node-&gt;keys.size(); i++) {
            if (!node-&gt;isLeaf) {
                traverseHelper(node-&gt;children[i]);
            }
            cout &lt;&lt; node-&gt;keys[i] &lt;&lt; " ";
        }
        if (!node-&gt;isLeaf) {
            traverseHelper(node-&gt;children[i]);
        }
    }
};</code></pre>
                </div>

                <div id="java-code" class="code-content">
                    <div class="code-header">
                        <span>Java å®ç°</span>
                        <button onclick="copyCode('java', this)" class="copy-btn">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code id="java-source">import java.util.*;

public class BTree&lt;T extends Comparable&lt;T&gt;&gt; {
    private BTreeNode root;
    private int minDegree; // Bæ ‘çš„æœ€å°åº¦æ•° t

    private class BTreeNode {
        List&lt;T&gt; keys;           // å…³é”®å­—åˆ—è¡¨
        List&lt;BTreeNode&gt; children; // å­èŠ‚ç‚¹åˆ—è¡¨
        boolean isLeaf;         // æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹

        BTreeNode(boolean isLeaf) {
            this.keys = new ArrayList&lt;&gt;();
            this.children = new ArrayList&lt;&gt;();
            this.isLeaf = isLeaf;
        }
    }

    public BTree(int degree) {
        this.minDegree = degree;
        this.root = null;
    }

    // æœç´¢å…³é”®å­—
    public boolean search(T key) {
        return search(root, key);
    }

    private boolean search(BTreeNode node, T key) {
        if (node == null) return false;

        int i = 0;
        while (i &lt; node.keys.size() && key.compareTo(node.keys.get(i)) &gt; 0) {
            i++;
        }

        if (i &lt; node.keys.size() && key.compareTo(node.keys.get(i)) == 0) {
            return true;
        }

        if (node.isLeaf) {
            return false;
        }

        return search(node.children.get(i), key);
    }

    // æ’å…¥å…³é”®å­—
    public void insert(T key) {
        if (root == null) {
            root = new BTreeNode(true);
            root.keys.add(key);
        } else {
            if (root.keys.size() == 2 * minDegree - 1) {
                BTreeNode newRoot = new BTreeNode(false);
                newRoot.children.add(root);
                splitChild(newRoot, 0);
                root = newRoot;
            }
            insertNonFull(root, key);
        }
    }

    private void insertNonFull(BTreeNode node, T key) {
        int i = node.keys.size() - 1;

        if (node.isLeaf) {
            node.keys.add(null);
            while (i &gt;= 0 && key.compareTo(node.keys.get(i)) &lt; 0) {
                node.keys.set(i + 1, node.keys.get(i));
                i--;
            }
            node.keys.set(i + 1, key);
        } else {
            while (i &gt;= 0 && key.compareTo(node.keys.get(i)) &lt; 0) {
                i--;
            }
            i++;

            if (node.children.get(i).keys.size() == 2 * minDegree - 1) {
                splitChild(node, i);
                if (key.compareTo(node.keys.get(i)) &gt; 0) {
                    i++;
                }
            }
            insertNonFull(node.children.get(i), key);
        }
    }

    private void splitChild(BTreeNode parent, int childIndex) {
        BTreeNode fullChild = parent.children.get(childIndex);
        BTreeNode newChild = new BTreeNode(fullChild.isLeaf);

        int midIndex = minDegree - 1;

        // ç§»åŠ¨ååŠéƒ¨åˆ†å…³é”®å­—
        for (int i = 0; i &lt; minDegree - 1; i++) {
            newChild.keys.add(fullChild.keys.get(midIndex + 1 + i));
        }

        // å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç§»åŠ¨å­æŒ‡é’ˆ
        if (!fullChild.isLeaf) {
            for (int i = 0; i &lt; minDegree; i++) {
                newChild.children.add(fullChild.children.get(midIndex + 1 + i));
            }
            // ç§»é™¤å·²ç§»åŠ¨çš„å­èŠ‚ç‚¹
            for (int i = 0; i &lt; minDegree; i++) {
                fullChild.children.remove(fullChild.children.size() - 1);
            }
        }

        // è·å–ä¸­é—´å…³é”®å­—
        T midKey = fullChild.keys.get(midIndex);

        // ç§»é™¤å·²ç§»åŠ¨çš„å…³é”®å­—
        for (int i = 0; i &lt; minDegree; i++) {
            fullChild.keys.remove(fullChild.keys.size() - 1);
        }

        // åœ¨çˆ¶èŠ‚ç‚¹ä¸­æ’å…¥ä¸­é—´å…³é”®å­—å’Œæ–°å­èŠ‚ç‚¹
        parent.children.add(childIndex + 1, newChild);
        parent.keys.add(childIndex, midKey);
    }

    // åˆ é™¤å…³é”®å­—
    public void remove(T key) {
        if (root == null) return;

        remove(root, key);

        if (root.keys.isEmpty()) {
            if (!root.isLeaf) {
                root = root.children.get(0);
            } else {
                root = null;
            }
        }
    }

    private void remove(BTreeNode node, T key) {
        int keyIndex = findKey(node, key);

        if (keyIndex &lt; node.keys.size() &&
            key.compareTo(node.keys.get(keyIndex)) == 0) {
            if (node.isLeaf) {
                node.keys.remove(keyIndex);
            } else {
                removeFromNonLeaf(node, keyIndex);
            }
        } else if (!node.isLeaf) {
            boolean shouldGoToLastChild = (keyIndex == node.keys.size());

            if (node.children.get(keyIndex).keys.size() &lt; minDegree) {
                fillChild(node, keyIndex);
            }

            if (shouldGoToLastChild && keyIndex &gt; node.keys.size()) {
                remove(node.children.get(keyIndex - 1), key);
            } else {
                remove(node.children.get(keyIndex), key);
            }
        }
    }

    private int findKey(BTreeNode node, T key) {
        int index = 0;
        while (index &lt; node.keys.size() &&
               key.compareTo(node.keys.get(index)) &gt; 0) {
            index++;
        }
        return index;
    }

    private void removeFromNonLeaf(BTreeNode node, int keyIndex) {
        T key = node.keys.get(keyIndex);

        if (node.children.get(keyIndex).keys.size() &gt;= minDegree) {
            T predecessor = getPredecessor(node, keyIndex);
            node.keys.set(keyIndex, predecessor);
            remove(node.children.get(keyIndex), predecessor);
        } else if (node.children.get(keyIndex + 1).keys.size() &gt;= minDegree) {
            T successor = getSuccessor(node, keyIndex);
            node.keys.set(keyIndex, successor);
            remove(node.children.get(keyIndex + 1), successor);
        } else {
            mergeChildren(node, keyIndex);
            remove(node.children.get(keyIndex), key);
        }
    }

    private T getPredecessor(BTreeNode node, int keyIndex) {
        BTreeNode current = node.children.get(keyIndex);
        while (!current.isLeaf) {
            current = current.children.get(current.children.size() - 1);
        }
        return current.keys.get(current.keys.size() - 1);
    }

    private T getSuccessor(BTreeNode node, int keyIndex) {
        BTreeNode current = node.children.get(keyIndex + 1);
        while (!current.isLeaf) {
            current = current.children.get(0);
        }
        return current.keys.get(0);
    }

    private void fillChild(BTreeNode node, int childIndex) {
        if (childIndex != 0 &&
            node.children.get(childIndex - 1).keys.size() &gt;= minDegree) {
            borrowFromPrev(node, childIndex);
        } else if (childIndex != node.children.size() - 1 &&
                   node.children.get(childIndex + 1).keys.size() &gt;= minDegree) {
            borrowFromNext(node, childIndex);
        } else {
            if (childIndex != node.children.size() - 1) {
                mergeChildren(node, childIndex);
            } else {
                mergeChildren(node, childIndex - 1);
            }
        }
    }

    private void borrowFromPrev(BTreeNode node, int childIndex) {
        BTreeNode child = node.children.get(childIndex);
        BTreeNode sibling = node.children.get(childIndex - 1);

        child.keys.add(0, node.keys.get(childIndex - 1));
        node.keys.set(childIndex - 1,
                     sibling.keys.get(sibling.keys.size() - 1));
        sibling.keys.remove(sibling.keys.size() - 1);

        if (!child.isLeaf) {
            child.children.add(0,
                sibling.children.get(sibling.children.size() - 1));
            sibling.children.remove(sibling.children.size() - 1);
        }
    }

    private void borrowFromNext(BTreeNode node, int childIndex) {
        BTreeNode child = node.children.get(childIndex);
        BTreeNode sibling = node.children.get(childIndex + 1);

        child.keys.add(node.keys.get(childIndex));
        node.keys.set(childIndex, sibling.keys.get(0));
        sibling.keys.remove(0);

        if (!child.isLeaf) {
            child.children.add(sibling.children.get(0));
            sibling.children.remove(0);
        }
    }

    private void mergeChildren(BTreeNode node, int childIndex) {
        BTreeNode child = node.children.get(childIndex);
        BTreeNode sibling = node.children.get(childIndex + 1);

        child.keys.add(node.keys.get(childIndex));
        child.keys.addAll(sibling.keys);

        if (!child.isLeaf) {
            child.children.addAll(sibling.children);
        }

        node.keys.remove(childIndex);
        node.children.remove(childIndex + 1);
    }

    // éå†Bæ ‘
    public void traverse() {
        if (root != null) {
            traverse(root);
        }
        System.out.println();
    }

    private void traverse(BTreeNode node) {
        int i;
        for (i = 0; i &lt; node.keys.size(); i++) {
            if (!node.isLeaf) {
                traverse(node.children.get(i));
            }
            System.out.print(node.keys.get(i) + " ");
        }
        if (!node.isLeaf) {
            traverse(node.children.get(i));
        }
    }
}</code></pre>
                </div>

                <div id="python-code" class="code-content">
                    <div class="code-header">
                        <span>Python å®ç°</span>
                        <button onclick="copyCode('python', this)" class="copy-btn">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                    </div>
                    <pre><code id="python-source">class BTreeNode:
    """Bæ ‘èŠ‚ç‚¹ç±»"""
    def __init__(self, is_leaf=False):
        self.keys = []          # å…³é”®å­—åˆ—è¡¨
        self.children = []      # å­èŠ‚ç‚¹åˆ—è¡¨
        self.is_leaf = is_leaf  # æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹

class BTree:
    """Bæ ‘ç±»"""
    def __init__(self, min_degree):
        self.root = None
        self.min_degree = min_degree  # Bæ ‘çš„æœ€å°åº¦æ•° t

    def search(self, key, node=None):
        """æœç´¢å…³é”®å­—"""
        if node is None:
            node = self.root

        if node is None:
            return False

        i = 0
        while i < len(node.keys) and key > node.keys[i]:
            i += 1

        if i < len(node.keys) and key == node.keys[i]:
            return True

        if node.is_leaf:
            return False

        return self.search(key, node.children[i])

    def insert(self, key):
        """æ’å…¥å…³é”®å­—"""
        if self.root is None:
            self.root = BTreeNode(is_leaf=True)
            self.root.keys.append(key)
        else:
            if len(self.root.keys) == 2 * self.min_degree - 1:
                # æ ¹èŠ‚ç‚¹æ»¡äº†ï¼Œéœ€è¦åˆ†è£‚
                new_root = BTreeNode(is_leaf=False)
                new_root.children.append(self.root)
                self._split_child(new_root, 0)
                self.root = new_root

            self._insert_non_full(self.root, key)

    def _insert_non_full(self, node, key):
        """å‘éæ»¡èŠ‚ç‚¹æ’å…¥å…³é”®å­—"""
        i = len(node.keys) - 1

        if node.is_leaf:
            node.keys.append(None)
            while i >= 0 and key < node.keys[i]:
                node.keys[i + 1] = node.keys[i]
                i -= 1
            node.keys[i + 1] = key
        else:
            while i >= 0 and key < node.keys[i]:
                i -= 1
            i += 1

            if len(node.children[i].keys) == 2 * self.min_degree - 1:
                self._split_child(node, i)
                if key > node.keys[i]:
                    i += 1

            self._insert_non_full(node.children[i], key)

    def _split_child(self, parent, child_index):
        """åˆ†è£‚å­èŠ‚ç‚¹"""
        full_child = parent.children[child_index]
        new_child = BTreeNode(is_leaf=full_child.is_leaf)

        mid_index = self.min_degree - 1

        # å°†ååŠéƒ¨åˆ†å…³é”®å­—ç§»åˆ°æ–°èŠ‚ç‚¹
        new_child.keys = full_child.keys[mid_index + 1:]
        full_child.keys = full_child.keys[:mid_index]

        # å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç§»åŠ¨å­æŒ‡é’ˆ
        if not full_child.is_leaf:
            new_child.children = full_child.children[mid_index + 1:]
            full_child.children = full_child.children[:mid_index + 1]

        # åœ¨çˆ¶èŠ‚ç‚¹ä¸­æ’å…¥ä¸­é—´å…³é”®å­—å’Œæ–°å­èŠ‚ç‚¹
        mid_key = full_child.keys[mid_index] if mid_index < len(full_child.keys) else full_child.keys[-1]
        if mid_index < len(full_child.keys):
            full_child.keys.pop()

        parent.children.insert(child_index + 1, new_child)
        parent.keys.insert(child_index, mid_key)

    def remove(self, key):
        """åˆ é™¤å…³é”®å­—"""
        if self.root is None:
            return

        self._remove_helper(self.root, key)

        # å¦‚æœæ ¹èŠ‚ç‚¹ä¸ºç©ºï¼Œè°ƒæ•´æ ‘ç»“æ„
        if len(self.root.keys) == 0:
            if not self.root.is_leaf:
                self.root = self.root.children[0]
            else:
                self.root = None

    def _remove_helper(self, node, key):
        """åˆ é™¤è¾…åŠ©å‡½æ•°"""
        key_index = self._find_key_index(node, key)

        if key_index < len(node.keys) and node.keys[key_index] == key:
            if node.is_leaf:
                # æƒ…å†µ1: å…³é”®å­—åœ¨å¶å­èŠ‚ç‚¹ä¸­
                node.keys.pop(key_index)
            else:
                # æƒ…å†µ2: å…³é”®å­—åœ¨å†…éƒ¨èŠ‚ç‚¹ä¸­
                self._remove_from_non_leaf(node, key_index)
        elif not node.is_leaf:
            # å…³é”®å­—ä¸åœ¨å½“å‰èŠ‚ç‚¹ä¸­ï¼Œé€’å½’åˆ°å­èŠ‚ç‚¹
            should_go_to_last_child = (key_index == len(node.keys))

            if len(node.children[key_index].keys) < self.min_degree:
                self._fill_child(node, key_index)

            if should_go_to_last_child and key_index > len(node.keys):
                self._remove_helper(node.children[key_index - 1], key)
            else:
                self._remove_helper(node.children[key_index], key)

    def _find_key_index(self, node, key):
        """åœ¨èŠ‚ç‚¹ä¸­æ‰¾åˆ°å…³é”®å­—çš„ç´¢å¼•ä½ç½®"""
        index = 0
        while index < len(node.keys) and node.keys[index] < key:
            index += 1
        return index

    def _remove_from_non_leaf(self, node, key_index):
        """ä»éå¶å­èŠ‚ç‚¹åˆ é™¤å…³é”®å­—"""
        key = node.keys[key_index]

        if len(node.children[key_index].keys) >= self.min_degree:
            # å·¦å­èŠ‚ç‚¹æœ‰è¶³å¤Ÿå…³é”®å­—ï¼Œæ‰¾å‰é©±
            predecessor = self._get_predecessor(node, key_index)
            node.keys[key_index] = predecessor
            self._remove_helper(node.children[key_index], predecessor)
        elif len(node.children[key_index + 1].keys) >= self.min_degree:
            # å³å­èŠ‚ç‚¹æœ‰è¶³å¤Ÿå…³é”®å­—ï¼Œæ‰¾åç»§
            successor = self._get_successor(node, key_index)
            node.keys[key_index] = successor
            self._remove_helper(node.children[key_index + 1], successor)
        else:
            # åˆå¹¶èŠ‚ç‚¹
            self._merge_children(node, key_index)
            self._remove_helper(node.children[key_index], key)

    def _get_predecessor(self, node, key_index):
        """è·å–å‰é©±å…³é”®å­—"""
        current = node.children[key_index]
        while not current.is_leaf:
            current = current.children[-1]
        return current.keys[-1]

    def _get_successor(self, node, key_index):
        """è·å–åç»§å…³é”®å­—"""
        current = node.children[key_index + 1]
        while not current.is_leaf:
            current = current.children[0]
        return current.keys[0]

    def _fill_child(self, node, child_index):
        """å¡«å……å­èŠ‚ç‚¹"""
        if (child_index != 0 and
            len(node.children[child_index - 1].keys) >= self.min_degree):
            self._borrow_from_prev(node, child_index)
        elif (child_index != len(node.children) - 1 and
              len(node.children[child_index + 1].keys) >= self.min_degree):
            self._borrow_from_next(node, child_index)
        else:
            if child_index != len(node.children) - 1:
                self._merge_children(node, child_index)
            else:
                self._merge_children(node, child_index - 1)

    def _borrow_from_prev(self, node, child_index):
        """ä»å‰ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹å€Ÿå…³é”®å­—"""
        child = node.children[child_index]
        sibling = node.children[child_index - 1]

        child.keys.insert(0, node.keys[child_index - 1])
        node.keys[child_index - 1] = sibling.keys.pop()

        if not child.is_leaf:
            child.children.insert(0, sibling.children.pop())

    def _borrow_from_next(self, node, child_index):
        """ä»åä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹å€Ÿå…³é”®å­—"""
        child = node.children[child_index]
        sibling = node.children[child_index + 1]

        child.keys.append(node.keys[child_index])
        node.keys[child_index] = sibling.keys.pop(0)

        if not child.is_leaf:
            child.children.append(sibling.children.pop(0))

    def _merge_children(self, node, child_index):
        """åˆå¹¶å­èŠ‚ç‚¹"""
        child = node.children[child_index]
        sibling = node.children[child_index + 1]

        child.keys.append(node.keys[child_index])
        child.keys.extend(sibling.keys)

        if not child.is_leaf:
            child.children.extend(sibling.children)

        node.keys.pop(child_index)
        node.children.pop(child_index + 1)

    def traverse(self):
        """éå†Bæ ‘"""
        if self.root is not None:
            result = []
            self._traverse_helper(self.root, result)
            return result
        return []

    def _traverse_helper(self, node, result):
        """éå†è¾…åŠ©å‡½æ•°"""
        i = 0
        for i in range(len(node.keys)):
            if not node.is_leaf:
                self._traverse_helper(node.children[i], result)
            result.append(node.keys[i])

        if not node.is_leaf:
            self._traverse_helper(node.children[i + 1], result)

# ä½¿ç”¨ç¤ºä¾‹
def example_usage():
    # åˆ›å»ºä¸€ä¸ª3é˜¶Bæ ‘
    btree = BTree(min_degree=2)

    # æ’å…¥å…³é”®å­—
    keys_to_insert = [10, 20, 5, 6, 12, 30, 7, 17]
    for key in keys_to_insert:
        btree.insert(key)
        print(f"æ’å…¥ {key} åçš„Bæ ‘: {btree.traverse()}")

    # æœç´¢å…³é”®å­—
    search_keys = [6, 15, 20]
    for key in search_keys:
        found = btree.search(key)
        print(f"æœç´¢ {key}: {'æ‰¾åˆ°' if found else 'æœªæ‰¾åˆ°'}")

    # åˆ é™¤å…³é”®å­—
    keys_to_delete = [6, 12, 5]
    for key in keys_to_delete:
        print(f"åˆ é™¤ {key} å‰çš„Bæ ‘: {btree.traverse()}")
        btree.remove(key)
        print(f"åˆ é™¤ {key} åçš„Bæ ‘: {btree.traverse()}")

if __name__ == "__main__":
    example_usage()</code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸŒŸ å®é™…åº”ç”¨ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">ğŸŒŸ</span>
                å®é™…åº”ç”¨
            </h2>

            <div class="applications">
                <div class="unified-grid unified-grid-2">
                    <div class="app-item">
                        <h4>ğŸ—„ï¸ æ•°æ®åº“ç´¢å¼•</h4>
                        <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>MySQLã€PostgreSQLç­‰æ•°æ®åº“çš„ä¸»é”®ç´¢å¼•</p>
                        <p><strong>ä¼˜åŠ¿ï¼š</strong>å‡å°‘ç£ç›˜I/Oæ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</p>
                        <p><strong>å®ç°ï¼š</strong>æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªç£ç›˜å—ï¼Œæœ€å¤§åŒ–åˆ©ç”¨ç£ç›˜ç©ºé—´</p>
                    </div>

                    <div class="app-item">
                        <h4>ğŸ“ æ–‡ä»¶ç³»ç»Ÿ</h4>
                        <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>NTFSã€HFS+ç­‰æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç´¢å¼•</p>
                        <p><strong>ä¼˜åŠ¿ï¼š</strong>å¿«é€Ÿå®šä½æ–‡ä»¶ï¼Œæ”¯æŒå¤§é‡æ–‡ä»¶å­˜å‚¨</p>
                        <p><strong>å®ç°ï¼š</strong>æ–‡ä»¶åå’Œinodeä¿¡æ¯å­˜å‚¨åœ¨Bæ ‘èŠ‚ç‚¹ä¸­</p>
                    </div>

                    <div class="app-item">
                        <h4>ğŸ’¾ NoSQLæ•°æ®åº“</h4>
                        <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>MongoDBã€CouchDBçš„å­˜å‚¨å¼•æ“</p>
                        <p><strong>ä¼˜åŠ¿ï¼š</strong>æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œé€‚åˆå¤§æ•°æ®åœºæ™¯</p>
                        <p><strong>å®ç°ï¼š</strong>æ–‡æ¡£IDä½œä¸ºå…³é”®å­—ï¼Œæ”¯æŒå¿«é€Ÿæ£€ç´¢</p>
                    </div>

                    <div class="app-item">
                        <h4>ğŸ” æœç´¢å¼•æ“</h4>
                        <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>å€’æ’ç´¢å¼•çš„å­˜å‚¨å’Œæ£€ç´¢</p>
                        <p><strong>ä¼˜åŠ¿ï¼š</strong>é«˜æ•ˆçš„è¯æ±‡æŸ¥æ‰¾å’Œæ–‡æ¡£åŒ¹é…</p>
                        <p><strong>å®ç°ï¼š</strong>è¯æ±‡ä½œä¸ºå…³é”®å­—ï¼Œæ–‡æ¡£åˆ—è¡¨ä½œä¸ºæ•°æ®</p>
                    </div>
                </div>

                <div class="comparison-table">
                    <h4>ğŸ“ˆ æ€§èƒ½å¯¹æ¯”</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>æ•°æ®ç»“æ„</th>
                                <th>æŸ¥æ‰¾æ—¶é—´</th>
                                <th>æ’å…¥æ—¶é—´</th>
                                <th>ç©ºé—´åˆ©ç”¨ç‡</th>
                                <th>é€‚ç”¨åœºæ™¯</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>äºŒå‰æœç´¢æ ‘</td>
                                <td>O(log n) ~ O(n)</td>
                                <td>O(log n) ~ O(n)</td>
                                <td>ä½</td>
                                <td>å†…å­˜æ•°æ®</td>
                            </tr>
                            <tr>
                                <td>å¹³è¡¡äºŒå‰æ ‘</td>
                                <td>O(log n)</td>
                                <td>O(log n)</td>
                                <td>ä¸­ç­‰</td>
                                <td>å†…å­˜ç´¢å¼•</td>
                            </tr>
                            <tr>
                                <td>Bæ ‘</td>
                                <td>O(log n)</td>
                                <td>O(log n)</td>
                                <td>é«˜</td>
                                <td>ç£ç›˜å­˜å‚¨</td>
                            </tr>
                            <tr>
                                <td>å“ˆå¸Œè¡¨</td>
                                <td>O(1)</td>
                                <td>O(1)</td>
                                <td>ä¸­ç­‰</td>
                                <td>ç²¾ç¡®åŒ¹é…</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="concept-item">
                    <h3>ğŸ¯ Bæ ‘ vs B+æ ‘ å¯¹æ¯”</h3>
                    <div class="unified-grid unified-grid-2">
                        <div class="comparison-box">
                            <h4>ğŸŒ³ Bæ ‘ç‰¹ç‚¹</h4>
                            <ul>
                                <li><strong>æ•°æ®åˆ†å¸ƒï¼š</strong>å†…éƒ¨èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½å­˜å‚¨æ•°æ®</li>
                                <li><strong>æŸ¥æ‰¾æ•ˆç‡ï¼š</strong>å¯èƒ½åœ¨å†…éƒ¨èŠ‚ç‚¹å°±æ‰¾åˆ°æ•°æ®</li>
                                <li><strong>ç©ºé—´åˆ©ç”¨ï¼š</strong>èŠ‚ç‚¹åˆ©ç”¨ç‡ç›¸å¯¹è¾ƒä½</li>
                                <li><strong>èŒƒå›´æŸ¥è¯¢ï¼š</strong>éœ€è¦ä¸­åºéå†ï¼Œæ•ˆç‡è¾ƒä½</li>
                            </ul>
                        </div>
                        <div class="comparison-box">
                            <h4>ğŸŒ² B+æ ‘ç‰¹ç‚¹</h4>
                            <ul>
                                <li><strong>æ•°æ®åˆ†å¸ƒï¼š</strong>åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®</li>
                                <li><strong>æŸ¥æ‰¾æ•ˆç‡ï¼š</strong>æŸ¥æ‰¾è·¯å¾„ç¨³å®šï¼Œéƒ½åˆ°å¶å­èŠ‚ç‚¹</li>
                                <li><strong>ç©ºé—´åˆ©ç”¨ï¼š</strong>å†…éƒ¨èŠ‚ç‚¹å¯å®¹çº³æ›´å¤šå…³é”®å­—</li>
                                <li><strong>èŒƒå›´æŸ¥è¯¢ï¼š</strong>å¶å­èŠ‚ç‚¹é“¾è¡¨ï¼Œæ•ˆç‡å¾ˆé«˜</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- âœ… å­¦ä¹ æ£€éªŒ -->
    <div class="content-card">
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-icon">âœ…</span>
                å­¦ä¹ æ£€éªŒ
            </h2>

            <div class="quiz-section">
                <div class="quiz-item">
                    <h4>ğŸ¤” é—®é¢˜1ï¼šBæ ‘æ€§è´¨ç†è§£</h4>
                    <p>ä¸€æ£µ4é˜¶Bæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå¯ä»¥å­˜å‚¨å¤šå°‘ä¸ªå…³é”®å­—ï¼Ÿæœ€å°‘éœ€è¦å¤šå°‘ä¸ªå…³é”®å­—ï¼ˆæ ¹èŠ‚ç‚¹é™¤å¤–ï¼‰ï¼Ÿ</p>
                    <button class="quiz-btn" onclick="toggleAnswer(1)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div id="answer1" class="quiz-answer">
                        <strong>ç­”æ¡ˆï¼š</strong><br>
                        <strong>æœ€å¤šå…³é”®å­—æ•°ï¼š</strong>4-1=3ä¸ªå…³é”®å­—<br>
                        <strong>æœ€å°‘å…³é”®å­—æ•°ï¼š</strong>âŒˆ4/2âŒ‰-1=1ä¸ªå…³é”®å­—<br>
                        <strong>è§£é‡Šï¼š</strong>å¯¹äºmé˜¶Bæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰m-1ä¸ªå…³é”®å­—ï¼Œéæ ¹èŠ‚ç‚¹æœ€å°‘æœ‰âŒˆm/2âŒ‰-1ä¸ªå…³é”®å­—<br>
                        <strong>å­æ ‘æ•°é‡ï¼š</strong>æœ€å¤š4ä¸ªå­æ ‘ï¼Œæœ€å°‘2ä¸ªå­æ ‘
                    </div>
                </div>

                <div class="quiz-item">
                    <h4>ğŸ¤” é—®é¢˜2ï¼šæ’å…¥æ“ä½œåˆ†æ</h4>
                    <p>å‘Bæ ‘æ’å…¥å…³é”®å­—æ—¶ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”ŸèŠ‚ç‚¹åˆ†è£‚ï¼Ÿåˆ†è£‚åä¸­é—´å…³é”®å­—å»å“ªé‡Œäº†ï¼Ÿ</p>
                    <button class="quiz-btn" onclick="toggleAnswer(2)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div id="answer2" class="quiz-answer">
                        <strong>ç­”æ¡ˆï¼š</strong><br>
                        <strong>åˆ†è£‚æ¡ä»¶ï¼š</strong>å½“èŠ‚ç‚¹ä¸­å…³é”®å­—æ•°é‡è¾¾åˆ°m-1ä¸ªæ—¶ï¼Œå†æ’å…¥æ–°å…³é”®å­—å°±ä¼šè§¦å‘åˆ†è£‚<br>
                        <strong>ä¸­é—´å…³é”®å­—ï¼š</strong>åˆ†è£‚æ—¶é€‰æ‹©ä¸­ä½æ•°å…³é”®å­—ä¸Šå‡åˆ°çˆ¶èŠ‚ç‚¹<br>
                        <strong>åˆ†è£‚è¿‡ç¨‹ï¼š</strong>å·¦åŠéƒ¨åˆ†å’Œå³åŠéƒ¨åˆ†åˆ†åˆ«å½¢æˆä¸¤ä¸ªæ–°èŠ‚ç‚¹<br>
                        <strong>é€’å½’æ€§ï¼š</strong>å¦‚æœçˆ¶èŠ‚ç‚¹ä¹Ÿæ»¡äº†ï¼Œåˆ†è£‚ä¼šå‘ä¸Šä¼ æ’­ï¼Œå¯èƒ½å¯¼è‡´æ ‘é«˜å¢åŠ 
                    </div>
                </div>

                <div class="quiz-item">
                    <h4>ğŸ¤” é—®é¢˜3ï¼šBæ ‘ä¼˜åŠ¿åˆ†æ</h4>
                    <p>ä¸ºä»€ä¹ˆBæ ‘ç‰¹åˆ«é€‚åˆä½œä¸ºæ•°æ®åº“ç´¢å¼•ï¼Ÿç›¸æ¯”äºŒå‰æœç´¢æ ‘æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</p>
                    <button class="quiz-btn" onclick="toggleAnswer(3)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div id="answer3" class="quiz-answer">
                        <strong>ç­”æ¡ˆï¼š</strong><br>
                        <strong>ç£ç›˜I/Oä¼˜åŒ–ï¼š</strong><br>
                        â€¢ Bæ ‘èŠ‚ç‚¹å¯ä»¥å¡«æ»¡ä¸€ä¸ªç£ç›˜å—ï¼Œæœ€å¤§åŒ–æ¯æ¬¡I/Oçš„æ•°æ®é‡<br>
                        â€¢ æ ‘é«˜è¾ƒä½ï¼Œå‡å°‘ç£ç›˜è®¿é—®æ¬¡æ•°<br>
                        <strong>ç›¸æ¯”äºŒå‰æ ‘ä¼˜åŠ¿ï¼š</strong><br>
                        â€¢ å¤šè·¯ç»“æ„å‡å°‘æ ‘é«˜ï¼šlogâ‚‚(n) vs logâ‚˜(n)<br>
                        â€¢ æ›´å¥½çš„ç©ºé—´å±€éƒ¨æ€§å’Œç¼“å­˜æ•ˆç‡<br>
                        â€¢ èŠ‚ç‚¹å†…éƒ¨å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å¿«é€Ÿå®šä½<br>
                        â€¢ å¹³è¡¡æ€§ä¿è¯ç¨³å®šçš„æŸ¥è¯¢æ€§èƒ½
                    </div>
                </div>

                <div class="quiz-item">
                    <h4>ğŸ¤” é—®é¢˜4ï¼šåˆ é™¤æ“ä½œå¤æ‚åº¦</h4>
                    <p>Bæ ‘åˆ é™¤æ“ä½œä¸­ï¼Œä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦åˆå¹¶èŠ‚ç‚¹ï¼Ÿåˆå¹¶å’Œå€Ÿä½çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>
                    <button class="quiz-btn" onclick="toggleAnswer(4)">ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ</button>
                    <div id="answer4" class="quiz-answer">
                        <strong>ç­”æ¡ˆï¼š</strong><br>
                        <strong>åˆå¹¶æ¡ä»¶ï¼š</strong><br>
                        â€¢ å½“å‰èŠ‚ç‚¹å…³é”®å­—æ•°é‡å°‘äºæœ€å°å€¼<br>
                        â€¢ ç›¸é‚»å…„å¼ŸèŠ‚ç‚¹ä¹Ÿåªæœ‰æœ€å°‘å…³é”®å­—ï¼Œæ— æ³•å€Ÿä½<br>
                        <strong>å€Ÿä½ vs åˆå¹¶ï¼š</strong><br>
                        â€¢ <strong>å€Ÿä½ï¼š</strong>å…„å¼ŸèŠ‚ç‚¹æœ‰å¤šä½™å…³é”®å­—ï¼Œé€šè¿‡çˆ¶èŠ‚ç‚¹è½¬ç§»ä¸€ä¸ªå…³é”®å­—<br>
                        â€¢ <strong>åˆå¹¶ï¼š</strong>ä¸¤ä¸ªèŠ‚ç‚¹å…³é”®å­—éƒ½ä¸è¶³ï¼Œå°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªèŠ‚ç‚¹<br>
                        <strong>å½±å“ï¼š</strong>åˆå¹¶å¯èƒ½å¯¼è‡´çˆ¶èŠ‚ç‚¹å…³é”®å­—å‡å°‘ï¼Œå‘ä¸Šä¼ æ’­å¯èƒ½é™ä½æ ‘é«˜
                    </div>
                </div>
            </div>

            <div class="next-steps">
                <h4>ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®</h4>
                <div class="unified-grid unified-grid-2">
                    <div class="info-box info-box-info">
                        <span class="info-icon">ğŸ“–</span>
                        <strong>æ·±å…¥å­¦ä¹ ï¼š</strong>B+æ ‘ã€B*æ ‘çš„è®¾è®¡åŸç†å’Œå®ç°ç»†èŠ‚
                    </div>
                    <div class="info-box info-box-success">
                        <span class="info-icon">ğŸ’ª</span>
                        <strong>å®è·µå»ºè®®ï¼š</strong>å®ç°ä¸€ä¸ªç®€å•çš„Bæ ‘ï¼Œç†è§£æ•°æ®åº“ç´¢å¼•çš„å·¥ä½œæœºåˆ¶
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¯¼èˆªæŒ‰é’® -->
    <div style="text-align: center; margin-top: 40px;">
        <a href="{% url 'knowledge_app:index' %}" class="unified-btn unified-btn-primary">
            <span>ğŸ </span>
            è¿”å›é¦–é¡µ
        </a>
        <a href="{% url 'knowledge_app:cs_universe' %}" class="unified-btn unified-btn-secondary">
            <span>ğŸŒŒ</span>
            æ¢ç´¢CSå®‡å®™
        </a>
    </div>
</div>

<style>
/* é¡µé¢åŸºç¡€æ ·å¼ - ç»§æ‰¿çº¿ç´¢äºŒå‰æ ‘çš„æ ·å¼æ¡†æ¶ */
.page-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.breadcrumb {
    margin-bottom: 20px;
    font-size: 14px;
    color: #666;
}

.page-header {
    text-align: center;
    margin-bottom: 30px;
}

.page-header h1 {
    font-size: 2.5rem;
    color: #333;
    margin-bottom: 10px;
}

.page-icon {
    font-size: 3rem;
    margin-right: 15px;
}

.content-card {
    background: white;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 20px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}

.section-title {
    font-size: 1.5rem;
    color: #333;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-icon {
    font-size: 1.8rem;
}

/* ç½‘æ ¼å¸ƒå±€ */
.unified-grid {
    display: grid;
    gap: 20px;
}

.unified-grid-2 {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

/* ä¿¡æ¯æ¡†æ ·å¼ */
.info-box {
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #4299e1;
}

.info-box-info {
    background: #ebf8ff;
    border-left-color: #4299e1;
}

.info-box-success {
    background: #f0fff4;
    border-left-color: #48bb78;
}

.info-box-warning {
    background: #fffaf0;
    border-left-color: #ed8936;
}

.info-icon {
    margin-right: 8px;
}

/* æ¦‚å¿µè¯¦è§£æ ·å¼ */
.concept-item {
    margin-bottom: 25px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.concept-item h3 {
    color: #2d3748;
    margin-bottom: 10px;
}

.example-box {
    margin-top: 15px;
    padding: 15px;
    background: #e6fffa;
    border-left: 4px solid #38b2ac;
    border-radius: 4px;
}

/* é—®é¢˜è§£å†³æ–¹æ¡ˆæ ·å¼ */
.problem-solution {
    margin-top: 25px;
}

.problem-box {
    padding: 20px;
    background: #fef2f2;
    border-left: 4px solid #f56565;
    border-radius: 8px;
}

.solution-box {
    padding: 20px;
    background: #f0fff4;
    border-left: 4px solid #48bb78;
    border-radius: 8px;
}

/* ç»Ÿè®¡æ¡†æ ·å¼ */
.stats-box {
    margin-top: 15px;
    padding: 15px;
    background: #f7fafc;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.stats-box h5 {
    color: #2d3748;
    margin-bottom: 10px;
}

/* Bæ ‘ç±»å‹æ ·å¼ */
.thread-types {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.type-box {
    padding: 15px;
    background: #ebf4ff;
    border-radius: 8px;
    border-left: 4px solid #3182ce;
    text-align: center;
}

.type-box h4 {
    color: #2b6cb0;
    margin-bottom: 10px;
}

.type-feature {
    margin-top: 10px;
    font-size: 0.9rem;
    color: #4a5568;
    font-style: italic;
}

/* è¿‡ç¨‹æ­¥éª¤æ ·å¼ */
.process-steps {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.step-box {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.step-number {
    background: #4299e1;
    color: white;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    flex-shrink: 0;
}

.step-content h5 {
    color: #2d3748;
    margin-bottom: 5px;
}

/* éå†ç®—æ³•æ ·å¼ */
.traversal-algorithm {
    margin-top: 15px;
}

.algorithm-steps {
    background: #f7fafc;
    padding: 20px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.algo-step {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 10px;
    padding: 8px 0;
}

.step-label {
    background: #ed8936;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: bold;
    flex-shrink: 0;
}

/* Bæ ‘å¯è§†åŒ–æ¼”ç¤ºæ ·å¼ */
.canvas-demo {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.control-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.control-group label {
    font-size: 14px;
    color: #4a5568;
    font-weight: 500;
}

.control-group select,
.control-group input {
    padding: 6px 10px;
    border: 2px solid #e2e8f0;
    border-radius: 6px;
    font-size: 14px;
    min-width: 80px;
}

.control-group select:focus,
.control-group input:focus {
    outline: none;
    border-color: #4299e1;
}

.preset-controls {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.preset-controls button {
    padding: 10px 20px;
    border: none;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
    color: white;
}

.insert-btn { background: linear-gradient(45deg, #16a34a, #22c55e); }
.delete-btn { background: linear-gradient(45deg, #dc2626, #ef4444); }
.demo-btn { background: linear-gradient(45deg, #7c3aed, #a855f7); }
.search-btn { background: linear-gradient(45deg, #0ea5e9, #38bdf8); }
.reset-btn { background: linear-gradient(45deg, #4a5568, #6b7280); }

.preset-controls button:hover,
.control-group button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.canvas-container {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

#btreeCanvas {
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    background: white;
}

/* Bæ ‘å›¾ä¾‹æ ·å¼ */
.legend {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin: 20px 0;
    border: 1px solid #e2e8f0;
}

.legend h4 {
    margin: 0 0 15px 0;
    color: #2d3748;
    font-size: 16px;
}

.legend-items {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    margin-bottom: 15px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: white;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Bæ ‘èŠ‚ç‚¹æ ·å¼ */
.legend-node {
    padding: 6px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: bold;
    min-width: 50px;
    text-align: center;
    border: 2px solid;
}

.normal-node {
    background: #f3f4f6;
    border-color: #9ca3af;
    color: #374151;
}

.current-node {
    background: #ef4444;
    border-color: #dc2626;
    color: white;
}

.new-node {
    background: #22c55e;
    border-color: #16a34a;
    color: white;
}

.split-node {
    background: #f59e0b;
    border-color: #d97706;
    color: white;
}

.legend-connection {
    width: 30px;
    height: 3px;
    background: #374151;
}

.legend-explanation {
    background: white;
    padding: 12px;
    border-radius: 6px;
    border-left: 4px solid #3b82f6;
}

.legend-explanation p {
    margin: 0 0 8px 0;
    font-weight: bold;
    color: #2d3748;
}

.legend-explanation ul {
    margin: 0;
    padding-left: 20px;
}

.legend-explanation li {
    margin-bottom: 4px;
    font-size: 14px;
    color: #4a5568;
}

.info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
}

.info .info-box {
    background: #f7fafc;
    border: 1px solid #e2e8f0;
}

.info h4 {
    margin-top: 0;
    color: #2d3748;
}

.sequence {
    font-size: 16px;
    font-weight: bold;
    color: #4299e1;
    min-height: 20px;
}

.status {
    font-size: 14px;
    color: #718096;
    margin-top: 8px;
}

/* ä»£ç æ ·å¼ */
.code-tabs {
    display: flex;
    border-bottom: 1px solid #e2e8f0;
    margin-bottom: 20px;
}

.tab-btn {
    padding: 12px 24px;
    border: none;
    background: none;
    cursor: pointer;
    font-size: 16px;
    border-bottom: 2px solid transparent;
    transition: all 0.3s ease;
}

.tab-btn.active {
    color: #4299e1;
    border-bottom-color: #4299e1;
}

.code-content {
    display: none;
}

.code-content.active {
    display: block;
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.copy-btn {
    background: #4299e1;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

.copy-btn:hover {
    background: #3182ce;
}

pre {
    background: #2d3748;
    color: #e2e8f0;
    padding: 20px;
    border-radius: 8px;
    overflow-x: auto;
    line-height: 1.6;
    font-size: 14px;
}

/* åº”ç”¨åœºæ™¯æ ·å¼ */
.app-item {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #4299e1;
}

.app-item h4 {
    color: #2d3748;
    margin-bottom: 15px;
}

/* æ€§èƒ½å¯¹æ¯”è¡¨æ ¼æ ·å¼ */
.comparison-table {
    margin-top: 30px;
}

.comparison-table table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.comparison-table th,
.comparison-table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #e2e8f0;
}

.comparison-table th {
    background: #f7fafc;
    font-weight: bold;
    color: #2d3748;
}

/* å¯¹æ¯”æ¡†æ ·å¼ */
.comparison-box {
    padding: 20px;
    background: #f0f9ff;
    border-radius: 8px;
    border-left: 4px solid #0ea5e9;
}

.comparison-box h4 {
    color: #0c4a6e;
    margin-bottom: 15px;
}

.comparison-box ul {
    margin: 0;
    padding-left: 20px;
}

.comparison-box li {
    margin-bottom: 8px;
    color: #1e40af;
}

/* æœ¯è¯­åˆ—è¡¨æ ·å¼ */
.terms-list .unified-grid-2 {
    margin-top: 15px;
}

.term-item {
    padding: 12px;
    background: white;
    border-radius: 6px;
    border-left: 3px solid #4299e1;
}

/* æµ‹éªŒæ ·å¼ */
.quiz-item {
    margin-bottom: 25px;
    padding: 20px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
}

.quiz-btn {
    background: #4299e1;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 15px;
    transition: background 0.3s ease;
}

.quiz-btn:hover {
    background: #3182ce;
}

.quiz-answer {
    display: none;
    margin-top: 15px;
    padding: 15px;
    background: #f0fff4;
    border-left: 4px solid #48bb78;
    border-radius: 4px;
}

.quiz-answer.show {
    display: block;
}

.unified-btn {
    display: inline-block;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    margin: 0 10px;
    transition: all 0.3s ease;
}

.unified-btn-primary {
    background: #4299e1;
    color: white;
}

.unified-btn-secondary {
    background: #718096;
    color: white;
}

.unified-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

@media (max-width: 768px) {
    .info {
        grid-template-columns: 1fr;
    }

    .controls {
        flex-direction: column;
    }

    .preset-controls {
        flex-direction: column;
        align-items: center;
    }

    .preset-controls button {
        width: 200px;
    }

    .unified-grid-2 {
        grid-template-columns: 1fr;
    }

    .thread-types {
        grid-template-columns: 1fr;
    }

    .process-steps {
        grid-template-columns: 1fr;
    }

    .comparison-table table {
        font-size: 12px;
    }
}
</style>

<script>
// Bæ ‘å¯è§†åŒ–æ¼”ç¤ºç›¸å…³ä»£ç 
const btreeCanvas = document.getElementById('btreeCanvas');
const btreeCtx = btreeCanvas.getContext('2d');

// Bæ ‘èŠ‚ç‚¹ç±»
class BTreeNode {
    constructor(isLeaf = true) {
        this.keys = [];
        this.children = [];
        this.isLeaf = isLeaf;
        this.x = 0;
        this.y = 0;
        this.width = 0;
        this.height = 40;
        this.state = 'normal'; // normal, current, new, split
    }
}

// Bæ ‘ç±»
class BTree {
    constructor(order = 4) {
        this.root = null;
        this.order = order;
        this.minKeys = Math.floor((order - 1) / 2);
        this.maxKeys = order - 1;
    }

    insert(key) {
        if (this.root === null) {
            this.root = new BTreeNode(true);
            this.root.keys.push(key);
            return { type: 'create', node: this.root };
        }

        if (this.root.keys.length === this.maxKeys) {
            const newRoot = new BTreeNode(false);
            newRoot.children.push(this.root);
            this.splitChild(newRoot, 0);
            this.root = newRoot;
        }

        return this.insertNonFull(this.root, key);
    }

    insertNonFull(node, key) {
        let i = node.keys.length - 1;

        if (node.isLeaf) {
            node.keys.push(0);
            while (i >= 0 && key < node.keys[i]) {
                node.keys[i + 1] = node.keys[i];
                i--;
            }
            node.keys[i + 1] = key;
            return { type: 'insert', node: node, key: key };
        } else {
            while (i >= 0 && key < node.keys[i]) {
                i--;
            }
            i++;

            if (node.children[i].keys.length === this.maxKeys) {
                this.splitChild(node, i);
                if (key > node.keys[i]) {
                    i++;
                }
            }
            return this.insertNonFull(node.children[i], key);
        }
    }

    splitChild(parent, childIndex) {
        const fullChild = parent.children[childIndex];
        const newChild = new BTreeNode(fullChild.isLeaf);

        const midIndex = Math.floor(this.maxKeys / 2);

        // ç§»åŠ¨ååŠéƒ¨åˆ†å…³é”®å­—
        newChild.keys = fullChild.keys.splice(midIndex + 1);

        // å¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç§»åŠ¨å­æŒ‡é’ˆ
        if (!fullChild.isLeaf) {
            newChild.children = fullChild.children.splice(midIndex + 1);
        }

        // æå‡ä¸­é—´å…³é”®å­—
        const midKey = fullChild.keys.pop();

        // æ’å…¥åˆ°çˆ¶èŠ‚ç‚¹
        parent.children.splice(childIndex + 1, 0, newChild);
        parent.keys.splice(childIndex, 0, midKey);

        return { type: 'split', parent: parent, oldChild: fullChild, newChild: newChild, midKey: midKey };
    }

    search(key, node = null) {
        if (node === null) node = this.root;
        if (node === null) return false;

        let i = 0;
        while (i < node.keys.length && key > node.keys[i]) {
            i++;
        }

        if (i < node.keys.length && key === node.keys[i]) {
            return { found: true, node: node, index: i };
        }

        if (node.isLeaf) {
            return { found: false };
        }

        return this.search(key, node.children[i]);
    }

    // è·å–æ ‘çš„é«˜åº¦
    getHeight(node = null) {
        if (node === null) node = this.root;
        if (node === null) return 0;

        if (node.isLeaf) return 1;

        let maxHeight = 0;
        for (let child of node.children) {
            maxHeight = Math.max(maxHeight, this.getHeight(child));
        }
        return maxHeight + 1;
    }

    // è·å–èŠ‚ç‚¹æ•°é‡
    getNodeCount(node = null) {
        if (node === null) node = this.root;
        if (node === null) return 0;

        let count = 1;
        for (let child of node.children) {
            count += this.getNodeCount(child);
        }
        return count;
    }

    // è·å–å…³é”®å­—æ€»æ•°
    getKeyCount(node = null) {
        if (node === null) node = this.root;
        if (node === null) return 0;

        let count = node.keys.length;
        for (let child of node.children) {
            count += this.getKeyCount(child);
        }
        return count;
    }
}

// å…¨å±€å˜é‡
let btree = new BTree(4);
let animationState = {
    isAnimating: false,
    history: []
};

// è®¡ç®—èŠ‚ç‚¹å¸ƒå±€
function calculateLayout(node, level = 0, x = 450, levelWidth = 800) {
    if (!node) return;

    const keyWidth = 35;
    const nodeMargin = 20;
    node.width = node.keys.length * keyWidth + nodeMargin;
    node.x = x;
    node.y = 80 + level * 80;

    if (!node.isLeaf && node.children.length > 0) {
        const childrenCount = node.children.length;
        const childWidth = levelWidth / childrenCount;
        const startX = x - levelWidth / 2 + childWidth / 2;

        for (let i = 0; i < node.children.length; i++) {
            const childX = startX + i * childWidth;
            calculateLayout(node.children[i], level + 1, childX, childWidth * 0.8);
        }
    }
}

// ç»˜åˆ¶Bæ ‘èŠ‚ç‚¹
function drawBTreeNode(node) {
    if (!node) return;

    const keyWidth = 35;
    const nodeHeight = 40;
    const x = node.x - node.width / 2;
    const y = node.y - nodeHeight / 2;

    // æ ¹æ®çŠ¶æ€è®¾ç½®é¢œè‰²
    let fillColor, strokeColor, textColor;
    switch (node.state) {
        case 'current':
            fillColor = '#ef4444';
            strokeColor = '#dc2626';
            textColor = 'white';
            break;
        case 'new':
            fillColor = '#22c55e';
            strokeColor = '#16a34a';
            textColor = 'white';
            break;
        case 'split':
            fillColor = '#f59e0b';
            strokeColor = '#d97706';
            textColor = 'white';
            break;
        default:
            fillColor = '#f3f4f6';
            strokeColor = '#9ca3af';
            textColor = '#374151';
    }

    // ç»˜åˆ¶èŠ‚ç‚¹èƒŒæ™¯
    btreeCtx.fillStyle = fillColor;
    btreeCtx.fillRect(x, y, node.width, nodeHeight);

    // ç»˜åˆ¶èŠ‚ç‚¹è¾¹æ¡†
    btreeCtx.strokeStyle = strokeColor;
    btreeCtx.lineWidth = 2;
    btreeCtx.strokeRect(x, y, node.width, nodeHeight);

    // ç»˜åˆ¶åˆ†éš”çº¿å’Œå…³é”®å­—
    btreeCtx.strokeStyle = strokeColor;
    btreeCtx.lineWidth = 1;
    btreeCtx.fillStyle = textColor;
    btreeCtx.font = 'bold 14px Arial';
    btreeCtx.textAlign = 'center';
    btreeCtx.textBaseline = 'middle';

    for (let i = 0; i < node.keys.length; i++) {
        const keyX = x + (i + 0.5) * keyWidth + 10;
        const keyY = node.y;

        // ç»˜åˆ¶åˆ†éš”çº¿
        if (i > 0) {
            btreeCtx.beginPath();
            btreeCtx.moveTo(x + i * keyWidth + 10, y);
            btreeCtx.lineTo(x + i * keyWidth + 10, y + nodeHeight);
            btreeCtx.stroke();
        }

        // ç»˜åˆ¶å…³é”®å­—
        btreeCtx.fillText(node.keys[i].toString(), keyX, keyY);
    }
}

// ç»˜åˆ¶è¿æ¥çº¿
function drawConnections(node) {
    if (!node || node.isLeaf) return;

    const nodeY = node.y + 20;

    for (let i = 0; i < node.children.length; i++) {
        const child = node.children[i];
        const childY = child.y - 20;

        // è®¡ç®—è¿æ¥ç‚¹
        const parentX = node.x + (i - node.children.length / 2 + 0.5) * 20;

        btreeCtx.strokeStyle = '#6b7280';
        btreeCtx.lineWidth = 2;
        btreeCtx.beginPath();
        btreeCtx.moveTo(parentX, nodeY);
        btreeCtx.lineTo(child.x, childY);
        btreeCtx.stroke();

        // é€’å½’ç»˜åˆ¶å­èŠ‚ç‚¹çš„è¿æ¥
        drawConnections(child);
    }
}

// ç»˜åˆ¶æ•´ä¸ªBæ ‘
function drawBTree() {
    btreeCtx.clearRect(0, 0, btreeCanvas.width, btreeCanvas.height);

    if (!btree.root) {
        btreeCtx.fillStyle = '#6b7280';
        btreeCtx.font = '18px Arial';
        btreeCtx.textAlign = 'center';
        btreeCtx.fillText('Bæ ‘ä¸ºç©ºï¼Œè¯·æ’å…¥æ•°æ®', btreeCanvas.width / 2, btreeCanvas.height / 2);
        return;
    }

    // è®¡ç®—å¸ƒå±€
    calculateLayout(btree.root);

    // ç»˜åˆ¶è¿æ¥çº¿ï¼ˆåº•å±‚ï¼‰
    drawConnections(btree.root);

    // ç»˜åˆ¶èŠ‚ç‚¹ï¼ˆé¡¶å±‚ï¼‰
    function drawAllNodes(node) {
        if (node) {
            drawBTreeNode(node);
            for (let child of node.children) {
                drawAllNodes(child);
            }
        }
    }
    drawAllNodes(btree.root);
}

// é‡ç½®æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€
function resetNodeStates(node = btree.root) {
    if (node) {
        node.state = 'normal';
        for (let child of node.children) {
            resetNodeStates(child);
        }
    }
}

// æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
function updateStats() {
    const height = btree.getHeight();
    const nodeCount = btree.getNodeCount();
    const keyCount = btree.getKeyCount();

    document.getElementById('btreeStats').textContent =
        `å…³é”®å­—æ€»æ•°: ${keyCount}, èŠ‚ç‚¹æ€»æ•°: ${nodeCount}`;
    document.getElementById('btreeStructure').textContent =
        `æ ‘é«˜åº¦: ${height}, é˜¶æ•°: ${btree.order}`;
}

// æ’å…¥å…³é”®å­—
async function insertKey() {
    if (animationState.isAnimating) return;

    const input = document.getElementById('insertValue');
    const value = parseInt(input.value);

    if (isNaN(value) || value < 1 || value > 99) {
        alert('è¯·è¾“å…¥1-99ä¹‹é—´çš„æ•°å­—');
        return;
    }

    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
    const searchResult = btree.search(value);
    if (searchResult.found) {
        alert(`å…³é”®å­— ${value} å·²ç»å­˜åœ¨`);
        return;
    }

    animationState.isAnimating = true;

    try {
        resetNodeStates();
        const result = btree.insert(value);

        if (result.node) {
            result.node.state = 'new';
        }

        drawBTree();
        updateStats();

        // æ·»åŠ åˆ°å†å²è®°å½•
        animationState.history.push(`æ’å…¥ ${value}`);
        updateHistory();

        document.getElementById('btreeStatus').textContent = `æˆåŠŸæ’å…¥å…³é”®å­— ${value}`;

        // é‡ç½®çŠ¶æ€
        setTimeout(() => {
            resetNodeStates();
            drawBTree();
        }, 2000);

    } catch (error) {
        console.error('æ’å…¥æ“ä½œå‡ºé”™:', error);
        document.getElementById('btreeStatus').textContent = 'æ’å…¥æ“ä½œå¤±è´¥';
    }

    input.value = '';
    animationState.isAnimating = false;
}

// åˆ é™¤å…³é”®å­—ï¼ˆç®€åŒ–ç‰ˆï¼‰
async function deleteKey() {
    const input = document.getElementById('deleteValue');
    const value = parseInt(input.value);

    if (isNaN(value)) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆæ•°å­—');
        return;
    }

    // ç®€åŒ–çš„åˆ é™¤æ“ä½œ - é‡æ–°æ„å»ºBæ ‘
    const allKeys = [];
    function collectKeys(node) {
        if (node) {
            allKeys.push(...node.keys);
            for (let child of node.children) {
                collectKeys(child);
            }
        }
    }

    collectKeys(btree.root);
    const filteredKeys = allKeys.filter(k => k !== value);

    if (filteredKeys.length === allKeys.length) {
        alert(`å…³é”®å­— ${value} ä¸å­˜åœ¨`);
        return;
    }

    // é‡æ–°æ„å»ºBæ ‘
    btree = new BTree(btree.order);
    for (let key of filteredKeys) {
        btree.insert(key);
    }

    drawBTree();
    updateStats();

    animationState.history.push(`åˆ é™¤ ${value}`);
    updateHistory();

    document.getElementById('btreeStatus').textContent = `æˆåŠŸåˆ é™¤å…³é”®å­— ${value}`;
    input.value = '';
}

// æŸ¥æ‰¾æ¼”ç¤º
async function searchDemo() {
    if (!btree.root) {
        alert('è¯·å…ˆæ’å…¥ä¸€äº›æ•°æ®');
        return;
    }

    const keys = [];
    function collectKeys(node) {
        if (node) {
            keys.push(...node.keys);
            for (let child of node.children) {
                collectKeys(child);
            }
        }
    }
    collectKeys(btree.root);

    if (keys.length === 0) return;

    const randomKey = keys[Math.floor(Math.random() * keys.length)];
    const result = btree.search(randomKey);

    if (result.found) {
        resetNodeStates();
        result.node.state = 'current';
        drawBTree();

        document.getElementById('btreeStatus').textContent =
            `æ‰¾åˆ°å…³é”®å­— ${randomKey} åœ¨èŠ‚ç‚¹ä¸­`;

        setTimeout(() => {
            resetNodeStates();
            drawBTree();
        }, 2000);
    }
}

// æ¼”ç¤ºæ’å…¥
async function insertDemo() {
    if (animationState.isAnimating) return;

    const demoKeys = [50, 25, 75, 10, 30, 60, 80, 5, 15, 35];
    animationState.isAnimating = true;

    for (let key of demoKeys) {
        const searchResult = btree.search(key);
        if (!searchResult.found) {
            await new Promise(resolve => {
                setTimeout(() => {
                    resetNodeStates();
                    const result = btree.insert(key);
                    if (result.node) {
                        result.node.state = 'new';
                    }
                    drawBTree();
                    updateStats();

                    animationState.history.push(`æ’å…¥ ${key}`);
                    updateHistory();

                    document.getElementById('btreeStatus').textContent =
                        `æ¼”ç¤ºæ’å…¥å…³é”®å­— ${key}`;

                    setTimeout(() => {
                        resetNodeStates();
                        drawBTree();
                        resolve();
                    }, 1500);
                }, 800);
            });
        }
    }

    animationState.isAnimating = false;
    document.getElementById('btreeStatus').textContent = 'æ¼”ç¤ºæ’å…¥å®Œæˆ';
}

// é‡ç½®Bæ ‘
function resetBTree() {
    btree = new BTree(btree.order);
    animationState.history = [];
    resetNodeStates();
    drawBTree();
    updateStats();
    updateHistory();
    document.getElementById('btreeStatus').textContent = 'Bæ ‘å·²é‡ç½®';
}

// æ”¹å˜é˜¶æ•°
function changeOrder() {
    const select = document.getElementById('btreeOrder');
    const newOrder = parseInt(select.value);
    btree = new BTree(newOrder);
    resetBTree();
    document.getElementById('btreeStatus').textContent = `å·²åˆ‡æ¢åˆ°${newOrder}é˜¶Bæ ‘`;
}

// æ›´æ–°å†å²è®°å½•
function updateHistory() {
    const history = animationState.history.slice(-10); // åªæ˜¾ç¤ºæœ€è¿‘10æ¡
    document.getElementById('btreeHistory').textContent =
        history.length > 0 ? history.join(' â†’ ') : 'æš‚æ— æ“ä½œ';
}

// ä»£ç ç›¸å…³åŠŸèƒ½
function showCode(language) {
    const codeContents = document.querySelectorAll('.code-content');
    codeContents.forEach(content => content.classList.remove('active'));

    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(tab => tab.classList.remove('active'));

    document.getElementById(`${language}-code`).classList.add('active');
    event.target.classList.add('active');
}

function copyCode(language, buttonElement) {
    let button = buttonElement;
    if (!button) {
        button = event ? event.target : null;
    }

    if (!button) {
        console.error('æ— æ³•è·å–æŒ‰é’®å…ƒç´ ');
        return;
    }

    const codeElement = document.getElementById(`${language}-source`);

    if (!codeElement) {
        console.error(`æ‰¾ä¸åˆ°ä»£ç å…ƒç´ : ${language}-source`);
        showCopyError(button);
        return;
    }

    const text = codeElement.textContent || codeElement.innerText;
    const cleanText = text.trim();

    if (!cleanText) {
        console.error('ä»£ç å†…å®¹ä¸ºç©º');
        showCopyError(button);
        return;
    }

    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(cleanText).then(() => {
            showCopySuccess(button);
        }).catch(err => {
            console.error('ç°ä»£APIå¤åˆ¶å¤±è´¥:', err);
            fallbackCopyTextToClipboard(cleanText, button);
        });
    } else {
        fallbackCopyTextToClipboard(cleanText, button);
    }
}

function fallbackCopyTextToClipboard(text, button) {
    const textArea = document.createElement("textarea");
    textArea.value = text;

    textArea.style.position = "fixed";
    textArea.style.top = "-1000px";
    textArea.style.left = "-1000px";
    textArea.style.width = "1px";
    textArea.style.height = "1px";
    textArea.style.padding = "0";
    textArea.style.border = "none";
    textArea.style.outline = "none";
    textArea.style.boxShadow = "none";
    textArea.style.background = "transparent";

    document.body.appendChild(textArea);

    try {
        textArea.focus();
        textArea.select();
        textArea.setSelectionRange(0, text.length);

        const successful = document.execCommand('copy');

        if (successful) {
            showCopySuccess(button);
        } else {
            console.error('execCommandå¤åˆ¶å¤±è´¥');
            showCopyError(button);
        }
    } catch (err) {
        console.error('é™çº§å¤åˆ¶æ–¹æ³•å‡ºé”™:', err);
        showCopyError(button);
    } finally {
        document.body.removeChild(textArea);
    }
}

function showCopySuccess(button) {
    if (!button) return;

    const originalText = button.innerHTML;
    const originalClass = button.className;

    button.innerHTML = 'âœ… å·²å¤åˆ¶';
    button.className = originalClass + ' copy-success';
    button.disabled = true;

    const originalStyle = button.style.cssText;
    button.style.cssText = originalStyle + '; background: #22c55e !important; color: white !important;';

    setTimeout(() => {
        button.innerHTML = originalText;
        button.className = originalClass;
        button.disabled = false;
        button.style.cssText = originalStyle;
    }, 2000);
}

function showCopyError(button) {
    if (!button) return;

    const originalText = button.innerHTML;
    const originalClass = button.className;

    button.innerHTML = 'âŒ å¤åˆ¶å¤±è´¥';
    button.className = originalClass + ' copy-error';
    button.disabled = true;

    const originalStyle = button.style.cssText;
    button.style.cssText = originalStyle + '; background: #ef4444 !important; color: white !important;';

    setTimeout(() => {
        button.innerHTML = originalText;
        button.className = originalClass;
        button.disabled = false;
        button.style.cssText = originalStyle;
    }, 2000);
}

// æµ‹éªŒåŠŸèƒ½
function toggleAnswer(questionNumber) {
    const answer = document.getElementById(`answer${questionNumber}`);
    const button = event.target;

    if (answer.classList.contains('show')) {
        answer.classList.remove('show');
        button.textContent = 'ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆ';
    } else {
        answer.classList.add('show');
        button.textContent = 'éšè—ç­”æ¡ˆ';
    }
}

// æ”¯æŒå›è½¦é”®æ’å…¥
document.getElementById('insertValue').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        insertKey();
    }
});

document.getElementById('deleteValue').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        deleteKey();
    }
});

// åˆå§‹åŒ–
drawBTree();
updateStats();
updateHistory();
</script>

{% endblock %}