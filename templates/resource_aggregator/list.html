{% extends 'resource_aggregator/base.html' %}

{% block extra_css %}
<style>.filters-bar {background:white;border-radius:var(--border-radius-lg);padding:1.5rem;margin-bottom:2rem;box-shadow:var(--shadow);display:flex;gap:1rem;flex-wrap:wrap;align-items:center}.filter-group {display:flex;align-items:center;gap:0.5rem}.filter-select {padding:0.5rem;border:1px solid var(--border-color);border-radius:var(--border-radius);background:white}.search-box {flex:1;min-width:200px}.search-input {width:100%;padding:0.75rem;border:2px solid var(--border-color);border-radius:var(--border-radius);font-size:1rem}.search-input:focus {outline:none;border-color:var(--primary-color)}.tools-grid {display:grid;grid-template-columns:repeat(auto-fill, minmax(320px, 1fr));gap:1.5rem;padding:2rem 0}@media (max-width:768px) {.tools-grid {grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));gap:1rem}}@media (max-width:480px) {.tools-grid {grid-template-columns:1fr}}.tool-card {background:white;border-radius:12px;border:1px solid #e2e8f0;padding:1.5rem;transition:all 0.3s ease;height:320px;display:flex;flex-direction:column;position:relative}.tool-card:hover {transform:translateY(-4px);box-shadow:0 12px 24px rgba(0,0,0,0.1);border-color:#667eea}.tool-header {display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem}.tool-icon {width:48px;height:48px;border-radius:8px;background:#f8fafc;display:flex;align-items:center;justify-content:center;font-size:1.5rem;border:1px solid #e2e8f0}.tool-icon img {width:100%;height:100%;object-fit:cover;border-radius:8px}.price-badge {padding:0.25rem 0.75rem;border-radius:12px;font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}.price-badge.free {background:#dcfce7;color:#166534}.price-badge.paid {background:#fef3c7;color:#92400e}.resource-thumbnail {width:100%;height:200px;object-fit:cover;background:var(--bg-secondary)}.tool-info {flex:1;margin-bottom:1rem}.tool-title {font-size:1.1rem;font-weight:700;color:#1f2937;margin:0 0 0.5rem 0;line-height:1.3}.tool-subtitle {font-size:0.85rem;color:#6b7280;margin:0 0 0.75rem 0;font-weight:500}.tool-description {font-size:0.8rem;color:#9ca3af;line-height:1.4;margin:0}.tool-features {display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem}.feature-badge {background:#f1f5f9;color:#475569;padding:0.25rem 0.5rem;border-radius:8px;font-size:0.7rem;font-weight:500;border:1px solid #e2e8f0}.feature-badge.more {background:#e0e7ff;color:#3730a3;border-color:#c7d2fe}.tool-actions {display:flex;gap:0.5rem;margin-top:auto}.btn-detail {flex:1;padding:0.5rem 1rem;background:#f8fafc;color:#374151;border:1px solid #e5e7eb;border-radius:6px;text-decoration:none;font-size:0.8rem;font-weight:500;text-align:center;transition:all 0.2s ease}.btn-detail:hover {background:#f3f4f6;text-decoration:none;color:#374151}.btn-visit {flex:1;padding:0.5rem 1rem;background:#667eea;color:white;border:1px solid #667eea;border-radius:6px;text-decoration:none;font-size:0.8rem;font-weight:500;text-align:center;transition:all 0.2s ease}.btn-visit:hover {background:#5a67d8;border-color:#5a67d8;text-decoration:none;color:white}.category-header-section {background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);border-radius:24px;padding:3rem 2rem;margin-bottom:3rem;box-shadow:0 8px 32px rgba(0,0,0,0.08);text-align:center;border:1px solid rgba(0,0,0,0.05);position:relative;overflow:hidden}.category-header-section::before {content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%);background-size:200% 100%;animation:shimmer 3s ease-in-out infinite}@keyframes shimmer {0% {background-position:-200% 0}100% {background-position:200% 0}}.category-info h2 {font-size:2.2rem;font-weight:800;margin-bottom:0.8rem;color:#1a202c;letter-spacing:-0.025em}.category-info p {color:#64748b;font-size:1.1rem;margin:0;line-height:1.6}.pagination {display:flex;justify-content:center;align-items:center;gap:0.5rem;margin-top:3rem}.pagination a, .pagination span {padding:0.5rem 1rem;border:1px solid var(--border-color);border-radius:var(--border-radius);text-decoration:none;color:var(--text-primary)}.pagination a:hover {background:var(--primary-color);color:white;border-color:var(--primary-color)}.pagination .current {background:var(--primary-color);color:white;border-color:var(--primary-color)}.empty-state {text-align:center;padding:4rem 2rem;color:var(--text-secondary)}.empty-state-icon {font-size:4rem;margin-bottom:1rem}@media (max-width:768px) {.filters-bar {flex-direction:column;align-items:stretch}.filter-group {justify-content:space-between}.resource-grid {grid-template-columns:1fr}.resource-meta {flex-direction:column;gap:0.5rem}.resource-footer {flex-direction:column;gap:1rem;align-items:stretch}}</style>
{% endblock %}

{% block page_description %}
<p>ç²¾é€‰å®ç”¨å·¥å…·å’Œä¼˜è´¨èµ„æºï¼Œæå‡å­¦ä¹ å’Œå·¥ä½œæ•ˆç‡</p>
{% endblock %}

{% block content %}
<!-- ç­›é€‰æ  --><div class="filters-bar"><div class="search-box"><form method="get" style="margin: 0;"><input type="text" name="q" class="search-input" 
                   placeholder="æœç´¢èµ„æºæ ‡é¢˜ã€ä½œè€…æˆ–æè¿°..." 
                   value="{{ search_query }}"><input type="hidden" name="category" value="{{ current_category }}"><input type="hidden" name="type" value="{{ current_type }}"><input type="hidden" name="difficulty" value="{{ current_difficulty }}"><input type="hidden" name="source" value="{{ current_source }}"><input type="hidden" name="sort" value="{{ sort_by }}"></form></div><div class="filter-group"><label>åˆ†ç±»:</label><select class="filter-select" onchange="updateFilter('category', this.value)"><option value="">å…¨éƒ¨</option>
            {% for category in categories %}
                <option value="{{ category.slug }}" {% if current_category == category.slug %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select></div><div class="filter-group"><label>ç±»å‹:</label><select class="filter-select" onchange="updateFilter('type', this.value)"><option value="">å…¨éƒ¨</option><option value="video" {% if current_type == 'video' %}selected{% endif %}>è§†é¢‘</option><option value="article" {% if current_type == 'article' %}selected{% endif %}>æ–‡ç« </option><option value="course" {% if current_type == 'course' %}selected{% endif %}>è¯¾ç¨‹</option><option value="github" {% if current_type == 'github' %}selected{% endif %}>é¡¹ç›®</option><option value="book" {% if current_type == 'book' %}selected{% endif %}>ä¹¦ç±</option></select></div><div class="filter-group"><label>æ’åº:</label><select class="filter-select" onchange="updateFilter('sort', this.value)"><option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>æœ€æ–°æ·»åŠ </option><option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>æœ€å—æ¬¢è¿</option><option value="name" {% if sort_by == 'name' %}selected{% endif %}>æŒ‰åç§°</option></select></div></div><!-- åˆ†ç±»æ ‡é¢˜ -->
{% if current_category %}
    <div class="category-header-section"><div class="category-info"><h2>{{ current_category_obj.icon }} {{ current_category_obj.name }}</h2><p>{{ current_category_obj.description }}</p></div></div>
{% endif %}

<!-- å·¥å…·å’Œèµ„æºåˆ—è¡¨ -->
{% if page_obj.object_list %}
    <div class="tools-grid">
        {% for resource in page_obj.object_list %}
            <div class="tool-card"><!-- å·¥å…·å›¾æ ‡å’Œæ ‡é¢˜ --><div class="tool-header"><div class="tool-icon">
                        {% if resource.thumbnail %}
                            <img src="{{ resource.thumbnail }}" alt="{{ resource.title }}">
                        {% else %}
                            {% if resource.resource_type == 'tool' %}ğŸ› ï¸
                            {% elif resource.resource_type == 'design' %}ğŸ¨
                            {% elif resource.resource_type == 'ai' %}ğŸ¤–
                            {% elif resource.resource_type == 'course' %}ğŸ“
                            {% elif resource.resource_type == 'video' %}ğŸ“º
                            {% elif resource.resource_type == 'article' %}ğŸ“„
                            {% elif resource.resource_type == 'book' %}ğŸ“š
                            {% elif resource.resource_type == 'github' %}ğŸ’»
                            {% elif resource.resource_type == 'website' %}ğŸŒ
                            {% else %}ğŸ“‹{% endif %}
                        {% endif %}
                    </div><div class="price-badge {% if resource.is_free %}free{% else %}paid{% endif %}">
                        {% if resource.is_free %}å…è´¹{% else %}ä»˜è´¹{% endif %}
                    </div></div><!-- å·¥å…·ä¿¡æ¯ --><div class="tool-info"><h3 class="tool-title">{{ resource.title }}</h3><p class="tool-subtitle">{{ resource.short_description|default:resource.description|truncatechars:50 }}</p><p class="tool-description">{{ resource.description|truncatechars:100 }}</p></div><!-- åŠŸèƒ½æ ‡ç­¾ -->
                {% if resource.features %}
                <div class="tool-features">
                    {% for feature in resource.features|slice:":3" %}
                        <span class="feature-badge">{{ feature }}</span>
                    {% endfor %}
                    {% if resource.features|length > 3 %}
                        <span class="feature-badge more">+{{ resource.features|length|add:"-3" }}</span>
                    {% endif %}
                </div>
                {% endif %}

                <!-- æ“ä½œæŒ‰é’® --><div class="tool-actions"><a href="{% url 'resource_aggregator:detail' resource.id %}" class="btn-detail">æŸ¥çœ‹è¯¦æƒ…</a><a href="{{ resource.url }}" target="_blank" class="btn-visit">ç«‹å³è®¿é—®</a></div></div>
        {% endfor %}
    </div><!-- åˆ†é¡µ -->
    {% if page_obj.has_other_pages %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">&laquo; é¦–é¡µ</a><a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">&lsaquo; ä¸Šä¸€é¡µ</a>
            {% endif %}
            
            <span class="current">
                ç¬¬ {{ page_obj.number }} é¡µï¼Œå…± {{ page_obj.paginator.num_pages }} é¡µ
            </span>
            
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">ä¸‹ä¸€é¡µ &rsaquo;</a><a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if current_category %}&category={{ current_category }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}">æœ«é¡µ &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
{% else %}
    <div class="empty-state"><div class="empty-state-icon">ğŸ§°</div><h3>æš‚æ— å·¥å…·</h3><p>å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–è¿è¡Œåˆå§‹åŒ–å‘½ä»¤æ·»åŠ é»˜è®¤å·¥å…·</p><div style="margin-top: 1rem;"><a href="{% url 'resource_aggregator:search' %}" class="btn btn-primary">
                ğŸ” æ™ºèƒ½æœç´¢
            </a>
            {% if user.is_staff %}
                <a href="/admin/resource_aggregator/" class="btn btn-secondary">
                    âš™ï¸ ç®¡ç†å·¥å…·
                </a>
            {% endif %}
        </div></div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>function updateFilter(param, value) { const url = new URL(window.location); if (value) { url.searchParams.set(param, value); } else { url.searchParams.delete(param); } url.searchParams.delete('page'); window.location.href = url.toString(); } document.querySelector('.search-input').addEventListener('input', function() { clearTimeout(this.searchTimeout); this.searchTimeout = setTimeout(() => { this.form.submit(); }, 500); });</script>
{% endblock %}
