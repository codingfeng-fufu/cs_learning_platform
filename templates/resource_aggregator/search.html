{% extends 'resource_aggregator/base.html' %}

{% block extra_css %}
<style>.search-form {background:white;border-radius:var(--border-radius-lg);padding:2rem;box-shadow:var(--shadow-lg);margin-bottom:2rem}.form-group {margin-bottom:1.5rem}.form-label {display:block;margin-bottom:0.5rem;font-weight:600;color:var(--text-primary)}.form-control {width:100%;padding:0.75rem;border:2px solid var(--border-color);border-radius:var(--border-radius);font-size:1rem;transition:border-color 0.3s ease}.form-control:focus {outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1)}.form-row {display:grid;grid-template-columns:1fr 1fr;gap:1rem}.checkbox-group {display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:0.5rem;margin-top:0.5rem}.checkbox-item {display:flex;align-items:center;gap:0.5rem}.search-btn {background:linear-gradient(135deg, var(--primary-color), var(--secondary-color));color:white;border:none;padding:1rem 2rem;border-radius:var(--border-radius);font-size:1.1rem;font-weight:600;cursor:pointer;transition:all 0.3s ease;width:100%}.search-btn:hover {transform:translateY(-2px);box-shadow:var(--shadow-lg)}.search-btn:disabled {opacity:0.6;cursor:not-allowed;transform:none}.results-container {margin-top:2rem}.results-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding:1rem;background:white;border-radius:var(--border-radius);box-shadow:var(--shadow)}.resource-card {background:white;border-radius:var(--border-radius-lg);box-shadow:var(--shadow);overflow:hidden;transition:all 0.3s ease;margin-bottom:1rem}.resource-card:hover {transform:translateY(-2px);box-shadow:var(--shadow-lg)}.resource-content {padding:1.5rem}.resource-header {display:flex;gap:1rem;margin-bottom:1rem}.resource-thumbnail {width:120px;height:90px;object-fit:cover;border-radius:var(--border-radius);flex-shrink:0}.resource-info {flex:1}.resource-title {font-size:1.2rem;font-weight:600;color:var(--text-primary);margin-bottom:0.5rem;line-height:1.4}.resource-title a {color:inherit;text-decoration:none}.resource-title a:hover {color:var(--primary-color)}.resource-meta {display:flex;gap:1rem;margin-bottom:0.5rem;font-size:0.9rem;color:var(--text-secondary)}.resource-description {color:var(--text-secondary);line-height:1.6;margin-bottom:1rem}.resource-tags {display:flex;gap:0.5rem;flex-wrap:wrap}.tag {background:var(--bg-secondary);color:var(--text-secondary);padding:0.25rem 0.5rem;border-radius:12px;font-size:0.8rem}.resource-type {display:inline-block;padding:0.25rem 0.75rem;border-radius:12px;font-size:0.8rem;font-weight:600;text-transform:uppercase}.type-video {background:#e3f2fd;color:#1976d2}.type-article {background:#f3e5f5;color:#7b1fa2}.type-course {background:#e8f5e8;color:#2e7d32}.type-github {background:#fff3e0;color:#f57c00}.type-book {background:#ffebee;color:#d32f2f}.empty-state {text-align:center;padding:3rem;color:var(--text-secondary)}.empty-state-icon {font-size:4rem;margin-bottom:1rem}@media (max-width:768px) {.form-row {grid-template-columns:1fr}.checkbox-group {grid-template-columns:1fr}.resource-header {flex-direction:column}.resource-thumbnail {width:100%;height:200px}.results-header {flex-direction:column;gap:1rem}}</style>
{% endblock %}

{% block page_description %}
<p>æ™ºèƒ½æœç´¢å…¨ç½‘ä¼˜è´¨å­¦ä¹ èµ„æºï¼ŒåŒ…æ‹¬è§†é¢‘æ•™ç¨‹ã€æŠ€æœ¯æ–‡ç« ã€å¼€æºé¡¹ç›®ç­‰</p>
{% endblock %}

{% block content %}
<div class="search-form"><form id="searchForm"><div class="form-group"><label for="query" class="form-label">ğŸ” æœç´¢å…³é”®è¯</label><input type="text" id="query" name="query" class="form-control" 
                   placeholder="è¾“å…¥ä½ æƒ³å­¦ä¹ çš„æŠ€æœ¯æˆ–æ¦‚å¿µï¼Œå¦‚ï¼šPythonæœºå™¨å­¦ä¹ ã€Reactå‰ç«¯å¼€å‘..." required></div><div class="form-row"><div class="form-group"><label for="category" class="form-label">ğŸ“š å­¦ä¹ åˆ†ç±»</label><select id="category" name="category" class="form-control"><option value="">å…¨éƒ¨åˆ†ç±»</option>
                    {% for category in categories %}
                        <option value="{{ category.slug }}">{{ category.icon }} {{ category.name }}</option>
                    {% endfor %}
                </select></div><div class="form-group"><label for="limit" class="form-label">ğŸ“Š ç»“æœæ•°é‡</label><select id="limit" name="limit" class="form-control"><option value="10">10 ä¸ªç»“æœ</option><option value="20" selected>20 ä¸ªç»“æœ</option><option value="30">30 ä¸ªç»“æœ</option><option value="50">50 ä¸ªç»“æœ</option></select></div></div><div class="form-group"><label class="form-label">ğŸŒ èµ„æºå¹³å°</label><div class="checkbox-group"><label class="checkbox-item"><input type="checkbox" name="platforms" value="youtube" checked><span>ğŸ“º YouTube</span></label><label class="checkbox-item"><input type="checkbox" name="platforms" value="github" checked><span>ğŸ’» GitHub</span></label><label class="checkbox-item"><input type="checkbox" name="platforms" value="bilibili" checked><span>ğŸ“± Bilibili</span></label></div></div><button type="submit" class="search-btn"><span class="btn-text">ğŸš€ å¼€å§‹æœç´¢</span><span class="loading" style="display: none;"></span></button></form></div><div class="results-container" id="resultsContainer" style="display: none;"><div class="results-header"><div><strong id="resultsCount">0</strong> ä¸ªæœç´¢ç»“æœ
            <span id="searchQuery"></span></div><button class="btn btn-secondary" onclick="exportResults()">ğŸ“¥ å¯¼å‡ºç»“æœ</button></div><div id="resultsList"></div></div><div class="empty-state" id="emptyState" style="display: none;"><div class="empty-state-icon">ğŸ”</div><h3>å¼€å§‹ä½ çš„å­¦ä¹ ä¹‹æ—…</h3><p>è¾“å…¥å…³é”®è¯ï¼Œå‘ç°å…¨ç½‘æœ€ä¼˜è´¨çš„å­¦ä¹ èµ„æº</p></div>
{% endblock %}

{% block extra_js %}
<script>document.addEventListener('DOMContentLoaded', function() { const searchForm = document.getElementById('searchForm'); const resultsContainer = document.getElementById('resultsContainer'); const resultsList = document.getElementById('resultsList'); const emptyState = document.getElementById('emptyState'); const searchBtn = searchForm.querySelector('.search-btn'); const btnText = searchBtn.querySelector('.btn-text'); const loading = searchBtn.querySelector('.loading'); emptyState.style.display = 'block'; searchForm.addEventListener('submit', async function(e) { e.preventDefault(); const formData = new FormData(searchForm); const query = formData.get('query').trim(); if (!query) { ResourceAggregator.showMessage('è¯·è¾“å…¥æœç´¢å…³é”®è¯', 'error'); return; } const platforms = Array.from(formData.getAll('platforms')); const searchData = { query: query, category: formData.get('category'), platforms: platforms, limit: parseInt(formData.get('limit')) }; searchBtn.disabled = true; btnText.style.display = 'none'; loading.style.display = 'inline-block'; try { const response = await ResourceAggregator.request('{% url "resource_aggregator:search" %}', { method: 'POST', body: JSON.stringify(searchData) }); if (response.success) { displayResults(response.results, response.query); ResourceAggregator.showMessage(`æ‰¾åˆ° ${response.total} ä¸ªç›¸å…³èµ„æº`, 'success'); } else { throw new Error(response.error || 'æœç´¢å¤±è´¥'); } } catch (error) { console.error('Search error:', error); ResourceAggregator.showMessage('æœç´¢å¤±è´¥ï¼š' + error.message, 'error'); } finally { searchBtn.disabled = false; btnText.style.display = 'inline'; loading.style.display = 'none'; } }); function displayResults(results, query) { if (results.length === 0) { emptyState.innerHTML = ` <div class="empty-state-icon">ğŸ˜”</div><h3>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³èµ„æº</h3><p>å°è¯•ä½¿ç”¨ä¸åŒçš„å…³é”®è¯æˆ–é€‰æ‹©æ›´å¤šå¹³å°</p> `; emptyState.style.display = 'block'; resultsContainer.style.display = 'none'; return; } emptyState.style.display = 'none'; resultsContainer.style.display = 'block'; document.getElementById('resultsCount').textContent = results.length; document.getElementById('searchQuery').textContent = `å…³äº "${query}"`; resultsList.innerHTML = results.map(resource => ` <div class="resource-card"><div class="resource-content"><div class="resource-header"> ${resource.thumbnail ? `<img src="${resource.thumbnail}" alt="${resource.title}" class="resource-thumbnail">` : ''} <div class="resource-info"><h3 class="resource-title"><a href="${resource.url}" target="_blank" rel="noopener">${resource.title}</a></h3><div class="resource-meta"><span class="resource-type type-${resource.resource_type}">${getResourceTypeLabel(resource.resource_type)}</span> ${resource.author ? `<span>ğŸ‘¤ ${resource.author}</span>` : ''} ${resource.duration ? `<span>â±ï¸ ${resource.duration}</span>` : ''} ${resource.view_count ? `<span>ğŸ‘€ ${formatNumber(resource.view_count)}</span>` : ''} ${resource.like_count ? `<span>ğŸ‘ ${formatNumber(resource.like_count)}</span>` : ''} </div></div></div><p class="resource-description">${truncateText(resource.description, 200)}</p> ${resource.tags && resource.tags.length > 0 ? ` <div class="resource-tags"> ${resource.tags.slice(0, 5).map(tag => `<span class="tag">${tag}</span>`).join('')} </div> ` : ''} </div></div> `).join(''); } function getResourceTypeLabel(type) { const labels = { 'video': 'è§†é¢‘', 'article': 'æ–‡ç« ', 'course': 'è¯¾ç¨‹', 'github': 'é¡¹ç›®', 'book': 'ä¹¦ç±', 'documentation': 'æ–‡æ¡£' }; return labels[type] || type; } function formatNumber(num) { if (num >= 1000000) { return (num / 1000000).toFixed(1) + 'M'; } else if (num >= 1000) { return (num / 1000).toFixed(1) + 'K'; } return num.toString(); } function truncateText(text, maxLength) { if (text.length <= maxLength) return text; return text.substring(0, maxLength) + '...'; } window.exportResults = function() { const results = Array.from(document.querySelectorAll('.resource-card')).map(card => { const title = card.querySelector('.resource-title a').textContent; const url = card.querySelector('.resource-title a').href; const description = card.querySelector('.resource-description').textContent; return `${title}\n${url}\n${description}\n\n`; }).join(''); const blob = new Blob([results], { type: 'text/plain' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `å­¦ä¹ èµ„æº_${new Date().toISOString().split('T')[0]}.txt`; a.click(); URL.revokeObjectURL(url); ResourceAggregator.showMessage('èµ„æºåˆ—è¡¨å·²å¯¼å‡º', 'success'); }; });</script>
{% endblock %}
