{% extends 'knowledge_app/base.html' %}

{% block title %}编辑资料 - 计算机科学学习平台{% endblock %}

{% block extra_css %}
<style>.edit-profile-container {max-width:800px;margin:0 auto;padding:20px;min-height:100vh}.page-header {background:rgba(255, 255, 255, 0.1);backdrop-filter:blur(15px);border-radius:var(--border-radius-lg);padding:30px;margin-bottom:30px;color:var(--text-inverse);text-align:center}.page-title {font-size:2.5rem;font-weight:700;margin-bottom:10px}.page-subtitle {font-size:1.1rem;opacity:0.9}.form-card {background:var(--bg-card);border-radius:var(--border-radius-lg);padding:40px;box-shadow:var(--shadow-md);border:1px solid rgba(255, 255, 255, 0.2)}.form-section {margin-bottom:40px}.section-title {font-size:1.3rem;font-weight:600;color:var(--text-primary);margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid var(--accent-color);display:flex;align-items:center;gap:10px}.form-row {display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}.form-group {margin-bottom:20px}.form-label {display:block;margin-bottom:8px;color:var(--text-primary);font-weight:600;font-size:0.95rem}.form-control {width:100%;padding:12px 16px;border:2px solid #e1e5e9;border-radius:var(--border-radius);font-size:1rem;transition:all 0.3s ease;background:var(--bg-card);box-sizing:border-box}.form-control:focus {outline:none;border-color:var(--accent-color);box-shadow:0 0 0 3px rgba(78, 205, 196, 0.1)}.form-control.is-invalid {border-color:#dc3545}.invalid-feedback {display:block;color:#dc3545;font-size:0.875rem;margin-top:5px}.form-help {font-size:0.85rem;color:#666;margin-top:5px}.avatar-section {text-align:center;margin-bottom:30px}.current-avatar {width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg, var(--accent-color) 0%, #44a08d 100%);display:flex;align-items:center;justify-content:center;font-size:3rem;color:var(--text-inverse);margin:0 auto 15px;cursor:pointer;transition:all 0.3s ease}.current-avatar:hover {transform:scale(1.05);box-shadow:0 10px 25px rgba(78, 205, 196, 0.3)}.avatar-hint {color:#666;font-size:0.9rem}.action-buttons {display:flex;gap:15px;justify-content:center;margin-top:40px;padding-top:30px;border-top:1px solid #eee}.btn {padding:12px 30px;border-radius:var(--border-radius);text-decoration:none;font-weight:600;transition:all 0.3s ease;border:none;cursor:pointer;font-size:1rem;min-width:120px}.btn-primary {background:linear-gradient(135deg, var(--accent-color) 0%, #44a08d 100%);color:var(--text-inverse)}.btn-primary:hover {transform:translateY(-2px);box-shadow:0 8px 25px rgba(78, 205, 196, 0.3)}.btn-secondary {background:#f8f9fa;color:var(--text-primary);border:1px solid #ddd}.btn-secondary:hover {background:#e9ecef;transform:translateY(-2px)}.character-count {font-size:0.8rem;color:#666;text-align:right;margin-top:5px}.social-links {display:grid;grid-template-columns:1fr 1fr;gap:20px}.input-with-icon {position:relative}.input-icon {position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#666;font-size:1.1rem}.input-with-icon .form-control {padding-left:40px}@media (max-width:768px) {.edit-profile-container {padding:15px}.form-card {padding:25px}.form-row {grid-template-columns:1fr;gap:15px}.social-links {grid-template-columns:1fr}.action-buttons {flex-direction:column;align-items:center}.btn {width:100%;max-width:250px}}</style>
{% endblock %}

{% block content %}
<div class="edit-profile-container"><!-- 页面头部 --><div class="page-header"><h1 class="page-title">✏️ 编辑资料</h1><p class="page-subtitle">完善您的个人信息，让其他学习者更好地了解您</p></div><!-- 编辑表单 --><div class="form-card"><form method="post" novalidate>
            {% csrf_token %}
            
            <!-- 头像部分 --><div class="avatar-section"><div class="current-avatar" onclick="changeAvatar()">
                    {{ user.get_display_name|first|upper }}
                </div><p class="avatar-hint">点击头像更换（功能即将推出）</p></div><!-- 基本信息 --><div class="form-section"><h3 class="section-title"><span>👤</span> 基本信息
                </h3><div class="form-row"><div class="form-group"><label for="{{ form.first_name.id_for_label }}" class="form-label">姓名</label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            {% for error in form.first_name.errors %}
                                <div class="invalid-feedback">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div><div class="form-group"><label for="{{ form.last_name.id_for_label }}" class="form-label">姓氏</label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                            {% for error in form.last_name.errors %}
                                <div class="invalid-feedback">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div></div><div class="form-group"><label for="{{ form.bio.id_for_label }}" class="form-label">个人简介</label>
                    {{ form.bio }}
                    <div class="character-count"><span id="bio-count">{{ form.bio.value|length|default:0 }}</span>/500 字符
                    </div>
                    {% if form.bio.errors %}
                        {% for error in form.bio.errors %}
                            <div class="invalid-feedback">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                    <div class="form-help">简单介绍一下自己，让其他学习者了解您的背景和兴趣</div></div><div class="form-group"><label for="{{ form.location.id_for_label }}" class="form-label">所在地</label><div class="input-with-icon"><span class="input-icon">📍</span>
                        {{ form.location }}
                    </div>
                    {% if form.location.errors %}
                        {% for error in form.location.errors %}
                            <div class="invalid-feedback">{{ error }}</div>
                        {% endfor %}
                    {% endif %}
                </div></div><!-- 社交链接 --><div class="form-section"><h3 class="section-title"><span>🔗</span> 社交链接
                </h3><div class="social-links"><div class="form-group"><label for="{{ form.website.id_for_label }}" class="form-label">个人网站</label><div class="input-with-icon"><span class="input-icon">🌐</span>
                            {{ form.website }}
                        </div>
                        {% if form.website.errors %}
                            {% for error in form.website.errors %}
                                <div class="invalid-feedback">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div><div class="form-group"><label for="{{ form.github_username.id_for_label }}" class="form-label">GitHub 用户名</label><div class="input-with-icon"><span class="input-icon">💻</span>
                            {{ form.github_username }}
                        </div>
                        {% if form.github_username.errors %}
                            {% for error in form.github_username.errors %}
                                <div class="invalid-feedback">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                        <div class="form-help">只需要用户名，不需要完整URL</div></div></div></div><!-- 操作按钮 --><div class="action-buttons"><button type="submit" class="btn btn-primary">
                    💾 保存更改
                </button><a href="{% url 'users:profile' %}" class="btn btn-secondary">
                    ❌ 取消
                </a></div></form></div></div>
{% endblock %}

{% block extra_js %}
<script>document.addEventListener('DOMContentLoaded', function() { const bioTextarea = document.getElementById('{{ form.bio.id_for_label }}'); const bioCount = document.getElementById('bio-count'); if (bioTextarea && bioCount) { bioTextarea.addEventListener('input', function() { const count = this.value.length; bioCount.textContent = count; if (count > 500) { bioCount.style.color = '#dc3545'; } else if (count > 450) { bioCount.style.color = '#ffc107'; } else { bioCount.style.color = '#666'; } }); } const form = document.querySelector('form'); const inputs = form.querySelectorAll('.form-control'); inputs.forEach(input => { input.addEventListener('blur', function() { validateField(this); }); input.addEventListener('input', function() { this.classList.remove('is-invalid'); }); }); function validateField(field) { if (field.hasAttribute('required') && field.value.trim() === '') { field.classList.add('is-invalid'); return false; } if (field.type === 'url' && field.value && !isValidUrl(field.value)) { field.classList.add('is-invalid'); return false; } field.classList.remove('is-invalid'); return true; } function isValidUrl(string) { try { new URL(string); return true; } catch (_) { return false; } } const formCard = document.querySelector('.form-card'); formCard.style.opacity = '0'; formCard.style.transform = 'translateY(20px)'; setTimeout(() => { formCard.style.transition = 'all 0.6s ease'; formCard.style.opacity = '1'; formCard.style.transform = 'translateY(0)'; }, 100); }); function changeAvatar() { alert('头像自定义功能即将推出！'); }</script>
{% endblock %}
