{% extends 'knowledge_app/base.html' %}

{% block title %}å­¦ä¹ ä»ªè¡¨æ¿ - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block extra_css %}
<style>.dashboard-container {max-width:1500px;margin:0 auto;padding:50px 35px;min-height:100vh;position:relative;z-index:1}.page-header {background:linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);backdrop-filter:blur(25px);border-radius:30px;padding:60px 50px;margin:0 20px 50px 20px;color:var(--text-inverse);text-align:center;position:relative;z-index:2;box-shadow:0 30px 80px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2);border:1px solid rgba(255, 255, 255, 0.3);overflow:hidden}.page-header::before {content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);animation:shimmer 4s infinite}@keyframes shimmer {0% {transform:translateX(-100%) translateY(-100%) rotate(45deg)}100% {transform:translateX(100%) translateY(100%) rotate(45deg)}}.page-title {font-size:3.5rem;font-weight:900;margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:25px;background:linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 4px 15px rgba(0, 0, 0, 0.3);position:relative;z-index:1}.page-title span {font-size:4rem;filter:drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));animation:float 3s ease-in-out infinite}@keyframes float {0%, 100% {transform:translateY(0px)}50% {transform:translateY(-10px)}}.page-subtitle {font-size:1.4rem;opacity:0.95;margin-bottom:0;font-weight:500;color:rgba(255, 255, 255, 0.9);position:relative;z-index:1}.action-btn {background:rgba(255, 255, 255, 0.15);backdrop-filter:blur(10px);border:1px solid rgba(255, 255, 255, 0.3);color:var(--text-inverse);padding:12px 20px;border-radius:var(--border-radius-lg);cursor:pointer;transition:all 0.3s ease;font-size:0.95rem;font-weight:600;display:flex;align-items:center;gap:8px;position:relative;overflow:hidden;z-index:1}.action-btn::before {content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);transition:left 0.5s ease;z-index:-1}.action-btn:hover::before {left:100%}.action-btn:hover {background:rgba(255, 255, 255, 0.25);transform:translateY(-2px);box-shadow:var(--shadow-md);border-color:rgba(255, 255, 255, 0.4)}.action-btn span {font-size:1.1rem;filter:drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2))}.stats-grid {display:grid;grid-template-columns:repeat(auto-fit, minmax(320px, 1fr));gap:30px;margin:0 25px 50px 25px}.stat-card {background:var(--bg-card);backdrop-filter:blur(20px);border-radius:25px;padding:40px 35px;box-shadow:0 20px 60px rgba(0,0,0,0.1), 0 8px 25px rgba(0,0,0,0.05);border:1px solid rgba(255, 255, 255, 0.3);transition:all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);position:relative;overflow:hidden;cursor:pointer}.stat-card:hover {transform:translateY(-8px) scale(1.02);box-shadow:0 35px 80px rgba(0,0,0,0.15), 0 15px 35px rgba(0,0,0,0.08);border-color:rgba(102, 126, 234, 0.4)}.stat-card::before {content:'';position:absolute;top:0;left:0;right:0;height:5px;background:linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 50%, var(--accent-color) 100%);border-radius:25px 25px 0 0}.stat-card::after {content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg, transparent, rgba(102, 126, 234, 0.05), transparent);transform:translateX(-100%) translateY(-100%) rotate(45deg);transition:transform 0.6s ease}.stat-card:hover::after {transform:translateX(100%) translateY(100%) rotate(45deg)}.stat-header {display:flex;align-items:center;justify-content:space-between;margin-bottom:25px;position:relative;z-index:1}.stat-icon {font-size:3rem;filter:drop-shadow(0 6px 12px rgba(0,0,0,0.15));background:linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:pulse 2s ease-in-out infinite}@keyframes pulse {0%, 100% {transform:scale(1)}50% {transform:scale(1.05)}}.stat-value {font-size:3rem;font-weight:900;background:linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px;text-shadow:0 4px 8px rgba(0, 0, 0, 0.1);position:relative;z-index:1}.stat-label {font-size:1.1rem;color:var(--text-secondary);font-weight:700;text-transform:uppercase;letter-spacing:0.5px;position:relative;z-index:1}.stat-trend {font-size:1rem;margin-top:15px;padding:8px 15px;border-radius:25px;font-weight:700;display:inline-flex;align-items:center;gap:6px;position:relative;z-index:1;backdrop-filter:blur(10px);border:1px solid rgba(255, 255, 255, 0.2);box-shadow:var(--shadow-md)}.trend-up {background:linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);color:#065f46;border-color:rgba(6, 95, 70, 0.2)}.trend-down {background:linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);color:#991b1b;border-color:rgba(153, 27, 27, 0.2)}.trend-stable {background:linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);color:#92400e;border-color:rgba(146, 64, 14, 0.2)}.trend-up::before {content:'â†—';font-size:1.2rem}.trend-down::before {content:'â†˜';font-size:1.2rem}.trend-stable::before {content:'â†’';font-size:1.2rem}.main-content {display:grid;grid-template-columns:2fr 1fr;gap:50px;margin:0 25px 50px 25px}.content-card {background:var(--bg-card);backdrop-filter:blur(25px);border-radius:30px;padding:50px 45px;box-shadow:0 25px 70px rgba(0,0,0,0.1), 0 10px 30px rgba(0,0,0,0.05);border:1px solid rgba(255, 255, 255, 0.3);transition:all 0.3s ease;position:relative;overflow:hidden}.content-card:hover {transform:translateY(-5px);box-shadow:0 35px 90px rgba(0,0,0,0.12), 0 15px 40px rgba(0,0,0,0.08);border-color:rgba(102, 126, 234, 0.3)}.content-card::before {content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 50%, var(--accent-color) 100%);border-radius:30px 30px 0 0}.card-title {font-size:1.8rem;font-weight:800;background:linear-gradient(135deg, #2d3748 0%, #4a5568 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:35px;display:flex;align-items:center;gap:15px;position:relative;padding-bottom:15px}.card-title::after {content:'';position:absolute;bottom:0;left:0;width:60px;height:3px;background:linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);border-radius:2px}.card-title span {font-size:2rem;filter:drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1))}.progress-circle-container {display:flex;justify-content:center;align-items:center;margin:40px 0;position:relative;padding:20px}.progress-circle {position:relative;width:240px;height:240px;filter:drop-shadow(0 10px 30px rgba(0, 0, 0, 0.1))}.progress-circle svg {width:100%;height:100%;transform:rotate(-90deg)}.progress-circle-bg {fill:none;stroke:#f1f5f9;stroke-width:16;opacity:0.3}.progress-circle-fill {fill:none;stroke:url(#progressGradient);stroke-width:16;stroke-linecap:round;transition:stroke-dasharray 2.5s cubic-bezier(0.4, 0, 0.2, 1);filter:drop-shadow(0 0 10px rgba(102, 126, 234, 0.3))}.progress-circle::before {content:'';position:absolute;top:-10px;left:-10px;right:-10px;bottom:-10px;border-radius:50%;background:linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);z-index:-1}.progress-text {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);text-align:center;z-index:1}.progress-percentage {font-size:3rem;font-weight:900;background:linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;display:block;text-shadow:0 4px 8px rgba(0, 0, 0, 0.1);animation:countUp 2s ease-out}@keyframes countUp {from {opacity:0;transform:scale(0.5)}to {opacity:1;transform:scale(1)}}.progress-label {font-size:1.1rem;color:var(--text-secondary);font-weight:700;margin-top:8px;text-transform:uppercase;letter-spacing:1px}.learning-calendar {margin:20px 0}.calendar-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.calendar-nav {display:flex;gap:10px}.nav-btn {background:var(--primary-color);color:var(--text-inverse);border:none;border-radius:var(--border-radius-sm);padding:8px 12px;cursor:pointer;font-weight:600;transition:all 0.3s ease}.nav-btn:hover {background:var(--secondary-color);transform:translateY(-2px)}.calendar-grid {display:grid;grid-template-columns:repeat(7, 1fr);gap:5px;margin-bottom:20px}.calendar-day {aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:var(--border-radius-sm);font-size:0.9rem;font-weight:600;cursor:pointer;transition:all 0.3s ease;position:relative}.calendar-day.header {background:#f8fafc;color:#64748b;cursor:default;font-weight:700}.calendar-day.empty {color:#cbd5e1}.calendar-day.today {background:var(--primary-color);color:var(--text-inverse);box-shadow:0 4px 12px rgba(102, 126, 234, 0.3)}.calendar-day.has-study {background:#d1fae5;color:#065f46}.calendar-day.high-activity {background:#10b981;color:var(--text-inverse)}.calendar-day:hover:not(.header) {transform:scale(1.1);z-index:10}.time-chart {margin:20px 0}.chart-container {height:300px;background:#f8fafc;border-radius:12px;padding:20px;display:flex;align-items:end;justify-content:space-around;gap:5px}.chart-bar {background:linear-gradient(to top, var(--primary-color), var(--secondary-color));border-radius:4px 4px 0 0;min-width:20px;position:relative;transition:all 0.3s ease;cursor:pointer}.chart-bar:hover {transform:scaleY(1.1);filter:brightness(1.1)}.chart-bar::after {content:attr(data-value);position:absolute;bottom:-25px;left:50%;transform:translateX(-50%);font-size:0.8rem;color:#666;font-weight:600}.activity-list {max-height:400px;overflow-y:auto}.activity-item {display:flex;align-items:center;padding:15px;border-radius:12px;margin-bottom:10px;background:#f8fafc;transition:all 0.3s ease}.activity-item:hover {background:#f1f5f9;transform:translateX(5px)}.activity-icon {font-size:1.5rem;margin-right:15px;width:40px;text-align:center}.activity-content {flex:1}.activity-title {font-weight:600;color:#374151;margin-bottom:3px}.activity-meta {font-size:0.9rem;color:#6b7280}.activity-time {font-size:0.8rem;color:#9ca3af;font-weight:600}@media (max-width:1200px) {.main-content {grid-template-columns:1fr}}@media (max-width:768px) {.dashboard-container {padding:30px 25px}.page-header {padding:40px 30px;margin:0 10px 40px 10px;border-radius:25px}.page-title {font-size:2.5rem;gap:15px}.page-title span {font-size:3rem}.page-subtitle {font-size:1.2rem}.stats-grid {grid-template-columns:1fr;gap:25px;margin:0 15px 40px 15px}.stat-card {padding:35px 30px}.stat-icon {font-size:2.5rem}.stat-value {font-size:2.5rem}.main-content {grid-template-columns:1fr;gap:30px;margin:0 15px 40px 15px}.content-card {padding:35px 30px;border-radius:25px}.card-title {font-size:1.6rem}.progress-circle {width:180px;height:180px}.progress-percentage {font-size:2.5rem}.progress-label {font-size:1rem}}</style>
{% endblock %}

{% block content %}
<div class="dashboard-container"><!-- é¡µé¢å¤´éƒ¨ --><div class="page-header"><h1 class="page-title"><span>ğŸ“Š</span>
            å­¦ä¹ ä»ªè¡¨æ¿
        </h1><p class="page-subtitle">å…¨é¢äº†è§£ä½ çš„å­¦ä¹ è¿›åº¦å’Œæˆå°±</p><!-- åŠŸèƒ½æŒ‰é’® --><div class="header-actions" style="margin-top: 30px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;"><button onclick="refreshDashboard()" class="action-btn" title="åˆ·æ–°æ•°æ® (Ctrl+R)"><span>ğŸ”„</span> åˆ·æ–°æ•°æ®
            </button><button onclick="setLearningGoal()" class="action-btn" title="è®¾ç½®å­¦ä¹ ç›®æ ‡ (Ctrl+G)"><span>ğŸ¯</span> è®¾ç½®ç›®æ ‡
            </button><button onclick="exportReport()" class="action-btn" title="å¯¼å‡ºå­¦ä¹ æŠ¥å‘Š"><span>ğŸ“Š</span> å¯¼å‡ºæŠ¥å‘Š
            </button></div></div><!-- ç»Ÿè®¡å¡ç‰‡ --><div class="stats-grid"><div class="stat-card"><div class="stat-header"><div class="stat-icon">ğŸ¯</div><div><div class="stat-value">{{ progress_summary.completion_rate|floatformat:1 }}%</div><div class="stat-label">å®Œæˆç‡</div></div></div><div class="stat-trend trend-up"><span>ğŸ“ˆ æœ¬å‘¨ +5.2%</span></div></div><div class="stat-card"><div class="stat-header"><div class="stat-icon">ğŸ“š</div><div><div class="stat-value">{{ progress_summary.completed_points }}</div><div class="stat-label">å·²å®ŒæˆçŸ¥è¯†ç‚¹</div></div></div><div class="stat-trend trend-up"><span>ğŸ“ˆ æœ¬å‘¨ +{{ weekly_completed|default:3 }}</span></div></div><div class="stat-card"><div class="stat-header"><div class="stat-icon">â±ï¸</div><div><div class="stat-value">{{ progress_summary.total_study_time_hours }}</div><div class="stat-label">å­¦ä¹ å°æ—¶</div></div></div><div class="stat-trend trend-stable"><span>ğŸ“Š æœ¬å‘¨ {{ weekly_hours|default:12 }}h</span></div></div><div class="stat-card"><div class="stat-header"><div class="stat-icon">ğŸ”¥</div><div><div class="stat-value">{{ progress_summary.current_streak }}</div><div class="stat-label">è¿ç»­å­¦ä¹ å¤©æ•°</div></div></div><div class="stat-trend trend-up"><span>ğŸ† æœ€é•¿ {{ progress_summary.longest_streak }} å¤©</span></div></div></div><!-- ä¸»è¦å†…å®¹åŒºåŸŸ --><div class="main-content"><!-- å·¦ä¾§ï¼šè¯¦ç»†è¿›åº¦å’Œå›¾è¡¨ --><div class="content-card"><h2 class="card-title"><span>ğŸ“ˆ</span>
                å­¦ä¹ è¿›åº¦è¯¦æƒ…
            </h2><!-- æ€»ä½“è¿›åº¦åœ†ç¯ --><div class="progress-circle-container"><div class="progress-circle"><svg viewBox="0 0 200 200"><defs><linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:var(--primary-color);stop-opacity:1" /><stop offset="100%" style="stop-color:var(--secondary-color);stop-opacity:1" /></linearGradient></defs><circle cx="100" cy="100" r="80" class="progress-circle-bg"/><circle cx="100" cy="100" r="80" class="progress-circle-fill"
                                stroke-dasharray="{{ progress_summary.completion_rate|floatformat:1 }}, 100"
                                id="progressCircle"/></svg><div class="progress-text"><span class="progress-percentage">{{ progress_summary.completion_rate|floatformat:1 }}%</span><span class="progress-label">æ€»ä½“å®Œæˆåº¦</span></div></div></div><!-- åˆ†ç±»è¿›åº¦æ¡ --><div style="margin-top: 40px;"><h3 style="color: var(--primary-color); margin-bottom: 20px; font-weight: 700;">ğŸ“Š åˆ†ç±»è¿›åº¦</h3>
                {% for category in progress_summary.category_progress %}
                <div style="margin-bottom: 20px;"><div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span style="font-weight: 600; color: #374151;">{{ category.knowledge_point__category|default:"æœªåˆ†ç±»" }}</span><span style="color: #6b7280; font-weight: 600;">{{ category.completed }}/{{ category.total }}</span></div><div style="background: #f0f0f0; height: 8px; border-radius: 4px; overflow: hidden;"><div style="background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
                                   height: 100%; width: {% widthratio category.completed category.total 100 %}%;
                                   border-radius: 4px; transition: width 1s ease;"></div></div></div>
                {% empty %}
                <div style="text-align: center; color: #9ca3af; padding: 40px;"><p>ğŸ¯ å¼€å§‹å­¦ä¹ æ¥æŸ¥çœ‹åˆ†ç±»è¿›åº¦ï¼</p></div>
                {% endfor %}
            </div><!-- å­¦ä¹ æ—¶é—´åˆ†å¸ƒ --><div class="time-chart"><h3 style="color: var(--primary-color); margin-bottom: 20px; font-weight: 700;">â° æœ€è¿‘7å¤©å­¦ä¹ æ—¶é—´</h3><div class="chart-container" id="timeChart"><!-- æ—¶é—´å›¾è¡¨å°†é€šè¿‡JavaScriptç”Ÿæˆ --></div></div></div><!-- å³ä¾§ï¼šå­¦ä¹ æ—¥å†å’Œæœ€è¿‘æ´»åŠ¨ --><div class="content-card"><h2 class="card-title"><span>ğŸ“…</span>
                å­¦ä¹ æ—¥å†
            </h2><div class="learning-calendar"><div class="calendar-header"><h3 id="calendarMonth" style="margin: 0; color: var(--primary-color);">2025å¹´8æœˆ</h3><div class="calendar-nav"><button class="nav-btn" onclick="previousMonth()">â€¹</button><button class="nav-btn" onclick="nextMonth()">â€º</button></div></div><div class="calendar-grid" id="calendarGrid"><!-- æ—¥å†å°†é€šè¿‡JavaScriptç”Ÿæˆ --></div><div style="display: flex; gap: 15px; font-size: 0.9rem; color: #6b7280; justify-content: center;"><div style="display: flex; align-items: center; gap: 5px;"><div style="width: 12px; height: 12px; background: #d1fae5; border-radius: 3px;"></div><span>æœ‰å­¦ä¹ </span></div><div style="display: flex; align-items: center; gap: 5px;"><div style="width: 12px; height: 12px; background: #10b981; border-radius: 3px;"></div><span>é«˜å¼ºåº¦</span></div><div style="display: flex; align-items: center; gap: 5px;"><div style="width: 12px; height: 12px; background: var(--primary-color); border-radius: 3px;"></div><span>ä»Šå¤©</span></div></div></div><!-- æœ€è¿‘æ´»åŠ¨ --><div style="margin-top: 40px;"><h3 style="color: var(--primary-color); margin-bottom: 20px; font-weight: 700;">ğŸ¯ æœ€è¿‘æ´»åŠ¨</h3><div class="activity-list">
                    {% for activity in recent_activities %}
                    <div class="activity-item"><div class="activity-icon">
                            {% if activity.is_completed %}ğŸ“š{% else %}â³{% endif %}
                        </div><div class="activity-content"><div class="activity-title">{{ activity.knowledge_point.title }}</div><div class="activity-meta">
                                {% if activity.duration %}
                                    å­¦ä¹ æ—¶é•¿: {{ activity.duration|floatformat:0 }}åˆ†é’Ÿ
                                {% else %}
                                    æ­£åœ¨å­¦ä¹ ä¸­...
                                {% endif %}
                            </div></div><div class="activity-time">
                            {{ activity.start_time|timesince }}å‰
                        </div></div>
                    {% empty %}
                    <div style="text-align: center; color: #9ca3af; padding: 40px;"><p>ğŸ“ æš‚æ— å­¦ä¹ è®°å½•</p><p style="font-size: 0.9rem;">å¼€å§‹å­¦ä¹ æ¥æŸ¥çœ‹æ´»åŠ¨å†å²</p></div>
                    {% endfor %}
                </div></div></div></div></div>
{% endblock %}

{% block extra_js %}
<script>let currentDate = new Date(); let studyData = {}; document.addEventListener('DOMContentLoaded', function() { console.log('ğŸš€ å­¦ä¹ ä»ªè¡¨æ¿åŠ è½½å®Œæˆ'); showLoadingAnimation(); setTimeout(() => { initProgressAnimation(); initTimeChart(); initCalendar(); loadStudyData(); animateStatsCards(); animateContentCards(); hideLoadingAnimation(); }, 800); }); function showLoadingAnimation() { const loader = document.createElement('div'); loader.id = 'dashboardLoader'; loader.innerHTML = ` <div class="loader-content"><div class="loader-spinner"></div><div class="loader-text">æ­£åœ¨åŠ è½½å­¦ä¹ æ•°æ®...</div></div> `; loader.style.cssText = ` position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 15, 35, 0.95); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; z-index: 9999; color: var(--text-inverse); `; const style = document.createElement('style'); style.textContent = ` .loader-content { text-align: center; } .loader-spinner { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.1); border-left: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; } .loader-text { font-size: 1.2rem; font-weight: 600; opacity: 0.9; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } `; document.head.appendChild(style); document.body.appendChild(loader); } function hideLoadingAnimation() { const loader = document.getElementById('dashboardLoader'); if (loader) { loader.style.opacity = '0'; loader.style.transition = 'opacity 0.5s ease'; setTimeout(() => loader.remove(), 500); } } function initProgressAnimation() { const progressCircle = document.getElementById('progressCircle'); if (progressCircle) { const dashArray = progressCircle.getAttribute('stroke-dasharray'); const [progress, total] = dashArray.split(',').map(Number); const circumference = 2 * Math.PI * 80; progressCircle.style.strokeDasharray = `0, ${circumference}`; setTimeout(() => { progressCircle.style.transition = 'stroke-dasharray 2s ease-in-out'; progressCircle.style.strokeDasharray = `${circumference * progress / 100}, ${circumference}`; }, 500); } } function animateStatsCards() { const cards = document.querySelectorAll('.stat-card'); cards.forEach((card, index) => { card.style.opacity = '0'; card.style.transform = 'translateY(50px) scale(0.9)'; setTimeout(() => { card.style.transition = 'all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)'; card.style.opacity = '1'; card.style.transform = 'translateY(0) scale(1)'; }, index * 200); }); } function animateContentCards() { const cards = document.querySelectorAll('.content-card'); cards.forEach((card, index) => { card.style.opacity = '0'; card.style.transform = 'translateX(-30px)'; setTimeout(() => { card.style.transition = 'all 0.8s ease'; card.style.opacity = '1'; card.style.transform = 'translateX(0)'; }, 600 + index * 300); }); } async function initTimeChart() { const chartContainer = document.getElementById('timeChart'); if (!chartContainer) return; try { const response = await fetch('/users/api/weekly-chart/'); const data = await response.json(); if (data.daily_data) { renderTimeChart(data.daily_data); } else { renderTimeChartFallback(); } } catch (error) { console.error('è·å–æ—¶é—´å›¾è¡¨æ•°æ®å¤±è´¥:', error); renderTimeChartFallback(); } } function renderTimeChart(dailyData) { const chartContainer = document.getElementById('timeChart'); chartContainer.innerHTML = ''; const maxTime = Math.max(...dailyData.map(d => d.total_minutes), 1); dailyData.forEach((dayData, index) => { const bar = document.createElement('div'); bar.className = 'chart-bar'; const height = (dayData.total_minutes / maxTime) * 200; bar.style.height = '0px'; bar.setAttribute('data-value', dayData.day_short); bar.title = `${dayData.day_short}: ${dayData.total_minutes}åˆ†é’Ÿ (${dayData.session_count}æ¬¡å­¦ä¹ )`; bar.addEventListener('mouseenter', function() { this.style.filter = 'brightness(1.2)'; showTooltip(this, `${dayData.day_short}: ${dayData.total_minutes}åˆ†é’Ÿ`); }); bar.addEventListener('mouseleave', function() { this.style.filter = 'brightness(1)'; hideTooltip(); }); chartContainer.appendChild(bar); setTimeout(() => { bar.style.transition = 'height 1s ease'; bar.style.height = `${height}px`; }, index * 100); }); } function renderTimeChartFallback() { const weekData = [45, 60, 30, 90, 75, 120, 85]; const weekDays = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥']; const chartContainer = document.getElementById('timeChart'); chartContainer.innerHTML = ''; const maxTime = Math.max(...weekData); weekData.forEach((time, index) => { const bar = document.createElement('div'); bar.className = 'chart-bar'; bar.style.height = '0px'; bar.setAttribute('data-value', weekDays[index]); bar.title = `${weekDays[index]}: ${time}åˆ†é’Ÿ`; bar.addEventListener('mouseenter', function() { this.style.filter = 'brightness(1.2)'; showTooltip(this, `${weekDays[index]}: ${time}åˆ†é’Ÿ`); }); bar.addEventListener('mouseleave', function() { this.style.filter = 'brightness(1)'; hideTooltip(); }); chartContainer.appendChild(bar); setTimeout(() => { bar.style.transition = 'height 1s ease'; bar.style.height = `${(time / maxTime) * 200}px`; }, index * 100); }); } function initCalendar() { updateCalendar(); } async function updateCalendar() { const calendarGrid = document.getElementById('calendarGrid'); const calendarMonth = document.getElementById('calendarMonth'); if (!calendarGrid || !calendarMonth) return; const year = currentDate.getFullYear(); const month = currentDate.getMonth(); calendarMonth.textContent = `${year}å¹´${month + 1}æœˆ`; try { const response = await fetch(`/users/api/learning-calendar/?year=${year}&month=${month + 1}`); const data = await response.json(); renderCalendar(year, month, data.calendar_data || []); } catch (error) { console.error('è·å–æ—¥å†æ•°æ®å¤±è´¥:', error); renderCalendar(year, month, []); } } function renderCalendar(year, month, calendarData) { const calendarGrid = document.getElementById('calendarGrid'); calendarGrid.innerHTML = ''; const studyDataMap = {}; calendarData.forEach(item => { const date = new Date(item.day).getDate(); studyDataMap[date] = { totalTime: item.total_time || 0, sessionCount: item.session_count || 0 }; }); const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­']; weekDays.forEach(day => { const dayElement = document.createElement('div'); dayElement.className = 'calendar-day header'; dayElement.textContent = day; calendarGrid.appendChild(dayElement); }); const firstDay = new Date(year, month, 1); const lastDay = new Date(year, month + 1, 0); const startDate = firstDay.getDay(); const daysInMonth = lastDay.getDate(); for (let i = 0; i < startDate; i++) { const emptyDay = document.createElement('div'); emptyDay.className = 'calendar-day empty'; calendarGrid.appendChild(emptyDay); } const today = new Date(); for (let day = 1; day <= daysInMonth; day++) { const dayElement = document.createElement('div'); dayElement.className = 'calendar-day'; dayElement.textContent = day; const currentDay = new Date(year, month, day); if (currentDay.toDateString() === today.toDateString()) { dayElement.classList.add('today'); } const studyData = studyDataMap[day]; if (studyData && studyData.totalTime > 0) { const studyMinutes = Math.round(studyData.totalTime / 60); dayElement.classList.add('has-study'); if (studyMinutes > 90) { dayElement.classList.add('high-activity'); } dayElement.title = `å­¦ä¹ æ—¶é—´: ${studyMinutes}åˆ†é’Ÿ (${studyData.sessionCount}æ¬¡å­¦ä¹ )`; dayElement.addEventListener('click', function() { showDayDetails(year, month, day, studyMinutes, studyData.sessionCount); }); } else { dayElement.addEventListener('click', function() { showDayDetails(year, month, day, 0, 0); }); } calendarGrid.appendChild(dayElement); } } function previousMonth() { currentDate.setMonth(currentDate.getMonth() - 1); updateCalendar(); } function nextMonth() { currentDate.setMonth(currentDate.getMonth() + 1); updateCalendar(); } function showDayDetails(year, month, day, studyTime, sessionCount = 0) { const date = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`; if (studyTime > 0) { const message = `ğŸ“… ${date}\n\nğŸ“Š å­¦ä¹ ç»Ÿè®¡:\nâ±ï¸ å­¦ä¹ æ—¶é—´: ${studyTime}åˆ†é’Ÿ\nğŸ“š å­¦ä¹ æ¬¡æ•°: ${sessionCount}æ¬¡\n\nğŸ’¡ ç»§ç»­ä¿æŒè¿™ä¸ªèŠ‚å¥ï¼`; alert(message); } else { const message = `ğŸ“… ${date}\n\nğŸ“ è¿™å¤©æ²¡æœ‰å­¦ä¹ è®°å½•\n\nğŸ¯ å¼€å§‹å­¦ä¹ æ¥è®°å½•ä½ çš„è¿›åº¦ï¼\nğŸ’ª æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œæˆå°±æ›´å¥½çš„è‡ªå·±`; alert(message); } } async function loadStudyData() { try { const response = await fetch('/users/api/learning-stats/'); if (response.ok) { const data = await response.json(); studyData = data; updateDashboardWithData(data); } } catch (error) { console.error('åŠ è½½å­¦ä¹ æ•°æ®å¤±è´¥:', error); } } function updateDashboardWithData(data) { console.log('å­¦ä¹ æ•°æ®å·²åŠ è½½:', data); } function showTooltip(element, text) { const tooltip = document.createElement('div'); tooltip.className = 'tooltip'; tooltip.textContent = text; tooltip.style.cssText = ` position: absolute; background: rgba(0,0,0,0.8); color: var(--text-inverse); padding: 8px 12px; border-radius: 6px; font-size: 0.9rem; z-index: 1000; pointer-events: none; white-space: nowrap; `; document.body.appendChild(tooltip); const rect = element.getBoundingClientRect(); tooltip.style.left = rect.left + rect.width / 2 - tooltip.offsetWidth / 2 + 'px'; tooltip.style.top = rect.top - tooltip.offsetHeight - 10 + 'px'; element._tooltip = tooltip; } function hideTooltip() { const tooltips = document.querySelectorAll('.tooltip'); tooltips.forEach(tooltip => tooltip.remove()); } function exportLearningReport() { alert('å­¦ä¹ æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...'); } function setLearningGoal() { const goal = prompt('è¯·è®¾ç½®ä½ çš„æ¯æ—¥å­¦ä¹ ç›®æ ‡ï¼ˆåˆ†é’Ÿï¼‰:', '60'); if (goal && !isNaN(goal)) { localStorage.setItem('dailyLearningGoal', goal); showSuccessMessage(`æ¯æ—¥å­¦ä¹ ç›®æ ‡å·²è®¾ç½®ä¸º ${goal} åˆ†é’Ÿ`); updateGoalDisplay(goal); } } function showSuccessMessage(message) { const toast = document.createElement('div'); toast.className = 'success-toast'; toast.textContent = message; toast.style.cssText = ` position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: var(--text-inverse); padding: 15px 25px; border-radius: var(--border-radius); font-weight: 600; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3); z-index: 10000; transform: translateX(400px); transition: transform 0.3s ease; `; document.body.appendChild(toast); setTimeout(() => { toast.style.transform = 'translateX(0)'; }, 100); setTimeout(() => { toast.style.transform = 'translateX(400px)'; setTimeout(() => toast.remove(), 300); }, 3000); } function updateGoalDisplay(goal) { console.log(`ç›®æ ‡å·²æ›´æ–°ä¸º: ${goal}åˆ†é’Ÿ`); } function refreshDashboard() { showLoadingAnimation(); setTimeout(() => { loadStudyData(); initTimeChart(); initCalendar(); hideLoadingAnimation(); showSuccessMessage('æ•°æ®å·²åˆ·æ–°'); }, 1500); } document.addEventListener('keydown', function(e) { if (e.ctrlKey && e.key === 'r') { e.preventDefault(); refreshDashboard(); } if (e.ctrlKey && e.key === 'g') { e.preventDefault(); setLearningGoal(); } if (e.ctrlKey && e.key === 'e') { e.preventDefault(); exportReport(); } }); function exportReport() { const reportData = { date: new Date().toLocaleDateString('zh-CN'), completionRate: document.querySelector('.stat-value').textContent, studyTime: document.querySelectorAll('.stat-value')[2].textContent, streak: document.querySelectorAll('.stat-value')[3].textContent, completedPoints: document.querySelectorAll('.stat-value')[1].textContent }; const reportContent = ` å­¦ä¹ è¿›åº¦æŠ¥å‘Š ç”Ÿæˆæ—¥æœŸ: ${reportData.date} ğŸ“Š å­¦ä¹ ç»Ÿè®¡: â€¢ å®Œæˆç‡: ${reportData.completionRate} â€¢ å­¦ä¹ æ—¶é•¿: ${reportData.studyTime}å°æ—¶ â€¢ è¿ç»­å­¦ä¹ : ${reportData.streak}å¤© â€¢ å®ŒæˆçŸ¥è¯†ç‚¹: ${reportData.completedPoints}ä¸ª ğŸ¯ å­¦ä¹ å»ºè®®: â€¢ ä¿æŒå½“å‰çš„å­¦ä¹ èŠ‚å¥ â€¢ ç»§ç»­æŒ‘æˆ˜æ›´é«˜éš¾åº¦çš„å†…å®¹ â€¢ å®šæœŸå¤ä¹ å·²å­¦çŸ¥è¯†ç‚¹ ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’: â€¢ åˆ¶å®šä¸‹å‘¨å­¦ä¹ è®¡åˆ’ â€¢ é€‰æ‹©æ–°çš„å­¦ä¹ é¢†åŸŸ â€¢ å‚ä¸ç¤¾åŒºè®¨è®º --- ç”±è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°ç”Ÿæˆ `.trim(); const blob = new Blob([reportContent], { type: 'text/plain;charset=utf-8' }); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `å­¦ä¹ æŠ¥å‘Š_${new Date().toISOString().split('T')[0]}.txt`; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); showSuccessMessage('å­¦ä¹ æŠ¥å‘Šå·²å¯¼å‡º'); }</script>
{% endblock %}
