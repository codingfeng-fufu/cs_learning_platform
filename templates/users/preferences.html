{% extends 'knowledge_app/base.html' %}

{% block title %}åå¥½è®¾ç½® - è®¡ç®—æœºç§‘å­¦å­¦ä¹ å¹³å°{% endblock %}

{% block extra_css %}
<style>.preferences-container {max-width:900px;margin:0 auto;padding:30px 25px;min-height:100vh;position:relative;z-index:1}.page-header {background:rgba(255, 255, 255, 0.1);backdrop-filter:blur(15px);border-radius:var(--border-radius-lg);padding:35px;margin-bottom:35px;color:var(--text-inverse);text-align:center;position:relative;z-index:2}.page-title {font-size:2.5rem;font-weight:700;margin-bottom:10px}.settings-grid {display:grid;grid-template-columns:1fr 1fr;gap:25px;margin-bottom:30px}.settings-card {background:var(--bg-card);border-radius:var(--border-radius-lg);padding:35px;box-shadow:var(--shadow-md);border:1px solid rgba(255, 255, 255, 0.2);transition:all 0.3s ease;margin-bottom:25px}.settings-card:hover {transform:translateY(-5px);box-shadow:var(--shadow-md)}.card-header {display:flex;align-items:center;gap:12px;margin-bottom:25px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}.card-icon {font-size:1.8rem}.card-title {font-size:1.4rem;font-weight:600;color:var(--text-primary);margin:0}.form-group {margin-bottom:25px}.form-label {display:block;margin-bottom:10px;color:var(--text-primary);font-weight:600;font-size:1rem}.form-control {width:100%;padding:12px 16px;border:2px solid #e1e5e9;border-radius:var(--border-radius);font-size:1rem;transition:all 0.3s ease;background:var(--bg-card);box-sizing:border-box}.form-control:focus {outline:none;border-color:var(--accent-color);box-shadow:0 0 0 3px rgba(78, 205, 196, 0.1)}.form-check {display:flex;align-items:center;gap:12px;padding:15px;background:#f8f9fa;border-radius:var(--border-radius);transition:all 0.3s ease;cursor:pointer}.form-check:hover {background:#e9ecef}.form-check-input {width:20px;height:20px;accent-color:var(--accent-color)}.form-check-label {font-size:1rem;color:var(--text-primary);cursor:pointer;flex:1}.form-help {font-size:0.85rem;color:#666;margin-top:8px;line-height:1.4}.password-section {grid-column:1 / -1;background:linear-gradient(135deg, #fff5f5 0%, #fff 100%);border:2px solid #ffe6e6}.password-form {display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin-top:20px}.password-strength {margin-top:10px}.strength-bar {height:4px;background:#f0f0f0;border-radius:2px;overflow:hidden;margin-bottom:5px}.strength-fill {height:100%;transition:all 0.3s ease;border-radius:2px}.strength-weak {background:#dc3545;width:25%}.strength-fair {background:#ffc107;width:50%}.strength-good {background:#28a745;width:75%}.strength-strong {background:var(--accent-color);width:100%}.strength-text {font-size:0.8rem;font-weight:600}.action-buttons {display:flex;gap:15px;justify-content:center;margin-top:40px;flex-wrap:wrap}.btn {padding:12px 30px;border-radius:var(--border-radius);text-decoration:none;font-weight:600;transition:all 0.3s ease;border:none;cursor:pointer;font-size:1rem;min-width:120px}.btn-primary {background:linear-gradient(135deg, var(--accent-color) 0%, #44a08d 100%);color:var(--text-inverse)}.btn-primary:hover {transform:translateY(-2px);box-shadow:0 8px 25px rgba(78, 205, 196, 0.3)}.btn-secondary {background:#f8f9fa;color:var(--text-primary);border:1px solid #ddd}.btn-secondary:hover {background:#e9ecef;transform:translateY(-2px)}.btn-danger {background:linear-gradient(135deg, #dc3545 0%, #c82333 100%);color:var(--text-inverse)}.btn-danger:hover {transform:translateY(-2px);box-shadow:0 8px 25px rgba(220, 53, 69, 0.3)}.danger-zone {grid-column:1 / -1;background:linear-gradient(135deg, #fff5f5 0%, #fff 100%);border:2px solid #ffe6e6;margin-top:30px}.danger-zone .card-title {color:#dc3545}.danger-actions {display:flex;gap:15px;margin-top:20px}@media (max-width:768px) {.preferences-container {padding:20px 15px}.settings-grid {grid-template-columns:1fr;gap:20px}.password-form {grid-template-columns:1fr}.settings-card {padding:25px}.action-buttons {flex-direction:column;align-items:center}.btn {width:100%;max-width:250px}}</style>
{% endblock %}

{% block content %}
<div class="preferences-container"><!-- é¡µé¢å¤´éƒ¨ --><div class="page-header"><h1 class="page-title">âš™ï¸ åå¥½è®¾ç½®</h1><p>ä¸ªæ€§åŒ–æ‚¨çš„å­¦ä¹ ä½“éªŒ</p></div><!-- è®¾ç½®è¡¨å• --><form method="post" id="preferences-form">
        {% csrf_token %}

        <div class="settings-grid"><!-- ç”¨æˆ·åå¥½è®¾ç½® --><div class="settings-card"><div class="card-header"><span class="card-icon">ğŸŒ</span><h3 class="card-title">ç•Œé¢åå¥½</h3></div><div class="form-group"><label for="{{ user_form.preferred_language.id_for_label }}" class="form-label">é¦–é€‰è¯­è¨€</label>
                    {{ user_form.preferred_language }}
                    <div class="form-help">é€‰æ‹©æ‚¨çš„é¦–é€‰ç•Œé¢è¯­è¨€</div></div><div class="form-group"><div class="form-check">
                        {{ user_form.email_notifications }}
                        <label for="{{ user_form.email_notifications.id_for_label }}" class="form-check-label">
                            æ¥æ”¶é‚®ä»¶é€šçŸ¥
                        </label></div><div class="form-help">åŒ…æ‹¬å­¦ä¹ æé†’ã€æˆå°±é€šçŸ¥ç­‰</div></div></div><!-- å­¦ä¹ è®¾ç½® --><div class="settings-card"><div class="card-header"><span class="card-icon">ğŸ“š</span><h3 class="card-title">å­¦ä¹ è®¾ç½®</h3></div><div class="form-group"><label for="{{ profile_form.study_goal.id_for_label }}" class="form-label">å­¦ä¹ ç›®æ ‡</label>
                    {{ profile_form.study_goal }}
                    <div class="form-help">é€‰æ‹©æ‚¨çš„ä¸»è¦å­¦ä¹ ç›®æ ‡</div></div><div class="form-group"><label for="{{ profile_form.daily_study_goal.id_for_label }}" class="form-label">æ¯æ—¥å­¦ä¹ ç›®æ ‡</label><div style="display: flex; align-items: center; gap: 10px;">
                        {{ profile_form.daily_study_goal }}
                        <span style="color: #666;">åˆ†é’Ÿ</span></div><div class="form-help">è®¾ç½®æ¯æ—¥å­¦ä¹ æ—¶é—´ç›®æ ‡ï¼ˆ5-480åˆ†é’Ÿï¼‰</div></div></div><!-- å¯†ç ä¿®æ”¹ --><div class="settings-card password-section"><div class="card-header"><span class="card-icon">ğŸ”’</span><h3 class="card-title">å®‰å…¨è®¾ç½®</h3></div><div class="password-form"><div class="form-group"><label class="form-label">å½“å‰å¯†ç </label><input type="password" name="current_password" class="form-control" id="current-password"></div><div class="form-group"><label class="form-label">æ–°å¯†ç </label><input type="password" name="new_password1" class="form-control" id="new-password"><div class="password-strength"><div class="strength-bar"><div class="strength-fill" id="strength-fill"></div></div><div class="strength-text" id="strength-text">è¯·è¾“å…¥æ–°å¯†ç </div></div></div><div class="form-group"><label class="form-label">ç¡®è®¤æ–°å¯†ç </label><input type="password" name="new_password2" class="form-control" id="confirm-password"><div class="form-help" id="password-match"></div></div></div><div class="action-buttons"><button type="button" class="btn btn-danger" onclick="changePassword()">
                        ğŸ”‘ ä¿®æ”¹å¯†ç 
                    </button></div></div><!-- å±é™©åŒºåŸŸ --><div class="settings-card danger-zone"><div class="card-header"><span class="card-icon">âš ï¸</span><h3 class="card-title">å±é™©æ“ä½œ</h3></div><p style="color: #666; margin-bottom: 20px;">
                    ä»¥ä¸‹æ“ä½œä¸å¯é€†ï¼Œè¯·è°¨æ…æ“ä½œ
                </p><div class="danger-actions"><button type="button" class="btn btn-danger" onclick="clearLearningData()">
                        ğŸ—‘ï¸ æ¸…é™¤å­¦ä¹ æ•°æ®
                    </button><button type="button" class="btn btn-danger" onclick="deleteAccount()">
                        âŒ åˆ é™¤è´¦æˆ·
                    </button></div></div></div><!-- ä¸»è¦æ“ä½œæŒ‰é’® --><div class="action-buttons"><button type="submit" class="btn btn-primary">
                ğŸ’¾ ä¿å­˜è®¾ç½®
            </button><a href="{% url 'users:profile' %}" class="btn btn-secondary">
                â†©ï¸ è¿”å›ä¸ªäººä¸­å¿ƒ
            </a></div></form></div>
{% endblock %}

{% block extra_js %}
<script>document.addEventListener('DOMContentLoaded', function() { const newPasswordInput = document.getElementById('new-password'); const confirmPasswordInput = document.getElementById('confirm-password'); const strengthFill = document.getElementById('strength-fill'); const strengthText = document.getElementById('strength-text'); const passwordMatch = document.getElementById('password-match'); if (newPasswordInput) { newPasswordInput.addEventListener('input', function() { const password = this.value; const strength = calculatePasswordStrength(password); updatePasswordStrength(strength); }); } if (confirmPasswordInput) { confirmPasswordInput.addEventListener('input', function() { const newPassword = newPasswordInput.value; const confirmPassword = this.value; if (confirmPassword === '') { passwordMatch.textContent = ''; passwordMatch.style.color = ''; } else if (newPassword === confirmPassword) { passwordMatch.textContent = 'âœ“ å¯†ç åŒ¹é…'; passwordMatch.style.color = '#28a745'; } else { passwordMatch.textContent = 'âœ— å¯†ç ä¸åŒ¹é…'; passwordMatch.style.color = '#dc3545'; } }); } function calculatePasswordStrength(password) { let score = 0; if (password.length >= 8) score += 1; if (password.length >= 12) score += 1; if (/[a-z]/.test(password)) score += 1; if (/[A-Z]/.test(password)) score += 1; if (/[0-9]/.test(password)) score += 1; if (/[^A-Za-z0-9]/.test(password)) score += 1; return Math.min(score, 4); } function updatePasswordStrength(strength) { const classes = ['strength-weak', 'strength-fair', 'strength-good', 'strength-strong']; const texts = ['å¼±', 'ä¸€èˆ¬', 'è‰¯å¥½', 'å¼º']; strengthFill.className = 'strength-fill'; if (strength > 0) { strengthFill.classList.add(classes[strength - 1]); strengthText.textContent = `å¯†ç å¼ºåº¦: ${texts[strength - 1]}`; } else { strengthText.textContent = 'è¯·è¾“å…¥æ–°å¯†ç '; } } const cards = document.querySelectorAll('.settings-card'); cards.forEach((card, index) => { card.style.opacity = '0'; card.style.transform = 'translateY(20px)'; setTimeout(() => { card.style.transition = 'all 0.6s ease'; card.style.opacity = '1'; card.style.transform = 'translateY(0)'; }, index * 100); }); }); function changePassword() { const currentPassword = document.getElementById('current-password').value; const newPassword = document.getElementById('new-password').value; const confirmPassword = document.getElementById('confirm-password').value; if (!currentPassword || !newPassword || !confirmPassword) { alert('è¯·å¡«å†™å®Œæ•´çš„å¯†ç ä¿¡æ¯'); return; } if (newPassword !== confirmPassword) { alert('æ–°å¯†ç å’Œç¡®è®¤å¯†ç ä¸åŒ¹é…'); return; } if (newPassword.length < 8) { alert('æ–°å¯†ç é•¿åº¦è‡³å°‘ä¸º8ä½'); return; } const formData = new FormData(); formData.append('current_password', currentPassword); formData.append('new_password1', newPassword); formData.append('new_password2', confirmPassword); formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value); fetch('{% url "users:change_password" %}', { method: 'POST', body: formData }) .then(response => { if (response.ok) { alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•'); window.location.href = '{% url "users:login" %}'; } else { alert('å¯†ç ä¿®æ”¹å¤±è´¥ï¼Œè¯·æ£€æŸ¥å½“å‰å¯†ç æ˜¯å¦æ­£ç¡®'); } }) .catch(error => { console.error('Error:', error); alert('å¯†ç ä¿®æ”¹å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'); }); } function clearLearningData() { if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å­¦ä¹ æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) { if (confirm('å†æ¬¡ç¡®è®¤ï¼šè¿™å°†åˆ é™¤æ‚¨çš„æ‰€æœ‰å­¦ä¹ è®°å½•ã€è¿›åº¦å’Œæˆå°±ï¼')) { alert('æ¸…é™¤å­¦ä¹ æ•°æ®åŠŸèƒ½å³å°†æ¨å‡º'); } } } function deleteAccount() { if (confirm('ç¡®å®šè¦åˆ é™¤è´¦æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) { if (confirm('æœ€åç¡®è®¤ï¼šåˆ é™¤è´¦æˆ·å°†æ°¸ä¹…åˆ é™¤æ‚¨çš„æ‰€æœ‰æ•°æ®ï¼')) { alert('åˆ é™¤è´¦æˆ·åŠŸèƒ½å³å°†æ¨å‡º'); } } }</script>
{% endblock %}
