# 📚 每日计算机名词解释系统部署指南

## 🎯 系统概述

每日计算机名词解释系统是一个完全自动化的学习功能，通过调用Kimi API每天生成一个计算机专业名词及其详细解释，帮助用户持续学习专业知识。

## 🏗️ 系统架构

### 核心组件
- **数据模型**：`DailyTerm`（每日名词）、`TermHistory`（历史记录）
- **服务层**：`DailyTermService`（业务逻辑）、`KimiAPIClient`（API客户端）
- **管理命令**：`generate_daily_term`（生成名词命令）
- **前端界面**：每日名词展示页面、历史记录页面
- **管理后台**：Django Admin集成

## 🔧 部署步骤

### 1. 环境配置

#### 设置Kimi API密钥
```bash
# 在环境变量中设置API密钥
export KIMI_API_KEY="your_kimi_api_key_here"

# 或在.env文件中设置
echo "KIMI_API_KEY=your_kimi_api_key_here" >> .env
```

#### 数据库迁移
```bash
# 生成迁移文件（已完成）
python manage.py makemigrations knowledge_app

# 应用迁移（已完成）
python manage.py migrate
```

### 2. 手动测试

#### 生成今日名词
```bash
# 生成今天的名词
python manage.py generate_daily_term

# 生成指定日期的名词
python manage.py generate_daily_term --date 2024-01-15

# 强制重新生成（覆盖已存在的）
python manage.py generate_daily_term --force

# 批量生成未来7天的名词
python manage.py generate_daily_term --batch 7

# 回填过去7天的名词
python manage.py generate_daily_term --backfill 7
```

### 3. 定时任务配置

#### 方案一：使用Cron（Linux/Mac）
```bash
# 编辑crontab
crontab -e

# 添加每日0点执行的任务
0 0 * * * cd /path/to/your/project && python manage.py generate_daily_term >> /var/log/daily_term.log 2>&1
```

#### 方案二：使用Windows任务计划程序
1. 打开"任务计划程序"
2. 创建基本任务
3. 设置触发器：每天0:00
4. 设置操作：启动程序
   - 程序：`python`
   - 参数：`manage.py generate_daily_term`
   - 起始位置：项目根目录

#### 方案三：使用Django-Crontab（推荐）
```bash
# 安装django-crontab
pip install django-crontab

# 在settings.py中添加
INSTALLED_APPS = [
    # ...
    'django_crontab',
]

CRONJOBS = [
    ('0 0 * * *', 'knowledge_app.management.commands.generate_daily_term.Command'),
]

# 添加定时任务
python manage.py crontab add

# 查看定时任务
python manage.py crontab show

# 移除定时任务
python manage.py crontab remove
```

### 4. 监控和日志

#### 配置日志
在`settings.py`中添加：
```python
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'daily_term_file': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': 'logs/daily_term.log',
        },
    },
    'loggers': {
        'knowledge_app.services.daily_term_service': {
            'handlers': ['daily_term_file'],
            'level': 'INFO',
            'propagate': True,
        },
    },
}
```

## 🎮 使用指南

### 管理后台操作

1. **访问管理后台**：`/admin/`
2. **查看每日名词**：`知识应用 > 每日名词`
3. **管理历史记录**：`知识应用 > 名词历史`

#### 管理功能
- **批量操作**：激活、归档、重新生成解释
- **筛选功能**：按状态、分类、难度筛选
- **搜索功能**：按名词、解释内容搜索

### 前端页面

#### 每日名词主页
- **URL**：`/daily-term/`
- **功能**：显示今日名词、历史名词列表
- **交互**：点赞、查看详情

#### 名词详情页
- **URL**：`/daily-term/<id>/`
- **功能**：显示完整解释、相关名词推荐

#### 历史记录页
- **URL**：`/daily-term/history/`
- **功能**：分页浏览、分类筛选、搜索

### API接口

#### 获取今日名词
```javascript
// GET /api/daily-term/
fetch('/api/daily-term/')
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      console.log('今日名词:', data.data);
    }
  });
```

#### 点赞名词
```javascript
// POST /api/daily-term/like/<id>/
fetch(`/api/daily-term/like/${termId}/`, {
  method: 'POST',
  headers: {
    'X-CSRFToken': getCookie('csrftoken')
  }
})
.then(response => response.json())
.then(data => {
  if (data.success) {
    console.log('点赞成功，当前点赞数:', data.like_count);
  }
});
```

## 🔍 故障排除

### 常见问题

#### 1. API调用失败
**症状**：生成名词失败，日志显示API错误
**解决**：
- 检查API密钥是否正确设置
- 确认网络连接正常
- 检查API配额是否用完

#### 2. 名词重复
**症状**：生成了重复的名词
**解决**：
- 检查`TermHistory`表是否正常工作
- 增加重试次数（修改`max_retry_attempts`）

#### 3. 定时任务不执行
**症状**：每日名词没有自动生成
**解决**：
- 检查cron任务是否正确设置
- 确认Python环境路径正确
- 查看系统日志

### 调试命令

```bash
# 检查今日是否有名词
python manage.py shell -c "from knowledge_app.models import DailyTerm; print(DailyTerm.get_today_term())"

# 查看最近的名词
python manage.py shell -c "from knowledge_app.models import DailyTerm; [print(f'{t.display_date}: {t.term}') for t in DailyTerm.objects.filter(status='active')[:5]]"

# 测试API连接
python manage.py shell -c "from knowledge_app.services.daily_term_service import KimiAPIClient; client = KimiAPIClient(); print(client.get_computer_term())"
```

## 📊 系统监控

### 关键指标
- **生成成功率**：每日名词生成的成功率
- **API响应时间**：Kimi API的平均响应时间
- **用户参与度**：浏览量、点赞数统计
- **内容质量**：名词重复率、解释长度分布

### 监控脚本
```python
# 创建监控脚本 monitor_daily_term.py
from knowledge_app.models import DailyTerm, TermHistory
from datetime import date, timedelta

def check_system_health():
    today = date.today()
    
    # 检查今日名词
    today_term = DailyTerm.get_today_term()
    print(f"今日名词: {'✅' if today_term else '❌'}")
    
    # 检查最近7天的生成情况
    recent_days = [(today - timedelta(days=i)) for i in range(7)]
    generated_days = DailyTerm.objects.filter(
        display_date__in=recent_days,
        status='active'
    ).count()
    print(f"最近7天生成率: {generated_days}/7 ({generated_days/7*100:.1f}%)")
    
    # 检查重复率
    total_terms = TermHistory.objects.count()
    unique_terms = TermHistory.objects.values('term_lower').distinct().count()
    print(f"名词去重率: {unique_terms}/{total_terms} ({unique_terms/total_terms*100:.1f}%)")

if __name__ == '__main__':
    check_system_health()
```

## 🚀 扩展功能

### 计划中的功能
1. **多语言支持**：英文名词解释
2. **难度自适应**：根据用户水平调整名词难度
3. **个性化推荐**：基于用户兴趣推荐相关名词
4. **社交功能**：用户评论、讨论
5. **学习统计**：个人学习进度跟踪

### 集成建议
- **与练习题系统集成**：为每个名词生成相关练习题
- **与搜索系统集成**：将每日名词加入搜索索引
- **与用户系统集成**：记录用户学习历史

## 📝 维护建议

1. **定期备份**：每周备份名词数据
2. **性能优化**：定期清理过期的搜索记录
3. **内容审核**：定期检查生成内容的质量
4. **用户反馈**：收集用户对名词解释的反馈
5. **API监控**：监控API使用量和成本

## 🎉 部署完成

系统已成功部署！现在您可以：
- ✅ 访问 `/daily-term/` 查看每日名词
- ✅ 在管理后台管理名词内容
- ✅ 设置定时任务自动生成
- ✅ 监控系统运行状态

祝您使用愉快！🎓
