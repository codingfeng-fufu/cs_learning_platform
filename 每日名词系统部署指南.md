# ğŸ“š æ¯æ—¥è®¡ç®—æœºåè¯è§£é‡Šç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

æ¯æ—¥è®¡ç®—æœºåè¯è§£é‡Šç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„å­¦ä¹ åŠŸèƒ½ï¼Œé€šè¿‡è°ƒç”¨Kimi APIæ¯å¤©ç”Ÿæˆä¸€ä¸ªè®¡ç®—æœºä¸“ä¸šåè¯åŠå…¶è¯¦ç»†è§£é‡Šï¼Œå¸®åŠ©ç”¨æˆ·æŒç»­å­¦ä¹ ä¸“ä¸šçŸ¥è¯†ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒç»„ä»¶
- **æ•°æ®æ¨¡å‹**ï¼š`DailyTerm`ï¼ˆæ¯æ—¥åè¯ï¼‰ã€`TermHistory`ï¼ˆå†å²è®°å½•ï¼‰
- **æœåŠ¡å±‚**ï¼š`DailyTermService`ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ã€`KimiAPIClient`ï¼ˆAPIå®¢æˆ·ç«¯ï¼‰
- **ç®¡ç†å‘½ä»¤**ï¼š`generate_daily_term`ï¼ˆç”Ÿæˆåè¯å‘½ä»¤ï¼‰
- **å‰ç«¯ç•Œé¢**ï¼šæ¯æ—¥åè¯å±•ç¤ºé¡µé¢ã€å†å²è®°å½•é¡µé¢
- **ç®¡ç†åå°**ï¼šDjango Adminé›†æˆ

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

### 1. ç¯å¢ƒé…ç½®

#### è®¾ç½®Kimi APIå¯†é’¥
```bash
# åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®APIå¯†é’¥
export KIMI_API_KEY="your_kimi_api_key_here"

# æˆ–åœ¨.envæ–‡ä»¶ä¸­è®¾ç½®
echo "KIMI_API_KEY=your_kimi_api_key_here" >> .env
```

#### æ•°æ®åº“è¿ç§»
```bash
# ç”Ÿæˆè¿ç§»æ–‡ä»¶ï¼ˆå·²å®Œæˆï¼‰
python manage.py makemigrations knowledge_app

# åº”ç”¨è¿ç§»ï¼ˆå·²å®Œæˆï¼‰
python manage.py migrate
```

### 2. æ‰‹åŠ¨æµ‹è¯•

#### ç”Ÿæˆä»Šæ—¥åè¯
```bash
# ç”Ÿæˆä»Šå¤©çš„åè¯
python manage.py generate_daily_term

# ç”ŸæˆæŒ‡å®šæ—¥æœŸçš„åè¯
python manage.py generate_daily_term --date 2024-01-15

# å¼ºåˆ¶é‡æ–°ç”Ÿæˆï¼ˆè¦†ç›–å·²å­˜åœ¨çš„ï¼‰
python manage.py generate_daily_term --force

# æ‰¹é‡ç”Ÿæˆæœªæ¥7å¤©çš„åè¯
python manage.py generate_daily_term --batch 7

# å›å¡«è¿‡å»7å¤©çš„åè¯
python manage.py generate_daily_term --backfill 7
```

### 3. å®šæ—¶ä»»åŠ¡é…ç½®

#### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨Cronï¼ˆLinux/Macï¼‰
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ æ¯æ—¥0ç‚¹æ‰§è¡Œçš„ä»»åŠ¡
0 0 * * * cd /path/to/your/project && python manage.py generate_daily_term >> /var/log/daily_term.log 2>&1
```

#### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Windowsä»»åŠ¡è®¡åˆ’ç¨‹åº
1. æ‰“å¼€"ä»»åŠ¡è®¡åˆ’ç¨‹åº"
2. åˆ›å»ºåŸºæœ¬ä»»åŠ¡
3. è®¾ç½®è§¦å‘å™¨ï¼šæ¯å¤©0:00
4. è®¾ç½®æ“ä½œï¼šå¯åŠ¨ç¨‹åº
   - ç¨‹åºï¼š`python`
   - å‚æ•°ï¼š`manage.py generate_daily_term`
   - èµ·å§‹ä½ç½®ï¼šé¡¹ç›®æ ¹ç›®å½•

#### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨Django-Crontabï¼ˆæ¨èï¼‰
```bash
# å®‰è£…django-crontab
pip install django-crontab

# åœ¨settings.pyä¸­æ·»åŠ 
INSTALLED_APPS = [
    # ...
    'django_crontab',
]

CRONJOBS = [
    ('0 0 * * *', 'knowledge_app.management.commands.generate_daily_term.Command'),
]

# æ·»åŠ å®šæ—¶ä»»åŠ¡
python manage.py crontab add

# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
python manage.py crontab show

# ç§»é™¤å®šæ—¶ä»»åŠ¡
python manage.py crontab remove
```

### 4. ç›‘æ§å’Œæ—¥å¿—

#### é…ç½®æ—¥å¿—
åœ¨`settings.py`ä¸­æ·»åŠ ï¼š
```python
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'daily_term_file': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': 'logs/daily_term.log',
        },
    },
    'loggers': {
        'knowledge_app.services.daily_term_service': {
            'handlers': ['daily_term_file'],
            'level': 'INFO',
            'propagate': True,
        },
    },
}
```

## ğŸ® ä½¿ç”¨æŒ‡å—

### ç®¡ç†åå°æ“ä½œ

1. **è®¿é—®ç®¡ç†åå°**ï¼š`/admin/`
2. **æŸ¥çœ‹æ¯æ—¥åè¯**ï¼š`çŸ¥è¯†åº”ç”¨ > æ¯æ—¥åè¯`
3. **ç®¡ç†å†å²è®°å½•**ï¼š`çŸ¥è¯†åº”ç”¨ > åè¯å†å²`

#### ç®¡ç†åŠŸèƒ½
- **æ‰¹é‡æ“ä½œ**ï¼šæ¿€æ´»ã€å½’æ¡£ã€é‡æ–°ç”Ÿæˆè§£é‡Š
- **ç­›é€‰åŠŸèƒ½**ï¼šæŒ‰çŠ¶æ€ã€åˆ†ç±»ã€éš¾åº¦ç­›é€‰
- **æœç´¢åŠŸèƒ½**ï¼šæŒ‰åè¯ã€è§£é‡Šå†…å®¹æœç´¢

### å‰ç«¯é¡µé¢

#### æ¯æ—¥åè¯ä¸»é¡µ
- **URL**ï¼š`/daily-term/`
- **åŠŸèƒ½**ï¼šæ˜¾ç¤ºä»Šæ—¥åè¯ã€å†å²åè¯åˆ—è¡¨
- **äº¤äº’**ï¼šç‚¹èµã€æŸ¥çœ‹è¯¦æƒ…

#### åè¯è¯¦æƒ…é¡µ
- **URL**ï¼š`/daily-term/<id>/`
- **åŠŸèƒ½**ï¼šæ˜¾ç¤ºå®Œæ•´è§£é‡Šã€ç›¸å…³åè¯æ¨è

#### å†å²è®°å½•é¡µ
- **URL**ï¼š`/daily-term/history/`
- **åŠŸèƒ½**ï¼šåˆ†é¡µæµè§ˆã€åˆ†ç±»ç­›é€‰ã€æœç´¢

### APIæ¥å£

#### è·å–ä»Šæ—¥åè¯
```javascript
// GET /api/daily-term/
fetch('/api/daily-term/')
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      console.log('ä»Šæ—¥åè¯:', data.data);
    }
  });
```

#### ç‚¹èµåè¯
```javascript
// POST /api/daily-term/like/<id>/
fetch(`/api/daily-term/like/${termId}/`, {
  method: 'POST',
  headers: {
    'X-CSRFToken': getCookie('csrftoken')
  }
})
.then(response => response.json())
.then(data => {
  if (data.success) {
    console.log('ç‚¹èµæˆåŠŸï¼Œå½“å‰ç‚¹èµæ•°:', data.like_count);
  }
});
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. APIè°ƒç”¨å¤±è´¥
**ç—‡çŠ¶**ï¼šç”Ÿæˆåè¯å¤±è´¥ï¼Œæ—¥å¿—æ˜¾ç¤ºAPIé”™è¯¯
**è§£å†³**ï¼š
- æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®è®¾ç½®
- ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
- æ£€æŸ¥APIé…é¢æ˜¯å¦ç”¨å®Œ

#### 2. åè¯é‡å¤
**ç—‡çŠ¶**ï¼šç”Ÿæˆäº†é‡å¤çš„åè¯
**è§£å†³**ï¼š
- æ£€æŸ¥`TermHistory`è¡¨æ˜¯å¦æ­£å¸¸å·¥ä½œ
- å¢åŠ é‡è¯•æ¬¡æ•°ï¼ˆä¿®æ”¹`max_retry_attempts`ï¼‰

#### 3. å®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ
**ç—‡çŠ¶**ï¼šæ¯æ—¥åè¯æ²¡æœ‰è‡ªåŠ¨ç”Ÿæˆ
**è§£å†³**ï¼š
- æ£€æŸ¥cronä»»åŠ¡æ˜¯å¦æ­£ç¡®è®¾ç½®
- ç¡®è®¤Pythonç¯å¢ƒè·¯å¾„æ­£ç¡®
- æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—

### è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥ä»Šæ—¥æ˜¯å¦æœ‰åè¯
python manage.py shell -c "from knowledge_app.models import DailyTerm; print(DailyTerm.get_today_term())"

# æŸ¥çœ‹æœ€è¿‘çš„åè¯
python manage.py shell -c "from knowledge_app.models import DailyTerm; [print(f'{t.display_date}: {t.term}') for t in DailyTerm.objects.filter(status='active')[:5]]"

# æµ‹è¯•APIè¿æ¥
python manage.py shell -c "from knowledge_app.services.daily_term_service import KimiAPIClient; client = KimiAPIClient(); print(client.get_computer_term())"
```

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### å…³é”®æŒ‡æ ‡
- **ç”ŸæˆæˆåŠŸç‡**ï¼šæ¯æ—¥åè¯ç”Ÿæˆçš„æˆåŠŸç‡
- **APIå“åº”æ—¶é—´**ï¼šKimi APIçš„å¹³å‡å“åº”æ—¶é—´
- **ç”¨æˆ·å‚ä¸åº¦**ï¼šæµè§ˆé‡ã€ç‚¹èµæ•°ç»Ÿè®¡
- **å†…å®¹è´¨é‡**ï¼šåè¯é‡å¤ç‡ã€è§£é‡Šé•¿åº¦åˆ†å¸ƒ

### ç›‘æ§è„šæœ¬
```python
# åˆ›å»ºç›‘æ§è„šæœ¬ monitor_daily_term.py
from knowledge_app.models import DailyTerm, TermHistory
from datetime import date, timedelta

def check_system_health():
    today = date.today()
    
    # æ£€æŸ¥ä»Šæ—¥åè¯
    today_term = DailyTerm.get_today_term()
    print(f"ä»Šæ—¥åè¯: {'âœ…' if today_term else 'âŒ'}")
    
    # æ£€æŸ¥æœ€è¿‘7å¤©çš„ç”Ÿæˆæƒ…å†µ
    recent_days = [(today - timedelta(days=i)) for i in range(7)]
    generated_days = DailyTerm.objects.filter(
        display_date__in=recent_days,
        status='active'
    ).count()
    print(f"æœ€è¿‘7å¤©ç”Ÿæˆç‡: {generated_days}/7 ({generated_days/7*100:.1f}%)")
    
    # æ£€æŸ¥é‡å¤ç‡
    total_terms = TermHistory.objects.count()
    unique_terms = TermHistory.objects.values('term_lower').distinct().count()
    print(f"åè¯å»é‡ç‡: {unique_terms}/{total_terms} ({unique_terms/total_terms*100:.1f}%)")

if __name__ == '__main__':
    check_system_health()
```

## ğŸš€ æ‰©å±•åŠŸèƒ½

### è®¡åˆ’ä¸­çš„åŠŸèƒ½
1. **å¤šè¯­è¨€æ”¯æŒ**ï¼šè‹±æ–‡åè¯è§£é‡Š
2. **éš¾åº¦è‡ªé€‚åº”**ï¼šæ ¹æ®ç”¨æˆ·æ°´å¹³è°ƒæ•´åè¯éš¾åº¦
3. **ä¸ªæ€§åŒ–æ¨è**ï¼šåŸºäºç”¨æˆ·å…´è¶£æ¨èç›¸å…³åè¯
4. **ç¤¾äº¤åŠŸèƒ½**ï¼šç”¨æˆ·è¯„è®ºã€è®¨è®º
5. **å­¦ä¹ ç»Ÿè®¡**ï¼šä¸ªäººå­¦ä¹ è¿›åº¦è·Ÿè¸ª

### é›†æˆå»ºè®®
- **ä¸ç»ƒä¹ é¢˜ç³»ç»Ÿé›†æˆ**ï¼šä¸ºæ¯ä¸ªåè¯ç”Ÿæˆç›¸å…³ç»ƒä¹ é¢˜
- **ä¸æœç´¢ç³»ç»Ÿé›†æˆ**ï¼šå°†æ¯æ—¥åè¯åŠ å…¥æœç´¢ç´¢å¼•
- **ä¸ç”¨æˆ·ç³»ç»Ÿé›†æˆ**ï¼šè®°å½•ç”¨æˆ·å­¦ä¹ å†å²

## ğŸ“ ç»´æŠ¤å»ºè®®

1. **å®šæœŸå¤‡ä»½**ï¼šæ¯å‘¨å¤‡ä»½åè¯æ•°æ®
2. **æ€§èƒ½ä¼˜åŒ–**ï¼šå®šæœŸæ¸…ç†è¿‡æœŸçš„æœç´¢è®°å½•
3. **å†…å®¹å®¡æ ¸**ï¼šå®šæœŸæ£€æŸ¥ç”Ÿæˆå†…å®¹çš„è´¨é‡
4. **ç”¨æˆ·åé¦ˆ**ï¼šæ”¶é›†ç”¨æˆ·å¯¹åè¯è§£é‡Šçš„åé¦ˆ
5. **APIç›‘æ§**ï¼šç›‘æ§APIä½¿ç”¨é‡å’Œæˆæœ¬

## ğŸ‰ éƒ¨ç½²å®Œæˆ

ç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²ï¼ç°åœ¨æ‚¨å¯ä»¥ï¼š
- âœ… è®¿é—® `/daily-term/` æŸ¥çœ‹æ¯æ—¥åè¯
- âœ… åœ¨ç®¡ç†åå°ç®¡ç†åè¯å†…å®¹
- âœ… è®¾ç½®å®šæ—¶ä»»åŠ¡è‡ªåŠ¨ç”Ÿæˆ
- âœ… ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ“
